(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();/*!
  Archilogic Floor Plan Engine SDK v5.0.0-beta.0 webgl build nightly-221026-205413-f0b610

  Copyright (c) 2022 Archilogic AG. All rights reserved.

  License: According to your license agreement with Archilogic AG
*/var Sl=Object.defineProperty,Al=Object.defineProperties,Ol=Object.getOwnPropertyDescriptors,Xo=Object.getOwnPropertySymbols,Ll=Object.prototype.hasOwnProperty,Nl=Object.prototype.propertyIsEnumerable,Yo=(e,t,i)=>t in e?Sl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Rl=(e,t)=>{for(var i in t||(t={}))Ll.call(t,i)&&Yo(e,i,t[i]);if(Xo)for(var i of Xo(t))Nl.call(t,i)&&Yo(e,i,t[i]);return e},Ml=(e,t)=>Al(e,Ol(t));const bn=3.28084,Pn=(e,t=1/64)=>{const i=1/t;return Math.round(e*i)/i};function Go(e){return Math.sign(e)*Math.floor(Math.abs(e))}function Dl(e){const t=e*bn,i=Math.abs(t),r=Pn(i%1*12);return{feet:Go(i),inches:Go(r),fraction:Pn(r%1),isNegative:Math.sign(e)<0}}function Fl(e){return e*bn*bn}const si="\xA0",ai={meters:"m",feet:"\u2032",inches:"\u2033",squareMeters:"m\xB2",squareFeet:"ft\xB2",fraction:"/"};function Ha(e,t=1/2,i=1/64){return!(e%t)||t<=i?[e/t,1/t]:Ha(e,t/2)}const fi=(e=0,t="metric",i=3)=>{if(t==="imperial"){const{feet:n,inches:o,fraction:s,isNegative:a}=Dl(e);let h="";if(s>0){const[l,u]=Ha(Pn(s));h=`${si}${l}/${u}`}return`${a?"-":""}${n}${ai.feet}${si}${o}${h}${ai.inches}`}const r=Math.pow(10,i);return`${Math.round(e*r)/r}${si}${ai.meters}`},Wa=(e=0,t="metric",i=0,r=!0)=>{let n="",o="";const s=Math.pow(10,i);if(t==="imperial"){const a=Fl(e);n=`${Math.round(a*s)/s}`,o=`${si}${ai.squareFeet}`}else n=`${Math.round(e*s)/s}`,o=`${si}${ai.squareMeters}`;return r&&(n+=o),n};function Bl(e){return e.replace(/([A-Z])/g,t=>` ${t}`).replace(/^./,t=>t.toUpperCase()).trim()}function kl(e){return e.slice(0,1)==="#"&&(e=e.slice(1)),e}function za(e){const t=kl(e);return t.length===3?`#${t.split("").map(i=>i+i).join("")}`:e}function Fr(e){return e>=0&&e<=255}function Ul({r:e,g:t,b:i}){return Fr(e)&&Fr(t)&&Fr(i)}function Xl(e){const t=za(e),i={r:parseInt(t.substring(1,3),16),g:parseInt(t.substring(3,5),16),b:parseInt(t.substring(5,7),16)};if(Ul(i))return i;throw"invalid hex color input"}function Yl(e){return za(e).match(/^#[a-f0-9]{6}$/i)!==null}function He(e){return JSON.parse(JSON.stringify(e))}function ja(...e){let t={};for(const i of e)if(i instanceof Array)t instanceof Array||(t=[]),t=[...t,...i];else if(i instanceof Object)for(const r of Object.entries(i)){const n=r[0];let o=r[1];o instanceof Object&&n in t&&(o=ja(t[n],o)),t=Ml(Rl({},t),{[n]:o})}return t}function Ve(){return typeof window<"u"&&typeof navigator<"u"&&typeof document<"u"}function Gl(){return Ve()&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function Hl(){return Ve()?/iPad|iPhone|iPod/.test(navigator.platform)?!0:!!(navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)):!1}function Wl(){return!!(Ve()&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform))}function zl(){return Ve()&&navigator.platform.toUpperCase().indexOf("MAC")>=0}function jl(){return!Ve()||window.self===window.top?!1:!!(window.location.ancestorOrigins&&window.location.ancestorOrigins[0]||document.referrer)}function Vl(){return Ve()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}Hl(),Wl(),Gl(),jl(),Vl(),zl();var Wt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ql(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Zl(e){var t=e.default;if(typeof t=="function"){var i=function(){return t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(i,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}),i}var Va={},rr={},nr={};Object.defineProperty(nr,"__esModule",{value:!0}),nr.default=Kl;var Ho=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),$l=new Uint8Array(16);function Kl(){if(!Ho)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ho($l)}var We={};Object.defineProperty(We,"__esModule",{value:!0}),We.default=void 0;for(var qa=[],Ri=0;Ri<256;++Ri)qa[Ri]=(Ri+256).toString(16).substr(1);function Jl(e,t){var i=t||0,r=qa;return[r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]]].join("")}var Ql=Jl;We.default=Ql,Object.defineProperty(rr,"__esModule",{value:!0}),rr.default=void 0;var tu=Za(nr),eu=Za(We);function Za(e){return e&&e.__esModule?e:{default:e}}var Wo,Br,kr=0,Ur=0;function iu(e,t,i){var r=t&&i||0,n=t||[];e=e||{};var o=e.node||Wo,s=e.clockseq!==void 0?e.clockseq:Br;if(o==null||s==null){var a=e.random||(e.rng||tu.default)();o==null&&(o=Wo=[a[0]|1,a[1],a[2],a[3],a[4],a[5]]),s==null&&(s=Br=(a[6]<<8|a[7])&16383)}var h=e.msecs!==void 0?e.msecs:new Date().getTime(),l=e.nsecs!==void 0?e.nsecs:Ur+1,u=h-kr+(l-Ur)/1e4;if(u<0&&e.clockseq===void 0&&(s=s+1&16383),(u<0||h>kr)&&e.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");kr=h,Ur=l,Br=s,h+=122192928e5;var c=((h&268435455)*1e4+l)%4294967296;n[r++]=c>>>24&255,n[r++]=c>>>16&255,n[r++]=c>>>8&255,n[r++]=c&255;var d=h/4294967296*1e4&268435455;n[r++]=d>>>8&255,n[r++]=d&255,n[r++]=d>>>24&15|16,n[r++]=d>>>16&255,n[r++]=s>>>8|128,n[r++]=s&255;for(var f=0;f<6;++f)n[r+f]=o[f];return t||(0,eu.default)(n)}var ru=iu;rr.default=ru;var or={},ie={};Object.defineProperty(ie,"__esModule",{value:!0}),ie.default=hu,ie.URL=ie.DNS=void 0;var nu=ou(We);function ou(e){return e&&e.__esModule?e:{default:e}}function su(e){var t=[];return e.replace(/[a-fA-F0-9]{2}/g,function(i){t.push(parseInt(i,16))}),t}function au(e){e=unescape(encodeURIComponent(e));for(var t=new Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}const $a="6ba7b810-9dad-11d1-80b4-00c04fd430c8";ie.DNS=$a;const Ka="6ba7b811-9dad-11d1-80b4-00c04fd430c8";ie.URL=Ka;function hu(e,t,i){var r=function(n,o,s,a){var h=s&&a||0;if(typeof n=="string"&&(n=au(n)),typeof o=="string"&&(o=su(o)),!Array.isArray(n))throw TypeError("value must be an array of bytes");if(!Array.isArray(o)||o.length!==16)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var l=i(o.concat(n));if(l[6]=l[6]&15|t,l[8]=l[8]&63|128,s)for(var u=0;u<16;++u)s[h+u]=l[u];return s||(0,nu.default)(l)};try{r.name=e}catch{}return r.DNS=$a,r.URL=Ka,r}var sr={};Object.defineProperty(sr,"__esModule",{value:!0}),sr.default=void 0;function lu(e){if(typeof e=="string"){var t=unescape(encodeURIComponent(e));e=new Array(t.length);for(var i=0;i<t.length;i++)e[i]=t.charCodeAt(i)}return uu(cu(pu(e),e.length*8))}function uu(e){var t,i,r=[],n=e.length*32,o="0123456789abcdef",s;for(t=0;t<n;t+=8)i=e[t>>5]>>>t%32&255,s=parseInt(o.charAt(i>>>4&15)+o.charAt(i&15),16),r.push(s);return r}function cu(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;var i,r,n,o,s,a=1732584193,h=-271733879,l=-1732584194,u=271733878;for(i=0;i<e.length;i+=16)r=a,n=h,o=l,s=u,a=nt(a,h,l,u,e[i],7,-680876936),u=nt(u,a,h,l,e[i+1],12,-389564586),l=nt(l,u,a,h,e[i+2],17,606105819),h=nt(h,l,u,a,e[i+3],22,-1044525330),a=nt(a,h,l,u,e[i+4],7,-176418897),u=nt(u,a,h,l,e[i+5],12,1200080426),l=nt(l,u,a,h,e[i+6],17,-1473231341),h=nt(h,l,u,a,e[i+7],22,-45705983),a=nt(a,h,l,u,e[i+8],7,1770035416),u=nt(u,a,h,l,e[i+9],12,-1958414417),l=nt(l,u,a,h,e[i+10],17,-42063),h=nt(h,l,u,a,e[i+11],22,-1990404162),a=nt(a,h,l,u,e[i+12],7,1804603682),u=nt(u,a,h,l,e[i+13],12,-40341101),l=nt(l,u,a,h,e[i+14],17,-1502002290),h=nt(h,l,u,a,e[i+15],22,1236535329),a=ot(a,h,l,u,e[i+1],5,-165796510),u=ot(u,a,h,l,e[i+6],9,-1069501632),l=ot(l,u,a,h,e[i+11],14,643717713),h=ot(h,l,u,a,e[i],20,-373897302),a=ot(a,h,l,u,e[i+5],5,-701558691),u=ot(u,a,h,l,e[i+10],9,38016083),l=ot(l,u,a,h,e[i+15],14,-660478335),h=ot(h,l,u,a,e[i+4],20,-405537848),a=ot(a,h,l,u,e[i+9],5,568446438),u=ot(u,a,h,l,e[i+14],9,-1019803690),l=ot(l,u,a,h,e[i+3],14,-187363961),h=ot(h,l,u,a,e[i+8],20,1163531501),a=ot(a,h,l,u,e[i+13],5,-1444681467),u=ot(u,a,h,l,e[i+2],9,-51403784),l=ot(l,u,a,h,e[i+7],14,1735328473),h=ot(h,l,u,a,e[i+12],20,-1926607734),a=st(a,h,l,u,e[i+5],4,-378558),u=st(u,a,h,l,e[i+8],11,-2022574463),l=st(l,u,a,h,e[i+11],16,1839030562),h=st(h,l,u,a,e[i+14],23,-35309556),a=st(a,h,l,u,e[i+1],4,-1530992060),u=st(u,a,h,l,e[i+4],11,1272893353),l=st(l,u,a,h,e[i+7],16,-155497632),h=st(h,l,u,a,e[i+10],23,-1094730640),a=st(a,h,l,u,e[i+13],4,681279174),u=st(u,a,h,l,e[i],11,-358537222),l=st(l,u,a,h,e[i+3],16,-722521979),h=st(h,l,u,a,e[i+6],23,76029189),a=st(a,h,l,u,e[i+9],4,-640364487),u=st(u,a,h,l,e[i+12],11,-421815835),l=st(l,u,a,h,e[i+15],16,530742520),h=st(h,l,u,a,e[i+2],23,-995338651),a=at(a,h,l,u,e[i],6,-198630844),u=at(u,a,h,l,e[i+7],10,1126891415),l=at(l,u,a,h,e[i+14],15,-1416354905),h=at(h,l,u,a,e[i+5],21,-57434055),a=at(a,h,l,u,e[i+12],6,1700485571),u=at(u,a,h,l,e[i+3],10,-1894986606),l=at(l,u,a,h,e[i+10],15,-1051523),h=at(h,l,u,a,e[i+1],21,-2054922799),a=at(a,h,l,u,e[i+8],6,1873313359),u=at(u,a,h,l,e[i+15],10,-30611744),l=at(l,u,a,h,e[i+6],15,-1560198380),h=at(h,l,u,a,e[i+13],21,1309151649),a=at(a,h,l,u,e[i+4],6,-145523070),u=at(u,a,h,l,e[i+11],10,-1120210379),l=at(l,u,a,h,e[i+2],15,718787259),h=at(h,l,u,a,e[i+9],21,-343485551),a=re(a,r),h=re(h,n),l=re(l,o),u=re(u,s);return[a,h,l,u]}function pu(e){var t,i=[];for(i[(e.length>>2)-1]=void 0,t=0;t<i.length;t+=1)i[t]=0;var r=e.length*8;for(t=0;t<r;t+=8)i[t>>5]|=(e[t/8]&255)<<t%32;return i}function re(e,t){var i=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(i>>16);return r<<16|i&65535}function du(e,t){return e<<t|e>>>32-t}function Er(e,t,i,r,n,o){return re(du(re(re(t,e),re(r,o)),n),i)}function nt(e,t,i,r,n,o,s){return Er(t&i|~t&r,e,t,n,o,s)}function ot(e,t,i,r,n,o,s){return Er(t&r|i&~r,e,t,n,o,s)}function st(e,t,i,r,n,o,s){return Er(t^i^r,e,t,n,o,s)}function at(e,t,i,r,n,o,s){return Er(i^(t|~r),e,t,n,o,s)}var fu=lu;sr.default=fu,Object.defineProperty(or,"__esModule",{value:!0}),or.default=void 0;var mu=Ja(ie),yu=Ja(sr);function Ja(e){return e&&e.__esModule?e:{default:e}}const vu=(0,mu.default)("v3",48,yu.default);var gu=vu;or.default=gu;var ar={};Object.defineProperty(ar,"__esModule",{value:!0}),ar.default=void 0;var _u=Qa(nr),xu=Qa(We);function Qa(e){return e&&e.__esModule?e:{default:e}}function bu(e,t,i){var r=t&&i||0;typeof e=="string"&&(t=e==="binary"?new Array(16):null,e=null),e=e||{};var n=e.random||(e.rng||_u.default)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t)for(var o=0;o<16;++o)t[r+o]=n[o];return t||(0,xu.default)(n)}var Pu=bu;ar.default=Pu;var hr={},lr={};Object.defineProperty(lr,"__esModule",{value:!0}),lr.default=void 0;function Eu(e,t,i,r){switch(e){case 0:return t&i^~t&r;case 1:return t^i^r;case 2:return t&i^t&r^i&r;case 3:return t^i^r}}function Xr(e,t){return e<<t|e>>>32-t}function wu(e){var t=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof e=="string"){var r=unescape(encodeURIComponent(e));e=new Array(r.length);for(var n=0;n<r.length;n++)e[n]=r.charCodeAt(n)}e.push(128);for(var o=e.length/4+2,s=Math.ceil(o/16),a=new Array(s),n=0;n<s;n++){a[n]=new Array(16);for(var h=0;h<16;h++)a[n][h]=e[n*64+h*4]<<24|e[n*64+h*4+1]<<16|e[n*64+h*4+2]<<8|e[n*64+h*4+3]}a[s-1][14]=(e.length-1)*8/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=(e.length-1)*8&4294967295;for(var n=0;n<s;n++){for(var l=new Array(80),u=0;u<16;u++)l[u]=a[n][u];for(var u=16;u<80;u++)l[u]=Xr(l[u-3]^l[u-8]^l[u-14]^l[u-16],1);for(var c=i[0],d=i[1],f=i[2],m=i[3],v=i[4],u=0;u<80;u++){var y=Math.floor(u/20),g=Xr(c,5)+Eu(y,d,f,m)+v+t[y]+l[u]>>>0;v=m,m=f,f=Xr(d,30)>>>0,d=c,c=g}i[0]=i[0]+c>>>0,i[1]=i[1]+d>>>0,i[2]=i[2]+f>>>0,i[3]=i[3]+m>>>0,i[4]=i[4]+v>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,i[0]&255,i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,i[1]&255,i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,i[2]&255,i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,i[3]&255,i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,i[4]&255]}var Tu=wu;lr.default=Tu,Object.defineProperty(hr,"__esModule",{value:!0}),hr.default=void 0;var Iu=th(ie),Cu=th(lr);function th(e){return e&&e.__esModule?e:{default:e}}const Su=(0,Iu.default)("v5",80,Cu.default);var Au=Su;hr.default=Au,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"v1",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"v3",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"v4",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"v5",{enumerable:!0,get:function(){return n.default}});var t=o(rr),i=o(or),r=o(ar),n=o(hr);function o(s){return s&&s.__esModule?s:{default:s}}}(Va);var ur=ql(Va);ur.v1,ur.v3;const be=ur.v4;ur.v5;/*!
* @pixi/constants - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/constants is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/var jt;(function(e){e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2"})(jt||(jt={}));var ze;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WEBGL=1]="WEBGL",e[e.CANVAS=2]="CANVAS"})(ze||(ze={}));var cr;(function(e){e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL"})(cr||(cr={}));var w;(function(e){e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR"})(w||(w={}));var zt;(function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(zt||(zt={}));var L;(function(e){e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(L||(L={}));var _e;(function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(_e||(_e={}));var U;(function(e){e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT"})(U||(U={}));var pr;(function(e){e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT"})(pr||(pr={}));var ct;(function(e){e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR"})(ct||(ct={}));var mi;(function(e){e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(mi||(mi={}));var Pe;(function(e){e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL"})(Pe||(Pe={}));var ae;(function(e){e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"})(ae||(ae={}));var Qt;(function(e){e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT"})(Qt||(Qt={}));var En;(function(e){e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL"})(En||(En={}));var At;(function(e){e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp"})(At||(At={}));var ht;(function(e){e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE"})(ht||(ht={}));var Q;(function(e){e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH"})(Q||(Q={}));var Ot;(function(e){e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"})(Ot||(Ot={}));var Yr=/iPhone/i,zo=/iPod/i,jo=/iPad/i,Vo=/\biOS-universal(?:.+)Mac\b/i,Gr=/\bAndroid(?:.+)Mobile\b/i,qo=/Android/i,Re=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Mi=/Silk/i,Ut=/Windows Phone/i,Zo=/\bWindows(?:.+)ARM\b/i,$o=/BlackBerry/i,Ko=/BB10/i,Jo=/Opera Mini/i,Qo=/\b(CriOS|Chrome)(?:.+)Mobile/i,ts=/Mobile(?:.+)Firefox\b/i,es=function(e){return typeof e<"u"&&e.platform==="MacIntel"&&typeof e.maxTouchPoints=="number"&&e.maxTouchPoints>1&&typeof MSStream>"u"};function Ou(e){return function(t){return t.test(e)}}function Lu(e){var t={userAgent:"",platform:"",maxTouchPoints:0};!e&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof e=="string"?t.userAgent=e:e&&e.userAgent&&(t={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0});var i=t.userAgent,r=i.split("[FBAN");typeof r[1]<"u"&&(i=r[0]),r=i.split("Twitter"),typeof r[1]<"u"&&(i=r[0]);var n=Ou(i),o={apple:{phone:n(Yr)&&!n(Ut),ipod:n(zo),tablet:!n(Yr)&&(n(jo)||es(t))&&!n(Ut),universal:n(Vo),device:(n(Yr)||n(zo)||n(jo)||n(Vo)||es(t))&&!n(Ut)},amazon:{phone:n(Re),tablet:!n(Re)&&n(Mi),device:n(Re)||n(Mi)},android:{phone:!n(Ut)&&n(Re)||!n(Ut)&&n(Gr),tablet:!n(Ut)&&!n(Re)&&!n(Gr)&&(n(Mi)||n(qo)),device:!n(Ut)&&(n(Re)||n(Mi)||n(Gr)||n(qo))||n(/\bokhttp\b/i)},windows:{phone:n(Ut),tablet:n(Zo),device:n(Ut)||n(Zo)},other:{blackberry:n($o),blackberry10:n(Ko),opera:n(Jo),firefox:n(ts),chrome:n(Qo),device:n($o)||n(Ko)||n(Jo)||n(ts)||n(Qo)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}/*!
* @pixi/settings - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/settings is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/var ne=Lu(self.navigator);function Nu(e){var t=!0;if(ne.tablet||ne.phone){if(ne.apple.device){var i=navigator.userAgent.match(/OS (\d+)_(\d+)?/);if(i){var r=parseInt(i[1],10);r<11&&(t=!1)}}if(ne.android.device){var i=navigator.userAgent.match(/Android\s([0-9.]*)/);if(i){var r=parseInt(i[1],10);r<7&&(t=!1)}}}return t?e:4}function Ru(){return!ne.apple.device}/*!
* @pixi/constants - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/constants is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/var is;(function(e){e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2"})(is||(is={}));var rs;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WEBGL=1]="WEBGL",e[e.CANVAS=2]="CANVAS"})(rs||(rs={}));var ns;(function(e){e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL"})(ns||(ns={}));var os;(function(e){e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR"})(os||(os={}));var ss;(function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(ss||(ss={}));var as;(function(e){e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(as||(as={}));var hs;(function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(hs||(hs={}));var ls;(function(e){e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT"})(ls||(ls={}));var us;(function(e){e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT"})(us||(us={}));var wn;(function(e){e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR"})(wn||(wn={}));var Tn;(function(e){e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(Tn||(Tn={}));var In;(function(e){e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL"})(In||(In={}));var cs;(function(e){e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"})(cs||(cs={}));var ps;(function(e){e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT"})(ps||(ps={}));var Cn;(function(e){e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL"})(Cn||(Cn={}));var hi;(function(e){e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp"})(hi||(hi={}));var ds;(function(e){e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE"})(ds||(ds={}));var Sn;(function(e){e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH"})(Sn||(Sn={}));var fs;(function(e){e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"})(fs||(fs={}));var F={MIPMAP_TEXTURES:In.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:Sn.NONE,SPRITE_MAX_TEXTURES:Nu(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:Cn.AUTO,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:Tn.CLAMP,SCALE_MODE:wn.LINEAR,PRECISION_VERTEX:hi.HIGH,PRECISION_FRAGMENT:ne.apple.device?hi.HIGH:hi.MEDIUM,CAN_UPLOAD_SAME_BUFFER:Ru(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};/*!
* @pixi/ticker - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/ticker is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/F.TARGET_FPMS=.06;var Ee;(function(e){e[e.INTERACTION=50]="INTERACTION",e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY"})(Ee||(Ee={}));var Hr=function(){function e(t,i,r,n){i===void 0&&(i=null),r===void 0&&(r=0),n===void 0&&(n=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=i,this.priority=r,this.once=n}return e.prototype.match=function(t,i){return i===void 0&&(i=null),this.fn===t&&this.context===i},e.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var i=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),i},e.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},e.prototype.destroy=function(t){t===void 0&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var i=this.next;return this.next=t?null:i,this.previous=null,i},e}(),dt=function(){function e(){var t=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Hr(null,null,1/0),this.deltaMS=1/F.TARGET_FPMS,this.elapsedMS=1/F.TARGET_FPMS,this._tick=function(i){t._requestId=null,t.started&&(t.update(i),t.started&&t._requestId===null&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return e.prototype._requestIfNeeded=function(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},e.prototype._cancelIfNeeded=function(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)},e.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},e.prototype.add=function(t,i,r){return r===void 0&&(r=Ee.NORMAL),this._addListener(new Hr(t,i,r))},e.prototype.addOnce=function(t,i,r){return r===void 0&&(r=Ee.NORMAL),this._addListener(new Hr(t,i,r,!0))},e.prototype._addListener=function(t){var i=this._head.next,r=this._head;if(!i)t.connect(r);else{for(;i;){if(t.priority>i.priority){t.connect(r);break}r=i,i=i.next}t.previous||t.connect(r)}return this._startIfPossible(),this},e.prototype.remove=function(t,i){for(var r=this._head.next;r;)r.match(t,i)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(e.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,i=this._head;i=i.next;)t++;return t},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},e.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},e.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},e.prototype.update=function(t){t===void 0&&(t=performance.now());var i;if(t>this.lastTime){if(i=this.elapsedMS=t-this.lastTime,i>this._maxElapsedMS&&(i=this._maxElapsedMS),i*=this.speed,this._minElapsedMS){var r=t-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=t-r%this._minElapsedMS}this.deltaMS=i,this.deltaTime=this.deltaMS*F.TARGET_FPMS;for(var n=this._head,o=n.next;o;)o=o.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(e.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var i=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,i)/1e3,F.TARGET_FPMS);this._maxElapsedMS=1/r},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(t===0)this._minElapsedMS=0;else{var i=Math.max(this.minFPS,t);this._minElapsedMS=1/(i/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(e,"shared",{get:function(){if(!e._shared){var t=e._shared=new e;t.autoStart=!0,t._protected=!0}return e._shared},enumerable:!1,configurable:!0}),Object.defineProperty(e,"system",{get:function(){if(!e._system){var t=e._system=new e;t.autoStart=!0,t._protected=!0}return e._system},enumerable:!1,configurable:!0}),e}(),eh={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,i="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(i=!1));function n(h,l,u){this.fn=h,this.context=l,this.once=u||!1}function o(h,l,u,c,d){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new n(u,c||h,d),m=i?i+l:l;return h._events[m]?h._events[m].fn?h._events[m]=[h._events[m],f]:h._events[m].push(f):(h._events[m]=f,h._eventsCount++),h}function s(h,l){--h._eventsCount===0?h._events=new r:delete h._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var h=[],l,u;if(this._eventsCount===0)return h;for(u in l=this._events)t.call(l,u)&&h.push(i?u.slice(1):u);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(l)):h},a.prototype.listeners=function(h){var l=i?i+h:h,u=this._events[l];if(!u)return[];if(u.fn)return[u.fn];for(var c=0,d=u.length,f=new Array(d);c<d;c++)f[c]=u[c].fn;return f},a.prototype.listenerCount=function(h){var l=i?i+h:h,u=this._events[l];return u?u.fn?1:u.length:0},a.prototype.emit=function(h,l,u,c,d,f){var m=i?i+h:h;if(!this._events[m])return!1;var v=this._events[m],y=arguments.length,g,x;if(v.fn){switch(v.once&&this.removeListener(h,v.fn,void 0,!0),y){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,l),!0;case 3:return v.fn.call(v.context,l,u),!0;case 4:return v.fn.call(v.context,l,u,c),!0;case 5:return v.fn.call(v.context,l,u,c,d),!0;case 6:return v.fn.call(v.context,l,u,c,d,f),!0}for(x=1,g=new Array(y-1);x<y;x++)g[x-1]=arguments[x];v.fn.apply(v.context,g)}else{var _=v.length,E;for(x=0;x<_;x++)switch(v[x].once&&this.removeListener(h,v[x].fn,void 0,!0),y){case 1:v[x].fn.call(v[x].context);break;case 2:v[x].fn.call(v[x].context,l);break;case 3:v[x].fn.call(v[x].context,l,u);break;case 4:v[x].fn.call(v[x].context,l,u,c);break;default:if(!g)for(E=1,g=new Array(y-1);E<y;E++)g[E-1]=arguments[E];v[x].fn.apply(v[x].context,g)}}return!0},a.prototype.on=function(h,l,u){return o(this,h,l,u,!1)},a.prototype.once=function(h,l,u){return o(this,h,l,u,!0)},a.prototype.removeListener=function(h,l,u,c){var d=i?i+h:h;if(!this._events[d])return this;if(!l)return s(this,d),this;var f=this._events[d];if(f.fn)f.fn===l&&(!c||f.once)&&(!u||f.context===u)&&s(this,d);else{for(var m=0,v=[],y=f.length;m<y;m++)(f[m].fn!==l||c&&!f[m].once||u&&f[m].context!==u)&&v.push(f[m]);v.length?this._events[d]=v.length===1?v[0]:v:s(this,d)}return this},a.prototype.removeAllListeners=function(h){var l;return h?(l=i?i+h:h,this._events[l]&&s(this,l)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,e.exports=a})(eh);var Le=eh.exports,yi={exports:{}};yi.exports=dr,yi.exports.default=dr;function dr(e,t,i){i=i||2;var r=t&&t.length,n=r?t[0]*i:e.length,o=ih(e,0,n,i,!0),s=[];if(!o||o.next===o.prev)return s;var a,h,l,u,c,d,f;if(r&&(o=ku(e,t,o,i)),e.length>80*i){a=l=e[0],h=u=e[1];for(var m=i;m<n;m+=i)c=e[m],d=e[m+1],c<a&&(a=c),d<h&&(h=d),c>l&&(l=c),d>u&&(u=d);f=Math.max(l-a,u-h),f=f!==0?32767/f:0}return vi(o,s,i,a,h,f,0),s}function ih(e,t,i,r,n){var o,s;if(n===Ln(e,t,i,r)>0)for(o=t;o<i;o+=r)s=ms(o,e[o],e[o+1],s);else for(o=i-r;o>=t;o-=r)s=ms(o,e[o],e[o+1],s);return s&&wr(s,s.next)&&(_i(s),s=s.next),s}function we(e,t){if(!e)return e;t||(t=e);var i=e,r;do if(r=!1,!i.steiner&&(wr(i,i.next)||Z(i.prev,i,i.next)===0)){if(_i(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function vi(e,t,i,r,n,o,s){if(e){!s&&o&&Hu(e,r,n,o);for(var a=e,h,l;e.prev!==e.next;){if(h=e.prev,l=e.next,o?Du(e,r,n,o):Mu(e)){t.push(h.i/i|0),t.push(e.i/i|0),t.push(l.i/i|0),_i(e),e=l.next,a=l.next;continue}if(e=l,e===a){s?s===1?(e=Fu(we(e),t,i),vi(e,t,i,r,n,o,2)):s===2&&Bu(e,t,i,r,n,o):vi(we(e),t,i,r,n,o,1);break}}}}function Mu(e){var t=e.prev,i=e,r=e.next;if(Z(t,i,r)>=0)return!1;for(var n=t.x,o=i.x,s=r.x,a=t.y,h=i.y,l=r.y,u=n<o?n<s?n:s:o<s?o:s,c=a<h?a<l?a:l:h<l?h:l,d=n>o?n>s?n:s:o>s?o:s,f=a>h?a>l?a:l:h>l?h:l,m=r.next;m!==t;){if(m.x>=u&&m.x<=d&&m.y>=c&&m.y<=f&&ke(n,a,o,h,s,l,m.x,m.y)&&Z(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Du(e,t,i,r){var n=e.prev,o=e,s=e.next;if(Z(n,o,s)>=0)return!1;for(var a=n.x,h=o.x,l=s.x,u=n.y,c=o.y,d=s.y,f=a<h?a<l?a:l:h<l?h:l,m=u<c?u<d?u:d:c<d?c:d,v=a>h?a>l?a:l:h>l?h:l,y=u>c?u>d?u:d:c>d?c:d,g=An(f,m,t,i,r),x=An(v,y,t,i,r),_=e.prevZ,E=e.nextZ;_&&_.z>=g&&E&&E.z<=x;){if(_.x>=f&&_.x<=v&&_.y>=m&&_.y<=y&&_!==n&&_!==s&&ke(a,u,h,c,l,d,_.x,_.y)&&Z(_.prev,_,_.next)>=0||(_=_.prevZ,E.x>=f&&E.x<=v&&E.y>=m&&E.y<=y&&E!==n&&E!==s&&ke(a,u,h,c,l,d,E.x,E.y)&&Z(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;_&&_.z>=g;){if(_.x>=f&&_.x<=v&&_.y>=m&&_.y<=y&&_!==n&&_!==s&&ke(a,u,h,c,l,d,_.x,_.y)&&Z(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;E&&E.z<=x;){if(E.x>=f&&E.x<=v&&E.y>=m&&E.y<=y&&E!==n&&E!==s&&ke(a,u,h,c,l,d,E.x,E.y)&&Z(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function Fu(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!wr(n,o)&&rh(n,r,r.next,o)&&gi(n,o)&&gi(o,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(o.i/i|0),_i(r),_i(r.next),r=e=o),r=r.next}while(r!==e);return we(r)}function Bu(e,t,i,r,n,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&ju(s,a)){var h=nh(s,a);s=we(s,s.next),h=we(h,h.next),vi(s,t,i,r,n,o,0),vi(h,t,i,r,n,o,0);return}a=a.next}s=s.next}while(s!==e)}function ku(e,t,i,r){var n=[],o,s,a,h,l;for(o=0,s=t.length;o<s;o++)a=t[o]*r,h=o<s-1?t[o+1]*r:e.length,l=ih(e,a,h,r,!1),l===l.next&&(l.steiner=!0),n.push(zu(l));for(n.sort(Uu),o=0;o<n.length;o++)i=Xu(n[o],i);return i}function Uu(e,t){return e.x-t.x}function Xu(e,t){var i=Yu(e,t);if(!i)return t;var r=nh(i,e);return we(r,r.next),we(i,i.next)}function Yu(e,t){var i=t,r=e.x,n=e.y,o=-1/0,s;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){var a=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>o&&(o=a,s=i.x<i.next.x?i:i.next,a===r))return s}i=i.next}while(i!==t);if(!s)return null;var h=s,l=s.x,u=s.y,c=1/0,d;i=s;do r>=i.x&&i.x>=l&&r!==i.x&&ke(n<u?r:o,n,l,u,n<u?o:r,n,i.x,i.y)&&(d=Math.abs(n-i.y)/(r-i.x),gi(i,e)&&(d<c||d===c&&(i.x>s.x||i.x===s.x&&Gu(s,i)))&&(s=i,c=d)),i=i.next;while(i!==h);return s}function Gu(e,t){return Z(e.prev,e,t.prev)<0&&Z(t.next,e,e.next)<0}function Hu(e,t,i,r){var n=e;do n.z===0&&(n.z=An(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,Wu(n)}function Wu(e){var t,i,r,n,o,s,a,h,l=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,r=i,a=0,t=0;t<l&&(a++,r=r.nextZ,!!r);t++);for(h=l;a>0||h>0&&r;)a!==0&&(h===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,h--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,l*=2}while(s>1);return e}function An(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function zu(e){var t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function ke(e,t,i,r,n,o,s,a){return(n-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(r-a)>=(i-s)*(t-a)&&(i-s)*(o-a)>=(n-s)*(r-a)}function ju(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!Vu(e,t)&&(gi(e,t)&&gi(t,e)&&qu(e,t)&&(Z(e.prev,e,t.prev)||Z(e,t.prev,t))||wr(e,t)&&Z(e.prev,e,e.next)>0&&Z(t.prev,t,t.next)>0)}function Z(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function wr(e,t){return e.x===t.x&&e.y===t.y}function rh(e,t,i,r){var n=Fi(Z(e,t,i)),o=Fi(Z(e,t,r)),s=Fi(Z(i,r,e)),a=Fi(Z(i,r,t));return!!(n!==o&&s!==a||n===0&&Di(e,i,t)||o===0&&Di(e,r,t)||s===0&&Di(i,e,r)||a===0&&Di(i,t,r))}function Di(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Fi(e){return e>0?1:e<0?-1:0}function Vu(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&rh(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function gi(e,t){return Z(e.prev,e,e.next)<0?Z(e,t,e.next)>=0&&Z(e,e.prev,t)>=0:Z(e,t,e.prev)<0||Z(e,e.next,t)<0}function qu(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function nh(e,t){var i=new On(e.i,e.x,e.y),r=new On(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function ms(e,t,i,r){var n=new On(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function _i(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function On(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}dr.deviation=function(e,t,i,r){var n=t&&t.length,o=n?t[0]*i:e.length,s=Math.abs(Ln(e,0,o,i));if(n)for(var a=0,h=t.length;a<h;a++){var l=t[a]*i,u=a<h-1?t[a+1]*i:e.length;s-=Math.abs(Ln(e,l,u,i))}var c=0;for(a=0;a<r.length;a+=3){var d=r[a]*i,f=r[a+1]*i,m=r[a+2]*i;c+=Math.abs((e[d]-e[m])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[m+1]-e[d+1]))}return s===0&&c===0?0:Math.abs((c-s)/s)};function Ln(e,t,i,r){for(var n=0,o=t,s=i-r;o<i;o+=r)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}dr.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var s=0;s<t;s++)i.vertices.push(e[n][o][s]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i};/*! https://mths.be/punycode v1.4.1 by @mathias */var Wr=2147483647,li=36,oh=1,Nn=26,Zu=38,$u=700,Ku=72,Ju=128,Qu="-",tc=/[^\x20-\x7E]/,ec=/[\x2E\u3002\uFF0E\uFF61]/g,ic={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},zr=li-oh,Ue=Math.floor,jr=String.fromCharCode;function ys(e){throw new RangeError(ic[e])}function rc(e,t){for(var i=e.length,r=[];i--;)r[i]=t(e[i]);return r}function nc(e,t){var i=e.split("@"),r="";i.length>1&&(r=i[0]+"@",e=i[1]),e=e.replace(ec,".");var n=e.split("."),o=rc(n,t).join(".");return r+o}function oc(e){for(var t=[],i=0,r=e.length,n,o;i<r;)n=e.charCodeAt(i++),n>=55296&&n<=56319&&i<r?(o=e.charCodeAt(i++),(o&64512)==56320?t.push(((n&1023)<<10)+(o&1023)+65536):(t.push(n),i--)):t.push(n);return t}function vs(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function sc(e,t,i){var r=0;for(e=i?Ue(e/$u):e>>1,e+=Ue(e/t);e>zr*Nn>>1;r+=li)e=Ue(e/zr);return Ue(r+(zr+1)*e/(e+Zu))}function ac(e){var t,i,r,n,o,s,a,h,l,u,c,d=[],f,m,v,y;for(e=oc(e),f=e.length,t=Ju,i=0,o=Ku,s=0;s<f;++s)c=e[s],c<128&&d.push(jr(c));for(r=n=d.length,n&&d.push(Qu);r<f;){for(a=Wr,s=0;s<f;++s)c=e[s],c>=t&&c<a&&(a=c);for(m=r+1,a-t>Ue((Wr-i)/m)&&ys("overflow"),i+=(a-t)*m,t=a,s=0;s<f;++s)if(c=e[s],c<t&&++i>Wr&&ys("overflow"),c==t){for(h=i,l=li;u=l<=o?oh:l>=o+Nn?Nn:l-o,!(h<u);l+=li)y=h-u,v=li-u,d.push(jr(vs(u+y%v,0))),h=Ue(y/v);d.push(jr(vs(h,0))),o=sc(i,m,r==n),i=0,++r}++i,++t}return d.join("")}function hc(e){return nc(e,function(t){return tc.test(t)?"xn--"+ac(t):t})}function Bi(e){return e===null}function lc(e){return e==null}function po(e){return typeof e=="string"}function sh(e){return typeof e=="object"&&e!==null}function uc(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var ah=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function $e(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}function cc(e,t,i,r){return t=t||"&",i=i||"=",e===null&&(e=void 0),typeof e=="object"?gs(pc(e),function(n){var o=encodeURIComponent($e(n))+i;return ah(e[n])?gs(e[n],function(s){return o+encodeURIComponent($e(s))}).join(t):o+encodeURIComponent($e(e[n]))}).join(t):r?encodeURIComponent($e(r))+i+encodeURIComponent($e(e)):""}function gs(e,t){if(e.map)return e.map(t);for(var i=[],r=0;r<e.length;r++)i.push(t(e[r],r));return i}var pc=Object.keys||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(i);return t};function _s(e,t,i,r){t=t||"&",i=i||"=";var n={};if(typeof e!="string"||e.length===0)return n;var o=/\+/g;e=e.split(t);var s=1e3;r&&typeof r.maxKeys=="number"&&(s=r.maxKeys);var a=e.length;s>0&&a>s&&(a=s);for(var h=0;h<a;++h){var l=e[h].replace(o,"%20"),u=l.indexOf(i),c,d,f,m;u>=0?(c=l.substr(0,u),d=l.substr(u+1)):(c=l,d=""),f=decodeURIComponent(c),m=decodeURIComponent(d),uc(n,f)?ah(n[f])?n[f].push(m):n[f]=[n[f],m]:n[f]=m}return n}function Ht(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var dc=/^([a-z0-9.+-]+:)/i,fc=/:[0-9]*$/,mc=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,yc=["<",">",'"',"`"," ","\r",`
`,"	"],vc=["{","}","|","\\","^","`"].concat(yc),Rn=["'"].concat(vc),xs=["%","/","?",";","#"].concat(Rn),bs=["/","?","#"],gc=255,Ps=/^[+a-z0-9A-Z_-]{0,63}$/,_c=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,xc={javascript:!0,"javascript:":!0},Mn={javascript:!0,"javascript:":!0},Xe={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function fo(e,t,i){if(e&&sh(e)&&e instanceof Ht)return e;var r=new Ht;return r.parse(e,t,i),r}Ht.prototype.parse=function(e,t,i){return hh(this,e,t,i)};function hh(e,t,i,r){if(!po(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t.indexOf("?"),o=n!==-1&&n<t.indexOf("#")?"?":"#",s=t.split(o),a=/\\/g;s[0]=s[0].replace(a,"/"),t=s.join(o);var h=t;if(h=h.trim(),!r&&t.split("#").length===1){var l=mc.exec(h);if(l)return e.path=h,e.href=h,e.pathname=l[1],l[2]?(e.search=l[2],i?e.query=_s(e.search.substr(1)):e.query=e.search.substr(1)):i&&(e.search="",e.query={}),e}var u=dc.exec(h);if(u){u=u[0];var c=u.toLowerCase();e.protocol=c,h=h.substr(u.length)}if(r||u||h.match(/^\/\/[^@\/]+@[^@\/]+/)){var d=h.substr(0,2)==="//";d&&!(u&&Mn[u])&&(h=h.substr(2),e.slashes=!0)}var f,m,v,y;if(!Mn[u]&&(d||u&&!Xe[u])){var g=-1;for(f=0;f<bs.length;f++)m=h.indexOf(bs[f]),m!==-1&&(g===-1||m<g)&&(g=m);var x,_;for(g===-1?_=h.lastIndexOf("@"):_=h.lastIndexOf("@",g),_!==-1&&(x=h.slice(0,_),h=h.slice(_+1),e.auth=decodeURIComponent(x)),g=-1,f=0;f<xs.length;f++)m=h.indexOf(xs[f]),m!==-1&&(g===-1||m<g)&&(g=m);g===-1&&(g=h.length),e.host=h.slice(0,g),h=h.slice(g),lh(e),e.hostname=e.hostname||"";var E=e.hostname[0]==="["&&e.hostname[e.hostname.length-1]==="]";if(!E){var b=e.hostname.split(/\./);for(f=0,v=b.length;f<v;f++){var P=b[f];if(!!P&&!P.match(Ps)){for(var S="",D=0,T=P.length;D<T;D++)P.charCodeAt(D)>127?S+="x":S+=P[D];if(!S.match(Ps)){var A=b.slice(0,f),M=b.slice(f+1),O=P.match(_c);O&&(A.push(O[1]),M.unshift(O[2])),M.length&&(h="/"+M.join(".")+h),e.hostname=A.join(".");break}}}}e.hostname.length>gc?e.hostname="":e.hostname=e.hostname.toLowerCase(),E||(e.hostname=hc(e.hostname)),y=e.port?":"+e.port:"";var R=e.hostname||"";e.host=R+y,e.href+=e.host,E&&(e.hostname=e.hostname.substr(1,e.hostname.length-2),h[0]!=="/"&&(h="/"+h))}if(!xc[c])for(f=0,v=Rn.length;f<v;f++){var H=Rn[f];if(h.indexOf(H)!==-1){var C=encodeURIComponent(H);C===H&&(C=escape(H)),h=h.split(H).join(C)}}var N=h.indexOf("#");N!==-1&&(e.hash=h.substr(N),h=h.slice(0,N));var B=h.indexOf("?");if(B!==-1?(e.search=h.substr(B),e.query=h.substr(B+1),i&&(e.query=_s(e.query)),h=h.slice(0,B)):i&&(e.search="",e.query={}),h&&(e.pathname=h),Xe[c]&&e.hostname&&!e.pathname&&(e.pathname="/"),e.pathname||e.search){y=e.pathname||"";var et=e.search||"";e.path=y+et}return e.href=mo(e),e}function bc(e){return po(e)&&(e=hh({},e)),mo(e)}function mo(e){var t=e.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var i=e.protocol||"",r=e.pathname||"",n=e.hash||"",o=!1,s="";e.host?o=t+e.host:e.hostname&&(o=t+(e.hostname.indexOf(":")===-1?e.hostname:"["+this.hostname+"]"),e.port&&(o+=":"+e.port)),e.query&&sh(e.query)&&Object.keys(e.query).length&&(s=cc(e.query));var a=e.search||s&&"?"+s||"";return i&&i.substr(-1)!==":"&&(i+=":"),e.slashes||(!i||Xe[i])&&o!==!1?(o="//"+(o||""),r&&r.charAt(0)!=="/"&&(r="/"+r)):o||(o=""),n&&n.charAt(0)!=="#"&&(n="#"+n),a&&a.charAt(0)!=="?"&&(a="?"+a),r=r.replace(/[?#]/g,function(h){return encodeURIComponent(h)}),a=a.replace("#","%23"),i+o+r+a+n}Ht.prototype.format=function(){return mo(this)};function Pc(e,t){return fo(e,!1,!0).resolve(t)}Ht.prototype.resolve=function(e){return this.resolveObject(fo(e,!1,!0)).format()},Ht.prototype.resolveObject=function(e){if(po(e)){var t=new Ht;t.parse(e,!1,!0),e=t}for(var i=new Ht,r=Object.keys(this),n=0;n<r.length;n++){var o=r[n];i[o]=this[o]}if(i.hash=e.hash,e.href==="")return i.href=i.format(),i;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),a=0;a<s.length;a++){var h=s[a];h!=="protocol"&&(i[h]=e[h])}return Xe[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}var l;if(e.protocol&&e.protocol!==i.protocol){if(!Xe[e.protocol]){for(var u=Object.keys(e),c=0;c<u.length;c++){var d=u[c];i[d]=e[d]}return i.href=i.format(),i}if(i.protocol=e.protocol,!e.host&&!Mn[e.protocol]){for(l=(e.pathname||"").split("/");l.length&&!(e.host=l.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),l[0]!==""&&l.unshift(""),l.length<2&&l.unshift(""),i.pathname=l.join("/")}else i.pathname=e.pathname;if(i.search=e.search,i.query=e.query,i.host=e.host||"",i.auth=e.auth,i.hostname=e.hostname||e.host,i.port=e.port,i.pathname||i.search){var f=i.pathname||"",m=i.search||"";i.path=f+m}return i.slashes=i.slashes||e.slashes,i.href=i.format(),i}var v=i.pathname&&i.pathname.charAt(0)==="/",y=e.host||e.pathname&&e.pathname.charAt(0)==="/",g=y||v||i.host&&e.pathname,x=g,_=i.pathname&&i.pathname.split("/")||[],E=i.protocol&&!Xe[i.protocol];l=e.pathname&&e.pathname.split("/")||[],E&&(i.hostname="",i.port=null,i.host&&(_[0]===""?_[0]=i.host:_.unshift(i.host)),i.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(l[0]===""?l[0]=e.host:l.unshift(e.host)),e.host=null),g=g&&(l[0]===""||_[0]===""));var b;if(y)i.host=e.host||e.host===""?e.host:i.host,i.hostname=e.hostname||e.hostname===""?e.hostname:i.hostname,i.search=e.search,i.query=e.query,_=l;else if(l.length)_||(_=[]),_.pop(),_=_.concat(l),i.search=e.search,i.query=e.query;else if(!lc(e.search))return E&&(i.hostname=i.host=_.shift(),b=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1,b&&(i.auth=b.shift(),i.host=i.hostname=b.shift())),i.search=e.search,i.query=e.query,(!Bi(i.pathname)||!Bi(i.search))&&(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i;if(!_.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var P=_.slice(-1)[0],S=(i.host||e.host||_.length>1)&&(P==="."||P==="..")||P==="",D=0,T=_.length;T>=0;T--)P=_[T],P==="."?_.splice(T,1):P===".."?(_.splice(T,1),D++):D&&(_.splice(T,1),D--);if(!g&&!x)for(;D--;D)_.unshift("..");g&&_[0]!==""&&(!_[0]||_[0].charAt(0)!=="/")&&_.unshift(""),S&&_.join("/").substr(-1)!=="/"&&_.push("");var A=_[0]===""||_[0]&&_[0].charAt(0)==="/";return E&&(i.hostname=i.host=A?"":_.length?_.shift():"",b=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1,b&&(i.auth=b.shift(),i.host=i.hostname=b.shift())),g=g||i.host&&_.length,g&&!A&&_.unshift(""),_.length?i.pathname=_.join("/"):(i.pathname=null,i.path=null),(!Bi(i.pathname)||!Bi(i.search))&&(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=e.auth||i.auth,i.slashes=i.slashes||e.slashes,i.href=i.format(),i},Ht.prototype.parseHost=function(){return lh(this)};function lh(e){var t=e.host,i=fc.exec(t);i&&(i=i[0],i!==":"&&(e.port=i.substr(1)),t=t.substr(0,t.length-i.length)),t&&(e.hostname=t)}/*!
* @pixi/utils - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/utils is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/var uh={parse:fo,format:bc,resolve:Pc};F.RETINA_PREFIX=/@([0-9\.]+)x/,F.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Dn=!1,Es="6.2.2";function ch(){Dn=!0}function yo(e){var t;if(!Dn){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var i=[`
 %c %c %c PixiJS `+Es+" - \u2730 "+e+` \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 

`,"background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(t=self.console).log.apply(t,i)}else self.console&&self.console.log("PixiJS "+Es+" - "+e+" - http://www.pixijs.com/");Dn=!0}}var Vr;function ph(){return typeof Vr>"u"&&(Vr=function(){var e={stencil:!0,failIfMajorPerformanceCaveat:F.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!self.WebGLRenderingContext)return!1;var t=document.createElement("canvas"),i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),r=!!(i&&i.getContextAttributes().stencil);if(i){var n=i.getExtension("WEBGL_lose_context");n&&n.loseContext()}return i=null,r}catch{return!1}}()),Vr}var Ec="#f0f8ff",wc="#faebd7",Tc="#00ffff",Ic="#7fffd4",Cc="#f0ffff",Sc="#f5f5dc",Ac="#ffe4c4",Oc="#000000",Lc="#ffebcd",Nc="#0000ff",Rc="#8a2be2",Mc="#a52a2a",Dc="#deb887",Fc="#5f9ea0",Bc="#7fff00",kc="#d2691e",Uc="#ff7f50",Xc="#6495ed",Yc="#fff8dc",Gc="#dc143c",Hc="#00ffff",Wc="#00008b",zc="#008b8b",jc="#b8860b",Vc="#a9a9a9",qc="#006400",Zc="#a9a9a9",$c="#bdb76b",Kc="#8b008b",Jc="#556b2f",Qc="#ff8c00",tp="#9932cc",ep="#8b0000",ip="#e9967a",rp="#8fbc8f",np="#483d8b",op="#2f4f4f",sp="#2f4f4f",ap="#00ced1",hp="#9400d3",lp="#ff1493",up="#00bfff",cp="#696969",pp="#696969",dp="#1e90ff",fp="#b22222",mp="#fffaf0",yp="#228b22",vp="#ff00ff",gp="#dcdcdc",_p="#f8f8ff",xp="#daa520",bp="#ffd700",Pp="#808080",Ep="#008000",wp="#adff2f",Tp="#808080",Ip="#f0fff0",Cp="#ff69b4",Sp="#cd5c5c",Ap="#4b0082",Op="#fffff0",Lp="#f0e68c",Np="#fff0f5",Rp="#e6e6fa",Mp="#7cfc00",Dp="#fffacd",Fp="#add8e6",Bp="#f08080",kp="#e0ffff",Up="#fafad2",Xp="#d3d3d3",Yp="#90ee90",Gp="#d3d3d3",Hp="#ffb6c1",Wp="#ffa07a",zp="#20b2aa",jp="#87cefa",Vp="#778899",qp="#778899",Zp="#b0c4de",$p="#ffffe0",Kp="#00ff00",Jp="#32cd32",Qp="#faf0e6",td="#ff00ff",ed="#800000",id="#66cdaa",rd="#0000cd",nd="#ba55d3",od="#9370db",sd="#3cb371",ad="#7b68ee",hd="#00fa9a",ld="#48d1cc",ud="#c71585",cd="#191970",pd="#f5fffa",dd="#ffe4e1",fd="#ffe4b5",md="#ffdead",yd="#000080",vd="#fdf5e6",gd="#808000",_d="#6b8e23",xd="#ffa500",bd="#ff4500",Pd="#da70d6",Ed="#eee8aa",wd="#98fb98",Td="#afeeee",Id="#db7093",Cd="#ffefd5",Sd="#ffdab9",Ad="#cd853f",Od="#ffc0cb",Ld="#dda0dd",Nd="#b0e0e6",Rd="#800080",Md="#663399",Dd="#ff0000",Fd="#bc8f8f",Bd="#4169e1",kd="#8b4513",Ud="#fa8072",Xd="#f4a460",Yd="#2e8b57",Gd="#fff5ee",Hd="#a0522d",Wd="#c0c0c0",zd="#87ceeb",jd="#6a5acd",Vd="#708090",qd="#708090",Zd="#fffafa",$d="#00ff7f",Kd="#4682b4",Jd="#d2b48c",Qd="#008080",tf="#d8bfd8",ef="#ff6347",rf="#40e0d0",nf="#ee82ee",of="#f5deb3",sf="#ffffff",af="#f5f5f5",hf="#ffff00",lf="#9acd32",uf={aliceblue:Ec,antiquewhite:wc,aqua:Tc,aquamarine:Ic,azure:Cc,beige:Sc,bisque:Ac,black:Oc,blanchedalmond:Lc,blue:Nc,blueviolet:Rc,brown:Mc,burlywood:Dc,cadetblue:Fc,chartreuse:Bc,chocolate:kc,coral:Uc,cornflowerblue:Xc,cornsilk:Yc,crimson:Gc,cyan:Hc,darkblue:Wc,darkcyan:zc,darkgoldenrod:jc,darkgray:Vc,darkgreen:qc,darkgrey:Zc,darkkhaki:$c,darkmagenta:Kc,darkolivegreen:Jc,darkorange:Qc,darkorchid:tp,darkred:ep,darksalmon:ip,darkseagreen:rp,darkslateblue:np,darkslategray:op,darkslategrey:sp,darkturquoise:ap,darkviolet:hp,deeppink:lp,deepskyblue:up,dimgray:cp,dimgrey:pp,dodgerblue:dp,firebrick:fp,floralwhite:mp,forestgreen:yp,fuchsia:vp,gainsboro:gp,ghostwhite:_p,goldenrod:xp,gold:bp,gray:Pp,green:Ep,greenyellow:wp,grey:Tp,honeydew:Ip,hotpink:Cp,indianred:Sp,indigo:Ap,ivory:Op,khaki:Lp,lavenderblush:Np,lavender:Rp,lawngreen:Mp,lemonchiffon:Dp,lightblue:Fp,lightcoral:Bp,lightcyan:kp,lightgoldenrodyellow:Up,lightgray:Xp,lightgreen:Yp,lightgrey:Gp,lightpink:Hp,lightsalmon:Wp,lightseagreen:zp,lightskyblue:jp,lightslategray:Vp,lightslategrey:qp,lightsteelblue:Zp,lightyellow:$p,lime:Kp,limegreen:Jp,linen:Qp,magenta:td,maroon:ed,mediumaquamarine:id,mediumblue:rd,mediumorchid:nd,mediumpurple:od,mediumseagreen:sd,mediumslateblue:ad,mediumspringgreen:hd,mediumturquoise:ld,mediumvioletred:ud,midnightblue:cd,mintcream:pd,mistyrose:dd,moccasin:fd,navajowhite:md,navy:yd,oldlace:vd,olive:gd,olivedrab:_d,orange:xd,orangered:bd,orchid:Pd,palegoldenrod:Ed,palegreen:wd,paleturquoise:Td,palevioletred:Id,papayawhip:Cd,peachpuff:Sd,peru:Ad,pink:Od,plum:Ld,powderblue:Nd,purple:Rd,rebeccapurple:Md,red:Dd,rosybrown:Fd,royalblue:Bd,saddlebrown:kd,salmon:Ud,sandybrown:Xd,seagreen:Yd,seashell:Gd,sienna:Hd,silver:Wd,skyblue:zd,slateblue:jd,slategray:Vd,slategrey:qd,snow:Zd,springgreen:$d,steelblue:Kd,tan:Jd,teal:Qd,thistle:tf,tomato:ef,turquoise:rf,violet:nf,wheat:of,white:sf,whitesmoke:af,yellow:hf,yellowgreen:lf};function Te(e,t){return t===void 0&&(t=[]),t[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(e&255)/255,t}function Si(e){var t=e.toString(16);return t="000000".substr(0,6-t.length)+t,"#"+t}function qe(e){return typeof e=="string"&&(e=uf[e.toLowerCase()]||e,e[0]==="#"&&(e=e.substr(1))),parseInt(e,16)}function Ai(e){return(e[0]*255<<16)+(e[1]*255<<8)+(e[2]*255|0)}function cf(){for(var e=[],t=[],i=0;i<32;i++)e[i]=i,t[i]=i;e[w.NORMAL_NPM]=w.NORMAL,e[w.ADD_NPM]=w.ADD,e[w.SCREEN_NPM]=w.SCREEN,t[w.NORMAL]=w.NORMAL_NPM,t[w.ADD]=w.ADD_NPM,t[w.SCREEN]=w.SCREEN_NPM;var r=[];return r.push(t),r.push(e),r}var vo=cf();function pf(e,t){return vo[t?1:0][e]}function df(e,t,i,r){return i=i||new Float32Array(4),r||r===void 0?(i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t):(i[0]=e[0],i[1]=e[1],i[2]=e[2]),i[3]=t,i}function go(e,t){if(t===1)return(t*255<<24)+e;if(t===0)return 0;var i=e>>16&255,r=e>>8&255,n=e&255;return i=i*t+.5|0,r=r*t+.5|0,n=n*t+.5|0,(t*255<<24)+(i<<16)+(r<<8)+n}function ff(e,t,i,r){return i=i||new Float32Array(4),i[0]=(e>>16&255)/255,i[1]=(e>>8&255)/255,i[2]=(e&255)/255,(r||r===void 0)&&(i[0]*=t,i[1]*=t,i[2]*=t),i[3]=t,i}function mf(e,t){t===void 0&&(t=null);var i=e*6;if(t=t||new Uint16Array(i),t.length!==i)throw new Error("Out buffer length is incorrect, got "+t.length+" and expected "+i);for(var r=0,n=0;r<i;r+=6,n+=4)t[r+0]=n+0,t[r+1]=n+1,t[r+2]=n+2,t[r+3]=n+0,t[r+4]=n+2,t[r+5]=n+3;return t}function Tr(e){if(e.BYTES_PER_ELEMENT===4)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(e.BYTES_PER_ELEMENT===2){if(e instanceof Uint16Array)return"Uint16Array"}else if(e.BYTES_PER_ELEMENT===1&&e instanceof Uint8Array)return"Uint8Array";return null}var yf={Float32Array,Uint32Array,Int32Array,Uint8Array};function vf(e,t){for(var i=0,r=0,n={},o=0;o<e.length;o++)r+=t[o],i+=e[o].length;for(var s=new ArrayBuffer(i*4),a=null,h=0,o=0;o<e.length;o++){var l=t[o],u=e[o],c=Tr(u);n[c]||(n[c]=new yf[c](s)),a=n[c];for(var d=0;d<u.length;d++){var f=(d/l|0)*r+h,m=d%l;a[f+m]=u[d]}h+=l}return new Float32Array(s)}function xi(e){return e+=e===0?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e+1}function Fn(e){return!(e&e-1)&&!!e}function Bn(e){var t=(e>65535?1:0)<<4;e>>>=t;var i=(e>255?1:0)<<3;return e>>>=i,t|=i,i=(e>15?1:0)<<2,e>>>=i,t|=i,i=(e>3?1:0)<<1,e>>>=i,t|=i,t|e>>1}function ui(e,t,i){var r=e.length,n;if(!(t>=r||i===0)){i=t+i>r?r-t:i;var o=r-i;for(n=t;n<o;++n)e[n]=e[n+i];e.length=o}}function ve(e){return e===0?0:e<0?-1:1}var gf=0;function je(){return++gf}var ws={};function Ie(e,t,i){if(i===void 0&&(i=3),!ws[t]){var r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",t+`
Deprecated since v`+e):(r=r.split(`
`).splice(i).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",t+`
Deprecated since v`+e),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",t+`
Deprecated since v`+e),console.warn(r))),ws[t]=!0}}var kn={},mt=Object.create(null),gt=Object.create(null);function _f(){var e;for(e in mt)mt[e].destroy();for(e in gt)gt[e].destroy()}function _o(){var e;for(e in mt)delete mt[e];for(e in gt)delete gt[e]}var xo=function(){function e(t,i,r){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=r||F.RESOLUTION,this.resize(t,i)}return e.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},e.prototype.resize=function(t,i){this.canvas.width=Math.round(t*this.resolution),this.canvas.height=Math.round(i*this.resolution)},e.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(e.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=Math.round(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=Math.round(t)},enumerable:!1,configurable:!0}),e}();function dh(e){var t=e.width,i=e.height,r=e.getContext("2d"),n=r.getImageData(0,0,t,i),o=n.data,s=o.length,a={top:null,left:null,right:null,bottom:null},h=null,l,u,c;for(l=0;l<s;l+=4)o[l+3]!==0&&(u=l/4%t,c=~~(l/4/t),a.top===null&&(a.top=c),(a.left===null||u<a.left)&&(a.left=u),(a.right===null||a.right<u)&&(a.right=u+1),(a.bottom===null||a.bottom<c)&&(a.bottom=c));return a.top!==null&&(t=a.right-a.left,i=a.bottom-a.top+1,h=r.getImageData(a.left,a.top,t,i)),{height:i,width:t,data:h}}var fh=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function xf(e){var t=fh.exec(e);if(t)return{mediaType:t[1]?t[1].toLowerCase():void 0,subType:t[2]?t[2].toLowerCase():void 0,charset:t[3]?t[3].toLowerCase():void 0,encoding:t[4]?t[4].toLowerCase():void 0,data:t[5]}}var ki;function mh(e,t){if(t===void 0&&(t=self.location),e.indexOf("data:")===0)return"";t=t||self.location,ki||(ki=document.createElement("a")),ki.href=e;var i=uh.parse(ki.href),r=!i.port&&t.port===""||i.port===t.port;return i.hostname!==t.hostname||!r||i.protocol!==t.protocol?"anonymous":""}function Un(e,t){var i=F.RETINA_PREFIX.exec(e);return i?parseFloat(i[1]):t!==void 0?t:1}var bf=Object.freeze({__proto__:null,BaseTextureCache:gt,CanvasRenderTarget:xo,DATA_URI:fh,ProgramCache:kn,TextureCache:mt,clearTextureCache:_o,correctBlendMode:pf,createIndicesForQuads:mf,decomposeDataUri:xf,deprecation:Ie,destroyTextureCache:_f,determineCrossOrigin:mh,getBufferType:Tr,getResolutionOfUrl:Un,hex2rgb:Te,hex2string:Si,interleaveTypedArrays:vf,isPow2:Fn,isWebGLSupported:ph,log2:Bn,nextPow2:xi,premultiplyBlendMode:vo,premultiplyRgba:df,premultiplyTint:go,premultiplyTintToRgba:ff,removeItems:ui,rgb2hex:Ai,sayHello:yo,sign:ve,skipHello:ch,string2hex:qe,trimCanvas:dh,uid:je,url:uh,isMobile:ne,EventEmitter:Le,earcut:yi.exports});/*!
* @pixi/math - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/math is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/var fr=Math.PI*2,Pf=180/Math.PI,Ef=Math.PI/180,Y;(function(e){e[e.POLY=0]="POLY",e[e.RECT=1]="RECT",e[e.CIRC=2]="CIRC",e[e.ELIP=3]="ELIP",e[e.RREC=4]="RREC"})(Y||(Y={}));var X=function(){function e(t,i,r,n){t===void 0&&(t=0),i===void 0&&(i=0),r===void 0&&(r=0),n===void 0&&(n=0),this.x=Number(t),this.y=Number(i),this.width=Number(r),this.height=Number(n),this.type=Y.RECT}return Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(e,"EMPTY",{get:function(){return new e(0,0,0,0)},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},e.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},e.prototype.contains=function(t,i){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&i>=this.y&&i<this.y+this.height},e.prototype.pad=function(t,i){return t===void 0&&(t=0),i===void 0&&(i=t),this.x-=t,this.y-=i,this.width+=t*2,this.height+=i*2,this},e.prototype.fit=function(t){var i=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),o=Math.min(this.y+this.height,t.y+t.height);return this.x=i,this.width=Math.max(r-i,0),this.y=n,this.height=Math.max(o-n,0),this},e.prototype.ceil=function(t,i){t===void 0&&(t=1),i===void 0&&(i=.001);var r=Math.ceil((this.x+this.width-i)*t)/t,n=Math.ceil((this.y+this.height-i)*t)/t;return this.x=Math.floor((this.x+i)*t)/t,this.y=Math.floor((this.y+i)*t)/t,this.width=r-this.x,this.height=n-this.y,this},e.prototype.enlarge=function(t){var i=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),o=Math.max(this.y+this.height,t.y+t.height);return this.x=i,this.width=r-i,this.y=n,this.height=o-n,this},e.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},e}(),wf=function(){function e(t,i,r){t===void 0&&(t=0),i===void 0&&(i=0),r===void 0&&(r=0),this.x=t,this.y=i,this.radius=r,this.type=Y.CIRC}return e.prototype.clone=function(){return new e(this.x,this.y,this.radius)},e.prototype.contains=function(t,i){if(this.radius<=0)return!1;var r=this.radius*this.radius,n=this.x-t,o=this.y-i;return n*=n,o*=o,n+o<=r},e.prototype.getBounds=function(){return new X(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)},e.prototype.toString=function(){return"[@pixi/math:Circle x="+this.x+" y="+this.y+" radius="+this.radius+"]"},e}(),Tf=function(){function e(t,i,r,n){t===void 0&&(t=0),i===void 0&&(i=0),r===void 0&&(r=0),n===void 0&&(n=0),this.x=t,this.y=i,this.width=r,this.height=n,this.type=Y.ELIP}return e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.contains=function(t,i){if(this.width<=0||this.height<=0)return!1;var r=(t-this.x)/this.width,n=(i-this.y)/this.height;return r*=r,n*=n,r+n<=1},e.prototype.getBounds=function(){return new X(this.x-this.width,this.y-this.height,this.width,this.height)},e.prototype.toString=function(){return"[@pixi/math:Ellipse x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},e}(),qr=function(){function e(){for(var t=arguments,i=[],r=0;r<arguments.length;r++)i[r]=t[r];var n=Array.isArray(i[0])?i[0]:i;if(typeof n[0]!="number"){for(var o=[],s=0,a=n.length;s<a;s++)o.push(n[s].x,n[s].y);n=o}this.points=n,this.type=Y.POLY,this.closeStroke=!0}return e.prototype.clone=function(){var t=this.points.slice(),i=new e(t);return i.closeStroke=this.closeStroke,i},e.prototype.contains=function(t,i){for(var r=!1,n=this.points.length/2,o=0,s=n-1;o<n;s=o++){var a=this.points[o*2],h=this.points[o*2+1],l=this.points[s*2],u=this.points[s*2+1],c=h>i!=u>i&&t<(l-a)*((i-h)/(u-h))+a;c&&(r=!r)}return r},e.prototype.toString=function(){return"[@pixi/math:Polygon"+("closeStroke="+this.closeStroke)+("points="+this.points.reduce(function(t,i){return t+", "+i},"")+"]")},e}(),If=function(){function e(t,i,r,n,o){t===void 0&&(t=0),i===void 0&&(i=0),r===void 0&&(r=0),n===void 0&&(n=0),o===void 0&&(o=20),this.x=t,this.y=i,this.width=r,this.height=n,this.radius=o,this.type=Y.RREC}return e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height,this.radius)},e.prototype.contains=function(t,i){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&i>=this.y&&i<=this.y+this.height){var r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(i>=this.y+r&&i<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;var n=t-(this.x+r),o=i-(this.y+r),s=r*r;if(n*n+o*o<=s||(n=t-(this.x+this.width-r),n*n+o*o<=s)||(o=i-(this.y+this.height-r),n*n+o*o<=s)||(n=t-(this.x+r),n*n+o*o<=s))return!0}return!1},e.prototype.toString=function(){return"[@pixi/math:RoundedRectangle x="+this.x+" y="+this.y+("width="+this.width+" height="+this.height+" radius="+this.radius+"]")},e}(),G=function(){function e(t,i){t===void 0&&(t=0),i===void 0&&(i=0),this.x=0,this.y=0,this.x=t,this.y=i}return e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},e.prototype.copyTo=function(t){return t.set(this.x,this.y),t},e.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},e.prototype.set=function(t,i){return t===void 0&&(t=0),i===void 0&&(i=t),this.x=t,this.y=i,this},e.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},e}(),oi=function(){function e(t,i,r,n){r===void 0&&(r=0),n===void 0&&(n=0),this._x=r,this._y=n,this.cb=t,this.scope=i}return e.prototype.clone=function(t,i){return t===void 0&&(t=this.cb),i===void 0&&(i=this.scope),new e(t,i,this._x,this._y)},e.prototype.set=function(t,i){return t===void 0&&(t=0),i===void 0&&(i=t),(this._x!==t||this._y!==i)&&(this._x=t,this._y=i,this.cb.call(this.scope)),this},e.prototype.copyFrom=function(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},e.prototype.copyTo=function(t){return t.set(this._x,this._y),t},e.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},e.prototype.toString=function(){return"[@pixi/math:ObservablePoint x="+0+" y="+0+" scope="+this.scope+"]"},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),e}(),J=function(){function e(t,i,r,n,o,s){t===void 0&&(t=1),i===void 0&&(i=0),r===void 0&&(r=0),n===void 0&&(n=1),o===void 0&&(o=0),s===void 0&&(s=0),this.array=null,this.a=t,this.b=i,this.c=r,this.d=n,this.tx=o,this.ty=s}return e.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},e.prototype.set=function(t,i,r,n,o,s){return this.a=t,this.b=i,this.c=r,this.d=n,this.tx=o,this.ty=s,this},e.prototype.toArray=function(t,i){this.array||(this.array=new Float32Array(9));var r=i||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r},e.prototype.apply=function(t,i){i=i||new G;var r=t.x,n=t.y;return i.x=this.a*r+this.c*n+this.tx,i.y=this.b*r+this.d*n+this.ty,i},e.prototype.applyInverse=function(t,i){i=i||new G;var r=1/(this.a*this.d+this.c*-this.b),n=t.x,o=t.y;return i.x=this.d*r*n+-this.c*r*o+(this.ty*this.c-this.tx*this.d)*r,i.y=this.a*r*o+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,i},e.prototype.translate=function(t,i){return this.tx+=t,this.ty+=i,this},e.prototype.scale=function(t,i){return this.a*=t,this.d*=i,this.c*=t,this.b*=i,this.tx*=t,this.ty*=i,this},e.prototype.rotate=function(t){var i=Math.cos(t),r=Math.sin(t),n=this.a,o=this.c,s=this.tx;return this.a=n*i-this.b*r,this.b=n*r+this.b*i,this.c=o*i-this.d*r,this.d=o*r+this.d*i,this.tx=s*i-this.ty*r,this.ty=s*r+this.ty*i,this},e.prototype.append=function(t){var i=this.a,r=this.b,n=this.c,o=this.d;return this.a=t.a*i+t.b*n,this.b=t.a*r+t.b*o,this.c=t.c*i+t.d*n,this.d=t.c*r+t.d*o,this.tx=t.tx*i+t.ty*n+this.tx,this.ty=t.tx*r+t.ty*o+this.ty,this},e.prototype.setTransform=function(t,i,r,n,o,s,a,h,l){return this.a=Math.cos(a+l)*o,this.b=Math.sin(a+l)*o,this.c=-Math.sin(a-h)*s,this.d=Math.cos(a-h)*s,this.tx=t-(r*this.a+n*this.c),this.ty=i-(r*this.b+n*this.d),this},e.prototype.prepend=function(t){var i=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){var r=this.a,n=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=i*t.a+this.ty*t.c+t.tx,this.ty=i*t.b+this.ty*t.d+t.ty,this},e.prototype.decompose=function(t){var i=this.a,r=this.b,n=this.c,o=this.d,s=t.pivot,a=-Math.atan2(-n,o),h=Math.atan2(r,i),l=Math.abs(a+h);return l<1e-5||Math.abs(fr-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=h),t.scale.x=Math.sqrt(i*i+r*r),t.scale.y=Math.sqrt(n*n+o*o),t.position.x=this.tx+(s.x*i+s.y*n),t.position.y=this.ty+(s.x*r+s.y*o),t},e.prototype.invert=function(){var t=this.a,i=this.b,r=this.c,n=this.d,o=this.tx,s=t*n-i*r;return this.a=n/s,this.b=-i/s,this.c=-r/s,this.d=t/s,this.tx=(r*this.ty-n*o)/s,this.ty=-(t*this.ty-i*o)/s,this},e.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},e.prototype.clone=function(){var t=new e;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},e.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},e.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},e.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(e,"IDENTITY",{get:function(){return new e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"TEMP_MATRIX",{get:function(){return new e},enumerable:!1,configurable:!0}),e}(),de=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],fe=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],me=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],ye=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Xn=[],yh=[],Ui=Math.sign;function Cf(){for(var e=0;e<16;e++){var t=[];Xn.push(t);for(var i=0;i<16;i++)for(var r=Ui(de[e]*de[i]+me[e]*fe[i]),n=Ui(fe[e]*de[i]+ye[e]*fe[i]),o=Ui(de[e]*me[i]+me[e]*ye[i]),s=Ui(fe[e]*me[i]+ye[e]*ye[i]),a=0;a<16;a++)if(de[a]===r&&fe[a]===n&&me[a]===o&&ye[a]===s){t.push(a);break}}for(var e=0;e<16;e++){var h=new J;h.set(de[e],fe[e],me[e],ye[e],0,0),yh.push(h)}}Cf();var q={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(e){return de[e]},uY:function(e){return fe[e]},vX:function(e){return me[e]},vY:function(e){return ye[e]},inv:function(e){return e&8?e&15:-e&7},add:function(e,t){return Xn[e][t]},sub:function(e,t){return Xn[e][q.inv(t)]},rotate180:function(e){return e^4},isVertical:function(e){return(e&3)===2},byDirection:function(e,t){return Math.abs(e)*2<=Math.abs(t)?t>=0?q.S:q.N:Math.abs(t)*2<=Math.abs(e)?e>0?q.E:q.W:t>0?e>0?q.SE:q.SW:e>0?q.NE:q.NW},matrixAppendRotationInv:function(e,t,i,r){i===void 0&&(i=0),r===void 0&&(r=0);var n=yh[q.inv(t)];n.tx=i,n.ty=r,e.append(n)}},Sf=function(){function e(){this.worldTransform=new J,this.localTransform=new J,this.position=new oi(this.onChange,this,0,0),this.scale=new oi(this.onChange,this,1,1),this.pivot=new oi(this.onChange,this,0,0),this.skew=new oi(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return e.prototype.onChange=function(){this._localID++},e.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},e.prototype.toString=function(){return"[@pixi/math:Transform "+("position=("+this.position.x+", "+this.position.y+") ")+("rotation="+this.rotation+" ")+("scale=("+this.scale.x+", "+this.scale.y+") ")+("skew=("+this.skew.x+", "+this.skew.y+") ")+"]"},e.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},e.prototype.updateTransform=function(t){var i=this.localTransform;if(this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var r=t.worldTransform,n=this.worldTransform;n.a=i.a*r.a+i.b*r.c,n.b=i.a*r.b+i.b*r.d,n.c=i.c*r.a+i.d*r.c,n.d=i.c*r.b+i.d*r.d,n.tx=i.tx*r.a+i.ty*r.c+r.tx,n.ty=i.tx*r.b+i.ty*r.d+r.ty,this._parentID=t._worldID,this._worldID++}},e.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!1,configurable:!0}),e.IDENTITY=new e,e}();/*!
* @pixi/display - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/display is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/F.SORTABLE_CHILDREN=!1;var bi=function(){function e(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return e.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},e.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},e.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?X.EMPTY:(t=t||new X(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},e.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},e.prototype.addPointMatrix=function(t,i){var r=t.a,n=t.b,o=t.c,s=t.d,a=t.tx,h=t.ty,l=r*i.x+o*i.y+a,u=n*i.x+s*i.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)},e.prototype.addQuad=function(t){var i=this.minX,r=this.minY,n=this.maxX,o=this.maxY,s=t[0],a=t[1];i=s<i?s:i,r=a<r?a:r,n=s>n?s:n,o=a>o?a:o,s=t[2],a=t[3],i=s<i?s:i,r=a<r?a:r,n=s>n?s:n,o=a>o?a:o,s=t[4],a=t[5],i=s<i?s:i,r=a<r?a:r,n=s>n?s:n,o=a>o?a:o,s=t[6],a=t[7],i=s<i?s:i,r=a<r?a:r,n=s>n?s:n,o=a>o?a:o,this.minX=i,this.minY=r,this.maxX=n,this.maxY=o},e.prototype.addFrame=function(t,i,r,n,o){this.addFrameMatrix(t.worldTransform,i,r,n,o)},e.prototype.addFrameMatrix=function(t,i,r,n,o){var s=t.a,a=t.b,h=t.c,l=t.d,u=t.tx,c=t.ty,d=this.minX,f=this.minY,m=this.maxX,v=this.maxY,y=s*i+h*r+u,g=a*i+l*r+c;d=y<d?y:d,f=g<f?g:f,m=y>m?y:m,v=g>v?g:v,y=s*n+h*r+u,g=a*n+l*r+c,d=y<d?y:d,f=g<f?g:f,m=y>m?y:m,v=g>v?g:v,y=s*i+h*o+u,g=a*i+l*o+c,d=y<d?y:d,f=g<f?g:f,m=y>m?y:m,v=g>v?g:v,y=s*n+h*o+u,g=a*n+l*o+c,d=y<d?y:d,f=g<f?g:f,m=y>m?y:m,v=g>v?g:v,this.minX=d,this.minY=f,this.maxX=m,this.maxY=v},e.prototype.addVertexData=function(t,i,r){for(var n=this.minX,o=this.minY,s=this.maxX,a=this.maxY,h=i;h<r;h+=2){var l=t[h],u=t[h+1];n=l<n?l:n,o=u<o?u:o,s=l>s?l:s,a=u>a?u:a}this.minX=n,this.minY=o,this.maxX=s,this.maxY=a},e.prototype.addVertices=function(t,i,r,n){this.addVerticesMatrix(t.worldTransform,i,r,n)},e.prototype.addVerticesMatrix=function(t,i,r,n,o,s){o===void 0&&(o=0),s===void 0&&(s=o);for(var a=t.a,h=t.b,l=t.c,u=t.d,c=t.tx,d=t.ty,f=this.minX,m=this.minY,v=this.maxX,y=this.maxY,g=r;g<n;g+=2){var x=i[g],_=i[g+1],E=a*x+l*_+c,b=u*_+h*x+d;f=Math.min(f,E-o),v=Math.max(v,E+o),m=Math.min(m,b-s),y=Math.max(y,b+s)}this.minX=f,this.minY=m,this.maxX=v,this.maxY=y},e.prototype.addBounds=function(t){var i=this.minX,r=this.minY,n=this.maxX,o=this.maxY;this.minX=t.minX<i?t.minX:i,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>o?t.maxY:o},e.prototype.addBoundsMask=function(t,i){var r=t.minX>i.minX?t.minX:i.minX,n=t.minY>i.minY?t.minY:i.minY,o=t.maxX<i.maxX?t.maxX:i.maxX,s=t.maxY<i.maxY?t.maxY:i.maxY;if(r<=o&&n<=s){var a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=n<h?n:h,this.maxX=o>l?o:l,this.maxY=s>u?s:u}},e.prototype.addBoundsMatrix=function(t,i){this.addFrameMatrix(i,t.minX,t.minY,t.maxX,t.maxY)},e.prototype.addBoundsArea=function(t,i){var r=t.minX>i.x?t.minX:i.x,n=t.minY>i.y?t.minY:i.y,o=t.maxX<i.x+i.width?t.maxX:i.x+i.width,s=t.maxY<i.y+i.height?t.maxY:i.y+i.height;if(r<=o&&n<=s){var a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=n<h?n:h,this.maxX=o>l?o:l,this.maxY=s>u?s:u}},e.prototype.pad=function(t,i){t===void 0&&(t=0),i===void 0&&(i=t),this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=i,this.maxY+=i)},e.prototype.addFramePad=function(t,i,r,n,o,s){t-=o,i-=s,r+=o,n+=s,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<i?this.minY:i,this.maxY=this.maxY>n?this.maxY:n},e}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Yn=function(e,t){return Yn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},Yn(e,t)};function bo(e,t){Yn(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var Vt=function(e){bo(t,e);function t(){var i=e.call(this)||this;return i.tempDisplayObjectParent=null,i.transform=new Sf,i.alpha=1,i.visible=!0,i.renderable=!0,i.parent=null,i.worldAlpha=1,i._lastSortedIndex=0,i._zIndex=0,i.filterArea=null,i.filters=null,i._enabledFilters=null,i._bounds=new bi,i._localBounds=null,i._boundsID=0,i._boundsRect=null,i._localBoundsRect=null,i._mask=null,i._maskRefCount=0,i._destroyed=!1,i.isSprite=!1,i.isMask=!1,i}return t.mixin=function(i){for(var r=Object.keys(i),n=0;n<r.length;++n){var o=r[n];Object.defineProperty(t.prototype,o,Object.getOwnPropertyDescriptor(i,o))}},Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),t.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},t.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},t.prototype.getBounds=function(i,r){return i||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),r||(this._boundsRect||(this._boundsRect=new X),r=this._boundsRect),this._bounds.getRectangle(r)},t.prototype.getLocalBounds=function(i){i||(this._localBoundsRect||(this._localBoundsRect=new X),i=this._localBoundsRect),this._localBounds||(this._localBounds=new bi);var r=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var o=this._bounds,s=this._boundsID;this._bounds=this._localBounds;var a=this.getBounds(!1,i);return this.parent=n,this.transform=r,this._bounds=o,this._bounds.updateID+=this._boundsID-s,a},t.prototype.toGlobal=function(i,r,n){return n===void 0&&(n=!1),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(i,r)},t.prototype.toLocal=function(i,r,n,o){return r&&(i=r.toGlobal(i,n,o)),o||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(i,n)},t.prototype.setParent=function(i){if(!i||!i.addChild)throw new Error("setParent: Argument must be a Container");return i.addChild(this),i},t.prototype.setTransform=function(i,r,n,o,s,a,h,l,u){return i===void 0&&(i=0),r===void 0&&(r=0),n===void 0&&(n=1),o===void 0&&(o=1),s===void 0&&(s=0),a===void 0&&(a=0),h===void 0&&(h=0),l===void 0&&(l=0),u===void 0&&(u=0),this.position.x=i,this.position.y=r,this.scale.x=n||1,this.scale.y=o||1,this.rotation=s,this.skew.x=a,this.skew.y=h,this.pivot.x=l,this.pivot.y=u,this},t.prototype.destroy=function(i){this.parent&&this.parent.removeChild(this),this.emit("destroyed"),this.removeAllListeners(),this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},Object.defineProperty(t.prototype,"_tempDisplayObjectParent",{get:function(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new vh),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),t.prototype.enableTempParent=function(){var i=this.parent;return this.parent=this._tempDisplayObjectParent,i},t.prototype.disableTempParent=function(i){this.parent=i},Object.defineProperty(t.prototype,"x",{get:function(){return this.position.x},set:function(i){this.transform.position.x=i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.position.y},set:function(i){this.transform.position.y=i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.transform.position},set:function(i){this.transform.position.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.transform.scale},set:function(i){this.transform.scale.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(i){this.transform.pivot.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skew",{get:function(){return this.transform.skew},set:function(i){this.transform.skew.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(i){this.transform.rotation=i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this.transform.rotation*Pf},set:function(i){this.transform.rotation=i*Ef},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zIndex",{get:function(){return this._zIndex},set:function(i){this._zIndex=i,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldVisible",{get:function(){var i=this;do{if(!i.visible)return!1;i=i.parent}while(i);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(i){if(this._mask!==i){if(this._mask){var r=this._mask.maskObject||this._mask;r._maskRefCount--,r._maskRefCount===0&&(r.renderable=!0,r.isMask=!1)}if(this._mask=i,this._mask){var r=this._mask.maskObject||this._mask;r._maskRefCount===0&&(r.renderable=!1,r.isMask=!0),r._maskRefCount++}}},enumerable:!1,configurable:!0}),t}(Le),vh=function(e){bo(t,e);function t(){var i=e!==null&&e.apply(this,arguments)||this;return i.sortDirty=null,i}return t}(Vt);Vt.prototype.displayObjectUpdateTransform=Vt.prototype.updateTransform;/*!
* @pixi/constants - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/constants is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/var Ts;(function(e){e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2"})(Ts||(Ts={}));var Is;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WEBGL=1]="WEBGL",e[e.CANVAS=2]="CANVAS"})(Is||(Is={}));var Cs;(function(e){e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL"})(Cs||(Cs={}));var Ss;(function(e){e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR"})(Ss||(Ss={}));var As;(function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(As||(As={}));var Os;(function(e){e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(Os||(Os={}));var Ls;(function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(Ls||(Ls={}));var Ns;(function(e){e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT"})(Ns||(Ns={}));var Rs;(function(e){e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT"})(Rs||(Rs={}));var Ms;(function(e){e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR"})(Ms||(Ms={}));var Ds;(function(e){e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(Ds||(Ds={}));var Fs;(function(e){e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL"})(Fs||(Fs={}));var Bs;(function(e){e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"})(Bs||(Bs={}));var ks;(function(e){e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT"})(ks||(ks={}));var Us;(function(e){e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL"})(Us||(Us={}));var Xs;(function(e){e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp"})(Xs||(Xs={}));var Gn;(function(e){e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE"})(Gn||(Gn={}));var Ys;(function(e){e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH"})(Ys||(Ys={}));var Gs;(function(e){e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"})(Gs||(Gs={}));function Af(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}var rt=function(e){bo(t,e);function t(){var i=e.call(this)||this;return i.children=[],i.sortableChildren=F.SORTABLE_CHILDREN,i.sortDirty=!1,i}return t.prototype.onChildrenChange=function(i){},t.prototype.addChild=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];if(r.length>1)for(var o=0;o<r.length;o++)this.addChild(r[o]);else{var s=r[0];s.parent&&s.parent.removeChild(s),s.parent=this,this.sortDirty=!0,s.transform._parentID=-1,this.children.push(s),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",s,this,this.children.length-1),s.emit("added",this)}return r[0]},t.prototype.addChildAt=function(i,r){if(r<0||r>this.children.length)throw new Error(i+"addChildAt: The index "+r+" supplied is out of bounds "+this.children.length);return i.parent&&i.parent.removeChild(i),i.parent=this,this.sortDirty=!0,i.transform._parentID=-1,this.children.splice(r,0,i),this._boundsID++,this.onChildrenChange(r),i.emit("added",this),this.emit("childAdded",i,this,r),i},t.prototype.swapChildren=function(i,r){if(i!==r){var n=this.getChildIndex(i),o=this.getChildIndex(r);this.children[n]=r,this.children[o]=i,this.onChildrenChange(n<o?n:o)}},t.prototype.getChildIndex=function(i){var r=this.children.indexOf(i);if(r===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return r},t.prototype.setChildIndex=function(i,r){if(r<0||r>=this.children.length)throw new Error("The index "+r+" supplied is out of bounds "+this.children.length);var n=this.getChildIndex(i);ui(this.children,n,1),this.children.splice(r,0,i),this.onChildrenChange(r)},t.prototype.getChildAt=function(i){if(i<0||i>=this.children.length)throw new Error("getChildAt: Index ("+i+") does not exist.");return this.children[i]},t.prototype.removeChild=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];if(r.length>1)for(var o=0;o<r.length;o++)this.removeChild(r[o]);else{var s=r[0],a=this.children.indexOf(s);if(a===-1)return null;s.parent=null,s.transform._parentID=-1,ui(this.children,a,1),this._boundsID++,this.onChildrenChange(a),s.emit("removed",this),this.emit("childRemoved",s,this,a)}return r[0]},t.prototype.removeChildAt=function(i){var r=this.getChildAt(i);return r.parent=null,r.transform._parentID=-1,ui(this.children,i,1),this._boundsID++,this.onChildrenChange(i),r.emit("removed",this),this.emit("childRemoved",r,this,i),r},t.prototype.removeChildren=function(i,r){i===void 0&&(i=0),r===void 0&&(r=this.children.length);var n=i,o=r,s=o-n,a;if(s>0&&s<=o){a=this.children.splice(n,s);for(var h=0;h<a.length;++h)a[h].parent=null,a[h].transform&&(a[h].transform._parentID=-1);this._boundsID++,this.onChildrenChange(i);for(var h=0;h<a.length;++h)a[h].emit("removed",this),this.emit("childRemoved",a[h],this,h);return a}else if(s===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},t.prototype.sortChildren=function(){for(var i=!1,r=0,n=this.children.length;r<n;++r){var o=this.children[r];o._lastSortedIndex=r,!i&&o.zIndex!==0&&(i=!0)}i&&this.children.length>1&&this.children.sort(Af),this.sortDirty=!1},t.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var i=0,r=this.children.length;i<r;++i){var n=this.children[i];n.visible&&n.updateTransform()}},t.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var i=0;i<this.children.length;i++){var r=this.children[i];if(!(!r.visible||!r.renderable))if(r.calculateBounds(),r._mask){var n=r._mask.maskObject||r._mask;n.calculateBounds(),this._bounds.addBoundsMask(r._bounds,n._bounds)}else r.filterArea?this._bounds.addBoundsArea(r._bounds,r.filterArea):this._bounds.addBounds(r._bounds)}this._bounds.updateID=this._boundsID},t.prototype.getLocalBounds=function(i,r){r===void 0&&(r=!1);var n=e.prototype.getLocalBounds.call(this,i);if(!r)for(var o=0,s=this.children.length;o<s;++o){var a=this.children[o];a.visible&&a.updateTransform()}return n},t.prototype._calculateBounds=function(){},t.prototype.render=function(i){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(i);else{this._render(i);for(var r=0,n=this.children.length;r<n;++r)this.children[r].render(i)}},t.prototype.renderAdvanced=function(i){var r=this.filters,n=this._mask;if(r){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var o=0;o<r.length;o++)r[o].enabled&&this._enabledFilters.push(r[o])}var s=r&&this._enabledFilters&&this._enabledFilters.length||n&&(!n.isMaskData||n.enabled&&(n.autoDetect||n.type!==Gn.NONE));s&&i.batch.flush(),r&&this._enabledFilters&&this._enabledFilters.length&&i.filter.push(this,this._enabledFilters),n&&i.mask.push(this,this._mask),this._render(i);for(var o=0,a=this.children.length;o<a;o++)this.children[o].render(i);s&&i.batch.flush(),n&&i.mask.pop(this),r&&this._enabledFilters&&this._enabledFilters.length&&i.filter.pop()},t.prototype._render=function(i){},t.prototype.destroy=function(i){e.prototype.destroy.call(this),this.sortDirty=!1;var r=typeof i=="boolean"?i:i&&i.children,n=this.removeChildren(0,this.children.length);if(r)for(var o=0;o<n.length;++o)n[o].destroy(i)},Object.defineProperty(t.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(i){var r=this.getLocalBounds().width;r!==0?this.scale.x=i/r:this.scale.x=1,this._width=i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(i){var r=this.getLocalBounds().height;r!==0?this.scale.y=i/r:this.scale.y=1,this._height=i},enumerable:!1,configurable:!0}),t}(Vt);rt.prototype.containerUpdateTransform=rt.prototype.updateTransform;/*!
* @pixi/runner - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/runner is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/var ut=function(){function e(t){this.items=[],this._name=t,this._aliasCount=0}return e.prototype.emit=function(t,i,r,n,o,s,a,h){if(arguments.length>8)throw new Error("max arguments reached");var l=this,u=l.name,c=l.items;this._aliasCount++;for(var d=0,f=c.length;d<f;d++)c[d][u](t,i,r,n,o,s,a,h);return c===this.items&&this._aliasCount--,this},e.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},e.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},e.prototype.remove=function(t){var i=this.items.indexOf(t);return i!==-1&&(this.ensureNonAliasedItems(),this.items.splice(i,1)),this},e.prototype.contains=function(t){return this.items.indexOf(t)!==-1},e.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},e.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(e.prototype,"empty",{get:function(){return this.items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),e}();Object.defineProperties(ut.prototype,{dispatch:{value:ut.prototype.emit},run:{value:ut.prototype.emit}});/*!
* @pixi/core - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/core is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/F.PREFER_ENV=ne.any?jt.WEBGL:jt.WEBGL2,F.STRICT_TEXTURE_CACHE=!1;var Hn=[];function gh(e,t){if(!e)return null;var i="";if(typeof e=="string"){var r=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);r&&(i=r[1].toLowerCase())}for(var n=Hn.length-1;n>=0;--n){var o=Hn[n];if(o.test&&o.test(e,i))return new o(e,t)}throw new Error("Unrecognized source type to auto-detect Resource")}/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Wn=function(e,t){return Wn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},Wn(e,t)};function V(e,t){Wn(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var zn=function(){return zn=Object.assign||function(e){for(var t=arguments,i,r=1,n=arguments.length;r<n;r++){i=t[r];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},zn.apply(this,arguments)};function Of(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&(i[r[n]]=e[r[n]]);return i}var Pi=function(){function e(t,i){t===void 0&&(t=0),i===void 0&&(i=0),this._width=t,this._height=i,this.destroyed=!1,this.internal=!1,this.onResize=new ut("setRealSize"),this.onUpdate=new ut("update"),this.onError=new ut("onError")}return e.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},e.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},e.prototype.resize=function(t,i){(t!==this._width||i!==this._height)&&(this._width=t,this._height=i,this.onResize.emit(t,i))},Object.defineProperty(e.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),e.prototype.update=function(){this.destroyed||this.onUpdate.emit()},e.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e.prototype.style=function(t,i,r){return!1},e.prototype.dispose=function(){},e.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},e.test=function(t,i){return!1},e}(),Po=function(e){V(t,e);function t(i,r){var n=this,o=r||{},s=o.width,a=o.height;if(!s||!a)throw new Error("BufferResource width or height invalid");return n=e.call(this,s,a)||this,n.data=i,n}return t.prototype.upload=function(i,r,n){var o=i.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===ae.UNPACK);var s=r.realWidth,a=r.realHeight;return n.width===s&&n.height===a?o.texSubImage2D(r.target,0,0,0,s,a,r.format,n.type,this.data):(n.width=s,n.height=a,o.texImage2D(r.target,0,n.internalFormat,s,a,0,r.format,n.type,this.data)),!0},t.prototype.dispose=function(){this.data=null},t.test=function(i){return i instanceof Float32Array||i instanceof Uint8Array||i instanceof Uint32Array},t}(Pi),Lf={scaleMode:ct.NEAREST,format:L.RGBA,alphaMode:ae.NPM},W=function(e){V(t,e);function t(i,r){i===void 0&&(i=null),r===void 0&&(r=null);var n=e.call(this)||this;r=r||{};var o=r.alphaMode,s=r.mipmap,a=r.anisotropicLevel,h=r.scaleMode,l=r.width,u=r.height,c=r.wrapMode,d=r.format,f=r.type,m=r.target,v=r.resolution,y=r.resourceOptions;return i&&!(i instanceof Pi)&&(i=gh(i,y),i.internal=!0),n.resolution=v||F.RESOLUTION,n.width=Math.round((l||0)*n.resolution)/n.resolution,n.height=Math.round((u||0)*n.resolution)/n.resolution,n._mipmap=s!==void 0?s:F.MIPMAP_TEXTURES,n.anisotropicLevel=a!==void 0?a:F.ANISOTROPIC_LEVEL,n._wrapMode=c||F.WRAP_MODE,n._scaleMode=h!==void 0?h:F.SCALE_MODE,n.format=d||L.RGBA,n.type=f||U.UNSIGNED_BYTE,n.target=m||_e.TEXTURE_2D,n.alphaMode=o!==void 0?o:ae.UNPACK,n.uid=je(),n.touched=0,n.isPowerOfTwo=!1,n._refreshPOT(),n._glTextures={},n.dirtyId=0,n.dirtyStyleId=0,n.cacheId=null,n.valid=l>0&&u>0,n.textureCacheIds=[],n.destroyed=!1,n.resource=null,n._batchEnabled=0,n._batchLocation=0,n.parentTextureArray=null,n.setResource(i),n}return Object.defineProperty(t.prototype,"realWidth",{get:function(){return Math.round(this.width*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mipmap",{get:function(){return this._mipmap},set:function(i){this._mipmap!==i&&(this._mipmap=i,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(i){this._scaleMode!==i&&(this._scaleMode=i,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(i){this._wrapMode!==i&&(this._wrapMode=i,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),t.prototype.setStyle=function(i,r){var n;return i!==void 0&&i!==this.scaleMode&&(this.scaleMode=i,n=!0),r!==void 0&&r!==this.mipmap&&(this.mipmap=r,n=!0),n&&this.dirtyStyleId++,this},t.prototype.setSize=function(i,r,n){return n=n||this.resolution,this.setRealSize(i*n,r*n,n)},t.prototype.setRealSize=function(i,r,n){return this.resolution=n||this.resolution,this.width=Math.round(i)/this.resolution,this.height=Math.round(r)/this.resolution,this._refreshPOT(),this.update(),this},t.prototype._refreshPOT=function(){this.isPowerOfTwo=Fn(this.realWidth)&&Fn(this.realHeight)},t.prototype.setResolution=function(i){var r=this.resolution;return r===i?this:(this.resolution=i,this.valid&&(this.width=Math.round(this.width*r)/i,this.height=Math.round(this.height*r)/i,this.emit("update",this)),this._refreshPOT(),this)},t.prototype.setResource=function(i){if(this.resource===i)return this;if(this.resource)throw new Error("Resource can be set only once");return i.bind(this),this.resource=i,this},t.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},t.prototype.onError=function(i){this.emit("error",this,i)},t.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete gt[this.cacheId],delete mt[this.cacheId],this.cacheId=null),this.dispose(),t.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},t.prototype.dispose=function(){this.emit("dispose",this)},t.prototype.castToBaseTexture=function(){return this},t.from=function(i,r,n){n===void 0&&(n=F.STRICT_TEXTURE_CACHE);var o=typeof i=="string",s=null;if(o)s=i;else{if(!i._pixiId){var a=r&&r.pixiIdPrefix||"pixiid";i._pixiId=a+"_"+je()}s=i._pixiId}var h=gt[s];if(o&&n&&!h)throw new Error('The cacheId "'+s+'" does not exist in BaseTextureCache.');return h||(h=new t(i,r),h.cacheId=s,t.addToCache(h,s)),h},t.fromBuffer=function(i,r,n,o){i=i||new Float32Array(r*n*4);var s=new Po(i,{width:r,height:n}),a=i instanceof Float32Array?U.FLOAT:U.UNSIGNED_BYTE;return new t(s,Object.assign(Lf,o||{width:r,height:n,type:a}))},t.addToCache=function(i,r){r&&(i.textureCacheIds.indexOf(r)===-1&&i.textureCacheIds.push(r),gt[r]&&console.warn("BaseTexture added to the cache with an id ["+r+"] that already had an entry"),gt[r]=i)},t.removeFromCache=function(i){if(typeof i=="string"){var r=gt[i];if(r){var n=r.textureCacheIds.indexOf(i);return n>-1&&r.textureCacheIds.splice(n,1),delete gt[i],r}}else if(i&&i.textureCacheIds){for(var o=0;o<i.textureCacheIds.length;++o)delete gt[i.textureCacheIds[o]];return i.textureCacheIds.length=0,i}return null},t._globalBatch=0,t}(Le),_h=function(e){V(t,e);function t(i,r){var n=this,o=r||{},s=o.width,a=o.height;n=e.call(this,s,a)||this,n.items=[],n.itemDirtyIds=[];for(var h=0;h<i;h++){var l=new W;n.items.push(l),n.itemDirtyIds.push(-2)}return n.length=i,n._load=null,n.baseTexture=null,n}return t.prototype.initFromArray=function(i,r){for(var n=0;n<this.length;n++)!i[n]||(i[n].castToBaseTexture?this.addBaseTextureAt(i[n].castToBaseTexture(),n):i[n]instanceof Pi?this.addResourceAt(i[n],n):this.addResourceAt(gh(i[n],r),n))},t.prototype.dispose=function(){for(var i=0,r=this.length;i<r;i++)this.items[i].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},t.prototype.addResourceAt=function(i,r){if(!this.items[r])throw new Error("Index "+r+" is out of bounds");return i.valid&&!this.valid&&this.resize(i.width,i.height),this.items[r].setResource(i),this},t.prototype.bind=function(i){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");e.prototype.bind.call(this,i);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=i,this.items[r].on("update",i.update,i)},t.prototype.unbind=function(i){e.prototype.unbind.call(this,i);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=null,this.items[r].off("update",i.update,i)},t.prototype.load=function(){var i=this;if(this._load)return this._load;var r=this.items.map(function(o){return o.resource}).filter(function(o){return o}),n=r.map(function(o){return o.load()});return this._load=Promise.all(n).then(function(){var o=i.items[0],s=o.realWidth,a=o.realHeight;return i.resize(s,a),Promise.resolve(i)}),this._load},t}(Pi),Nf=function(e){V(t,e);function t(i,r){var n=this,o=r||{},s=o.width,a=o.height,h,l;return Array.isArray(i)?(h=i,l=i.length):l=i,n=e.call(this,l,{width:s,height:a})||this,h&&n.initFromArray(h,r),n}return t.prototype.addBaseTextureAt=function(i,r){if(i.resource)this.addResourceAt(i.resource,r);else throw new Error("ArrayResource does not support RenderTexture");return this},t.prototype.bind=function(i){e.prototype.bind.call(this,i),i.target=_e.TEXTURE_2D_ARRAY},t.prototype.upload=function(i,r,n){var o=this,s=o.length,a=o.itemDirtyIds,h=o.items,l=i.gl;n.dirtyId<0&&l.texImage3D(l.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,s,0,r.format,n.type,null);for(var u=0;u<s;u++){var c=h[u];a[u]<c.dirtyId&&(a[u]=c.dirtyId,c.valid&&l.texSubImage3D(l.TEXTURE_2D_ARRAY,0,0,0,u,c.resource.width,c.resource.height,1,r.format,n.type,c.resource.source))}return!0},t}(_h),he=function(e){V(t,e);function t(i){var r=this,n=i,o=n.naturalWidth||n.videoWidth||n.width,s=n.naturalHeight||n.videoHeight||n.height;return r=e.call(this,o,s)||this,r.source=i,r.noSubImage=!1,r}return t.crossOrigin=function(i,r,n){n===void 0&&r.indexOf("data:")!==0?i.crossOrigin=mh(r):n!==!1&&(i.crossOrigin=typeof n=="string"?n:"anonymous")},t.prototype.upload=function(i,r,n,o){var s=i.gl,a=r.realWidth,h=r.realHeight;return o=o||this.source,s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===ae.UNPACK),!this.noSubImage&&r.target===s.TEXTURE_2D&&n.width===a&&n.height===h?s.texSubImage2D(s.TEXTURE_2D,0,0,0,r.format,n.type,o):(n.width=a,n.height=h,s.texImage2D(r.target,0,n.internalFormat,r.format,n.type,o)),!0},t.prototype.update=function(){if(!this.destroyed){var i=this.source,r=i.naturalWidth||i.videoWidth||i.width,n=i.naturalHeight||i.videoHeight||i.height;this.resize(r,n),e.prototype.update.call(this)}},t.prototype.dispose=function(){this.source=null},t}(Pi),Eo=function(e){V(t,e);function t(i){return e.call(this,i)||this}return t.test=function(i){var r=self.OffscreenCanvas;return r&&i instanceof r?!0:self.HTMLCanvasElement&&i instanceof HTMLCanvasElement},t}(he),Rf=function(e){V(t,e);function t(i,r){var n=this,o=r||{},s=o.width,a=o.height,h=o.autoLoad,l=o.linkBaseTexture;if(i&&i.length!==t.SIDES)throw new Error("Invalid length. Got "+i.length+", expected 6");n=e.call(this,6,{width:s,height:a})||this;for(var u=0;u<t.SIDES;u++)n.items[u].target=_e.TEXTURE_CUBE_MAP_POSITIVE_X+u;return n.linkBaseTexture=l!==!1,i&&n.initFromArray(i,r),h!==!1&&n.load(),n}return t.prototype.bind=function(i){e.prototype.bind.call(this,i),i.target=_e.TEXTURE_CUBE_MAP},t.prototype.addBaseTextureAt=function(i,r,n){if(n===void 0&&(n=this.linkBaseTexture),!this.items[r])throw new Error("Index "+r+" is out of bounds");if(!this.linkBaseTexture||i.parentTextureArray||Object.keys(i._glTextures).length>0)if(i.resource)this.addResourceAt(i.resource,r);else throw new Error("CubeResource does not support copying of renderTexture.");else i.target=_e.TEXTURE_CUBE_MAP_POSITIVE_X+r,i.parentTextureArray=this.baseTexture,this.items[r]=i;return i.valid&&!this.valid&&this.resize(i.realWidth,i.realHeight),this.items[r]=i,this},t.prototype.upload=function(i,r,n){for(var o=this.itemDirtyIds,s=0;s<t.SIDES;s++){var a=this.items[s];o[s]<a.dirtyId&&(a.valid&&a.resource?(a.resource.upload(i,a,n),o[s]=a.dirtyId):o[s]<-1&&(i.gl.texImage2D(a.target,0,n.internalFormat,r.realWidth,r.realHeight,0,r.format,n.type,null),o[s]=-1))}return!0},t.test=function(i){return Array.isArray(i)&&i.length===t.SIDES},t.SIDES=6,t}(_h),xh=function(e){V(t,e);function t(i,r){var n=this;if(r=r||{},!(i instanceof HTMLImageElement)){var o=new Image;he.crossOrigin(o,i,r.crossorigin),o.src=i,i=o}return n=e.call(this,i)||this,!i.complete&&!!n._width&&!!n._height&&(n._width=0,n._height=0),n.url=i.src,n._process=null,n.preserveBitmap=!1,n.createBitmap=(r.createBitmap!==void 0?r.createBitmap:F.CREATE_IMAGE_BITMAP)&&!!self.createImageBitmap,n.alphaMode=typeof r.alphaMode=="number"?r.alphaMode:null,n.bitmap=null,n._load=null,r.autoLoad!==!1&&n.load(),n}return t.prototype.load=function(i){var r=this;return this._load?this._load:(i!==void 0&&(this.createBitmap=i),this._load=new Promise(function(n,o){var s=r.source;r.url=s.src;var a=function(){r.destroyed||(s.onload=null,s.onerror=null,r.resize(s.width,s.height),r._load=null,r.createBitmap?n(r.process()):n(r))};s.complete&&s.src?a():(s.onload=a,s.onerror=function(h){o(h),r.onError.emit(h)})}),this._load)},t.prototype.process=function(){var i=this,r=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!self.createImageBitmap)return Promise.resolve(this);var n=self.createImageBitmap,o=!r.crossOrigin||r.crossOrigin==="anonymous";return this._process=fetch(r.src,{mode:o?"cors":"no-cors"}).then(function(s){return s.blob()}).then(function(s){return n(s,0,0,r.width,r.height,{premultiplyAlpha:i.alphaMode===ae.UNPACK?"premultiply":"none"})}).then(function(s){return i.destroyed?Promise.reject():(i.bitmap=s,i.update(),i._process=null,Promise.resolve(i))}),this._process},t.prototype.upload=function(i,r,n){if(typeof this.alphaMode=="number"&&(r.alphaMode=this.alphaMode),!this.createBitmap)return e.prototype.upload.call(this,i,r,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(e.prototype.upload.call(this,i,r,n,this.bitmap),!this.preserveBitmap){var o=!0,s=r._glTextures;for(var a in s){var h=s[a];if(h!==n&&h.dirtyId!==r.dirtyId){o=!1;break}}o&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},t.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,e.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},t.test=function(i){return typeof i=="string"||i instanceof HTMLImageElement},t}(he),Mf=function(e){V(t,e);function t(i,r){var n=this;return r=r||{},n=e.call(this,document.createElement("canvas"))||this,n._width=0,n._height=0,n.svg=i,n.scale=r.scale||1,n._overrideWidth=r.width,n._overrideHeight=r.height,n._resolve=null,n._crossorigin=r.crossorigin,n._load=null,r.autoLoad!==!1&&n.load(),n}return t.prototype.load=function(){var i=this;return this._load?this._load:(this._load=new Promise(function(r){if(i._resolve=function(){i.resize(i.source.width,i.source.height),r(i)},t.SVG_XML.test(i.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");i.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(i.svg)))}i._loadSvg()}),this._load)},t.prototype._loadSvg=function(){var i=this,r=new Image;he.crossOrigin(r,this.svg,this._crossorigin),r.src=this.svg,r.onerror=function(n){!i._resolve||(r.onerror=null,i.onError.emit(n))},r.onload=function(){if(i._resolve){var n=r.width,o=r.height;if(!n||!o)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var s=n*i.scale,a=o*i.scale;(i._overrideWidth||i._overrideHeight)&&(s=i._overrideWidth||i._overrideHeight/o*n,a=i._overrideHeight||i._overrideWidth/n*o),s=Math.round(s),a=Math.round(a);var h=i.source;h.width=s,h.height=a,h._pixiId="canvas_"+je(),h.getContext("2d").drawImage(r,0,0,n,o,0,0,s,a),i._resolve(),i._resolve=null}}},t.getSize=function(i){var r=t.SVG_SIZE.exec(i),n={};return r&&(n[r[1]]=Math.round(parseFloat(r[3])),n[r[5]]=Math.round(parseFloat(r[7]))),n},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},t.test=function(i,r){return r==="svg"||typeof i=="string"&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(i)||typeof i=="string"&&t.SVG_XML.test(i)},t.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,t.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,t}(he),Df=function(e){V(t,e);function t(i,r){var n=this;if(r=r||{},!(i instanceof HTMLVideoElement)){var o=document.createElement("video");o.setAttribute("preload","auto"),o.setAttribute("webkit-playsinline",""),o.setAttribute("playsinline",""),typeof i=="string"&&(i=[i]);var s=i[0].src||i[0];he.crossOrigin(o,s,r.crossorigin);for(var a=0;a<i.length;++a){var h=document.createElement("source"),l=i[a],u=l.src,c=l.mime;u=u||i[a];var d=u.split("?").shift().toLowerCase(),f=d.substr(d.lastIndexOf(".")+1);c=c||t.MIME_TYPES[f]||"video/"+f,h.src=u,h.type=c,o.appendChild(h)}i=o}return n=e.call(this,i)||this,n.noSubImage=!0,n._autoUpdate=!0,n._isConnectedToTicker=!1,n._updateFPS=r.updateFPS||0,n._msToNextUpdate=0,n.autoPlay=r.autoPlay!==!1,n._load=null,n._resolve=null,n._onCanPlay=n._onCanPlay.bind(n),n._onError=n._onError.bind(n),r.autoLoad!==!1&&n.load(),n}return t.prototype.update=function(i){if(!this.destroyed){var r=dt.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-r),(!this._updateFPS||this._msToNextUpdate<=0)&&(e.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},t.prototype.load=function(){var i=this;if(this._load)return this._load;var r=this.source;return(r.readyState===r.HAVE_ENOUGH_DATA||r.readyState===r.HAVE_FUTURE_DATA)&&r.width&&r.height&&(r.complete=!0),r.addEventListener("play",this._onPlayStart.bind(this)),r.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(r.addEventListener("canplay",this._onCanPlay),r.addEventListener("canplaythrough",this._onCanPlay),r.addEventListener("error",this._onError,!0)),this._load=new Promise(function(n){i.valid?n(i):(i._resolve=n,r.load())}),this._load},t.prototype._onError=function(i){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(i)},t.prototype._isSourcePlaying=function(){var i=this.source;return i.currentTime>0&&i.paused===!1&&i.ended===!1&&i.readyState>2},t.prototype._isSourceReady=function(){var i=this.source;return i.readyState===3||i.readyState===4},t.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(dt.shared.add(this.update,this),this._isConnectedToTicker=!0)},t.prototype._onPlayStop=function(){this._isConnectedToTicker&&(dt.shared.remove(this.update,this),this._isConnectedToTicker=!1)},t.prototype._onCanPlay=function(){var i=this.source;i.removeEventListener("canplay",this._onCanPlay),i.removeEventListener("canplaythrough",this._onCanPlay);var r=this.valid;this.resize(i.videoWidth,i.videoHeight),!r&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&i.play()},t.prototype.dispose=function(){this._isConnectedToTicker&&(dt.shared.remove(this.update,this),this._isConnectedToTicker=!1);var i=this.source;i&&(i.removeEventListener("error",this._onError,!0),i.pause(),i.src="",i.load()),e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(i){i!==this._autoUpdate&&(this._autoUpdate=i,!this._autoUpdate&&this._isConnectedToTicker?(dt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(dt.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(i){i!==this._updateFPS&&(this._updateFPS=i)},enumerable:!1,configurable:!0}),t.test=function(i,r){return self.HTMLVideoElement&&i instanceof HTMLVideoElement||t.TYPES.indexOf(r)>-1},t.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],t.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},t}(he),Ff=function(e){V(t,e);function t(i){return e.call(this,i)||this}return t.test=function(i){return!!self.createImageBitmap&&i instanceof ImageBitmap},t}(he);Hn.push(xh,Ff,Eo,Df,Mf,Po,Rf,Nf);var Bf=function(e){V(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.upload=function(i,r,n){var o=i.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===ae.UNPACK);var s=r.realWidth,a=r.realHeight;return n.width===s&&n.height===a?o.texSubImage2D(r.target,0,0,0,s,a,r.format,n.type,this.data):(n.width=s,n.height=a,o.texImage2D(r.target,0,n.internalFormat,s,a,0,r.format,n.type,this.data)),!0},t}(Po),jn=function(){function e(t,i){this.width=Math.round(t||100),this.height=Math.round(i||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new ut("disposeFramebuffer"),this.multisample=Q.NONE}return Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),e.prototype.addColorTexture=function(t,i){return t===void 0&&(t=0),this.colorTextures[t]=i||new W(null,{scaleMode:ct.NEAREST,resolution:1,mipmap:Pe.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},e.prototype.addDepthTexture=function(t){return this.depthTexture=t||new W(new Bf(null,{width:this.width,height:this.height}),{scaleMode:ct.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Pe.OFF,format:L.DEPTH_COMPONENT,type:U.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},e.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},e.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},e.prototype.resize=function(t,i){if(t=Math.round(t),i=Math.round(i),!(t===this.width&&i===this.height)){this.width=t,this.height=i,this.dirtyId++,this.dirtySize++;for(var r=0;r<this.colorTextures.length;r++){var n=this.colorTextures[r],o=n.resolution;n.setSize(t/o,i/o)}if(this.depthTexture){var o=this.depthTexture.resolution;this.depthTexture.setSize(t/o,i/o)}}},e.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},e.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},e}(),Ir=function(e){V(t,e);function t(i){var r=this;if(typeof i=="number"){var n=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];i={width:n,height:o,scaleMode:s,resolution:a}}return i.width=i.width||100,i.height=i.height||100,i.multisample=i.multisample!==void 0?i.multisample:Q.NONE,r=e.call(this,null,i)||this,r.mipmap=Pe.OFF,r.valid=!0,r.clearColor=[0,0,0,0],r.framebuffer=new jn(r.realWidth,r.realHeight).addColorTexture(0,r),r.framebuffer.multisample=i.multisample,r.maskStack=[],r.filterStack=[{}],r}return t.prototype.resize=function(i,r){this.framebuffer.resize(i*this.resolution,r*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)},t.prototype.dispose=function(){this.framebuffer.dispose(),e.prototype.dispose.call(this)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},t}(W),bh=function(){function e(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return e.prototype.set=function(t,i,r){var n=i.width,o=i.height;if(r){var s=t.width/2/n,a=t.height/2/o,h=t.x/n+s,l=t.y/o+a;r=q.add(r,q.NW),this.x0=h+s*q.uX(r),this.y0=l+a*q.uY(r),r=q.add(r,2),this.x1=h+s*q.uX(r),this.y1=l+a*q.uY(r),r=q.add(r,2),this.x2=h+s*q.uX(r),this.y2=l+a*q.uY(r),r=q.add(r,2),this.x3=h+s*q.uX(r),this.y3=l+a*q.uY(r)}else this.x0=t.x/n,this.y0=t.y/o,this.x1=(t.x+t.width)/n,this.y1=t.y/o,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/o,this.x3=t.x/n,this.y3=(t.y+t.height)/o;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},e.prototype.toString=function(){return"[@pixi/core:TextureUvs "+("x0="+this.x0+" y0="+this.y0+" ")+("x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" ")+("y2="+this.y2+" x3="+this.x3+" y3="+this.y3)+"]"},e}(),Hs=new bh,z=function(e){V(t,e);function t(i,r,n,o,s,a){var h=e.call(this)||this;if(h.noFrame=!1,r||(h.noFrame=!0,r=new X(0,0,1,1)),i instanceof t&&(i=i.baseTexture),h.baseTexture=i,h._frame=r,h.trim=o,h.valid=!1,h._uvs=Hs,h.uvMatrix=null,h.orig=n||r,h._rotate=Number(s||0),s===!0)h._rotate=2;else if(h._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return h.defaultAnchor=a?new G(a.x,a.y):new G(0,0),h._updateID=0,h.textureCacheIds=[],i.valid?h.noFrame?i.valid&&h.onBaseTextureUpdated(i):h.frame=r:i.once("loaded",h.onBaseTextureUpdated,h),h.noFrame&&i.on("update",h.onBaseTextureUpdated,h),h}return t.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},t.prototype.onBaseTextureUpdated=function(i){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=i.width,this._frame.height=i.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},t.prototype.destroy=function(i){if(this.baseTexture){if(i){var r=this.baseTexture.resource;r&&r.url&&mt[r.url]&&t.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,t.removeFromCache(this),this.textureCacheIds=null},t.prototype.clone=function(){var i=this._frame.clone(),r=this._frame===this.orig?i:this.orig.clone(),n=new t(this.baseTexture,!this.noFrame&&i,r,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(n._frame=i),n},t.prototype.updateUvs=function(){this._uvs===Hs&&(this._uvs=new bh),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},t.from=function(i,r,n){r===void 0&&(r={}),n===void 0&&(n=F.STRICT_TEXTURE_CACHE);var o=typeof i=="string",s=null;if(o)s=i;else if(i instanceof W){if(!i.cacheId){var a=r&&r.pixiIdPrefix||"pixiid";i.cacheId=a+"-"+je(),W.addToCache(i,i.cacheId)}s=i.cacheId}else{if(!i._pixiId){var a=r&&r.pixiIdPrefix||"pixiid";i._pixiId=a+"_"+je()}s=i._pixiId}var h=mt[s];if(o&&n&&!h)throw new Error('The cacheId "'+s+'" does not exist in TextureCache.');return!h&&!(i instanceof W)?(r.resolution||(r.resolution=Un(i)),h=new t(new W(i,r)),h.baseTexture.cacheId=s,W.addToCache(h.baseTexture,s),t.addToCache(h,s)):!h&&i instanceof W&&(h=new t(i),t.addToCache(h,s)),h},t.fromURL=function(i,r){var n=Object.assign({autoLoad:!1},r==null?void 0:r.resourceOptions),o=t.from(i,Object.assign({resourceOptions:n},r),!1),s=o.baseTexture.resource;return o.baseTexture.valid?Promise.resolve(o):s.load().then(function(){return Promise.resolve(o)})},t.fromBuffer=function(i,r,n,o){return new t(W.fromBuffer(i,r,n,o))},t.fromLoader=function(i,r,n,o){var s=new W(i,Object.assign({scaleMode:F.SCALE_MODE,resolution:Un(r)},o)),a=s.resource;a instanceof xh&&(a.url=r);var h=new t(s);return n||(n=r),W.addToCache(h.baseTexture,n),t.addToCache(h,n),n!==r&&(W.addToCache(h.baseTexture,r),t.addToCache(h,r)),h.baseTexture.valid?Promise.resolve(h):new Promise(function(l){h.baseTexture.once("loaded",function(){return l(h)})})},t.addToCache=function(i,r){r&&(i.textureCacheIds.indexOf(r)===-1&&i.textureCacheIds.push(r),mt[r]&&console.warn("Texture added to the cache with an id ["+r+"] that already had an entry"),mt[r]=i)},t.removeFromCache=function(i){if(typeof i=="string"){var r=mt[i];if(r){var n=r.textureCacheIds.indexOf(i);return n>-1&&r.textureCacheIds.splice(n,1),delete mt[i],r}}else if(i&&i.textureCacheIds){for(var o=0;o<i.textureCacheIds.length;++o)mt[i.textureCacheIds[o]]===i&&delete mt[i.textureCacheIds[o]];return i.textureCacheIds.length=0,i}return null},Object.defineProperty(t.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frame",{get:function(){return this._frame},set:function(i){this._frame=i,this.noFrame=!1;var r=i.x,n=i.y,o=i.width,s=i.height,a=r+o>this.baseTexture.width,h=n+s>this.baseTexture.height;if(a||h){var l=a&&h?"and":"or",u="X: "+r+" + "+o+" = "+(r+o)+" > "+this.baseTexture.width,c="Y: "+n+" + "+s+" = "+(n+s)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+(u+" "+l+" "+c))}this.valid=o&&s&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=i),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotate",{get:function(){return this._rotate},set:function(i){this._rotate=i,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),t.prototype.castToBaseTexture=function(){return this.baseTexture},t}(Le);function kf(){var e=document.createElement("canvas");e.width=16,e.height=16;var t=e.getContext("2d");return t.fillStyle="white",t.fillRect(0,0,16,16),new z(new W(new Eo(e)))}function Xi(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}z.EMPTY=new z(new W),Xi(z.EMPTY),Xi(z.EMPTY.baseTexture),z.WHITE=kf(),Xi(z.WHITE),Xi(z.WHITE.baseTexture);var Lt=function(e){V(t,e);function t(i,r){var n=e.call(this,i,r)||this;return n.valid=!0,n.filterFrame=null,n.filterPoolKey=null,n.updateUvs(),n}return Object.defineProperty(t.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(i){this.framebuffer.multisample=i},enumerable:!1,configurable:!0}),t.prototype.resize=function(i,r,n){n===void 0&&(n=!0);var o=this.baseTexture.resolution,s=Math.round(i*o)/o,a=Math.round(r*o)/o;this.valid=s>0&&a>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=a,n&&this.baseTexture.resize(s,a),this.updateUvs()},t.prototype.setResolution=function(i){var r=this.baseTexture;r.resolution!==i&&(r.setResolution(i),this.resize(r.width,r.height,!1))},t.create=function(i){for(var r=arguments,n=[],o=1;o<arguments.length;o++)n[o-1]=r[o];return typeof i=="number"&&(Ie("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),i={width:i,height:n[0],scaleMode:n[1],resolution:n[2]}),new t(new Ir(i))},t}(z),Uf=function(){function e(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return e.prototype.createTexture=function(t,i,r){r===void 0&&(r=Q.NONE);var n=new Ir(Object.assign({width:t,height:i,resolution:1,multisample:r},this.textureOptions));return new Lt(n)},e.prototype.getOptimalTexture=function(t,i,r,n){r===void 0&&(r=1),n===void 0&&(n=Q.NONE);var o;t=Math.ceil(t*r),i=Math.ceil(i*r),!this.enableFullScreen||t!==this._pixelsWidth||i!==this._pixelsHeight?(t=xi(t),i=xi(i),o=((t&65535)<<16|i&65535)>>>0,n>1&&(o+=n*4294967296)):o=n>1?-n:-1,this.texturePool[o]||(this.texturePool[o]=[]);var s=this.texturePool[o].pop();return s||(s=this.createTexture(t,i,n)),s.filterPoolKey=o,s.setResolution(r),s},e.prototype.getFilterTexture=function(t,i,r){var n=this.getOptimalTexture(t.width,t.height,i||t.resolution,r||Q.NONE);return n.filterFrame=t.filterFrame,n},e.prototype.returnTexture=function(t){var i=t.filterPoolKey;t.filterFrame=null,this.texturePool[i].push(t)},e.prototype.returnFilterTexture=function(t){this.returnTexture(t)},e.prototype.clear=function(t){if(t=t!==!1,t)for(var i in this.texturePool){var r=this.texturePool[i];if(r)for(var n=0;n<r.length;n++)r[n].destroy(!0)}this.texturePool={}},e.prototype.setScreenSize=function(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(var i in this.texturePool)if(Number(i)<0){var r=this.texturePool[i];if(r)for(var n=0;n<r.length;n++)r[n].destroy(!0);this.texturePool[i]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}},e.SCREEN_KEY=-1,e}(),Ws=function(){function e(t,i,r,n,o,s,a){i===void 0&&(i=0),r===void 0&&(r=!1),n===void 0&&(n=U.FLOAT),this.buffer=t,this.size=i,this.normalized=r,this.type=n,this.stride=o,this.start=s,this.instance=a}return e.prototype.destroy=function(){this.buffer=null},e.from=function(t,i,r,n,o){return new e(t,i,r,n,o)},e}(),Xf=0,vt=function(){function e(t,i,r){i===void 0&&(i=!0),r===void 0&&(r=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=i,this.id=Xf++,this.disposeRunner=new ut("disposeBuffer")}return e.prototype.update=function(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++},e.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},e.prototype.destroy=function(){this.dispose(),this.data=null},Object.defineProperty(e.prototype,"index",{get:function(){return this.type===Ot.ELEMENT_ARRAY_BUFFER},set:function(t){this.type=t?Ot.ELEMENT_ARRAY_BUFFER:Ot.ARRAY_BUFFER},enumerable:!1,configurable:!0}),e.from=function(t){return t instanceof Array&&(t=new Float32Array(t)),new e(t)},e}(),Yf={Float32Array,Uint32Array,Int32Array,Uint8Array};function Gf(e,t){for(var i=0,r=0,n={},o=0;o<e.length;o++)r+=t[o],i+=e[o].length;for(var s=new ArrayBuffer(i*4),a=null,h=0,o=0;o<e.length;o++){var l=t[o],u=e[o],c=Tr(u);n[c]||(n[c]=new Yf[c](s)),a=n[c];for(var d=0;d<u.length;d++){var f=(d/l|0)*r+h,m=d%l;a[f+m]=u[d]}h+=l}return new Float32Array(s)}var zs={5126:4,5123:2,5121:1},Hf=0,Wf={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},wo=function(){function e(t,i){t===void 0&&(t=[]),i===void 0&&(i={}),this.buffers=t,this.indexBuffer=null,this.attributes=i,this.glVertexArrayObjects={},this.id=Hf++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new ut("disposeGeometry"),this.refCount=0}return e.prototype.addAttribute=function(t,i,r,n,o,s,a,h){if(r===void 0&&(r=0),n===void 0&&(n=!1),h===void 0&&(h=!1),!i)throw new Error("You must pass a buffer when creating an attribute");i instanceof vt||(i instanceof Array&&(i=new Float32Array(i)),i=new vt(i));var l=t.split("|");if(l.length>1){for(var u=0;u<l.length;u++)this.addAttribute(l[u],i,r,n,o);return this}var c=this.buffers.indexOf(i);return c===-1&&(this.buffers.push(i),c=this.buffers.length-1),this.attributes[t]=new Ws(c,r,n,o,s,a,h),this.instanced=this.instanced||h,this},e.prototype.getAttribute=function(t){return this.attributes[t]},e.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},e.prototype.addIndex=function(t){return t instanceof vt||(t instanceof Array&&(t=new Uint16Array(t)),t=new vt(t)),t.type=Ot.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.indexOf(t)===-1&&this.buffers.push(t),this},e.prototype.getIndex=function(){return this.indexBuffer},e.prototype.interleave=function(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;var t=[],i=[],r=new vt,n;for(n in this.attributes){var o=this.attributes[n],s=this.buffers[o.buffer];t.push(s.data),i.push(o.size*zs[o.type]/4),o.buffer=0}for(r.data=Gf(t,i),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},e.prototype.getSize=function(){for(var t in this.attributes){var i=this.attributes[t],r=this.buffers[i.buffer];return r.data.length/(i.stride/4||i.size)}return 0},e.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},e.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},e.prototype.clone=function(){for(var t=new e,i=0;i<this.buffers.length;i++)t.buffers[i]=new vt(this.buffers[i].data.slice(0));for(var i in this.attributes){var r=this.attributes[i];t.attributes[i]=new Ws(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Ot.ELEMENT_ARRAY_BUFFER),t},e.merge=function(t){for(var i=new e,r=[],n=[],o=[],s,a=0;a<t.length;a++){s=t[a];for(var h=0;h<s.buffers.length;h++)n[h]=n[h]||0,n[h]+=s.buffers[h].data.length,o[h]=0}for(var a=0;a<s.buffers.length;a++)r[a]=new Wf[Tr(s.buffers[a].data)](n[a]),i.buffers[a]=new vt(r[a]);for(var a=0;a<t.length;a++){s=t[a];for(var h=0;h<s.buffers.length;h++)r[h].set(s.buffers[h].data,o[h]),o[h]+=s.buffers[h].data.length}if(i.attributes=s.attributes,s.indexBuffer){i.indexBuffer=i.buffers[s.buffers.indexOf(s.indexBuffer)],i.indexBuffer.type=Ot.ELEMENT_ARRAY_BUFFER;for(var l=0,u=0,c=0,d=0,a=0;a<s.buffers.length;a++)if(s.buffers[a]!==s.indexBuffer){d=a;break}for(var a in s.attributes){var f=s.attributes[a];(f.buffer|0)===d&&(u+=f.size*zs[f.type]/4)}for(var a=0;a<t.length;a++){for(var m=t[a].indexBuffer.data,h=0;h<m.length;h++)i.indexBuffer.data[h+c]+=l;l+=t[a].buffers[d].data.length/u,c+=m.length}}return i},e}(),zf=function(e){V(t,e);function t(){var i=e.call(this)||this;return i.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),i}return t}(wo),jf=function(e){V(t,e);function t(){var i=e.call(this)||this;return i.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),i.uvs=new Float32Array([0,0,1,0,1,1,0,1]),i.vertexBuffer=new vt(i.vertices),i.uvBuffer=new vt(i.uvs),i.addAttribute("aVertexPosition",i.vertexBuffer).addAttribute("aTextureCoord",i.uvBuffer).addIndex([0,1,2,0,2,3]),i}return t.prototype.map=function(i,r){var n=0,o=0;return this.uvs[0]=n,this.uvs[1]=o,this.uvs[2]=n+r.width/i.width,this.uvs[3]=o,this.uvs[4]=n+r.width/i.width,this.uvs[5]=o+r.height/i.height,this.uvs[6]=n,this.uvs[7]=o+r.height/i.height,n=r.x,o=r.y,this.vertices[0]=n,this.vertices[1]=o,this.vertices[2]=n+r.width,this.vertices[3]=o,this.vertices[4]=n+r.width,this.vertices[5]=o+r.height,this.vertices[6]=n,this.vertices[7]=o+r.height,this.invalidate(),this},t.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},t}(wo),Vf=0,xe=function(){function e(t,i,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Vf++,this.static=!!i,this.ubo=!!r,t instanceof vt?(this.buffer=t,this.buffer.type=Ot.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new vt(new Float32Array(1)),this.buffer.type=Ot.UNIFORM_BUFFER,this.autoManage=!0))}return e.prototype.update=function(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()},e.prototype.add=function(t,i,r){if(!this.ubo)this.uniforms[t]=new e(i,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")},e.from=function(t,i,r){return new e(t,i,r)},e.uboFrom=function(t,i){return new e(t,i!=null?i:!0,!0)},e}(),qf=function(){function e(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Q.NONE,this.sourceFrame=new X,this.destinationFrame=new X,this.bindingSourceFrame=new X,this.bindingDestinationFrame=new X,this.filters=[],this.transform=null}return e.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},e}(),Yi=[new G,new G,new G,new G],Zr=new J,Zf=function(){function e(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Uf,this.texturePool.setScreenSize(t.view),this.statePool=[],this.quad=new zf,this.quadUv=new jf,this.tempRect=new X,this.activeState={},this.globalUniforms=new xe({outputFrame:new X,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}return e.prototype.push=function(t,i){for(var r,n,o=this.renderer,s=this.defaultFilterStack,a=this.statePool.pop()||new qf,h=this.renderer.renderTexture,l=i[0].resolution,u=i[0].multisample,c=i[0].padding,d=i[0].autoFit,f=(r=i[0].legacy)!==null&&r!==void 0?r:!0,m=1;m<i.length;m++){var v=i[m];l=Math.min(l,v.resolution),u=Math.min(u,v.multisample),c=this.useMaxPadding?Math.max(c,v.padding):c+v.padding,d=d&&v.autoFit,f=f||((n=v.legacy)!==null&&n!==void 0?n:!0)}if(s.length===1&&(this.defaultFilterStack[0].renderTexture=h.current),s.push(a),a.resolution=l,a.multisample=u,a.legacy=f,a.target=t,a.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),a.sourceFrame.pad(c),d){var y=this.tempRect.copyFrom(h.sourceFrame);o.projection.transform&&this.transformAABB(Zr.copyFrom(o.projection.transform).invert(),y),a.sourceFrame.fit(y)}this.roundFrame(a.sourceFrame,h.current?h.current.resolution:o.resolution,h.sourceFrame,h.destinationFrame,o.projection.transform),a.renderTexture=this.getOptimalFilterTexture(a.sourceFrame.width,a.sourceFrame.height,l,u),a.filters=i,a.destinationFrame.width=a.renderTexture.width,a.destinationFrame.height=a.renderTexture.height;var g=this.tempRect;g.x=0,g.y=0,g.width=a.sourceFrame.width,g.height=a.sourceFrame.height,a.renderTexture.filterFrame=a.sourceFrame,a.bindingSourceFrame.copyFrom(h.sourceFrame),a.bindingDestinationFrame.copyFrom(h.destinationFrame),a.transform=o.projection.transform,o.projection.transform=null,h.bind(a.renderTexture,a.sourceFrame,g),o.framebuffer.clear(0,0,0,0)},e.prototype.pop=function(){var t=this.defaultFilterStack,i=t.pop(),r=i.filters;this.activeState=i;var n=this.globalUniforms.uniforms;n.outputFrame=i.sourceFrame,n.resolution=i.resolution;var o=n.inputSize,s=n.inputPixel,a=n.inputClamp;if(o[0]=i.destinationFrame.width,o[1]=i.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],s[0]=Math.round(o[0]*i.resolution),s[1]=Math.round(o[1]*i.resolution),s[2]=1/s[0],s[3]=1/s[1],a[0]=.5*s[2],a[1]=.5*s[3],a[2]=i.sourceFrame.width*o[2]-.5*s[2],a[3]=i.sourceFrame.height*o[3]-.5*s[3],i.legacy){var h=n.filterArea;h[0]=i.destinationFrame.width,h[1]=i.destinationFrame.height,h[2]=i.sourceFrame.x,h[3]=i.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();var l=t[t.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,i.renderTexture,l.renderTexture,Qt.BLEND,i),this.returnFilterTexture(i.renderTexture);else{var u=i.renderTexture,c=this.getOptimalFilterTexture(u.width,u.height,i.resolution);c.filterFrame=u.filterFrame;var d=0;for(d=0;d<r.length-1;++d){d===1&&i.multisample>1&&(c=this.getOptimalFilterTexture(u.width,u.height,i.resolution),c.filterFrame=u.filterFrame),r[d].apply(this,u,c,Qt.CLEAR,i);var f=u;u=c,c=f}r[d].apply(this,u,l.renderTexture,Qt.BLEND,i),d>1&&i.multisample>1&&this.returnFilterTexture(i.renderTexture),this.returnFilterTexture(u),this.returnFilterTexture(c)}i.clear(),this.statePool.push(i)},e.prototype.bindAndClear=function(t,i){i===void 0&&(i=Qt.CLEAR);var r=this.renderer,n=r.renderTexture,o=r.state;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t&&t.filterFrame){var s=this.tempRect;s.x=0,s.y=0,s.width=t.filterFrame.width,s.height=t.filterFrame.height,n.bind(t,t.filterFrame,s)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var a=o.stateId&1||this.forceClear;(i===Qt.CLEAR||i===Qt.BLIT&&a)&&this.renderer.framebuffer.clear(0,0,0,0)},e.prototype.applyFilter=function(t,i,r,n){var o=this.renderer;o.state.set(t.state),this.bindAndClear(r,n),t.uniforms.uSampler=i,t.uniforms.filterGlobals=this.globalUniforms,o.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(i._frame,i.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(zt.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(zt.TRIANGLE_STRIP))},e.prototype.calculateSpriteMatrix=function(t,i){var r=this.activeState,n=r.sourceFrame,o=r.destinationFrame,s=i._texture.orig,a=t.set(o.width,0,0,o.height,n.x,n.y),h=i.worldTransform.copyTo(J.TEMP_MATRIX);return h.invert(),a.prepend(h),a.scale(1/s.width,1/s.height),a.translate(i.anchor.x,i.anchor.y),a},e.prototype.destroy=function(){this.renderer=null,this.texturePool.clear(!1)},e.prototype.getOptimalFilterTexture=function(t,i,r,n){return r===void 0&&(r=1),n===void 0&&(n=Q.NONE),this.texturePool.getOptimalTexture(t,i,r,n)},e.prototype.getFilterTexture=function(t,i,r){if(typeof t=="number"){var n=t;t=i,i=n}t=t||this.activeState.renderTexture;var o=this.texturePool.getOptimalTexture(t.width,t.height,i||t.resolution,r||Q.NONE);return o.filterFrame=t.filterFrame,o},e.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},e.prototype.emptyPool=function(){this.texturePool.clear(!0)},e.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},e.prototype.transformAABB=function(t,i){var r=Yi[0],n=Yi[1],o=Yi[2],s=Yi[3];r.set(i.left,i.top),n.set(i.left,i.bottom),o.set(i.right,i.top),s.set(i.right,i.bottom),t.apply(r,r),t.apply(n,n),t.apply(o,o),t.apply(s,s);var a=Math.min(r.x,n.x,o.x,s.x),h=Math.min(r.y,n.y,o.y,s.y),l=Math.max(r.x,n.x,o.x,s.x),u=Math.max(r.y,n.y,o.y,s.y);i.x=a,i.y=h,i.width=l-a,i.height=u-h},e.prototype.roundFrame=function(t,i,r,n,o){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(o){var s=o.a,a=o.b,h=o.c,l=o.d;if((Math.abs(a)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(s)>1e-4||Math.abs(l)>1e-4))return}o=o?Zr.copyFrom(o):Zr.identity(),o.translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.transformAABB(o,t),t.ceil(i),this.transformAABB(o.invert(),t)}},e}(),Ph=function(){function e(t){this.renderer=t}return e.prototype.flush=function(){},e.prototype.destroy=function(){this.renderer=null},e.prototype.start=function(){},e.prototype.stop=function(){this.flush()},e.prototype.render=function(t){},e}(),$f=function(){function e(t){this.renderer=t,this.emptyRenderer=new Ph(t),this.currentRenderer=this.emptyRenderer}return e.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},e.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.copyBoundTextures=function(t,i){for(var r=this.renderer.texture.boundTextures,n=i-1;n>=0;--n)t[n]=r[n]||null,t[n]&&(t[n]._batchLocation=n)},e.prototype.boundArray=function(t,i,r,n){for(var o=t.elements,s=t.ids,a=t.count,h=0,l=0;l<a;l++){var u=o[l],c=u._batchLocation;if(c>=0&&c<n&&i[c]===u){s[l]=c;continue}for(;h<n;){var d=i[h];if(d&&d._batchEnabled===r&&d._batchLocation===h){h++;continue}s[l]=h,u._batchLocation=h,i[h]=u;break}}},e.prototype.destroy=function(){this.renderer=null},e}(),js=0,Kf=function(){function e(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),t.view.addEventListener("webglcontextlost",this.handleContextLost,!1),t.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}return Object.defineProperty(e.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),e.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=js++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()},e.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=js++,this.renderer.runners.contextChange.emit(t)},e.prototype.initFromOptions=function(t){var i=this.createContext(this.renderer.view,t);this.initFromContext(i)},e.prototype.createContext=function(t,i){var r;if(F.PREFER_ENV>=jt.WEBGL2&&(r=t.getContext("webgl2",i)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",i)||t.getContext("experimental-webgl",i),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl},e.prototype.getExtensions=function(){var t=this.gl,i={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,i,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,i,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})},e.prototype.handleContextLost=function(t){t.preventDefault()},e.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},e.prototype.destroy=function(){var t=this.renderer.view;this.renderer=null,t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},e.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},e.prototype.validateContext=function(t){var i=t.getContextAttributes(),r="WebGL2RenderingContext"in self&&t instanceof self.WebGL2RenderingContext;r&&(this.webGLVersion=2),i.stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var n=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},e}(),Jf=function(){function e(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Q.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}return e}(),Qf=new X,tm=function(){function e(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new jn(10,10),this.msaaSamples=null}return e.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new X,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),this.renderer.context.webGLVersion===1){var i=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;F.PREFER_ENV===jt.WEBGL_LEGACY&&(i=null,r=null),i?t.drawBuffers=function(n){return i.drawBuffersWEBGL(n)}:(this.hasMRT=!1,t.drawBuffers=function(){}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)},e.prototype.bind=function(t,i,r){r===void 0&&(r=0);var n=this.gl;if(t){var o=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,o.framebuffer)),o.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,o.mipLevel=r),o.dirtyId!==t.dirtyId&&(o.dirtyId=t.dirtyId,o.dirtyFormat!==t.dirtyFormat?(o.dirtyFormat=t.dirtyFormat,o.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):o.dirtySize!==t.dirtySize&&(o.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var s=0;s<t.colorTextures.length;s++){var a=t.colorTextures[s];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),i){var h=i.width>>r,l=i.height>>r,u=h/i.width;this.setViewport(i.x*u,i.y*u,h,l)}else{var h=t.width>>r,l=t.height>>r;this.setViewport(0,0,h,l)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),i?this.setViewport(i.x,i.y,i.width,i.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},e.prototype.setViewport=function(t,i,r,n){var o=this.viewport;t=Math.round(t),i=Math.round(i),r=Math.round(r),n=Math.round(n),(o.width!==r||o.height!==n||o.x!==t||o.y!==i)&&(o.x=t,o.y=i,o.width=r,o.height=n,this.gl.viewport(t,i,r,n))},Object.defineProperty(e.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),e.prototype.clear=function(t,i,r,n,o){o===void 0&&(o=cr.COLOR|cr.DEPTH);var s=this.gl;s.clearColor(t,i,r,n),s.clear(o)},e.prototype.initFramebuffer=function(t){var i=this.gl,r=new Jf(i.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r},e.prototype.resizeFramebuffer=function(t){var i=this.gl,r=t.glFramebuffers[this.CONTEXT_UID];r.msaaBuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,r.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.RGBA8,t.width,t.height)),r.stencil&&(i.bindRenderbuffer(i.RENDERBUFFER,r.stencil),r.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height));var n=t.colorTextures,o=n.length;i.drawBuffers||(o=Math.min(o,1));for(var s=0;s<o;s++){var a=n[s],h=a.parentTextureArray||a;this.renderer.texture.bind(h,0)}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)},e.prototype.updateFramebuffer=function(t,i){var r=this.gl,n=t.glFramebuffers[this.CONTEXT_UID],o=t.colorTextures,s=o.length;r.drawBuffers||(s=Math.min(s,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?(n.msaaBuffer=n.msaaBuffer||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,n.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,r.RGBA8,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n.msaaBuffer)):n.msaaBuffer&&(r.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));for(var a=[],h=0;h<s;h++){var l=o[h],u=l.parentTextureArray||l;this.renderer.texture.bind(u,0),!(h===0&&n.msaaBuffer)&&(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+h,l.target,u._glTextures[this.CONTEXT_UID].texture,i),a.push(r.COLOR_ATTACHMENT0+h))}if(a.length>1&&r.drawBuffers(a),t.depthTexture){var c=this.writeDepthTexture;if(c){var d=t.depthTexture;this.renderer.texture.bind(d,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,d._glTextures[this.CONTEXT_UID].texture,i)}}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(n.stencil=n.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),n.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,r.DEPTH24_STENCIL8,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,n.stencil)):n.stencil&&(r.deleteRenderbuffer(n.stencil),n.stencil=null)},e.prototype.canMultisampleFramebuffer=function(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture},e.prototype.detectSamples=function(t){var i=this.msaaSamples,r=Q.NONE;if(t<=1||i===null)return r;for(var n=0;n<i.length;n++)if(i[n]<=t){r=i[n];break}return r===1&&(r=Q.NONE),r},e.prototype.blit=function(t,i,r){var n=this,o=n.current,s=n.renderer,a=n.gl,h=n.CONTEXT_UID;if(s.context.webGLVersion===2&&!!o){var l=o.glFramebuffers[h];if(l){if(!t){if(!l.msaaBuffer)return;var u=o.colorTextures[0];if(!u)return;l.blitFramebuffer||(l.blitFramebuffer=new jn(o.width,o.height),l.blitFramebuffer.addColorTexture(0,u)),t=l.blitFramebuffer,t.colorTextures[0]!==u&&(t.colorTextures[0]=u,t.dirtyId++,t.dirtyFormat++),(t.width!==o.width||t.height!==o.height)&&(t.width=o.width,t.height=o.height,t.dirtyId++,t.dirtySize++)}i||(i=Qf,i.width=o.width,i.height=o.height),r||(r=i);var c=i.width===r.width&&i.height===r.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,l.framebuffer),a.blitFramebuffer(i.x,i.y,i.width,i.height,r.x,r.y,r.width,r.height,a.COLOR_BUFFER_BIT,c?a.NEAREST:a.LINEAR)}}},e.prototype.disposeFramebuffer=function(t,i){var r=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(r){delete t.glFramebuffers[this.CONTEXT_UID];var o=this.managedFramebuffers.indexOf(t);o>=0&&this.managedFramebuffers.splice(o,1),t.disposeRunner.remove(this),i||(n.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&n.deleteRenderbuffer(r.msaaBuffer),r.stencil&&n.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&r.blitFramebuffer.dispose()}},e.prototype.disposeAll=function(t){var i=this.managedFramebuffers;this.managedFramebuffers=[];for(var r=0;r<i.length;r++)this.disposeFramebuffer(i[r],t)},e.prototype.forceStencil=function(){var t=this.current;if(t){var i=t.glFramebuffers[this.CONTEXT_UID];if(!(!i||i.stencil)){t.stencil=!0;var r=t.width,n=t.height,o=this.gl,s=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,s),i.msaaBuffer?o.renderbufferStorageMultisample(o.RENDERBUFFER,i.multisample,o.DEPTH24_STENCIL8,r,n):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,r,n),i.stencil=s,o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,s)}}},e.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new X},e.prototype.destroy=function(){this.renderer=null},e}(),$r={5126:4,5123:2,5121:1},em=function(){function e(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}return e.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl,i=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,i.webGLVersion!==2){var r=this.renderer.context.extensions.vertexArrayObject;F.PREFER_ENV===jt.WEBGL_LEGACY&&(r=null),r?(t.createVertexArray=function(){return r.createVertexArrayOES()},t.bindVertexArray=function(o){return r.bindVertexArrayOES(o)},t.deleteVertexArray=function(o){return r.deleteVertexArrayOES(o)}):(this.hasVao=!1,t.createVertexArray=function(){return null},t.bindVertexArray=function(){return null},t.deleteVertexArray=function(){return null})}if(i.webGLVersion!==2){var n=t.getExtension("ANGLE_instanced_arrays");n?(t.vertexAttribDivisor=function(o,s){return n.vertexAttribDivisorANGLE(o,s)},t.drawElementsInstanced=function(o,s,a,h,l){return n.drawElementsInstancedANGLE(o,s,a,h,l)},t.drawArraysInstanced=function(o,s,a,h){return n.drawArraysInstancedANGLE(o,s,a,h)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=i.webGLVersion===2||!!i.extensions.uint32ElementIndex},e.prototype.bind=function(t,i){i=i||this.renderer.shader.shader;var r=this.gl,n=t.glVertexArrayObjects[this.CONTEXT_UID],o=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},o=!0);var s=n[i.program.id]||this.initGeometryVao(t,i,o);this._activeGeometry=t,this._activeVao!==s&&(this._activeVao=s,this.hasVao?r.bindVertexArray(s):this.activateVao(t,i.program)),this.updateBuffers()},e.prototype.reset=function(){this.unbind()},e.prototype.updateBuffers=function(){for(var t=this._activeGeometry,i=this.renderer.buffer,r=0;r<t.buffers.length;r++){var n=t.buffers[r];i.update(n)}},e.prototype.checkCompatibility=function(t,i){var r=t.attributes,n=i.attributeData;for(var o in n)if(!r[o])throw new Error('shader and geometry incompatible, geometry missing the "'+o+'" attribute')},e.prototype.getSignature=function(t,i){var r=t.attributes,n=i.attributeData,o=["g",t.id];for(var s in r)n[s]&&o.push(s,n[s].location);return o.join("-")},e.prototype.initGeometryVao=function(t,i,r){r===void 0&&(r=!0);var n=this.gl,o=this.CONTEXT_UID,s=this.renderer.buffer,a=i.program;a.glPrograms[o]||this.renderer.shader.generateProgram(i),this.checkCompatibility(t,a);var h=this.getSignature(t,a),l=t.glVertexArrayObjects[this.CONTEXT_UID],u=l[h];if(u)return l[a.id]=u,u;var c=t.buffers,d=t.attributes,f={},m={};for(var v in c)f[v]=0,m[v]=0;for(var v in d)!d[v].size&&a.attributeData[v]?d[v].size=a.attributeData[v].size:d[v].size||console.warn("PIXI Geometry attribute '"+v+"' size cannot be determined (likely the bound shader does not have the attribute)"),f[d[v].buffer]+=d[v].size*$r[d[v].type];for(var v in d){var y=d[v],g=y.size;y.stride===void 0&&(f[y.buffer]===g*$r[y.type]?y.stride=0:y.stride=f[y.buffer]),y.start===void 0&&(y.start=m[y.buffer],m[y.buffer]+=g*$r[y.type])}u=n.createVertexArray(),n.bindVertexArray(u);for(var x=0;x<c.length;x++){var _=c[x];s.bind(_),r&&_._glBuffers[o].refCount++}return this.activateVao(t,a),this._activeVao=u,l[a.id]=u,l[h]=u,u},e.prototype.disposeGeometry=function(t,i){var r;if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var n=t.glVertexArrayObjects[this.CONTEXT_UID],o=this.gl,s=t.buffers,a=(r=this.renderer)===null||r===void 0?void 0:r.buffer;if(t.disposeRunner.remove(this),!!n){if(a)for(var h=0;h<s.length;h++){var l=s[h]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!i&&a.dispose(s[h],i))}if(!i){for(var u in n)if(u[0]==="g"){var c=n[u];this._activeVao===c&&this.unbind(),o.deleteVertexArray(c)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},e.prototype.disposeAll=function(t){for(var i=Object.keys(this.managedGeometries),r=0;r<i.length;r++)this.disposeGeometry(this.managedGeometries[i[r]],t)},e.prototype.activateVao=function(t,i){var r=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,s=t.buffers,a=t.attributes;t.indexBuffer&&o.bind(t.indexBuffer);var h=null;for(var l in a){var u=a[l],c=s[u.buffer],d=c._glBuffers[n];if(i.attributeData[l]){h!==d&&(o.bind(c),h=d);var f=i.attributeData[l].location;if(r.enableVertexAttribArray(f),r.vertexAttribPointer(f,u.size,u.type||r.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)r.vertexAttribDivisor(f,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}},e.prototype.draw=function(t,i,r,n){var o=this.gl,s=this._activeGeometry;if(s.indexBuffer){var a=s.indexBuffer.data.BYTES_PER_ELEMENT,h=a===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?s.instanced?o.drawElementsInstanced(t,i||s.indexBuffer.data.length,h,(r||0)*a,n||1):o.drawElements(t,i||s.indexBuffer.data.length,h,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else s.instanced?o.drawArraysInstanced(t,r,i||s.getSize(),n||1):o.drawArrays(t,r,i||s.getSize());return this},e.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},e.prototype.destroy=function(){this.renderer=null},e}(),im=function(){function e(t){t===void 0&&(t=null),this.type=ht.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=F.FILTER_MULTISAMPLE,this.enabled=!0,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._target=null}return Object.defineProperty(e.prototype,"filter",{get:function(){return this._filters?this._filters[0]:null},set:function(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=ht.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null},e.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},e}();function Vs(e,t,i){var r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}function qs(e,t){var i=e.getShaderSource(t).split(`
`).map(function(l,u){return u+": "+l}),r=e.getShaderInfoLog(t),n=r.split(`
`),o={},s=n.map(function(l){return parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))}).filter(function(l){return l&&!o[l]?(o[l]=!0,!0):!1}),a=[""];s.forEach(function(l){i[l-1]="%c"+i[l-1]+"%c",a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});var h=i.join(`
`);a[0]=h,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn.apply(console,a),console.groupEnd()}function rm(e,t,i,r){e.getProgramParameter(t,e.LINK_STATUS)||(e.getShaderParameter(i,e.COMPILE_STATUS)||qs(e,i),e.getShaderParameter(r,e.COMPILE_STATUS)||qs(e,r),console.error("PixiJS Error: Could not initialize shader."),e.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(t)))}function Kr(e){for(var t=new Array(e),i=0;i<t.length;i++)t[i]=!1;return t}function Eh(e,t){switch(e){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Kr(2*t);case"bvec3":return Kr(3*t);case"bvec4":return Kr(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var wh={},Ke=wh;function nm(){if(Ke===wh||Ke&&Ke.isContextLost()){var e=document.createElement("canvas"),t=void 0;F.PREFER_ENV>=jt.WEBGL2&&(t=e.getContext("webgl2",{})),t||(t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Ke=t}return Ke}var Gi;function om(){if(!Gi){Gi=At.MEDIUM;var e=nm();if(e&&e.getShaderPrecisionFormat){var t=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);Gi=t.precision?At.HIGH:At.MEDIUM}}return Gi}function Zs(e,t,i){if(e.substring(0,9)!=="precision"){var r=t;return t===At.HIGH&&i!==At.HIGH&&(r=At.MEDIUM),"precision "+r+` float;
`+e}else if(i!==At.HIGH&&e.substring(0,15)==="precision highp")return e.replace("precision highp","precision mediump");return e}var sm={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Th(e){return sm[e]}var Hi=null,$s={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Ih(e,t){if(!Hi){var i=Object.keys($s);Hi={};for(var r=0;r<i.length;++r){var n=i[r];Hi[e[n]]=$s[n]}}return Hi[t]}var Ye=[{test:function(e){return e.type==="float"&&e.size===1},code:function(e){return`
            if(uv["`+e+'"] !== ud["'+e+`"].value)
            {
                ud["`+e+'"].value = uv["'+e+`"]
                gl.uniform1f(ud["`+e+'"].location, uv["'+e+`"])
            }
            `}},{test:function(e){return(e.type==="sampler2D"||e.type==="samplerCube"||e.type==="sampler2DArray")&&e.size===1&&!e.isArray},code:function(e){return`t = syncData.textureCount++;

            renderer.texture.bind(uv["`+e+`"], t);

            if(ud["`+e+`"].value !== t)
            {
                ud["`+e+`"].value = t;
                gl.uniform1i(ud["`+e+`"].location, t);
; // eslint-disable-line max-len
            }`}},{test:function(e,t){return e.type==="mat3"&&e.size===1&&t.a!==void 0},code:function(e){return`
            gl.uniformMatrix3fv(ud["`+e+'"].location, false, uv["'+e+`"].toArray(true));
            `},codeUbo:function(e){return`
                var `+e+"_matrix = uv."+e+`.toArray(true);

                data[offset] = `+e+`_matrix[0];
                data[offset+1] = `+e+`_matrix[1];
                data[offset+2] = `+e+`_matrix[2];
        
                data[offset + 4] = `+e+`_matrix[3];
                data[offset + 5] = `+e+`_matrix[4];
                data[offset + 6] = `+e+`_matrix[5];
        
                data[offset + 8] = `+e+`_matrix[6];
                data[offset + 9] = `+e+`_matrix[7];
                data[offset + 10] = `+e+`_matrix[8];
            `}},{test:function(e,t){return e.type==="vec2"&&e.size===1&&t.x!==void 0},code:function(e){return`
                cv = ud["`+e+`"].value;
                v = uv["`+e+`"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["`+e+`"].location, v.x, v.y);
                }`},codeUbo:function(e){return`
                v = uv.`+e+`;

                data[offset] = v.x;
                data[offset+1] = v.y;
            `}},{test:function(e){return e.type==="vec2"&&e.size===1},code:function(e){return`
                cv = ud["`+e+`"].value;
                v = uv["`+e+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["`+e+`"].location, v[0], v[1]);
                }
            `}},{test:function(e,t){return e.type==="vec4"&&e.size===1&&t.width!==void 0},code:function(e){return`
                cv = ud["`+e+`"].value;
                v = uv["`+e+`"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["`+e+`"].location, v.x, v.y, v.width, v.height)
                }`},codeUbo:function(e){return`
                    v = uv.`+e+`;

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `}},{test:function(e){return e.type==="vec4"&&e.size===1},code:function(e){return`
                cv = ud["`+e+`"].value;
                v = uv["`+e+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["`+e+`"].location, v[0], v[1], v[2], v[3])
                }`}}],am={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},hm={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function lm(e,t){var i,r=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(var n in e.uniforms){var o=t[n];if(!o){!((i=e.uniforms[n])===null||i===void 0)&&i.group&&(e.uniforms[n].ubo?r.push(`
                        renderer.shader.syncUniformBufferGroup(uv.`+n+", '"+n+`');
                    `):r.push(`
                        renderer.shader.syncUniformGroup(uv.`+n+`, syncData);
                    `));continue}for(var s=e.uniforms[n],a=!1,h=0;h<Ye.length;h++)if(Ye[h].test(o,s)){r.push(Ye[h].code(n,s)),a=!0;break}if(!a){var l=o.size===1?am:hm,u=l[o.type].replace("location",'ud["'+n+'"].location');r.push(`
            cu = ud["`+n+`"];
            cv = cu.value;
            v = uv["`+n+`"];
            `+u+";")}}return new Function("ud","uv","renderer","syncData",r.join(`
`))}var um=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function cm(e){for(var t="",i=0;i<e;++i)i>0&&(t+=`
else `),i<e-1&&(t+="if(test == "+i+".0){}");return t}function pm(e,t){if(e===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var i=t.createShader(t.FRAGMENT_SHADER);;){var r=um.replace(/%forloop%/gi,cm(e));if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))e=e/2|0;else break}return e}var Je;function dm(){if(typeof Je=="boolean")return Je;try{var e=new Function("param1","param2","param3","return param1[param2] === param3;");Je=e({a:"b"},"a","b")===!0}catch{Je=!1}return Je}var fm=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,mm=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`,ym=0,Wi={},To=function(){function e(t,i,r){r===void 0&&(r="pixi-shader"),this.id=ym++,this.vertexSrc=t||e.defaultVertexSrc,this.fragmentSrc=i||e.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Wi[r]?(Wi[r]++,r+="-"+Wi[r]):Wi[r]=1,this.vertexSrc="#define SHADER_NAME "+r+`
`+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+r+`
`+this.fragmentSrc,this.vertexSrc=Zs(this.vertexSrc,F.PRECISION_VERTEX,At.HIGH),this.fragmentSrc=Zs(this.fragmentSrc,F.PRECISION_FRAGMENT,om())),this.glPrograms={},this.syncUniforms=null}return Object.defineProperty(e,"defaultVertexSrc",{get:function(){return mm},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return fm},enumerable:!1,configurable:!0}),e.from=function(t,i,r){var n=t+i,o=kn[n];return o||(kn[n]=o=new e(t,i,r)),o},e}(),Io=function(){function e(t,i){this.uniformBindCount=0,this.program=t,i?i instanceof xe?this.uniformGroup=i:this.uniformGroup=new xe(i):this.uniformGroup=new xe({})}return e.prototype.checkUniformExists=function(t,i){if(i.uniforms[t])return!0;for(var r in i.uniforms){var n=i.uniforms[r];if(n.group&&this.checkUniformExists(t,n))return!0}return!1},e.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(e.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),e.from=function(t,i,r){var n=To.from(t,i);return new e(n,r)},e}(),Jr=0,Qr=1,tn=2,en=3,rn=4,nn=5,Cr=function(){function e(){this.data=0,this.blendMode=w.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(e.prototype,"blend",{get:function(){return!!(this.data&1<<Jr)},set:function(t){!!(this.data&1<<Jr)!==t&&(this.data^=1<<Jr)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsets",{get:function(){return!!(this.data&1<<Qr)},set:function(t){!!(this.data&1<<Qr)!==t&&(this.data^=1<<Qr)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"culling",{get:function(){return!!(this.data&1<<tn)},set:function(t){!!(this.data&1<<tn)!==t&&(this.data^=1<<tn)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return!!(this.data&1<<en)},set:function(t){!!(this.data&1<<en)!==t&&(this.data^=1<<en)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return!!(this.data&1<<nn)},set:function(t){!!(this.data&1<<nn)!==t&&(this.data^=1<<nn)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clockwiseFrontFace",{get:function(){return!!(this.data&1<<rn)},set:function(t){!!(this.data&1<<rn)!==t&&(this.data^=1<<rn)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){this.blend=t!==w.NONE,this._blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(t){this.offsets=!!t,this._polygonOffset=t},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"[@pixi/core:State "+("blendMode="+this.blendMode+" ")+("clockwiseFrontFace="+this.clockwiseFrontFace+" ")+("culling="+this.culling+" ")+("depthMask="+this.depthMask+" ")+("polygonOffset="+this.polygonOffset)+"]"},e.for2d=function(){var t=new e;return t.depthTest=!1,t.blend=!0,t},e}(),vm=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,gm=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,Ch=function(e){V(t,e);function t(i,r,n){var o=this,s=To.from(i||t.defaultVertexSrc,r||t.defaultFragmentSrc);return o=e.call(this,s,n)||this,o.padding=0,o.resolution=F.FILTER_RESOLUTION,o.multisample=F.FILTER_MULTISAMPLE,o.enabled=!0,o.autoFit=!0,o.state=new Cr,o}return t.prototype.apply=function(i,r,n,o,s){i.applyFilter(this,r,n,o)},Object.defineProperty(t.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(i){this.state.blendMode=i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolution",{get:function(){return this._resolution},set:function(i){this._resolution=i},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultVertexSrc",{get:function(){return vm},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentSrc",{get:function(){return gm},enumerable:!1,configurable:!0}),t}(Io),_m=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,xm=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,Ks=new J,bm=function(){function e(t,i){this._texture=t,this.mapCoord=new J,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof i>"u"?.5:i,this.isSimple=!1}return Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t,this._textureID=-1},enumerable:!1,configurable:!0}),e.prototype.multiplyUvs=function(t,i){i===void 0&&(i=t);for(var r=this.mapCoord,n=0;n<t.length;n+=2){var o=t[n],s=t[n+1];i[n]=o*r.a+s*r.c+r.tx,i[n+1]=o*r.b+s*r.d+r.ty}return i},e.prototype.update=function(t){var i=this._texture;if(!i||!i.valid||!t&&this._textureID===i._updateID)return!1;this._textureID=i._updateID,this._updateID++;var r=i._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);var n=i.orig,o=i.trim;o&&(Ks.set(n.width/o.width,0,0,n.height/o.height,-o.x/o.width,-o.y/o.height),this.mapCoord.append(Ks));var s=i.baseTexture,a=this.uClampFrame,h=this.clampMargin/s.resolution,l=this.clampOffset;return a[0]=(i._frame.x+h+l)/s.width,a[1]=(i._frame.y+h+l)/s.height,a[2]=(i._frame.x+i._frame.width-h+l)/s.width,a[3]=(i._frame.y+i._frame.height-h+l)/s.height,this.uClampOffset[0]=l/s.realWidth,this.uClampOffset[1]=l/s.realHeight,this.isSimple=i._frame.width===s.width&&i._frame.height===s.height&&i.rotate===0,!0},e}(),Pm=function(e){V(t,e);function t(i,r,n){var o=this,s=null;return typeof i!="string"&&r===void 0&&n===void 0&&(s=i,i=void 0,r=void 0,n=void 0),o=e.call(this,i||_m,r||xm,n)||this,o.maskSprite=s,o.maskMatrix=new J,o}return Object.defineProperty(t.prototype,"maskSprite",{get:function(){return this._maskSprite},set:function(i){this._maskSprite=i,this._maskSprite&&(this._maskSprite.renderable=!1)},enumerable:!1,configurable:!0}),t.prototype.apply=function(i,r,n,o){var s=this._maskSprite,a=s._texture;!a.valid||(a.uvMatrix||(a.uvMatrix=new bm(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=i.calculateSpriteMatrix(this.maskMatrix,s).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,i.applyFilter(this,r,n,o))},t}(Ch),Em=function(){function e(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return e.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},e.prototype.push=function(t,i){var r=i;if(!r.isMaskData){var n=this.maskDataPool.pop()||new im;n.pooled=!0,n.maskObject=i,r=n}var o=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(o),r.autoDetect&&this.detect(r),r._target=t,r.type!==ht.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case ht.SCISSOR:this.renderer.scissor.push(r);break;case ht.STENCIL:this.renderer.stencil.push(r);break;case ht.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break}r.type===ht.SPRITE&&this.maskStack.push(r)},e.prototype.pop=function(t){var i=this.maskStack.pop();if(!(!i||i._target!==t)){if(i.enabled)switch(i.type){case ht.SCISSOR:this.renderer.scissor.pop();break;case ht.STENCIL:this.renderer.stencil.pop(i.maskObject);break;case ht.SPRITE:this.popSpriteMask(i);break}if(i.reset(),i.pooled&&this.maskDataPool.push(i),this.maskStack.length!==0){var r=this.maskStack[this.maskStack.length-1];r.type===ht.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}},e.prototype.detect=function(t){var i=t.maskObject;i.isSprite?t.type=ht.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=ht.SCISSOR:t.type=ht.STENCIL},e.prototype.pushSpriteMask=function(t){var i,r,n=t.maskObject,o=t._target,s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new Pm]));var a=this.renderer,h=a.renderTexture,l,u;if(h.current){var c=h.current;l=t.resolution||c.resolution,u=(i=t.multisample)!==null&&i!==void 0?i:c.multisample}else l=t.resolution||a.resolution,u=(r=t.multisample)!==null&&r!==void 0?r:a.multisample;s[0].resolution=l,s[0].multisample=u,s[0].maskSprite=n;var d=o.filterArea;o.filterArea=n.getBounds(!0),a.filter.push(o,s),o.filterArea=d,t._filters||this.alphaMaskIndex++},e.prototype.popSpriteMask=function(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)},e.prototype.destroy=function(){this.renderer=null},e}(),Sh=function(){function e(t){this.renderer=t,this.maskStack=[],this.glConst=0}return e.prototype.getStackLength=function(){return this.maskStack.length},e.prototype.setMaskStack=function(t){var i=this.renderer.gl,r=this.getStackLength();this.maskStack=t;var n=this.getStackLength();n!==r&&(n===0?i.disable(this.glConst):(i.enable(this.glConst),this._useCurrent()))},e.prototype._useCurrent=function(){},e.prototype.destroy=function(){this.renderer=null,this.maskStack=null},e}(),Js=new J,wm=function(e){V(t,e);function t(i){var r=e.call(this,i)||this;return r.glConst=WebGLRenderingContext.SCISSOR_TEST,r}return t.prototype.getStackLength=function(){var i=this.maskStack[this.maskStack.length-1];return i?i._scissorCounter:0},t.prototype.calcScissorRect=function(i){if(!i._scissorRectLocal){var r=i._scissorRect,n=i.maskObject,o=this.renderer,s=o.renderTexture;n.renderable=!0;var a=n.getBounds();this.roundFrameToPixels(a,s.current?s.current.resolution:o.resolution,s.sourceFrame,s.destinationFrame,o.projection.transform),n.renderable=!1,r&&a.fit(r),i._scissorRectLocal=a}},t.isMatrixRotated=function(i){if(!i)return!1;var r=i.a,n=i.b,o=i.c,s=i.d;return(Math.abs(n)>1e-4||Math.abs(o)>1e-4)&&(Math.abs(r)>1e-4||Math.abs(s)>1e-4)},t.prototype.testScissor=function(i){var r=i.maskObject;if(!r.isFastRect||!r.isFastRect()||t.isMatrixRotated(r.worldTransform)||t.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(i);var n=i._scissorRectLocal;return n.width>0&&n.height>0},t.prototype.roundFrameToPixels=function(i,r,n,o,s){t.isMatrixRotated(s)||(s=s?Js.copyFrom(s):Js.identity(),s.translate(-n.x,-n.y).scale(o.width/n.width,o.height/n.height).translate(o.x,o.y),this.renderer.filter.transformAABB(s,i),i.fit(o),i.x=Math.round(i.x*r),i.y=Math.round(i.y*r),i.width=Math.round(i.width*r),i.height=Math.round(i.height*r))},t.prototype.push=function(i){i._scissorRectLocal||this.calcScissorRect(i);var r=this.renderer.gl;i._scissorRect||r.enable(r.SCISSOR_TEST),i._scissorCounter++,i._scissorRect=i._scissorRectLocal,this._useCurrent()},t.prototype.pop=function(){var i=this.renderer.gl;this.getStackLength()>0?this._useCurrent():i.disable(i.SCISSOR_TEST)},t.prototype._useCurrent=function(){var i=this.maskStack[this.maskStack.length-1]._scissorRect,r;this.renderer.renderTexture.current?r=i.y:r=this.renderer.height-i.height-i.y,this.renderer.gl.scissor(i.x,r,i.width,i.height)},t}(Sh),Tm=function(e){V(t,e);function t(i){var r=e.call(this,i)||this;return r.glConst=WebGLRenderingContext.STENCIL_TEST,r}return t.prototype.getStackLength=function(){var i=this.maskStack[this.maskStack.length-1];return i?i._stencilCounter:0},t.prototype.push=function(i){var r=i.maskObject,n=this.renderer.gl,o=i._stencilCounter;o===0&&(this.renderer.framebuffer.forceStencil(),n.clearStencil(0),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST)),i._stencilCounter++,n.colorMask(!1,!1,!1,!1),n.stencilFunc(n.EQUAL,o,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.INCR),r.renderable=!0,r.render(this.renderer),this.renderer.batch.flush(),r.renderable=!1,this._useCurrent()},t.prototype.pop=function(i){var r=this.renderer.gl;this.getStackLength()===0?r.disable(r.STENCIL_TEST):(r.colorMask(!1,!1,!1,!1),r.stencilOp(r.KEEP,r.KEEP,r.DECR),i.renderable=!0,i.render(this.renderer),this.renderer.batch.flush(),i.renderable=!1,this._useCurrent())},t.prototype._useCurrent=function(){var i=this.renderer.gl;i.colorMask(!0,!0,!0,!0),i.stencilFunc(i.EQUAL,this.getStackLength(),4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)},t}(Sh),Im=function(){function e(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new J,this.transform=null}return e.prototype.update=function(t,i,r,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=i||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,n),this.transform&&this.projectionMatrix.append(this.transform);var o=this.renderer;o.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,o.globalUniforms.update(),o.shader.shader&&o.shader.syncUniformGroup(o.shader.shader.uniforms.globals)},e.prototype.calculateProjection=function(t,i,r,n){var o=this.projectionMatrix,s=n?-1:1;o.identity(),o.a=1/i.width*2,o.d=s*(1/i.height*2),o.tx=-1-i.x*o.a,o.ty=-s-i.y*o.d},e.prototype.setTransform=function(t){},e.prototype.destroy=function(){this.renderer=null},e}(),ce=new X,Qe=new X,Cm=function(){function e(t){this.renderer=t,this.clearColor=t._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new X,this.destinationFrame=new X,this.viewportFrame=new X}return e.prototype.bind=function(t,i,r){t===void 0&&(t=null);var n=this.renderer;this.current=t;var o,s,a;t?(o=t.baseTexture,a=o.resolution,i||(ce.width=t.frame.width,ce.height=t.frame.height,i=ce),r||(Qe.x=t.frame.x,Qe.y=t.frame.y,Qe.width=i.width,Qe.height=i.height,r=Qe),s=o.framebuffer):(a=n.resolution,i||(ce.width=n.screen.width,ce.height=n.screen.height,i=ce),r||(r=ce,r.width=i.width,r.height=i.height));var h=this.viewportFrame;h.x=r.x*a,h.y=r.y*a,h.width=r.width*a,h.height=r.height*a,t||(h.y=n.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(s,h),this.renderer.projection.update(r,i,a,!s),t?this.renderer.mask.setMaskStack(o.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(i),this.destinationFrame.copyFrom(r)},e.prototype.clear=function(t,i){this.current?t=t||this.current.baseTexture.clearColor:t=t||this.clearColor;var r=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer.screen,o=r.width!==n.width||r.height!==n.height;if(o){var s=this.viewportFrame,a=s.x,h=s.y,l=s.width,u=s.height;a=Math.round(a),h=Math.round(h),l=Math.round(l),u=Math.round(u),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(a,h,l,u)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],i),o&&this.renderer.scissor.pop()},e.prototype.resize=function(){this.bind(null)},e.prototype.reset=function(){this.bind(null)},e.prototype.destroy=function(){this.renderer=null},e}();function Sm(e,t,i,r,n){i.buffer.update(n)}var Am={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Ah={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function Om(e){for(var t=e.map(function(h){return{data:h,offset:0,dataLen:0,dirty:0}}),i=0,r=0,n=0,o=0;o<t.length;o++){var s=t[o];if(i=Ah[s.data.type],s.data.size>1&&(i=Math.max(i,16)*s.data.size),s.dataLen=i,r%i!==0&&r<16){var a=r%i%16;r+=a,n+=a}r+i>16?(n=Math.ceil(n/16)*16,s.offset=n,n+=i,r=i):(s.offset=n,r+=i,n+=i)}return n=Math.ceil(n/16)*16,{uboElements:t,size:n}}function Lm(e,t){var i=[];for(var r in e)t[r]&&i.push(t[r]);return i.sort(function(n,o){return n.index-o.index}),i}function Nm(e,t){if(!e.autoManage)return{size:0,syncFunc:Sm};for(var i=Lm(e.uniforms,t),r=Om(i),n=r.uboElements,o=r.size,s=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `],a=0;a<n.length;a++){for(var h=n[a],l=e.uniforms[h.data.name],u=h.data.name,c=!1,d=0;d<Ye.length;d++){var f=Ye[d];if(f.codeUbo&&f.test(h.data,l)){s.push("offset = "+h.offset/4+";",Ye[d].codeUbo(h.data.name,l)),c=!0;break}}if(!c)if(h.data.size>1){var m=Th(h.data.type),v=Math.max(Ah[h.data.type]/16,1),y=m/v,g=(4-y%4)%4;s.push(`
                cv = ud.`+u+`.value;
                v = uv.`+u+`;
                offset = `+h.offset/4+`;

                t = 0;

                for(var i=0; i < `+h.data.size*v+`; i++)
                {
                    for(var j = 0; j < `+y+`; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += `+g+`;
                }

                `)}else{var x=Am[h.data.type];s.push(`
                cv = ud.`+u+`.value;
                v = uv.`+u+`;
                offset = `+h.offset/4+`;
                `+x+`;
                `)}}return s.push(`
       renderer.buffer.update(buffer);
    `),{size:o,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join(`
`))}}var Rm=function(){function e(t,i){this.program=t,this.uniformData=i,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}return e.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null},e}();function Mm(e,t){for(var i={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),n=0;n<r;n++){var o=t.getActiveAttrib(e,n);if(o.name.indexOf("gl_")!==0){var s=Ih(t,o.type),a={type:s,name:o.name,size:Th(s),location:t.getAttribLocation(e,o.name)};i[o.name]=a}}return i}function Dm(e,t){for(var i={},r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),n=0;n<r;n++){var o=t.getActiveUniform(e,n),s=o.name.replace(/\[.*?\]$/,""),a=!!o.name.match(/\[.*?\]$/),h=Ih(t,o.type);i[s]={name:s,index:n,type:h,size:o.size,isArray:a,value:Eh(h,o.size)}}return i}function Fm(e,t){var i=Vs(e,e.VERTEX_SHADER,t.vertexSrc),r=Vs(e,e.FRAGMENT_SHADER,t.fragmentSrc),n=e.createProgram();if(e.attachShader(n,i),e.attachShader(n,r),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)||rm(e,n,i,r),t.attributeData=Mm(n,e),t.uniformData=Dm(n,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){var o=Object.keys(t.attributeData);o.sort(function(u,c){return u>c?1:-1});for(var s=0;s<o.length;s++)t.attributeData[o[s]].location=s,e.bindAttribLocation(n,s,o[s]);e.linkProgram(n)}e.deleteShader(i),e.deleteShader(r);var a={};for(var s in t.uniformData){var h=t.uniformData[s];a[s]={location:e.getUniformLocation(n,s),value:Eh(h.type,h.size)}}var l=new Rm(n,a);return l}var Bm=0,zi={textureCount:0,uboCount:0},Oh=function(){function e(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Bm++}return e.prototype.systemCheck=function(){if(!dm())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},e.prototype.contextChange=function(t){this.gl=t,this.reset()},e.prototype.bind=function(t,i){t.uniforms.globals=this.renderer.globalUniforms;var r=t.program,n=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(n.program)),i||(zi.textureCount=0,zi.uboCount=0,this.syncUniformGroup(t.uniformGroup,zi)),n},e.prototype.setUniforms=function(t){var i=this.shader.program,r=i.glPrograms[this.renderer.CONTEXT_UID];i.syncUniforms(r.uniformData,t,this.renderer)},e.prototype.syncUniformGroup=function(t,i){var r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,i))},e.prototype.syncUniforms=function(t,i,r){var n=t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t);n(i.uniformData,t.uniforms,this.renderer,r)},e.prototype.createSyncGroups=function(t){var i=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[i]||(this.cache[i]=lm(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[i],t.syncUniforms[this.shader.program.id]},e.prototype.syncUniformBufferGroup=function(t,i){var r=this.getGlProgram();if(!t.static||t.dirtyId!==0||!r.uniformGroups[t.id]){t.dirtyId=0;var n=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,i);t.buffer.update(),n(r.uniformData,t.uniforms,this.renderer,zi,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[i])},e.prototype.createSyncBufferGroup=function(t,i,r){var n=this.renderer.gl;this.renderer.buffer.bind(t.buffer);var o=this.gl.getUniformBlockIndex(i.program,r);i.uniformBufferBindings[r]=this.shader.uniformBindCount,n.uniformBlockBinding(i.program,o,this.shader.uniformBindCount),this.shader.uniformBindCount++;var s=this.getSignature(t,this.shader.program.uniformData,"ubo"),a=this._uboCache[s];if(a||(a=this._uboCache[s]=Nm(t,this.shader.program.uniformData)),t.autoManage){var h=new Float32Array(a.size/4);t.buffer.update(h)}return i.uniformGroups[t.id]=a.syncFunc,i.uniformGroups[t.id]},e.prototype.getSignature=function(t,i,r){var n=t.uniforms,o=[r+"-"];for(var s in n)o.push(s),i[s]&&o.push(i[s].type);return o.join("-")},e.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},e.prototype.generateProgram=function(t){var i=this.gl,r=t.program,n=Fm(i,r);return r.glPrograms[this.renderer.CONTEXT_UID]=n,n},e.prototype.reset=function(){this.program=null,this.shader=null},e.prototype.destroy=function(){this.renderer=null,this.destroyed=!0},e}();function km(e,t){return t===void 0&&(t=[]),t[w.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.ADD]=[e.ONE,e.ONE],t[w.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.NONE]=[0,0],t[w.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[w.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[w.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[w.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[w.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[w.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[w.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[w.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[w.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[w.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[w.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}var Um=0,Xm=1,Ym=2,Gm=3,Hm=4,Wm=5,zm=function(){function e(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=w.NONE,this._blendEq=!1,this.map=[],this.map[Um]=this.setBlend,this.map[Xm]=this.setOffset,this.map[Ym]=this.setCullFace,this.map[Gm]=this.setDepthTest,this.map[Hm]=this.setFrontFace,this.map[Wm]=this.setDepthMask,this.checks=[],this.defaultState=new Cr,this.defaultState.blend=!0}return e.prototype.contextChange=function(t){this.gl=t,this.blendModes=km(t),this.set(this.defaultState),this.reset()},e.prototype.set=function(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var i=this.stateId^t.data,r=0;i;)i&1&&this.map[r].call(this,!!(t.data&1<<r)),i=i>>1,r++;this.stateId=t.data}for(var r=0;r<this.checks.length;r++)this.checks[r](this,t)},e.prototype.forceState=function(t){t=t||this.defaultState;for(var i=0;i<this.map.length;i++)this.map[i].call(this,!!(t.data&1<<i));for(var i=0;i<this.checks.length;i++)this.checks[i](this,t);this.stateId=t.data},e.prototype.setBlend=function(t){this.updateCheck(e.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},e.prototype.setOffset=function(t){this.updateCheck(e.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},e.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},e.prototype.setDepthMask=function(t){this.gl.depthMask(t)},e.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},e.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},e.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var i=this.blendModes[t],r=this.gl;i.length===2?r.blendFunc(i[0],i[1]):r.blendFuncSeparate(i[0],i[1],i[2],i[3]),i.length===6?(this._blendEq=!0,r.blendEquationSeparate(i[4],i[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}},e.prototype.setPolygonOffset=function(t,i){this.gl.polygonOffset(t,i)},e.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},e.prototype.updateCheck=function(t,i){var r=this.checks.indexOf(t);i&&r===-1?this.checks.push(t):!i&&r!==-1&&this.checks.splice(r,1)},e.checkBlendMode=function(t,i){t.setBlendMode(i.blendMode)},e.checkPolygonOffset=function(t,i){t.setPolygonOffset(1,i.polygonOffset)},e.prototype.destroy=function(){this.gl=null},e}(),jm=function(){function e(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=F.GC_MAX_IDLE,this.checkCountMax=F.GC_MAX_CHECK_COUNT,this.mode=F.GC_MODE}return e.prototype.postrender=function(){!this.renderer.renderingToScreen||(this.count++,this.mode!==En.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},e.prototype.run=function(){for(var t=this.renderer.texture,i=t.managedTextures,r=!1,n=0;n<i.length;n++){var o=i[n];!o.framebuffer&&this.count-o.touched>this.maxIdle&&(t.destroyTexture(o,!0),i[n]=null,r=!0)}if(r){for(var s=0,n=0;n<i.length;n++)i[n]!==null&&(i[s++]=i[n]);i.length=s}},e.prototype.unload=function(t){var i=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&i.destroyTexture(r);for(var n=t.children.length-1;n>=0;n--)this.unload(t.children[n])},e.prototype.destroy=function(){this.renderer=null},e}();function Vm(e){var t,i,r,n,o,s,a,h,l,u,c,d,f,m,v,y,g,x,_,E,b,P,S;return"WebGL2RenderingContext"in self&&e instanceof self.WebGL2RenderingContext?S=(t={},t[U.UNSIGNED_BYTE]=(i={},i[L.RGBA]=e.RGBA8,i[L.RGB]=e.RGB8,i[L.RG]=e.RG8,i[L.RED]=e.R8,i[L.RGBA_INTEGER]=e.RGBA8UI,i[L.RGB_INTEGER]=e.RGB8UI,i[L.RG_INTEGER]=e.RG8UI,i[L.RED_INTEGER]=e.R8UI,i[L.ALPHA]=e.ALPHA,i[L.LUMINANCE]=e.LUMINANCE,i[L.LUMINANCE_ALPHA]=e.LUMINANCE_ALPHA,i),t[U.BYTE]=(r={},r[L.RGBA]=e.RGBA8_SNORM,r[L.RGB]=e.RGB8_SNORM,r[L.RG]=e.RG8_SNORM,r[L.RED]=e.R8_SNORM,r[L.RGBA_INTEGER]=e.RGBA8I,r[L.RGB_INTEGER]=e.RGB8I,r[L.RG_INTEGER]=e.RG8I,r[L.RED_INTEGER]=e.R8I,r),t[U.UNSIGNED_SHORT]=(n={},n[L.RGBA_INTEGER]=e.RGBA16UI,n[L.RGB_INTEGER]=e.RGB16UI,n[L.RG_INTEGER]=e.RG16UI,n[L.RED_INTEGER]=e.R16UI,n[L.DEPTH_COMPONENT]=e.DEPTH_COMPONENT16,n),t[U.SHORT]=(o={},o[L.RGBA_INTEGER]=e.RGBA16I,o[L.RGB_INTEGER]=e.RGB16I,o[L.RG_INTEGER]=e.RG16I,o[L.RED_INTEGER]=e.R16I,o),t[U.UNSIGNED_INT]=(s={},s[L.RGBA_INTEGER]=e.RGBA32UI,s[L.RGB_INTEGER]=e.RGB32UI,s[L.RG_INTEGER]=e.RG32UI,s[L.RED_INTEGER]=e.R32UI,s[L.DEPTH_COMPONENT]=e.DEPTH_COMPONENT24,s),t[U.INT]=(a={},a[L.RGBA_INTEGER]=e.RGBA32I,a[L.RGB_INTEGER]=e.RGB32I,a[L.RG_INTEGER]=e.RG32I,a[L.RED_INTEGER]=e.R32I,a),t[U.FLOAT]=(h={},h[L.RGBA]=e.RGBA32F,h[L.RGB]=e.RGB32F,h[L.RG]=e.RG32F,h[L.RED]=e.R32F,h[L.DEPTH_COMPONENT]=e.DEPTH_COMPONENT32F,h),t[U.HALF_FLOAT]=(l={},l[L.RGBA]=e.RGBA16F,l[L.RGB]=e.RGB16F,l[L.RG]=e.RG16F,l[L.RED]=e.R16F,l),t[U.UNSIGNED_SHORT_5_6_5]=(u={},u[L.RGB]=e.RGB565,u),t[U.UNSIGNED_SHORT_4_4_4_4]=(c={},c[L.RGBA]=e.RGBA4,c),t[U.UNSIGNED_SHORT_5_5_5_1]=(d={},d[L.RGBA]=e.RGB5_A1,d),t[U.UNSIGNED_INT_2_10_10_10_REV]=(f={},f[L.RGBA]=e.RGB10_A2,f[L.RGBA_INTEGER]=e.RGB10_A2UI,f),t[U.UNSIGNED_INT_10F_11F_11F_REV]=(m={},m[L.RGB]=e.R11F_G11F_B10F,m),t[U.UNSIGNED_INT_5_9_9_9_REV]=(v={},v[L.RGB]=e.RGB9_E5,v),t[U.UNSIGNED_INT_24_8]=(y={},y[L.DEPTH_STENCIL]=e.DEPTH24_STENCIL8,y),t[U.FLOAT_32_UNSIGNED_INT_24_8_REV]=(g={},g[L.DEPTH_STENCIL]=e.DEPTH32F_STENCIL8,g),t):S=(x={},x[U.UNSIGNED_BYTE]=(_={},_[L.RGBA]=e.RGBA,_[L.RGB]=e.RGB,_[L.ALPHA]=e.ALPHA,_[L.LUMINANCE]=e.LUMINANCE,_[L.LUMINANCE_ALPHA]=e.LUMINANCE_ALPHA,_),x[U.UNSIGNED_SHORT_5_6_5]=(E={},E[L.RGB]=e.RGB,E),x[U.UNSIGNED_SHORT_4_4_4_4]=(b={},b[L.RGBA]=e.RGBA,b),x[U.UNSIGNED_SHORT_5_5_5_1]=(P={},P[L.RGBA]=e.RGBA,P),x),S}var on=function(){function e(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=U.UNSIGNED_BYTE,this.internalFormat=L.RGBA,this.samplerType=0}return e}(),qm=function(){function e(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new W,this.hasIntegerTextures=!1}return e.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=Vm(t);var i=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=i;for(var r=0;r<i;r++)this.boundTextures[r]=null;this.emptyTextures={};var n=new on(t.createTexture());t.bindTexture(t.TEXTURE_2D,n.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=n,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new on(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(var r=0;r<6;r++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(var r=0;r<this.boundTextures.length;r++)this.bind(null,r)},e.prototype.bind=function(t,i){i===void 0&&(i=0);var r=this.gl;if(t=t==null?void 0:t.castToBaseTexture(),t&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;var n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[i]!==t&&(this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),r.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId&&(this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),this.updateTexture(t)),this.boundTextures[i]=t}else this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[i]=null},e.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},e.prototype.unbind=function(t){var i=this,r=i.gl,n=i.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var o=0;o<n.length;o++)n[o]===this.unknownTexture&&this.bind(null,o)}for(var o=0;o<n.length;o++)n[o]===t&&(this.currentLocation!==o&&(r.activeTexture(r.TEXTURE0+o),this.currentLocation=o),r.bindTexture(t.target,this.emptyTextures[t.target].texture),n[o]=null)},e.prototype.ensureSamplerType=function(t){var i=this,r=i.boundTextures,n=i.hasIntegerTextures,o=i.CONTEXT_UID;if(n)for(var s=t-1;s>=0;--s){var a=r[s];if(a){var h=a._glTextures[o];h.samplerType!==pr.FLOAT&&this.renderer.texture.unbind(a)}}},e.prototype.initTexture=function(t){var i=new on(this.gl.createTexture());return i.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=i,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),i},e.prototype.initTextureType=function(t,i){var r,n;i.internalFormat=(n=(r=this.internalFormats[t.type])===null||r===void 0?void 0:r[t.format])!==null&&n!==void 0?n:t.format,this.webGLVersion===2&&t.type===U.HALF_FLOAT?i.type=this.gl.HALF_FLOAT:i.type=t.type},e.prototype.updateTexture=function(t){var i=t._glTextures[this.CONTEXT_UID];if(i){var r=this.renderer;if(this.initTextureType(t,i),t.resource&&t.resource.upload(r,t,i))i.samplerType!==pr.FLOAT&&(this.hasIntegerTextures=!0);else{var n=t.realWidth,o=t.realHeight,s=r.gl;(i.width!==n||i.height!==o||i.dirtyId<0)&&(i.width=n,i.height=o,s.texImage2D(t.target,0,i.internalFormat,n,o,0,t.format,i.type,null))}t.dirtyStyleId!==i.dirtyStyleId&&this.updateTextureStyle(t),i.dirtyId=t.dirtyId}},e.prototype.destroyTexture=function(t,i){var r=this.gl;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!i)){var n=this.managedTextures.indexOf(t);n!==-1&&ui(this.managedTextures,n,1)}},e.prototype.updateTextureStyle=function(t){var i=t._glTextures[this.CONTEXT_UID];!i||((t.mipmap===Pe.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?i.mipmap=!1:i.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?i.wrapMode=mi.CLAMP:i.wrapMode=t.wrapMode,t.resource&&t.resource.style(this.renderer,t,i)||this.setStyle(t,i),i.dirtyStyleId=t.dirtyStyleId)},e.prototype.setStyle=function(t,i){var r=this.gl;if(i.mipmap&&t.mipmap!==Pe.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,i.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,i.wrapMode),i.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===ct.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);var n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===ct.LINEAR){var o=Math.min(t.anisotropicLevel,r.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===ct.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===ct.LINEAR?r.LINEAR:r.NEAREST)},e.prototype.destroy=function(){this.renderer=null},e}(),sn=new J,Co=function(e){V(t,e);function t(i,r){i===void 0&&(i=ze.UNKNOWN);var n=e.call(this)||this;return r=Object.assign({},F.RENDER_OPTIONS,r),n.options=r,n.type=i,n.screen=new X(0,0,r.width,r.height),n.view=r.view||document.createElement("canvas"),n.resolution=r.resolution||F.RESOLUTION,n.useContextAlpha=r.useContextAlpha,n.autoDensity=!!r.autoDensity,n.preserveDrawingBuffer=r.preserveDrawingBuffer,n.clearBeforeRender=r.clearBeforeRender,n._backgroundColor=0,n._backgroundColorRgba=[0,0,0,1],n._backgroundColorString="#000000",n.backgroundColor=r.backgroundColor||n._backgroundColor,n.backgroundAlpha=r.backgroundAlpha,r.transparent!==void 0&&(Ie("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),n.useContextAlpha=r.transparent,n.backgroundAlpha=r.transparent?0:1),n._lastObjectRendered=null,n.plugins={},n}return t.prototype.initPlugins=function(i){for(var r in i)this.plugins[r]=new i[r](this)},Object.defineProperty(t.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),t.prototype.resize=function(i,r){this.view.width=Math.round(i*this.resolution),this.view.height=Math.round(r*this.resolution);var n=this.view.width/this.resolution,o=this.view.height/this.resolution;this.screen.width=n,this.screen.height=o,this.autoDensity&&(this.view.style.width=n+"px",this.view.style.height=o+"px"),this.emit("resize",n,o)},t.prototype.generateTexture=function(i,r,n,o){r===void 0&&(r={}),typeof r=="number"&&(Ie("6.1.0","generateTexture options (scaleMode, resolution, region) are now object options."),r={scaleMode:r,resolution:n,region:o});var s=r.region,a=Of(r,["region"]);o=s||i.getLocalBounds(null,!0),o.width===0&&(o.width=1),o.height===0&&(o.height=1);var h=Lt.create(zn({width:o.width,height:o.height},a));return sn.tx=-o.x,sn.ty=-o.y,this.render(i,{renderTexture:h,clear:!1,transform:sn,skipUpdateTransform:!!i.parent}),h},t.prototype.destroy=function(i){for(var r in this.plugins)this.plugins[r].destroy(),this.plugins[r]=null;i&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var n=this;n.plugins=null,n.type=ze.UNKNOWN,n.view=null,n.screen=null,n._tempDisplayObjectParent=null,n.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(t.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(i){this._backgroundColor=i,this._backgroundColorString=Si(i),Te(i,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(i){this._backgroundColorRgba[3]=i},enumerable:!1,configurable:!0}),t}(Le),Zm=function(){function e(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}return e}(),$m=function(){function e(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}return e.prototype.destroy=function(){this.renderer=null},e.prototype.contextChange=function(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID},e.prototype.bind=function(t){var i=this,r=i.gl,n=i.CONTEXT_UID,o=t._glBuffers[n]||this.createGLBuffer(t);r.bindBuffer(t.type,o.buffer)},e.prototype.bindBufferBase=function(t,i){var r=this,n=r.gl,o=r.CONTEXT_UID;if(this.boundBufferBases[i]!==t){var s=t._glBuffers[o]||this.createGLBuffer(t);this.boundBufferBases[i]=t,n.bindBufferBase(n.UNIFORM_BUFFER,i,s.buffer)}},e.prototype.bindBufferRange=function(t,i,r){var n=this,o=n.gl,s=n.CONTEXT_UID;r=r||0;var a=t._glBuffers[s]||this.createGLBuffer(t);o.bindBufferRange(o.UNIFORM_BUFFER,i||0,a.buffer,r*256,256)},e.prototype.update=function(t){var i=this,r=i.gl,n=i.CONTEXT_UID,o=t._glBuffers[n];if(t._updateID!==o.updateID)if(o.updateID=t._updateID,r.bindBuffer(t.type,o.buffer),o.byteLength>=t.data.byteLength)r.bufferSubData(t.type,0,t.data);else{var s=t.static?r.STATIC_DRAW:r.DYNAMIC_DRAW;o.byteLength=t.data.byteLength,r.bufferData(t.type,t.data,s)}},e.prototype.dispose=function(t,i){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var r=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),r&&(i||n.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}},e.prototype.disposeAll=function(t){for(var i=Object.keys(this.managedBuffers),r=0;r<i.length;r++)this.dispose(this.managedBuffers[i[r]],t)},e.prototype.createGLBuffer=function(t){var i=this,r=i.CONTEXT_UID,n=i.gl;return t._glBuffers[r]=new Zm(n.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[r]},e}(),Ce=function(e){V(t,e);function t(i){var r=e.call(this,ze.WEBGL,i)||this;return i=r.options,r.gl=null,r.CONTEXT_UID=0,r.runners={destroy:new ut("destroy"),contextChange:new ut("contextChange"),reset:new ut("reset"),update:new ut("update"),postrender:new ut("postrender"),prerender:new ut("prerender"),resize:new ut("resize")},r.runners.contextChange.add(r),r.globalUniforms=new xe({projectionMatrix:new J},!0),r.addSystem(Em,"mask").addSystem(Kf,"context").addSystem(zm,"state").addSystem(Oh,"shader").addSystem(qm,"texture").addSystem($m,"buffer").addSystem(em,"geometry").addSystem(tm,"framebuffer").addSystem(wm,"scissor").addSystem(Tm,"stencil").addSystem(Im,"projection").addSystem(jm,"textureGC").addSystem(Zf,"filter").addSystem(Cm,"renderTexture").addSystem($f,"batch"),r.initPlugins(t.__plugins),r.multisample=void 0,i.context?r.context.initFromContext(i.context):r.context.initFromOptions({alpha:!!r.useContextAlpha,antialias:i.antialias,premultipliedAlpha:r.useContextAlpha&&r.useContextAlpha!=="notMultiplied",stencil:!0,preserveDrawingBuffer:i.preserveDrawingBuffer,powerPreference:r.options.powerPreference}),r.renderingToScreen=!0,yo(r.context.webGLVersion===2?"WebGL 2":"WebGL 1"),r.resize(r.options.width,r.options.height),r}return t.create=function(i){if(ph())return new t(i);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},t.prototype.contextChange=function(){var i=this.gl,r;if(this.context.webGLVersion===1){var n=i.getParameter(i.FRAMEBUFFER_BINDING);i.bindFramebuffer(i.FRAMEBUFFER,null),r=i.getParameter(i.SAMPLES),i.bindFramebuffer(i.FRAMEBUFFER,n)}else{var n=i.getParameter(i.DRAW_FRAMEBUFFER_BINDING);i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),r=i.getParameter(i.SAMPLES),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,n)}r>=Q.HIGH?this.multisample=Q.HIGH:r>=Q.MEDIUM?this.multisample=Q.MEDIUM:r>=Q.LOW?this.multisample=Q.LOW:this.multisample=Q.NONE},t.prototype.addSystem=function(i,r){var n=new i(this);if(this[r])throw new Error('Whoops! The name "'+r+'" is already in use');this[r]=n;for(var o in this.runners)this.runners[o].add(n);return this},t.prototype.render=function(i,r){var n,o,s,a;if(r&&(r instanceof Lt?(Ie("6.0.0","Renderer#render arguments changed, use options instead."),n=r,o=arguments[2],s=arguments[3],a=arguments[4]):(n=r.renderTexture,o=r.clear,s=r.transform,a=r.skipUpdateTransform)),this.renderingToScreen=!n,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=s,!this.context.isLost){if(n||(this._lastObjectRendered=i),!a){var h=i.enableTempParent();i.updateTransform(),i.disableTempParent(h)}this.renderTexture.bind(n),this.batch.currentRenderer.start(),(o!==void 0?o:this.clearBeforeRender)&&this.renderTexture.clear(),i.render(this),this.batch.currentRenderer.flush(),n&&n.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},t.prototype.generateTexture=function(i,r,n,o){r===void 0&&(r={});var s=e.prototype.generateTexture.call(this,i,r,n,o);return this.framebuffer.blit(),s},t.prototype.resize=function(i,r){e.prototype.resize.call(this,i,r),this.runners.resize.emit(this.screen.height,this.screen.width)},t.prototype.reset=function(){return this.runners.reset.emit(),this},t.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},t.prototype.destroy=function(i){this.runners.destroy.emit();for(var r in this.runners)this.runners[r].destroy();e.prototype.destroy.call(this,i),this.gl=null},Object.defineProperty(t.prototype,"extract",{get:function(){return Ie("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),t.registerPlugin=function(i,r){t.__plugins=t.__plugins||{},t.__plugins[i]=r},t}(Co);function Km(e){return Ce.create(e)}var Jm=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,Qm=Jm,Vn=function(){function e(){this.texArray=null,this.blend=0,this.type=zt.TRIANGLES,this.start=0,this.size=0,this.data=null}return e}(),qn=function(){function e(){this.elements=[],this.ids=[],this.count=0}return e.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0},e}(),ty=function(){function e(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(e.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),e.prototype.view=function(t){return this[t+"View"]},e.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},e.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},e}(),ey=function(e){V(t,e);function t(i){var r=e.call(this,i)||this;return r.shaderGenerator=null,r.geometryClass=null,r.vertexSize=null,r.state=Cr.for2d(),r.size=F.SPRITE_BATCH_SIZE*4,r._vertexCount=0,r._indexCount=0,r._bufferedElements=[],r._bufferedTextures=[],r._bufferSize=0,r._shader=null,r._packedGeometries=[],r._packedGeometryPoolSize=2,r._flushId=0,r._aBuffers={},r._iBuffers={},r.MAX_TEXTURES=1,r.renderer.on("prerender",r.onPrerender,r),i.runners.contextChange.add(r),r._dcIndex=0,r._aIndex=0,r._iIndex=0,r._attributeBuffer=null,r._indexBuffer=null,r._tempBoundTextures=[],r}return t.prototype.contextChange=function(){var i=this.renderer.gl;F.PREFER_ENV===jt.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),F.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=pm(this.MAX_TEXTURES,i)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var r=0;r<this._packedGeometryPoolSize;r++)this._packedGeometries[r]=new this.geometryClass;this.initFlushBuffers()},t.prototype.initFlushBuffers=function(){for(var i=t._drawCallPool,r=t._textureArrayPool,n=this.size/4,o=Math.floor(n/this.MAX_TEXTURES)+1;i.length<n;)i.push(new Vn);for(;r.length<o;)r.push(new qn);for(var s=0;s<this.MAX_TEXTURES;s++)this._tempBoundTextures[s]=null},t.prototype.onPrerender=function(){this._flushId=0},t.prototype.render=function(i){!i._texture.valid||(this._vertexCount+i.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=i.vertexData.length/2,this._indexCount+=i.indices.length,this._bufferedTextures[this._bufferSize]=i._texture.baseTexture,this._bufferedElements[this._bufferSize++]=i)},t.prototype.buildTexturesAndDrawCalls=function(){var i=this,r=i._bufferedTextures,n=i.MAX_TEXTURES,o=t._textureArrayPool,s=this.renderer.batch,a=this._tempBoundTextures,h=this.renderer.textureGC.count,l=++W._globalBatch,u=0,c=o[0],d=0;s.copyBoundTextures(a,n);for(var f=0;f<this._bufferSize;++f){var m=r[f];r[f]=null,m._batchEnabled!==l&&(c.count>=n&&(s.boundArray(c,a,l,n),this.buildDrawCalls(c,d,f),d=f,c=o[++u],++l),m._batchEnabled=l,m.touched=h,c.elements[c.count++]=m)}c.count>0&&(s.boundArray(c,a,l,n),this.buildDrawCalls(c,d,this._bufferSize),++u,++l);for(var f=0;f<a.length;f++)a[f]=null;W._globalBatch=l},t.prototype.buildDrawCalls=function(i,r,n){var o=this,s=o._bufferedElements,a=o._attributeBuffer,h=o._indexBuffer,l=o.vertexSize,u=t._drawCallPool,c=this._dcIndex,d=this._aIndex,f=this._iIndex,m=u[c];m.start=this._iIndex,m.texArray=i;for(var v=r;v<n;++v){var y=s[v],g=y._texture.baseTexture,x=vo[g.alphaMode?1:0][y.blendMode];s[v]=null,r<v&&m.blend!==x&&(m.size=f-m.start,r=v,m=u[++c],m.texArray=i,m.start=f),this.packInterleavedGeometry(y,a,h,d,f),d+=y.vertexData.length/2*l,f+=y.indices.length,m.blend=x}r<n&&(m.size=f-m.start,++c),this._dcIndex=c,this._aIndex=d,this._iIndex=f},t.prototype.bindAndClearTexArray=function(i){for(var r=this.renderer.texture,n=0;n<i.count;n++)r.bind(i.elements[n],i.ids[n]),i.elements[n]=null;i.count=0},t.prototype.updateGeometry=function(){var i=this,r=i._packedGeometries,n=i._attributeBuffer,o=i._indexBuffer;F.CAN_UPLOAD_SAME_BUFFER?(r[this._flushId]._buffer.update(n.rawBinaryData),r[this._flushId]._indexBuffer.update(o),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,r[this._flushId]=new this.geometryClass),r[this._flushId]._buffer.update(n.rawBinaryData),r[this._flushId]._indexBuffer.update(o),this.renderer.geometry.bind(r[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},t.prototype.drawBatches=function(){for(var i=this._dcIndex,r=this.renderer,n=r.gl,o=r.state,s=t._drawCallPool,a=null,h=0;h<i;h++){var l=s[h],u=l.texArray,c=l.type,d=l.size,f=l.start,m=l.blend;a!==u&&(a=u,this.bindAndClearTexArray(u)),this.state.blendMode=m,o.set(this.state),n.drawElements(c,d,n.UNSIGNED_SHORT,f*2)}},t.prototype.flush=function(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},t.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),F.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},t.prototype.stop=function(){this.flush()},t.prototype.destroy=function(){for(var i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]&&this._packedGeometries[i].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),e.prototype.destroy.call(this)},t.prototype.getAttributeBuffer=function(i){var r=xi(Math.ceil(i/8)),n=Bn(r),o=r*8;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);var s=this._aBuffers[o];return s||(this._aBuffers[o]=s=new ty(o*this.vertexSize*4)),s},t.prototype.getIndexBuffer=function(i){var r=xi(Math.ceil(i/12)),n=Bn(r),o=r*12;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);var s=this._iBuffers[n];return s||(this._iBuffers[n]=s=new Uint16Array(o)),s},t.prototype.packInterleavedGeometry=function(i,r,n,o,s){for(var a=r.uint32View,h=r.float32View,l=o/this.vertexSize,u=i.uvs,c=i.indices,d=i.vertexData,f=i._texture.baseTexture._batchLocation,m=Math.min(i.worldAlpha,1),v=m<1&&i._texture.baseTexture.alphaMode?go(i._tintRGB,m):i._tintRGB+(m*255<<24),y=0;y<d.length;y+=2)h[o++]=d[y],h[o++]=d[y+1],h[o++]=u[y],h[o++]=u[y+1],a[o++]=v,h[o++]=f;for(var y=0;y<c.length;y++)n[s++]=l+c[y]},t._drawCallPool=[],t._textureArrayPool=[],t}(Ph),iy=function(){function e(t,i){if(this.vertexSrc=t,this.fragTemplate=i,this.programCache={},this.defaultGroupCache={},i.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(i.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return e.prototype.generateShader=function(t){if(!this.programCache[t]){for(var i=new Int32Array(t),r=0;r<t;r++)i[r]=r;this.defaultGroupCache[t]=xe.from({uSamplers:i},!0);var n=this.fragTemplate;n=n.replace(/%count%/gi,""+t),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new To(this.vertexSrc,n)}var o={tint:new Float32Array([1,1,1,1]),translationMatrix:new J,default:this.defaultGroupCache[t]};return new Io(this.programCache[t],o)},e.prototype.generateSampleSrc=function(t){var i="";i+=`
`,i+=`
`;for(var r=0;r<t;r++)r>0&&(i+=`
else `),r<t-1&&(i+="if(vTextureId < "+r+".5)"),i+=`
{`,i+=`
	color = texture2D(uSamplers[`+r+"], vTextureCoord);",i+=`
}`;return i+=`
`,i+=`
`,i},e}(),Lh=function(e){V(t,e);function t(i){i===void 0&&(i=!1);var r=e.call(this)||this;return r._buffer=new vt(null,i,!1),r._indexBuffer=new vt(null,i,!0),r.addAttribute("aVertexPosition",r._buffer,2,!1,U.FLOAT).addAttribute("aTextureCoord",r._buffer,2,!1,U.FLOAT).addAttribute("aColor",r._buffer,4,!0,U.UNSIGNED_BYTE).addAttribute("aTextureId",r._buffer,1,!0,U.FLOAT).addIndex(r._indexBuffer),r}return t}(wo),Qs=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,ta=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,ry=function(){function e(){}return e.create=function(t){var i=Object.assign({vertex:Qs,fragment:ta,geometryClass:Lh,vertexSize:6},t),r=i.vertex,n=i.fragment,o=i.vertexSize,s=i.geometryClass;return function(a){V(h,a);function h(l){var u=a.call(this,l)||this;return u.shaderGenerator=new iy(r,n),u.geometryClass=s,u.vertexSize=o,u}return h}(ey)},Object.defineProperty(e,"defaultVertexSrc",{get:function(){return Qs},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentTemplate",{get:function(){return ta},enumerable:!1,configurable:!0}),e}(),ny=ry.create();/*!
* @pixi/canvas-display - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/canvas-display is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/rt.prototype._renderCanvas=function(e){},rt.prototype.renderCanvas=function(e){if(!(!this.visible||this.worldAlpha<=0||!this.renderable)){this._mask&&e.maskManager.pushMask(this._mask),this._renderCanvas(e);for(var t=0,i=this.children.length;t<i;++t)this.children[t].renderCanvas(e);this._mask&&e.maskManager.popMask(e)}},Vt.prototype.renderCanvas=function(e){};/*!
* @pixi/sprite - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/sprite is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Zn=function(e,t){return Zn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},Zn(e,t)};function oy(e,t){Zn(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var ti=new G,sy=new Uint16Array([0,1,2,0,2,3]),Rt=function(e){oy(t,e);function t(i){var r=e.call(this)||this;return r._anchor=new oi(r._onAnchorUpdate,r,i?i.defaultAnchor.x:0,i?i.defaultAnchor.y:0),r._texture=null,r._width=0,r._height=0,r._tint=null,r._tintRGB=null,r.tint=16777215,r.blendMode=w.NORMAL,r._cachedTint=16777215,r.uvs=null,r.texture=i||z.EMPTY,r.vertexData=new Float32Array(8),r.vertexTrimmedData=null,r._transformID=-1,r._textureID=-1,r._transformTrimmedID=-1,r._textureTrimmedID=-1,r.indices=sy,r.pluginName="batch",r.isSprite=!0,r._roundPixels=F.ROUND_PIXELS,r}return t.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=ve(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=ve(this.scale.y)*this._height/this._texture.orig.height)},t.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},t.prototype.calculateVertices=function(){var i=this._texture;if(!(this._transformID===this.transform._worldID&&this._textureID===i._updateID)){this._textureID!==i._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=i._updateID;var r=this.transform.worldTransform,n=r.a,o=r.b,s=r.c,a=r.d,h=r.tx,l=r.ty,u=this.vertexData,c=i.trim,d=i.orig,f=this._anchor,m=0,v=0,y=0,g=0;if(c?(v=c.x-f._x*d.width,m=v+c.width,g=c.y-f._y*d.height,y=g+c.height):(v=-f._x*d.width,m=v+d.width,g=-f._y*d.height,y=g+d.height),u[0]=n*v+s*g+h,u[1]=a*g+o*v+l,u[2]=n*m+s*g+h,u[3]=a*g+o*m+l,u[4]=n*m+s*y+h,u[5]=a*y+o*m+l,u[6]=n*v+s*y+h,u[7]=a*y+o*v+l,this._roundPixels)for(var x=F.RESOLUTION,_=0;_<u.length;++_)u[_]=Math.round((u[_]*x|0)/x)}},t.prototype.calculateTrimmedVertices=function(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var i=this._texture,r=this.vertexTrimmedData,n=i.orig,o=this._anchor,s=this.transform.worldTransform,a=s.a,h=s.b,l=s.c,u=s.d,c=s.tx,d=s.ty,f=-o._x*n.width,m=f+n.width,v=-o._y*n.height,y=v+n.height;r[0]=a*f+l*v+c,r[1]=u*v+h*f+d,r[2]=a*m+l*v+c,r[3]=u*v+h*m+d,r[4]=a*m+l*y+c,r[5]=u*y+h*m+d,r[6]=a*f+l*y+c,r[7]=u*y+h*f+d},t.prototype._render=function(i){this.calculateVertices(),i.batch.setObjectRenderer(i.plugins[this.pluginName]),i.plugins[this.pluginName].render(this)},t.prototype._calculateBounds=function(){var i=this._texture.trim,r=this._texture.orig;!i||i.width===r.width&&i.height===r.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},t.prototype.getLocalBounds=function(i){return this.children.length===0?(this._localBounds||(this._localBounds=new bi),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),i||(this._localBoundsRect||(this._localBoundsRect=new X),i=this._localBoundsRect),this._localBounds.getRectangle(i)):e.prototype.getLocalBounds.call(this,i)},t.prototype.containsPoint=function(i){this.worldTransform.applyInverse(i,ti);var r=this._texture.orig.width,n=this._texture.orig.height,o=-r*this.anchor.x,s=0;return ti.x>=o&&ti.x<o+r&&(s=-n*this.anchor.y,ti.y>=s&&ti.y<s+n)},t.prototype.destroy=function(i){e.prototype.destroy.call(this,i),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null;var r=typeof i=="boolean"?i:i&&i.texture;if(r){var n=typeof i=="boolean"?i:i&&i.baseTexture;this._texture.destroy(!!n)}this._texture=null},t.from=function(i,r){var n=i instanceof z?i:z.from(i,r);return new t(n)},Object.defineProperty(t.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(i){this._roundPixels!==i&&(this._transformID=-1),this._roundPixels=i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(i){var r=ve(this.scale.x)||1;this.scale.x=r*i/this._texture.orig.width,this._width=i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(i){var r=ve(this.scale.y)||1;this.scale.y=r*i/this._texture.orig.height,this._height=i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anchor",{get:function(){return this._anchor},set:function(i){this._anchor.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tint",{get:function(){return this._tint},set:function(i){this._tint=i,this._tintRGB=(i>>16)+(i&65280)+((i&255)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(i){this._texture!==i&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=i||z.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,i&&(i.baseTexture.valid?this._onTextureUpdate():i.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),t}(rt);/*!
* @pixi/graphics - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/graphics is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/var oe;(function(e){e.MITER="miter",e.BEVEL="bevel",e.ROUND="round"})(oe||(oe={}));var se;(function(e){e.BUTT="butt",e.ROUND="round",e.SQUARE="square"})(se||(se={}));var Ei={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(e,t){if(t===void 0&&(t=20),!this.adaptive||!e||isNaN(e))return t;var i=Math.ceil(e/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}},Nh=function(){function e(){this.color=16777215,this.alpha=1,this.texture=z.WHITE,this.matrix=null,this.visible=!1,this.reset()}return e.prototype.clone=function(){var t=new e;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t},e.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=z.WHITE,this.matrix=null,this.visible=!1},e.prototype.destroy=function(){this.texture=null,this.matrix=null},e}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var $n=function(e,t){return $n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},$n(e,t)};function So(e,t){$n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var Rh={build:function(e){e.points=e.shape.points.slice()},triangulate:function(e,t){var i=e.points,r=e.holes,n=t.points,o=t.indices;if(i.length>=6){for(var s=[],a=0;a<r.length;a++){var h=r[a];s.push(i.length/2),i=i.concat(h.points)}var l=yi.exports(i,s,2);if(!l)return;for(var u=n.length/2,a=0;a<l.length;a+=3)o.push(l[a]+u),o.push(l[a+1]+u),o.push(l[a+2]+u);for(var a=0;a<i.length;a++)n.push(i[a])}}},ea={build:function(e){var t=e.shape,i=e.points,r=t.x,n=t.y,o,s;if(i.length=0,e.type===Y.CIRC)o=t.radius,s=t.radius;else{var a=e.shape;o=a.width,s=a.height}if(!(o===0||s===0)){var h=Math.floor(30*Math.sqrt(t.radius))||Math.floor(15*Math.sqrt(o+s));h/=2.3;for(var l=Math.PI*2/h,u=0;u<h-.5;u++)i.push(r+Math.sin(-l*u)*o,n+Math.cos(-l*u)*s);i.push(i[0],i[1])}},triangulate:function(e,t){var i=e.points,r=t.points,n=t.indices,o=r.length/2,s=o,a=e.shape,h=e.matrix,l=a.x,u=a.y;r.push(e.matrix?h.a*l+h.c*u+h.tx:l,e.matrix?h.b*l+h.d*u+h.ty:u);for(var c=0;c<i.length;c+=2)r.push(i[c],i[c+1]),n.push(o++,s,o)}},ay={build:function(e){var t=e.shape,i=t.x,r=t.y,n=t.width,o=t.height,s=e.points;s.length=0,s.push(i,r,i+n,r,i+n,r+o,i,r+o)},triangulate:function(e,t){var i=e.points,r=t.points,n=r.length/2;r.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),t.indices.push(n,n+1,n+2,n+1,n+2,n+3)}};function Me(e,t,i){var r=t-e;return e+r*i}function ji(e,t,i,r,n,o,s){s===void 0&&(s=[]);for(var a=20,h=s,l=0,u=0,c=0,d=0,f=0,m=0,v=0,y=0;v<=a;++v)y=v/a,l=Me(e,i,y),u=Me(t,r,y),c=Me(i,n,y),d=Me(r,o,y),f=Me(l,c,y),m=Me(u,d,y),!(v===0&&h[h.length-2]===f&&h[h.length-1]===m)&&h.push(f,m);return h}var hy={build:function(e){var t=e.shape,i=e.points,r=t.x,n=t.y,o=t.width,s=t.height,a=Math.max(0,Math.min(t.radius,Math.min(o,s)/2));i.length=0,a?(ji(r,n+a,r,n,r+a,n,i),ji(r+o-a,n,r+o,n,r+o,n+a,i),ji(r+o,n+s-a,r+o,n+s,r+o-a,n+s,i),ji(r+a,n+s,r,n+s,r,n+s-a,i)):i.push(r,n,r+o,n,r+o,n+s,r,n+s)},triangulate:function(e,t){for(var i=e.points,r=t.points,n=t.indices,o=r.length/2,s=yi.exports(i,null,2),a=0,h=s.length;a<h;a+=3)n.push(s[a]+o),n.push(s[a+1]+o),n.push(s[a+2]+o);for(var a=0,h=i.length;a<h;a++)r.push(i[a],i[++a])}};function ia(e,t,i,r,n,o,s,a){var h=e-i*n,l=t-r*n,u=e+i*o,c=t+r*o,d,f;s?(d=r,f=-i):(d=-r,f=i);var m=h+d,v=l+f,y=u+d,g=c+f;return a.push(m,v),a.push(y,g),2}function De(e,t,i,r,n,o,s,a){var h=i-e,l=r-t,u=Math.atan2(h,l),c=Math.atan2(n-e,o-t);a&&u<c?u+=Math.PI*2:!a&&u>c&&(c+=Math.PI*2);var d=u,f=c-u,m=Math.abs(f),v=Math.sqrt(h*h+l*l),y=(15*m*Math.sqrt(v)/Math.PI>>0)+1,g=f/y;if(d+=g,a){s.push(e,t),s.push(i,r);for(var x=1,_=d;x<y;x++,_+=g)s.push(e,t),s.push(e+Math.sin(_)*v,t+Math.cos(_)*v);s.push(e,t),s.push(n,o)}else{s.push(i,r),s.push(e,t);for(var x=1,_=d;x<y;x++,_+=g)s.push(e+Math.sin(_)*v,t+Math.cos(_)*v),s.push(e,t);s.push(n,o),s.push(e,t)}return y*2}function ly(e,t){var i=e.shape,r=e.points||i.points.slice(),n=t.closePointEps;if(r.length!==0){var o=e.lineStyle,s=new G(r[0],r[1]),a=new G(r[r.length-2],r[r.length-1]),h=i.type!==Y.POLY||i.closeStroke,l=Math.abs(s.x-a.x)<n&&Math.abs(s.y-a.y)<n;if(h){r=r.slice(),l&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));var u=(s.x+a.x)*.5,c=(a.y+s.y)*.5;r.unshift(u,c),r.push(u,c)}var d=t.points,f=r.length/2,m=r.length,v=d.length/2,y=o.width/2,g=y*y,x=o.miterLimit*o.miterLimit,_=r[0],E=r[1],b=r[2],P=r[3],S=0,D=0,T=-(E-P),A=_-b,M=0,O=0,R=Math.sqrt(T*T+A*A);T/=R,A/=R,T*=y,A*=y;var H=o.alignment,C=(1-H)*2,N=H*2;h||(o.cap===se.ROUND?m+=De(_-T*(C-N)*.5,E-A*(C-N)*.5,_-T*C,E-A*C,_+T*N,E+A*N,d,!0)+2:o.cap===se.SQUARE&&(m+=ia(_,E,T,A,C,N,!0,d))),d.push(_-T*C,E-A*C),d.push(_+T*N,E+A*N);for(var B=1;B<f-1;++B){_=r[(B-1)*2],E=r[(B-1)*2+1],b=r[B*2],P=r[B*2+1],S=r[(B+1)*2],D=r[(B+1)*2+1],T=-(E-P),A=_-b,R=Math.sqrt(T*T+A*A),T/=R,A/=R,T*=y,A*=y,M=-(P-D),O=b-S,R=Math.sqrt(M*M+O*O),M/=R,O/=R,M*=y,O*=y;var et=b-_,Ft=E-P,Bt=b-S,kt=D-P,bt=Ft*Bt-kt*et,Pt=bt<0;if(Math.abs(bt)<.1){d.push(b-T*C,P-A*C),d.push(b+T*N,P+A*N);continue}var le=(-T+_)*(-A+P)-(-T+b)*(-A+E),ue=(-M+S)*(-O+P)-(-M+b)*(-O+D),Zt=(et*ue-Bt*le)/bt,$t=(kt*le-Ft*ue)/bt,Ct=(Zt-b)*(Zt-b)+($t-P)*($t-P),pt=b+(Zt-b)*C,$=P+($t-P)*C,K=b-(Zt-b)*N,it=P-($t-P)*N,Et=Math.min(et*et+Ft*Ft,Bt*Bt+kt*kt),Li=Pt?C:N,ft=Et+Li*Li*g,Ni=Ct<=ft;Ni?o.join===oe.BEVEL||Ct/g>x?(Pt?(d.push(pt,$),d.push(b+T*N,P+A*N),d.push(pt,$),d.push(b+M*N,P+O*N)):(d.push(b-T*C,P-A*C),d.push(K,it),d.push(b-M*C,P-O*C),d.push(K,it)),m+=2):o.join===oe.ROUND?Pt?(d.push(pt,$),d.push(b+T*N,P+A*N),m+=De(b,P,b+T*N,P+A*N,b+M*N,P+O*N,d,!0)+4,d.push(pt,$),d.push(b+M*N,P+O*N)):(d.push(b-T*C,P-A*C),d.push(K,it),m+=De(b,P,b-T*C,P-A*C,b-M*C,P-O*C,d,!1)+4,d.push(b-M*C,P-O*C),d.push(K,it)):(d.push(pt,$),d.push(K,it)):(d.push(b-T*C,P-A*C),d.push(b+T*N,P+A*N),o.join===oe.BEVEL||Ct/g>x||(o.join===oe.ROUND?Pt?m+=De(b,P,b+T*N,P+A*N,b+M*N,P+O*N,d,!0)+2:m+=De(b,P,b-T*C,P-A*C,b-M*C,P-O*C,d,!1)+2:(Pt?(d.push(K,it),d.push(K,it)):(d.push(pt,$),d.push(pt,$)),m+=2)),d.push(b-M*C,P-O*C),d.push(b+M*N,P+O*N),m+=2)}_=r[(f-2)*2],E=r[(f-2)*2+1],b=r[(f-1)*2],P=r[(f-1)*2+1],T=-(E-P),A=_-b,R=Math.sqrt(T*T+A*A),T/=R,A/=R,T*=y,A*=y,d.push(b-T*C,P-A*C),d.push(b+T*N,P+A*N),h||(o.cap===se.ROUND?m+=De(b-T*(C-N)*.5,P-A*(C-N)*.5,b-T*C,P-A*C,b+T*N,P+A*N,d,!1)+2:o.cap===se.SQUARE&&(m+=ia(b,P,T,A,C,N,!1,d)));for(var Il=t.indices,Cl=Ei.epsilon*Ei.epsilon,B=v;B<m+v-2;++B)_=d[B*2],E=d[B*2+1],b=d[(B+1)*2],P=d[(B+1)*2+1],S=d[(B+2)*2],D=d[(B+2)*2+1],!(Math.abs(_*(P-D)+b*(D-E)+S*(E-P))<Cl)&&Il.push(B,B+1,B+2)}}function uy(e,t){var i=0,r=e.shape,n=e.points||r.points,o=r.type!==Y.POLY||r.closeStroke;if(n.length!==0){var s=t.points,a=t.indices,h=n.length/2,l=s.length/2,u=l;for(s.push(n[0],n[1]),i=1;i<h;i++)s.push(n[i*2],n[i*2+1]),a.push(u,u+1),u++;o&&a.push(u,l)}}function ra(e,t){e.lineStyle.native?uy(e,t):ly(e,t)}var na=function(){function e(){}return e.curveTo=function(t,i,r,n,o,s){var a=s[s.length-2],h=s[s.length-1],l=h-i,u=a-t,c=n-i,d=r-t,f=Math.abs(l*d-u*c);if(f<1e-8||o===0)return(s[s.length-2]!==t||s[s.length-1]!==i)&&s.push(t,i),null;var m=l*l+u*u,v=c*c+d*d,y=l*c+u*d,g=o*Math.sqrt(m)/f,x=o*Math.sqrt(v)/f,_=g*y/m,E=x*y/v,b=g*d+x*u,P=g*c+x*l,S=u*(x+_),D=l*(x+_),T=d*(g+E),A=c*(g+E),M=Math.atan2(D-P,S-b),O=Math.atan2(A-P,T-b);return{cx:b+t,cy:P+i,radius:o,startAngle:M,endAngle:O,anticlockwise:u*c>d*l}},e.arc=function(t,i,r,n,o,s,a,h,l){for(var u=a-s,c=Ei._segmentsCount(Math.abs(u)*o,Math.ceil(Math.abs(u)/fr)*40),d=u/(c*2),f=d*2,m=Math.cos(d),v=Math.sin(d),y=c-1,g=y%1/y,x=0;x<=y;++x){var _=x+g*x,E=d+s+f*_,b=Math.cos(E),P=-Math.sin(E);l.push((m*b+v*P)*o+r,(m*-P+v*b)*o+n)}},e}(),cy=function(){function e(){}return e.curveLength=function(t,i,r,n,o,s,a,h){for(var l=10,u=0,c=0,d=0,f=0,m=0,v=0,y=0,g=0,x=0,_=0,E=0,b=t,P=i,S=1;S<=l;++S)c=S/l,d=c*c,f=d*c,m=1-c,v=m*m,y=v*m,g=y*t+3*v*c*r+3*m*d*o+f*a,x=y*i+3*v*c*n+3*m*d*s+f*h,_=b-g,E=P-x,b=g,P=x,u+=Math.sqrt(_*_+E*E);return u},e.curveTo=function(t,i,r,n,o,s,a){var h=a[a.length-2],l=a[a.length-1];a.length-=2;var u=Ei._segmentsCount(e.curveLength(h,l,t,i,r,n,o,s)),c=0,d=0,f=0,m=0,v=0;a.push(h,l);for(var y=1,g=0;y<=u;++y)g=y/u,c=1-g,d=c*c,f=d*c,m=g*g,v=m*g,a.push(f*h+3*d*g*t+3*c*m*r+v*o,f*l+3*d*g*i+3*c*m*n+v*s)},e}(),py=function(){function e(){}return e.curveLength=function(t,i,r,n,o,s){var a=t-2*r+o,h=i-2*n+s,l=2*r-2*t,u=2*n-2*i,c=4*(a*a+h*h),d=4*(a*l+h*u),f=l*l+u*u,m=2*Math.sqrt(c+d+f),v=Math.sqrt(c),y=2*c*v,g=2*Math.sqrt(f),x=d/v;return(y*m+v*d*(m-g)+(4*f*c-d*d)*Math.log((2*v+x+m)/(x+g)))/(4*y)},e.curveTo=function(t,i,r,n,o){for(var s=o[o.length-2],a=o[o.length-1],h=Ei._segmentsCount(e.curveLength(s,a,t,i,r,n)),l=0,u=0,c=1;c<=h;++c){var d=c/h;l=s+(t-s)*d,u=a+(i-a)*d,o.push(l+(t+(r-t)*d-l)*d,u+(i+(n-i)*d-u)*d)}},e}(),dy=function(){function e(){this.reset()}return e.prototype.begin=function(t,i,r){this.reset(),this.style=t,this.start=i,this.attribStart=r},e.prototype.end=function(t,i){this.attribSize=i-this.attribStart,this.size=t-this.start},e.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},e}(),pe,an=(pe={},pe[Y.POLY]=Rh,pe[Y.CIRC]=ea,pe[Y.ELIP]=ea,pe[Y.RECT]=ay,pe[Y.RREC]=hy,pe),oa=[],Vi=[];function fy(e){for(var t=e.points,i=0,r=0;r<t.length-2;r+=2)i+=(t[r+2]-t[r])*(t[r+3]+t[r+1]);return i>0}var sa=function(){function e(t,i,r,n){i===void 0&&(i=null),r===void 0&&(r=null),n===void 0&&(n=null),this.points=[],this.holes=[],this.shape=t,this.lineStyle=r,this.fillStyle=i,this.matrix=n,this.type=t.type}return e.prototype.clone=function(){return new e(this.shape,this.fillStyle,this.lineStyle,this.matrix)},e.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},e}(),Fe=new G,my=new bi,yy=function(e){So(t,e);function t(){var i=e.call(this)||this;return i.closePointEps=1e-4,i.boundsPadding=0,i.uvsFloat32=null,i.indicesUint16=null,i.batchable=!1,i.points=[],i.colors=[],i.uvs=[],i.indices=[],i.textureIds=[],i.graphicsData=[],i.drawCalls=[],i.batchDirty=-1,i.batches=[],i.dirty=0,i.cacheDirty=-1,i.clearDirty=0,i.shapeIndex=0,i._bounds=new bi,i.boundsDirty=-1,i}return Object.defineProperty(t.prototype,"bounds",{get:function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),t.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var i=0;i<this.drawCalls.length;i++)this.drawCalls[i].texArray.clear(),Vi.push(this.drawCalls[i]);this.drawCalls.length=0;for(var i=0;i<this.batches.length;i++){var r=this.batches[i];r.reset(),oa.push(r)}this.batches.length=0},t.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},t.prototype.drawShape=function(i,r,n,o){r===void 0&&(r=null),n===void 0&&(n=null),o===void 0&&(o=null);var s=new sa(i,r,n,o);return this.graphicsData.push(s),this.dirty++,this},t.prototype.drawHole=function(i,r){if(r===void 0&&(r=null),!this.graphicsData.length)return null;var n=new sa(i,null,null,r),o=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=o.lineStyle,o.holes.push(n),this.dirty++,this},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var i=0;i<this.graphicsData.length;++i)this.graphicsData[i].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},t.prototype.containsPoint=function(i){for(var r=this.graphicsData,n=0;n<r.length;++n){var o=r[n];if(!!o.fillStyle.visible&&o.shape&&(o.matrix?o.matrix.applyInverse(i,Fe):Fe.copyFrom(i),o.shape.contains(Fe.x,Fe.y))){var s=!1;if(o.holes)for(var a=0;a<o.holes.length;a++){var h=o.holes[a];if(h.shape.contains(Fe.x,Fe.y)){s=!0;break}}if(!s)return!0}}return!1},t.prototype.updateBatches=function(i){if(!this.graphicsData.length){this.batchable=!0;return}if(this.validateBatching()){this.cacheDirty=this.dirty;var r=this.uvs,n=this.graphicsData,o=null,s=null;this.batches.length>0&&(o=this.batches[this.batches.length-1],s=o.style);for(var a=this.shapeIndex;a<n.length;a++){this.shapeIndex++;var h=n[a],l=h.fillStyle,u=h.lineStyle,c=an[h.type];c.build(h),h.matrix&&this.transformPoints(h.points,h.matrix);for(var d=0;d<2;d++){var f=d===0?l:u;if(f.visible){var m=f.texture.baseTexture,v=this.indices.length,y=this.points.length/2;m.wrapMode=mi.REPEAT,d===0?this.processFill(h):this.processLine(h);var g=this.points.length/2-y;g!==0&&(o&&!this._compareStyles(s,f)&&(o.end(v,y),o=null),o||(o=oa.pop()||new dy,o.begin(f,v,y),this.batches.push(o),s=f),this.addUvs(this.points,r,f.texture,y,g,f.matrix))}}}var x=this.indices.length,_=this.points.length/2;if(o&&o.end(x,_),this.batches.length===0){this.batchable=!0;return}if(this.indicesUint16&&this.indices.length===this.indicesUint16.length)this.indicesUint16.set(this.indices);else{var E=_>65535&&i;this.indicesUint16=E?new Uint32Array(this.indices):new Uint16Array(this.indices)}this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}},t.prototype._compareStyles=function(i,r){return!(!i||!r||i.texture.baseTexture!==r.texture.baseTexture||i.color+i.alpha!==r.color+r.alpha||!!i.native!=!!r.native)},t.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var i=0,r=this.graphicsData.length;i<r;i++){var n=this.graphicsData[i],o=n.fillStyle,s=n.lineStyle;if(o&&!o.texture.baseTexture.valid||s&&!s.texture.baseTexture.valid)return!1}return!0},t.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var i=this.batches,r=0,n=i.length;r<n;r++)for(var o=i[r],s=0;s<o.size;s++){var a=o.start+s;this.indicesUint16[a]=this.indicesUint16[a]-o.attribStart}},t.prototype.isBatchable=function(){if(this.points.length>65535*2)return!1;for(var i=this.batches,r=0;r<i.length;r++)if(i[r].style.native)return!1;return this.points.length<t.BATCHABLE_SIZE*2},t.prototype.buildDrawCalls=function(){for(var i=++W._globalBatch,r=0;r<this.drawCalls.length;r++)this.drawCalls[r].texArray.clear(),Vi.push(this.drawCalls[r]);this.drawCalls.length=0;var n=this.colors,o=this.textureIds,s=Vi.pop();s||(s=new Vn,s.texArray=new qn),s.texArray.count=0,s.start=0,s.size=0,s.type=zt.TRIANGLES;var a=0,h=null,l=0,u=!1,c=zt.TRIANGLES,d=0;this.drawCalls.push(s);for(var r=0;r<this.batches.length;r++){var f=this.batches[r],m=8,v=f.style,y=v.texture.baseTexture;u!==!!v.native&&(u=!!v.native,c=u?zt.LINES:zt.TRIANGLES,h=null,a=m,i++),h!==y&&(h=y,y._batchEnabled!==i&&(a===m&&(i++,a=0,s.size>0&&(s=Vi.pop(),s||(s=new Vn,s.texArray=new qn),this.drawCalls.push(s)),s.start=d,s.size=0,s.texArray.count=0,s.type=c),y.touched=1,y._batchEnabled=i,y._batchLocation=a,y.wrapMode=mi.REPEAT,s.texArray.elements[s.texArray.count++]=y,a++)),s.size+=f.size,d+=f.size,l=y._batchLocation,this.addColors(n,v.color,v.alpha,f.attribSize,f.attribStart),this.addTextureIds(o,l,f.attribSize,f.attribStart)}W._globalBatch=i,this.packAttributes()},t.prototype.packAttributes=function(){for(var i=this.points,r=this.uvs,n=this.colors,o=this.textureIds,s=new ArrayBuffer(i.length*3*4),a=new Float32Array(s),h=new Uint32Array(s),l=0,u=0;u<i.length/2;u++)a[l++]=i[u*2],a[l++]=i[u*2+1],a[l++]=r[u*2],a[l++]=r[u*2+1],h[l++]=n[u],a[l++]=o[u];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)},t.prototype.processFill=function(i){if(i.holes.length)this.processHoles(i.holes),Rh.triangulate(i,this);else{var r=an[i.type];r.triangulate(i,this)}},t.prototype.processLine=function(i){ra(i,this);for(var r=0;r<i.holes.length;r++)ra(i.holes[r],this)},t.prototype.processHoles=function(i){for(var r=0;r<i.length;r++){var n=i[r],o=an[n.type];o.build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}},t.prototype.calculateBounds=function(){var i=this._bounds,r=my,n=J.IDENTITY;this._bounds.clear(),r.clear();for(var o=0;o<this.graphicsData.length;o++){var s=this.graphicsData[o],a=s.shape,h=s.type,l=s.lineStyle,u=s.matrix||J.IDENTITY,c=0;if(l&&l.visible){var d=l.alignment;c=l.width,h===Y.POLY?fy(a)?c=c*(1-d):c=c*d:c=c*Math.max(0,d)}if(n!==u&&(r.isEmpty()||(i.addBoundsMatrix(r,n),r.clear()),n=u),h===Y.RECT||h===Y.RREC){var f=a;r.addFramePad(f.x,f.y,f.x+f.width,f.y+f.height,c,c)}else if(h===Y.CIRC){var m=a;r.addFramePad(m.x,m.y,m.x,m.y,m.radius+c,m.radius+c)}else if(h===Y.ELIP){var v=a;r.addFramePad(v.x,v.y,v.x,v.y,v.width+c,v.height+c)}else{var y=a;i.addVerticesMatrix(n,y.points,0,y.points.length,c,c)}}r.isEmpty()||i.addBoundsMatrix(r,n),i.pad(this.boundsPadding,this.boundsPadding)},t.prototype.transformPoints=function(i,r){for(var n=0;n<i.length/2;n++){var o=i[n*2],s=i[n*2+1];i[n*2]=r.a*o+r.c*s+r.tx,i[n*2+1]=r.b*o+r.d*s+r.ty}},t.prototype.addColors=function(i,r,n,o,s){s===void 0&&(s=0);var a=(r>>16)+(r&65280)+((r&255)<<16),h=go(a,n);i.length=Math.max(i.length,s+o);for(var l=0;l<o;l++)i[s+l]=h},t.prototype.addTextureIds=function(i,r,n,o){o===void 0&&(o=0),i.length=Math.max(i.length,o+n);for(var s=0;s<n;s++)i[o+s]=r},t.prototype.addUvs=function(i,r,n,o,s,a){a===void 0&&(a=null);for(var h=0,l=r.length,u=n.frame;h<s;){var c=i[(o+h)*2],d=i[(o+h)*2+1];if(a){var f=a.a*c+a.c*d+a.tx;d=a.b*c+a.d*d+a.ty,c=f}h++,r.push(c/u.width,d/u.height)}var m=n.baseTexture;(u.width<m.width||u.height<m.height)&&this.adjustUvs(r,n,l,s)},t.prototype.adjustUvs=function(i,r,n,o){for(var s=r.baseTexture,a=1e-6,h=n+o*2,l=r.frame,u=l.width/s.width,c=l.height/s.height,d=l.x/l.width,f=l.y/l.height,m=Math.floor(i[n]+a),v=Math.floor(i[n+1]+a),y=n+2;y<h;y+=2)m=Math.min(m,Math.floor(i[y]+a)),v=Math.min(v,Math.floor(i[y+1]+a));d-=m,f-=v;for(var y=n;y<h;y+=2)i[y]=(i[y]+d)*u,i[y+1]=(i[y+1]+f)*c},t.BATCHABLE_SIZE=100,t}(Lh),vy=function(e){So(t,e);function t(){var i=e!==null&&e.apply(this,arguments)||this;return i.width=0,i.alignment=.5,i.native=!1,i.cap=se.BUTT,i.join=oe.MITER,i.miterLimit=10,i}return t.prototype.clone=function(){var i=new t;return i.color=this.color,i.alpha=this.alpha,i.texture=this.texture,i.matrix=this.matrix,i.visible=this.visible,i.width=this.width,i.alignment=this.alignment,i.native=this.native,i.cap=this.cap,i.join=this.join,i.miterLimit=this.miterLimit,i},t.prototype.reset=function(){e.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},t}(Nh),gy=new Float32Array(3),hn={},tt=function(e){So(t,e);function t(i){i===void 0&&(i=null);var r=e.call(this)||this;return r.shader=null,r.pluginName="batch",r.currentPath=null,r.batches=[],r.batchTint=-1,r.batchDirty=-1,r.vertexData=null,r._fillStyle=new Nh,r._lineStyle=new vy,r._matrix=null,r._holeMode=!1,r.state=Cr.for2d(),r._geometry=i||new yy,r._geometry.refCount++,r._transformID=-1,r.tint=16777215,r.blendMode=w.NORMAL,r}return Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return this.finishPoly(),new t(this._geometry)},Object.defineProperty(t.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(i){this.state.blendMode=i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tint",{get:function(){return this._tint},set:function(i){this._tint=i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),t.prototype.lineStyle=function(i,r,n,o,s){return i===void 0&&(i=null),r===void 0&&(r=0),n===void 0&&(n=1),o===void 0&&(o=.5),s===void 0&&(s=!1),typeof i=="number"&&(i={width:i,color:r,alpha:n,alignment:o,native:s}),this.lineTextureStyle(i)},t.prototype.lineTextureStyle=function(i){i=Object.assign({width:0,texture:z.WHITE,color:i&&i.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:se.BUTT,join:oe.MITER,miterLimit:10},i),this.currentPath&&this.startPoly();var r=i.width>0&&i.alpha>0;return r?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._lineStyle,{visible:r},i)):this._lineStyle.reset(),this},t.prototype.startPoly=function(){if(this.currentPath){var i=this.currentPath.points,r=this.currentPath.points.length;r>2&&(this.drawShape(this.currentPath),this.currentPath=new qr,this.currentPath.closeStroke=!1,this.currentPath.points.push(i[r-2],i[r-1]))}else this.currentPath=new qr,this.currentPath.closeStroke=!1},t.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},t.prototype.moveTo=function(i,r){return this.startPoly(),this.currentPath.points[0]=i,this.currentPath.points[1]=r,this},t.prototype.lineTo=function(i,r){this.currentPath||this.moveTo(0,0);var n=this.currentPath.points,o=n[n.length-2],s=n[n.length-1];return(o!==i||s!==r)&&n.push(i,r),this},t.prototype._initCurve=function(i,r){i===void 0&&(i=0),r===void 0&&(r=0),this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[i,r]):this.moveTo(i,r)},t.prototype.quadraticCurveTo=function(i,r,n,o){this._initCurve();var s=this.currentPath.points;return s.length===0&&this.moveTo(0,0),py.curveTo(i,r,n,o,s),this},t.prototype.bezierCurveTo=function(i,r,n,o,s,a){return this._initCurve(),cy.curveTo(i,r,n,o,s,a,this.currentPath.points),this},t.prototype.arcTo=function(i,r,n,o,s){this._initCurve(i,r);var a=this.currentPath.points,h=na.curveTo(i,r,n,o,s,a);if(h){var l=h.cx,u=h.cy,c=h.radius,d=h.startAngle,f=h.endAngle,m=h.anticlockwise;this.arc(l,u,c,d,f,m)}return this},t.prototype.arc=function(i,r,n,o,s,a){if(a===void 0&&(a=!1),o===s)return this;!a&&s<=o?s+=fr:a&&o<=s&&(o+=fr);var h=s-o;if(h===0)return this;var l=i+Math.cos(o)*n,u=r+Math.sin(o)*n,c=this._geometry.closePointEps,d=this.currentPath?this.currentPath.points:null;if(d){var f=Math.abs(d[d.length-2]-l),m=Math.abs(d[d.length-1]-u);f<c&&m<c||d.push(l,u)}else this.moveTo(l,u),d=this.currentPath.points;return na.arc(l,u,i,r,n,o,s,a,d),this},t.prototype.beginFill=function(i,r){return i===void 0&&(i=0),r===void 0&&(r=1),this.beginTextureFill({texture:z.WHITE,color:i,alpha:r})},t.prototype.beginTextureFill=function(i){i=Object.assign({texture:z.WHITE,color:16777215,alpha:1,matrix:null},i),this.currentPath&&this.startPoly();var r=i.alpha>0;return r?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._fillStyle,{visible:r},i)):this._fillStyle.reset(),this},t.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},t.prototype.drawRect=function(i,r,n,o){return this.drawShape(new X(i,r,n,o))},t.prototype.drawRoundedRect=function(i,r,n,o,s){return this.drawShape(new If(i,r,n,o,s))},t.prototype.drawCircle=function(i,r,n){return this.drawShape(new wf(i,r,n))},t.prototype.drawEllipse=function(i,r,n,o){return this.drawShape(new Tf(i,r,n,o))},t.prototype.drawPolygon=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];var o,s=!0,a=r[0];a.points?(s=a.closeStroke,o=a.points):Array.isArray(r[0])?o=r[0]:o=r;var h=new qr(o);return h.closeStroke=s,this.drawShape(h),this},t.prototype.drawShape=function(i){return this._holeMode?this._geometry.drawHole(i,this._matrix):this._geometry.drawShape(i,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},t.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},t.prototype.isFastRect=function(){var i=this._geometry.graphicsData;return i.length===1&&i[0].shape.type===Y.RECT&&!i[0].matrix&&!i[0].holes.length&&!(i[0].lineStyle.visible&&i[0].lineStyle.width)},t.prototype._render=function(i){this.finishPoly();var r=this._geometry,n=i.context.supports.uint32Indices;r.updateBatches(n),r.batchable?(this.batchDirty!==r.batchDirty&&this._populateBatches(),this._renderBatched(i)):(i.batch.flush(),this._renderDirect(i))},t.prototype._populateBatches=function(){var i=this._geometry,r=this.blendMode,n=i.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=i.batchDirty,this.batches.length=n,this.vertexData=new Float32Array(i.points);for(var o=0;o<n;o++){var s=i.batches[o],a=s.style.color,h=new Float32Array(this.vertexData.buffer,s.attribStart*4*2,s.attribSize*2),l=new Float32Array(i.uvsFloat32.buffer,s.attribStart*4*2,s.attribSize*2),u=new Uint16Array(i.indicesUint16.buffer,s.start*2,s.size),c={vertexData:h,blendMode:r,indices:u,uvs:l,_batchRGB:Te(a),_tintRGB:a,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[o]=c}},t.prototype._renderBatched=function(i){if(this.batches.length){i.batch.setObjectRenderer(i.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var r=0,n=this.batches.length;r<n;r++){var o=this.batches[r];o.worldAlpha=this.worldAlpha*o.alpha,i.plugins[this.pluginName].render(o)}}},t.prototype._renderDirect=function(i){var r=this._resolveDirectShader(i),n=this._geometry,o=this.tint,s=this.worldAlpha,a=r.uniforms,h=n.drawCalls;a.translationMatrix=this.transform.worldTransform,a.tint[0]=(o>>16&255)/255*s,a.tint[1]=(o>>8&255)/255*s,a.tint[2]=(o&255)/255*s,a.tint[3]=s,i.shader.bind(r),i.geometry.bind(n,r),i.state.set(this.state);for(var l=0,u=h.length;l<u;l++)this._renderDrawCallDirect(i,n.drawCalls[l])},t.prototype._renderDrawCallDirect=function(i,r){for(var n=r.texArray,o=r.type,s=r.size,a=r.start,h=n.count,l=0;l<h;l++)i.texture.bind(n.elements[l],l);i.geometry.draw(o,s,a)},t.prototype._resolveDirectShader=function(i){var r=this.shader,n=this.pluginName;if(!r){if(!hn[n]){for(var o=i.plugins.batch.MAX_TEXTURES,s=new Int32Array(o),a=0;a<o;a++)s[a]=a;var h={tint:new Float32Array([1,1,1,1]),translationMatrix:new J,default:xe.from({uSamplers:s},!0)},l=i.plugins[n]._shader.program;hn[n]=new Io(l,h)}r=hn[n]}return r},t.prototype._calculateBounds=function(){this.finishPoly();var i=this._geometry;if(i.graphicsData.length){var r=i.bounds,n=r.minX,o=r.minY,s=r.maxX,a=r.maxY;this._bounds.addFrame(this.transform,n,o,s,a)}},t.prototype.containsPoint=function(i){return this.worldTransform.applyInverse(i,t._TEMP_POINT),this._geometry.containsPoint(t._TEMP_POINT)},t.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var i=Te(this.tint,gy),r=0;r<this.batches.length;r++){var n=this.batches[r],o=n._batchRGB,s=i[0]*o[0]*255,a=i[1]*o[1]*255,h=i[2]*o[2]*255,l=(s<<16)+(a<<8)+(h|0);n._tintRGB=(l>>16)+(l&65280)+((l&255)<<16)}}},t.prototype.calculateVertices=function(){var i=this.transform._worldID;if(this._transformID!==i){this._transformID=i;for(var r=this.transform.worldTransform,n=r.a,o=r.b,s=r.c,a=r.d,h=r.tx,l=r.ty,u=this._geometry.points,c=this.vertexData,d=0,f=0;f<u.length;f+=2){var m=u[f],v=u[f+1];c[d++]=n*m+s*v+h,c[d++]=a*v+o*m+l}}},t.prototype.closePath=function(){var i=this.currentPath;return i&&(i.closeStroke=!0,this.finishPoly()),this},t.prototype.setMatrix=function(i){return this._matrix=i,this},t.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},t.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},t.prototype.destroy=function(i){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,e.prototype.destroy.call(this,i)},t._TEMP_POINT=new G,t}(rt);/*!
* @pixi/text - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/text is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Kn=function(e,t){return Kn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},Kn(e,t)};function _y(e,t){Kn(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var mr;(function(e){e[e.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",e[e.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL"})(mr||(mr={}));var ln={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:mr.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},xy=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Se=function(){function e(t){this.styleID=0,this.reset(),cn(this,t,t)}return e.prototype.clone=function(){var t={};return cn(t,this,ln),new e(t)},e.prototype.reset=function(){cn(this,ln,ln)},Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"breakWords",{get:function(){return this._breakWords},set:function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(t){var i=un(t);this._dropShadowColor!==i&&(this._dropShadowColor=i,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fill",{get:function(){return this._fill},set:function(t){var i=un(t);this._fill!==i&&(this._fill=i,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(t){by(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leading",{get:function(){return this._leading},set:function(t){this._leading!==t&&(this._leading=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding!==t&&(this._padding=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stroke",{get:function(){return this._stroke},set:function(t){var i=un(t);this._stroke!==i&&(this._stroke=i,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trim",{get:function(){return this._trim},set:function(t){this._trim!==t&&(this._trim=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)},enumerable:!1,configurable:!0}),e.prototype.toFontString=function(){var t=typeof this.fontSize=="number"?this.fontSize+"px":this.fontSize,i=this.fontFamily;Array.isArray(this.fontFamily)||(i=this.fontFamily.split(","));for(var r=i.length-1;r>=0;r--){var n=i[r].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&xy.indexOf(n)<0&&(n='"'+n+'"'),i[r]=n}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+i.join(",")},e}();function aa(e){return typeof e=="number"?Si(e):(typeof e=="string"&&e.indexOf("0x")===0&&(e=e.replace("0x","#")),e)}function un(e){if(Array.isArray(e)){for(var t=0;t<e.length;++t)e[t]=aa(e[t]);return e}else return aa(e)}function by(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(var i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}function cn(e,t,i){for(var r in i)Array.isArray(t[r])?e[r]=t[r].slice():e[r]=t[r]}var Tt=function(){function e(t,i,r,n,o,s,a,h,l){this.text=t,this.style=i,this.width=r,this.height=n,this.lines=o,this.lineWidths=s,this.lineHeight=a,this.maxLineWidth=h,this.fontProperties=l}return e.measureText=function(t,i,r,n){n===void 0&&(n=e._canvas),r=r!=null?r:i.wordWrap;var o=i.toFontString(),s=e.measureFont(o);s.fontSize===0&&(s.fontSize=i.fontSize,s.ascent=i.fontSize);var a=n.getContext("2d");a.font=o;for(var h=r?e.wordWrap(t,i,n):t,l=h.split(/(?:\r\n|\r|\n)/),u=new Array(l.length),c=0,d=0;d<l.length;d++){var f=a.measureText(l[d]).width+(l[d].length-1)*i.letterSpacing;u[d]=f,c=Math.max(c,f)}var m=c+i.strokeThickness;i.dropShadow&&(m+=i.dropShadowDistance);var v=i.lineHeight||s.fontSize+i.strokeThickness,y=Math.max(v,s.fontSize+i.strokeThickness)+(l.length-1)*(v+i.leading);return i.dropShadow&&(y+=i.dropShadowDistance),new e(t,i,m,y,l,u,v+i.leading,c,s)},e.wordWrap=function(t,i,r){r===void 0&&(r=e._canvas);for(var n=r.getContext("2d"),o=0,s="",a="",h=Object.create(null),l=i.letterSpacing,u=i.whiteSpace,c=e.collapseSpaces(u),d=e.collapseNewlines(u),f=!c,m=i.wordWrapWidth+l,v=e.tokenize(t),y=0;y<v.length;y++){var g=v[y];if(e.isNewline(g)){if(!d){a+=e.addLine(s),f=!c,s="",o=0;continue}g=" "}if(c){var x=e.isBreakingSpace(g),_=e.isBreakingSpace(s[s.length-1]);if(x&&_)continue}var E=e.getFromCache(g,l,h,n);if(E>m)if(s!==""&&(a+=e.addLine(s),s="",o=0),e.canBreakWords(g,i.breakWords))for(var b=e.wordWrapSplit(g),P=0;P<b.length;P++){for(var S=b[P],D=1;b[P+D];){var T=b[P+D],A=S[S.length-1];if(!e.canBreakChars(A,T,g,P,i.breakWords))S+=T;else break;D++}P+=S.length-1;var M=e.getFromCache(S,l,h,n);M+o>m&&(a+=e.addLine(s),f=!1,s="",o=0),s+=S,o+=M}else{s.length>0&&(a+=e.addLine(s),s="",o=0);var O=y===v.length-1;a+=e.addLine(g,!O),f=!1,s="",o=0}else E+o>m&&(f=!1,a+=e.addLine(s),s="",o=0),(s.length>0||!e.isBreakingSpace(g)||f)&&(s+=g,o+=E)}return a+=e.addLine(s,!1),a},e.addLine=function(t,i){return i===void 0&&(i=!0),t=e.trimRight(t),t=i?t+`
`:t,t},e.getFromCache=function(t,i,r,n){var o=r[t];if(typeof o!="number"){var s=t.length*i;o=n.measureText(t).width+s,r[t]=o}return o},e.collapseSpaces=function(t){return t==="normal"||t==="pre-line"},e.collapseNewlines=function(t){return t==="normal"},e.trimRight=function(t){if(typeof t!="string")return"";for(var i=t.length-1;i>=0;i--){var r=t[i];if(!e.isBreakingSpace(r))break;t=t.slice(0,-1)}return t},e.isNewline=function(t){return typeof t!="string"?!1:e._newlines.indexOf(t.charCodeAt(0))>=0},e.isBreakingSpace=function(t,i){return typeof t!="string"?!1:e._breakingSpaces.indexOf(t.charCodeAt(0))>=0},e.tokenize=function(t){var i=[],r="";if(typeof t!="string")return i;for(var n=0;n<t.length;n++){var o=t[n],s=t[n+1];if(e.isBreakingSpace(o,s)||e.isNewline(o)){r!==""&&(i.push(r),r=""),i.push(o);continue}r+=o}return r!==""&&i.push(r),i},e.canBreakWords=function(t,i){return i},e.canBreakChars=function(t,i,r,n,o){return!0},e.wordWrapSplit=function(t){return t.split("")},e.measureFont=function(t){if(e._fonts[t])return e._fonts[t];var i={ascent:0,descent:0,fontSize:0},r=e._canvas,n=e._context;n.font=t;var o=e.METRICS_STRING+e.BASELINE_SYMBOL,s=Math.ceil(n.measureText(o).width),a=Math.ceil(n.measureText(e.BASELINE_SYMBOL).width),h=Math.ceil(e.HEIGHT_MULTIPLIER*a);a=a*e.BASELINE_MULTIPLIER|0,r.width=s,r.height=h,n.fillStyle="#f00",n.fillRect(0,0,s,h),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(o,0,a);var l=n.getImageData(0,0,s,h).data,u=l.length,c=s*4,d=0,f=0,m=!1;for(d=0;d<a;++d){for(var v=0;v<c;v+=4)if(l[f+v]!==255){m=!0;break}if(!m)f+=c;else break}for(i.ascent=a-d,f=u-c,m=!1,d=h;d>a;--d){for(var v=0;v<c;v+=4)if(l[f+v]!==255){m=!0;break}if(!m)f-=c;else break}return i.descent=d-a,i.fontSize=i.ascent+i.descent,e._fonts[t]=i,i},e.clearMetrics=function(t){t===void 0&&(t=""),t?delete e._fonts[t]:e._fonts={}},e}(),qi=function(){try{var e=new OffscreenCanvas(0,0),t=e.getContext("2d");return t&&t.measureText?e:document.createElement("canvas")}catch{return document.createElement("canvas")}}();qi.width=qi.height=10,Tt._canvas=qi,Tt._context=qi.getContext("2d"),Tt._fonts={},Tt.METRICS_STRING="|\xC9q\xC5",Tt.BASELINE_SYMBOL="M",Tt.BASELINE_MULTIPLIER=1.4,Tt.HEIGHT_MULTIPLIER=2,Tt._newlines=[10,13],Tt._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var Py={texture:!0,children:!1,baseTexture:!0},Ze=function(e){_y(t,e);function t(i,r,n){var o=this,s=!1;n||(n=document.createElement("canvas"),s=!0),n.width=3,n.height=3;var a=z.from(n);return a.orig=new X,a.trim=new X,o=e.call(this,a)||this,o._ownCanvas=s,o.canvas=n,o.context=o.canvas.getContext("2d"),o._resolution=F.RESOLUTION,o._autoResolution=!0,o._text=null,o._style=null,o._styleListener=null,o._font="",o.text=i,o.style=r,o.localStyleID=-1,o}return t.prototype.updateText=function(i){var r=this._style;if(this.localStyleID!==r.styleID&&(this.dirty=!0,this.localStyleID=r.styleID),!(!this.dirty&&i)){this._font=this._style.toFontString();var n=this.context,o=Tt.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=o.width,a=o.height,h=o.lines,l=o.lineHeight,u=o.lineWidths,c=o.maxLineWidth,d=o.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,s)+r.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,a)+r.padding*2)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=r.strokeThickness,n.textBaseline=r.textBaseline,n.lineJoin=r.lineJoin,n.miterLimit=r.miterLimit;for(var f,m,v=r.dropShadow?2:1,y=0;y<v;++y){var g=r.dropShadow&&y===0,x=g?Math.ceil(Math.max(1,a)+r.padding*2):0,_=x*this._resolution;if(g){n.fillStyle="black",n.strokeStyle="black";var E=r.dropShadowColor,b=Te(typeof E=="number"?E:qe(E)),P=r.dropShadowBlur*this._resolution,S=r.dropShadowDistance*this._resolution;n.shadowColor="rgba("+b[0]*255+","+b[1]*255+","+b[2]*255+","+r.dropShadowAlpha+")",n.shadowBlur=P,n.shadowOffsetX=Math.cos(r.dropShadowAngle)*S,n.shadowOffsetY=Math.sin(r.dropShadowAngle)*S+_}else n.fillStyle=this._generateFillStyle(r,h,o),n.strokeStyle=r.stroke,n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;var D=(l-d.fontSize)/2;(!t.nextLineHeightBehavior||l-d.fontSize<0)&&(D=0);for(var T=0;T<h.length;T++)f=r.strokeThickness/2,m=r.strokeThickness/2+T*l+d.ascent+D,r.align==="right"?f+=c-u[T]:r.align==="center"&&(f+=(c-u[T])/2),r.stroke&&r.strokeThickness&&this.drawLetterSpacing(h[T],f+r.padding,m+r.padding-x,!0),r.fill&&this.drawLetterSpacing(h[T],f+r.padding,m+r.padding-x)}this.updateTexture()}},t.prototype.drawLetterSpacing=function(i,r,n,o){o===void 0&&(o=!1);var s=this._style,a=s.letterSpacing,h="letterSpacing"in CanvasRenderingContext2D.prototype||"textLetterSpacing"in CanvasRenderingContext2D.prototype;if(a===0||h){h&&(this.context.letterSpacing=a,this.context.textLetterSpacing=a),o?this.context.strokeText(i,r,n):this.context.fillText(i,r,n);return}for(var l=r,u=Array.from?Array.from(i):i.split(""),c=this.context.measureText(i).width,d=0,f=0;f<u.length;++f){var m=u[f];o?this.context.strokeText(m,l,n):this.context.fillText(m,l,n);for(var v="",y=f+1;y<u.length;++y)v+=u[y];d=this.context.measureText(v).width,l+=c-d+a,c=d}},t.prototype.updateTexture=function(){var i=this.canvas;if(this._style.trim){var r=dh(i);r.data&&(i.width=r.width,i.height=r.height,this.context.putImageData(r.data,0,0))}var n=this._texture,o=this._style,s=o.trim?0:o.padding,a=n.baseTexture;n.trim.width=n._frame.width=i.width/this._resolution,n.trim.height=n._frame.height=i.height/this._resolution,n.trim.x=-s,n.trim.y=-s,n.orig.width=n._frame.width-s*2,n.orig.height=n._frame.height-s*2,this._onTextureUpdate(),a.setRealSize(i.width,i.height,this._resolution),n.updateUvs(),this._recursivePostUpdateTransform(),this.dirty=!1},t.prototype._render=function(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0),this.updateText(!0),e.prototype._render.call(this,i)},t.prototype.getLocalBounds=function(i){return this.updateText(!0),e.prototype.getLocalBounds.call(this,i)},t.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},t.prototype._generateFillStyle=function(i,r,n){var o=i.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;var s,a=i.dropShadow?i.dropShadowDistance:0,h=i.padding||0,l=this.canvas.width/this._resolution-a-h*2,u=this.canvas.height/this._resolution-a-h*2,c=o.slice(),d=i.fillGradientStops.slice();if(!d.length)for(var f=c.length+1,m=1;m<f;++m)d.push(m/f);if(c.unshift(o[0]),d.unshift(0),c.push(o[o.length-1]),d.push(1),i.fillGradientType===mr.LINEAR_VERTICAL){s=this.context.createLinearGradient(l/2,h,l/2,u+h);for(var v=n.fontProperties.fontSize+i.strokeThickness,m=0;m<r.length;m++){var y=n.lineHeight*(m-1)+v,g=n.lineHeight*m,x=g;m>0&&y>g&&(x=(g+y)/2);var _=g+v,E=n.lineHeight*(m+1),b=_;m+1<r.length&&E<_&&(b=(_+E)/2);for(var P=(b-x)/u,S=0;S<c.length;S++){var D=0;typeof d[S]=="number"?D=d[S]:D=S/c.length;var T=Math.min(1,Math.max(0,x/u+D*P));T=Number(T.toFixed(5)),s.addColorStop(T,c[S])}}}else{s=this.context.createLinearGradient(h,u/2,l+h,u/2);for(var A=c.length+1,M=1,m=0;m<c.length;m++){var O=void 0;typeof d[m]=="number"?O=d[m]:O=M/A,s.addColorStop(O,c[m]),M++}}return s},t.prototype.destroy=function(i){typeof i=="boolean"&&(i={children:i}),i=Object.assign({},Py,i),e.prototype.destroy.call(this,i),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(t.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(i){this.updateText(!0);var r=ve(this.scale.x)||1;this.scale.x=r*i/this._texture.orig.width,this._width=i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(i){this.updateText(!0);var r=ve(this.scale.y)||1;this.scale.y=r*i/this._texture.orig.height,this._height=i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"style",{get:function(){return this._style},set:function(i){i=i||{},i instanceof Se?this._style=i:this._style=new Se(i),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(i){i=String(i!=null?i:""),this._text!==i&&(this._text=i,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolution",{get:function(){return this._resolution},set:function(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)},enumerable:!1,configurable:!0}),t.nextLineHeightBehavior=!1,t}(Rt);/*!
* @pixi/canvas-text - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/canvas-text is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/Ze.prototype._renderCanvas=function(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),Rt.prototype._renderCanvas.call(this,e)};/*!
* @pixi/mixin-get-child-by-name - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/mixin-get-child-by-name is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/Vt.prototype.name=null,rt.prototype.getChildByName=function(e,t){for(var i=0,r=this.children.length;i<r;i++)if(this.children[i].name===e)return this.children[i];if(t)for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i];if(n.getChildByName){var o=this.children[i].getChildByName(e,!0);if(o)return o}}return null};/*!
* @pixi/unsafe-eval - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/unsafe-eval is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/var Ey={float:function(e,t,i,r){i!==r&&(i.v=r,e.uniform1f(t,r))},vec2:function(e,t,i,r){(i[0]!==r[0]||i[1]!==r[1])&&(i[0]=r[0],i[1]=r[1],e.uniform2f(t,r[0],r[1]))},vec3:function(e,t,i,r){(i[0]!==r[0]||i[1]!==r[1]||i[2]!==r[2])&&(i[0]=r[0],i[1]=r[1],i[2]=r[2],e.uniform3f(t,r[0],r[1],r[2]))},int:function(e,t,i,r){e.uniform1i(t,r)},ivec2:function(e,t,i,r){e.uniform2i(t,r[0],r[1])},ivec3:function(e,t,i,r){e.uniform3i(t,r[0],r[1],r[2])},ivec4:function(e,t,i,r){e.uniform4i(t,r[0],r[1],r[2],r[3])},uint:function(e,t,i,r){e.uniform1ui(t,r)},uvec2:function(e,t,i,r){e.uniform2ui(t,r[0],r[1])},uvec3:function(e,t,i,r){e.uniform3ui(t,r[0],r[1],r[2])},uvec4:function(e,t,i,r){e.uniform4ui(t,r[0],r[1],r[2],r[3])},bool:function(e,t,i,r){i!==r&&(i.v=r,e.uniform1i(t,Number(r)))},bvec2:function(e,t,i,r){e.uniform2i(t,r[0],r[1])},bvec3:function(e,t,i,r){e.uniform3i(t,r[0],r[1],r[2])},bvec4:function(e,t,i,r){e.uniform4i(t,r[0],r[1],r[2],r[3])},mat2:function(e,t,i,r){e.uniformMatrix2fv(t,!1,r)},mat3:function(e,t,i,r){e.uniformMatrix3fv(t,!1,r)},mat4:function(e,t,i,r){e.uniformMatrix4fv(t,!1,r)},sampler2D:function(e,t,i,r){e.uniform1i(t,r)},samplerCube:function(e,t,i,r){e.uniform1i(t,r)},sampler2DArray:function(e,t,i,r){e.uniform1i(t,r)}},wy={float:function(e,t,i,r){e.uniform1fv(t,r)},vec2:function(e,t,i,r){e.uniform2fv(t,r)},vec3:function(e,t,i,r){e.uniform3fv(t,r)},vec4:function(e,t,i,r){e.uniform4fv(t,r)},int:function(e,t,i,r){e.uniform1iv(t,r)},ivec2:function(e,t,i,r){e.uniform2iv(t,r)},ivec3:function(e,t,i,r){e.uniform3iv(t,r)},ivec4:function(e,t,i,r){e.uniform4iv(t,r)},uint:function(e,t,i,r){e.uniform1uiv(t,r)},uvec2:function(e,t,i,r){e.uniform2uiv(t,r)},uvec3:function(e,t,i,r){e.uniform3uiv(t,r)},uvec4:function(e,t,i,r){e.uniform4uiv(t,r)},bool:function(e,t,i,r){e.uniform1iv(t,r)},bvec2:function(e,t,i,r){e.uniform2iv(t,r)},bvec3:function(e,t,i,r){e.uniform3iv(t,r)},bvec4:function(e,t,i,r){e.uniform4iv(t,r)},sampler2D:function(e,t,i,r){e.uniform1iv(t,r)},samplerCube:function(e,t,i,r){e.uniform1iv(t,r)},sampler2DArray:function(e,t,i,r){e.uniform1iv(t,r)}};function Ty(e,t,i,r,n){var o=0,s=null,a=null,h=n.gl;for(var l in e.uniforms){var u=t[l],c=r[l],d=i[l],f=e.uniforms[l];if(!u){f.group&&n.shader.syncUniformGroup(c);continue}if(u.type==="float"&&u.size===1)c!==d.value&&(d.value=c,h.uniform1f(d.location,c));else if((u.type==="sampler2D"||u.type==="samplerCube"||u.type==="sampler2DArray")&&u.size===1&&!u.isArray)n.texture.bind(c,o),d.value!==o&&(d.value=o,h.uniform1i(d.location,o)),o++;else if(u.type==="mat3"&&u.size===1)f.a!==void 0?h.uniformMatrix3fv(d.location,!1,c.toArray(!0)):h.uniformMatrix3fv(d.location,!1,c);else if(u.type==="vec2"&&u.size===1)f.x!==void 0?(a=d.value,s=c,(a[0]!==s.x||a[1]!==s.y)&&(a[0]=s.x,a[1]=s.y,h.uniform2f(d.location,s.x,s.y))):(a=d.value,s=c,(a[0]!==s[0]||a[1]!==s[1])&&(a[0]=s[0],a[1]=s[1],h.uniform2f(d.location,s[0],s[1])));else if(u.type==="vec4"&&u.size===1)f.width!==void 0?(a=d.value,s=c,(a[0]!==s.x||a[1]!==s.y||a[2]!==s.width||a[3]!==s.height)&&(a[0]=s.x,a[1]=s.y,a[2]=s.width,a[3]=s.height,h.uniform4f(d.location,s.x,s.y,s.width,s.height))):(a=d.value,s=c,(a[0]!==s[0]||a[1]!==s[1]||a[2]!==s[2]||a[3]!==s[3])&&(a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=s[3],h.uniform4f(d.location,s[0],s[1],s[2],s[3])));else{var m=u.size===1?Ey:wy;m[u.type].call(null,h,d.location,d.value,c)}}}function Iy(e){var t=e.ShaderSystem;if(!t)throw new Error("Unable to patch ShaderSystem, class not found.");Object.assign(t.prototype,{systemCheck:function(){},syncUniforms:function(i,r){var n=this,o=n.shader,s=n.renderer;Ty(i,o.program.uniformData,r.uniformData,i.uniforms,s)}})}/*!
* @pixi/interaction - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/interaction is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/var ha=function(){function e(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new G,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(e.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),e.prototype.getLocalPosition=function(t,i,r){return t.worldTransform.applyInverse(r||this.global,i)},e.prototype.copyEvent=function(t){"isPrimary"in t&&t.isPrimary&&(this.isPrimary=!0),this.button="button"in t&&t.button;var i="buttons"in t&&t.buttons;this.buttons=Number.isInteger(i)?i:"which"in t&&t.which,this.width="width"in t&&t.width,this.height="height"in t&&t.height,this.tiltX="tiltX"in t&&t.tiltX,this.tiltY="tiltY"in t&&t.tiltY,this.pointerType="pointerType"in t&&t.pointerType,this.pressure="pressure"in t&&t.pressure,this.rotationAngle="rotationAngle"in t&&t.rotationAngle,this.twist="twist"in t&&t.twist||0,this.tangentialPressure="tangentialPressure"in t&&t.tangentialPressure||0},e.prototype.reset=function(){this.isPrimary=!1},e}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Jn=function(e,t){return Jn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},Jn(e,t)};function Cy(e,t){Jn(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var Sy=function(){function e(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return e.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},e.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},e}(),pn=function(){function e(t){this._pointerId=t,this._flags=e.FLAGS.NONE}return e.prototype._doSet=function(t,i){i?this._flags=this._flags|t:this._flags=this._flags&~t},Object.defineProperty(e.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"flags",{get:function(){return this._flags},set:function(t){this._flags=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"none",{get:function(){return this._flags===e.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"over",{get:function(){return(this._flags&e.FLAGS.OVER)!==0},set:function(t){this._doSet(e.FLAGS.OVER,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightDown",{get:function(){return(this._flags&e.FLAGS.RIGHT_DOWN)!==0},set:function(t){this._doSet(e.FLAGS.RIGHT_DOWN,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftDown",{get:function(){return(this._flags&e.FLAGS.LEFT_DOWN)!==0},set:function(t){this._doSet(e.FLAGS.LEFT_DOWN,t)},enumerable:!1,configurable:!0}),e.FLAGS=Object.freeze({NONE:0,OVER:1<<0,LEFT_DOWN:1<<1,RIGHT_DOWN:1<<2}),e}(),Ay=function(){function e(){this._tempPoint=new G}return e.prototype.recursiveFindHit=function(t,i,r,n,o){if(!i||!i.visible)return!1;var s=t.data.global;o=i.interactive||o;var a=!1,h=o,l=!0;if(i.hitArea?(n&&(i.worldTransform.applyInverse(s,this._tempPoint),i.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?a=!0:(n=!1,l=!1)),h=!1):i._mask&&n&&(i._mask.containsPoint&&i._mask.containsPoint(s)||(n=!1)),l&&i.interactiveChildren&&i.children)for(var u=i.children,c=u.length-1;c>=0;c--){var d=u[c],f=this.recursiveFindHit(t,d,r,n,h);if(f){if(!d.parent)continue;h=!1,f&&(t.target&&(n=!1),a=!0)}}return o&&(n&&!t.target&&!i.hitArea&&i.containsPoint&&i.containsPoint(s)&&(a=!0),i.interactive&&(a&&!t.target&&(t.target=i),r&&r(t,i,!!a))),a},e.prototype.findHit=function(t,i,r,n){this.recursiveFindHit(t,i,r,n,!1)},e}(),Oy={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return this.cursor==="pointer"},set buttonMode(e){e?this.cursor="pointer":this.cursor==="pointer"&&(this.cursor=null)},cursor:null,get trackedPointers(){return this._trackedPointers===void 0&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};Vt.mixin(Oy);var Zi=1,$i={target:null,data:{global:null}},la=function(e){Cy(t,e);function t(i,r){var n=e.call(this)||this;return r=r||{},n.renderer=i,n.autoPreventDefault=r.autoPreventDefault!==void 0?r.autoPreventDefault:!0,n.interactionFrequency=r.interactionFrequency||10,n.mouse=new ha,n.mouse.identifier=Zi,n.mouse.global.set(-999999),n.activeInteractionData={},n.activeInteractionData[Zi]=n.mouse,n.interactionDataPool=[],n.eventData=new Sy,n.interactionDOMElement=null,n.moveWhenInside=!1,n.eventsAdded=!1,n.tickerAdded=!1,n.mouseOverRenderer=!("PointerEvent"in self),n.supportsTouchEvents="ontouchstart"in self,n.supportsPointerEvents=!!self.PointerEvent,n.onPointerUp=n.onPointerUp.bind(n),n.processPointerUp=n.processPointerUp.bind(n),n.onPointerCancel=n.onPointerCancel.bind(n),n.processPointerCancel=n.processPointerCancel.bind(n),n.onPointerDown=n.onPointerDown.bind(n),n.processPointerDown=n.processPointerDown.bind(n),n.onPointerMove=n.onPointerMove.bind(n),n.processPointerMove=n.processPointerMove.bind(n),n.onPointerOut=n.onPointerOut.bind(n),n.processPointerOverOut=n.processPointerOverOut.bind(n),n.onPointerOver=n.onPointerOver.bind(n),n.cursorStyles={default:"inherit",pointer:"pointer"},n.currentCursorMode=null,n.cursor=null,n.resolution=1,n.delayedEvents=[],n.search=new Ay,n._tempDisplayObject=new vh,n._eventListenerOptions={capture:!0,passive:!1},n._useSystemTicker=r.useSystemTicker!==void 0?r.useSystemTicker:!0,n.setTargetElement(n.renderer.view,n.renderer.resolution),n}return Object.defineProperty(t.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(i){this._useSystemTicker=i,i?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),t.prototype.hitTest=function(i,r){return $i.target=null,$i.data.global=i,r||(r=this.lastObjectRendered),this.processInteractive($i,r,null,!0),$i.target},t.prototype.setTargetElement=function(i,r){r===void 0&&(r=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=i,this.resolution=r,this.addEvents(),this.addTickerListener()},t.prototype.addTickerListener=function(){this.tickerAdded||!this.interactionDOMElement||!this._useSystemTicker||(dt.system.add(this.tickerUpdate,this,Ee.INTERACTION),this.tickerAdded=!0)},t.prototype.removeTickerListener=function(){!this.tickerAdded||(dt.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},t.prototype.addEvents=function(){if(!(this.eventsAdded||!this.interactionDOMElement)){var i=this.interactionDOMElement.style;self.navigator.msPointerEnabled?(i.msContentZooming="none",i.msTouchAction="none"):this.supportsPointerEvents&&(i.touchAction="none"),this.supportsPointerEvents?(self.document.addEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),self.addEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),self.addEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(self.document.addEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),self.addEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.eventsAdded=!0}},t.prototype.removeEvents=function(){if(!(!this.eventsAdded||!this.interactionDOMElement)){var i=this.interactionDOMElement.style;self.navigator.msPointerEnabled?(i.msContentZooming="",i.msTouchAction=""):this.supportsPointerEvents&&(i.touchAction=""),this.supportsPointerEvents?(self.document.removeEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),self.removeEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),self.removeEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(self.document.removeEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),self.removeEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.interactionDOMElement=null,this.eventsAdded=!1}},t.prototype.tickerUpdate=function(i){this._deltaTime+=i,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())},t.prototype.update=function(){if(this.interactionDOMElement){if(this._didMove){this._didMove=!1;return}this.cursor=null;for(var i in this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(i)){var r=this.activeInteractionData[i];if(r.originalEvent&&r.pointerType!=="touch"){var n=this.configureInteractionEventForDOMEvent(this.eventData,r.originalEvent,r);this.processInteractive(n,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},t.prototype.setCursorMode=function(i){i=i||"default";var r=!0;if(self.OffscreenCanvas&&this.interactionDOMElement instanceof OffscreenCanvas&&(r=!1),this.currentCursorMode!==i){this.currentCursorMode=i;var n=this.cursorStyles[i];if(n)switch(typeof n){case"string":r&&(this.interactionDOMElement.style.cursor=n);break;case"function":n(i);break;case"object":r&&Object.assign(this.interactionDOMElement.style,n);break}else r&&typeof i=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,i)&&(this.interactionDOMElement.style.cursor=i)}},t.prototype.dispatchEvent=function(i,r,n){(!n.stopPropagationHint||i===n.stopsPropagatingAt)&&(n.currentTarget=i,n.type=r,i.emit(r,n),i[r]&&i[r](n))},t.prototype.delayDispatchEvent=function(i,r,n){this.delayedEvents.push({displayObject:i,eventString:r,eventData:n})},t.prototype.mapPositionToPoint=function(i,r,n){var o;this.interactionDOMElement.parentElement?o=this.interactionDOMElement.getBoundingClientRect():o={x:0,y:0,width:this.interactionDOMElement.width,height:this.interactionDOMElement.height,left:0,top:0};var s=1/this.resolution;i.x=(r-o.left)*(this.interactionDOMElement.width/o.width)*s,i.y=(n-o.top)*(this.interactionDOMElement.height/o.height)*s},t.prototype.processInteractive=function(i,r,n,o){var s=this.search.findHit(i,r,n,o),a=this.delayedEvents;if(!a.length)return s;i.stopPropagationHint=!1;var h=a.length;this.delayedEvents=[];for(var l=0;l<h;l++){var u=a[l],c=u.displayObject,d=u.eventString,f=u.eventData;f.stopsPropagatingAt===c&&(f.stopPropagationHint=!0),this.dispatchEvent(c,d,f)}return s},t.prototype.onPointerDown=function(i){if(!(this.supportsTouchEvents&&i.pointerType==="touch")){var r=this.normalizeToPointerData(i);if(this.autoPreventDefault&&r[0].isNormalized){var n=i.cancelable||!("cancelable"in i);n&&i.preventDefault()}for(var o=r.length,s=0;s<o;s++){var a=r[s],h=this.getInteractionDataForPointerId(a),l=this.configureInteractionEventForDOMEvent(this.eventData,a,h);if(l.data.originalEvent=i,this.processInteractive(l,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",l),a.pointerType==="touch")this.emit("touchstart",l);else if(a.pointerType==="mouse"||a.pointerType==="pen"){var u=a.button===2;this.emit(u?"rightdown":"mousedown",this.eventData)}}}},t.prototype.processPointerDown=function(i,r,n){var o=i.data,s=i.data.identifier;if(n){if(r.trackedPointers[s]||(r.trackedPointers[s]=new pn(s)),this.dispatchEvent(r,"pointerdown",i),o.pointerType==="touch")this.dispatchEvent(r,"touchstart",i);else if(o.pointerType==="mouse"||o.pointerType==="pen"){var a=o.button===2;a?r.trackedPointers[s].rightDown=!0:r.trackedPointers[s].leftDown=!0,this.dispatchEvent(r,a?"rightdown":"mousedown",i)}}},t.prototype.onPointerComplete=function(i,r,n){for(var o=this.normalizeToPointerData(i),s=o.length,a=i.target!==this.interactionDOMElement?"outside":"",h=0;h<s;h++){var l=o[h],u=this.getInteractionDataForPointerId(l),c=this.configureInteractionEventForDOMEvent(this.eventData,l,u);if(c.data.originalEvent=i,this.processInteractive(c,this.lastObjectRendered,n,r||!a),this.emit(r?"pointercancel":"pointerup"+a,c),l.pointerType==="mouse"||l.pointerType==="pen"){var d=l.button===2;this.emit(d?"rightup"+a:"mouseup"+a,c)}else l.pointerType==="touch"&&(this.emit(r?"touchcancel":"touchend"+a,c),this.releaseInteractionDataForPointerId(l.pointerId))}},t.prototype.onPointerCancel=function(i){this.supportsTouchEvents&&i.pointerType==="touch"||this.onPointerComplete(i,!0,this.processPointerCancel)},t.prototype.processPointerCancel=function(i,r){var n=i.data,o=i.data.identifier;r.trackedPointers[o]!==void 0&&(delete r.trackedPointers[o],this.dispatchEvent(r,"pointercancel",i),n.pointerType==="touch"&&this.dispatchEvent(r,"touchcancel",i))},t.prototype.onPointerUp=function(i){this.supportsTouchEvents&&i.pointerType==="touch"||this.onPointerComplete(i,!1,this.processPointerUp)},t.prototype.processPointerUp=function(i,r,n){var o=i.data,s=i.data.identifier,a=r.trackedPointers[s],h=o.pointerType==="touch",l=o.pointerType==="mouse"||o.pointerType==="pen",u=!1;if(l){var c=o.button===2,d=pn.FLAGS,f=c?d.RIGHT_DOWN:d.LEFT_DOWN,m=a!==void 0&&a.flags&f;n?(this.dispatchEvent(r,c?"rightup":"mouseup",i),m&&(this.dispatchEvent(r,c?"rightclick":"click",i),u=!0)):m&&this.dispatchEvent(r,c?"rightupoutside":"mouseupoutside",i),a&&(c?a.rightDown=!1:a.leftDown=!1)}n?(this.dispatchEvent(r,"pointerup",i),h&&this.dispatchEvent(r,"touchend",i),a&&((!l||u)&&this.dispatchEvent(r,"pointertap",i),h&&(this.dispatchEvent(r,"tap",i),a.over=!1))):a&&(this.dispatchEvent(r,"pointerupoutside",i),h&&this.dispatchEvent(r,"touchendoutside",i)),a&&a.none&&delete r.trackedPointers[s]},t.prototype.onPointerMove=function(i){if(!(this.supportsTouchEvents&&i.pointerType==="touch")){var r=this.normalizeToPointerData(i);(r[0].pointerType==="mouse"||r[0].pointerType==="pen")&&(this._didMove=!0,this.cursor=null);for(var n=r.length,o=0;o<n;o++){var s=r[o],a=this.getInteractionDataForPointerId(s),h=this.configureInteractionEventForDOMEvent(this.eventData,s,a);h.data.originalEvent=i,this.processInteractive(h,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",h),s.pointerType==="touch"&&this.emit("touchmove",h),(s.pointerType==="mouse"||s.pointerType==="pen")&&this.emit("mousemove",h)}r[0].pointerType==="mouse"&&this.setCursorMode(this.cursor)}},t.prototype.processPointerMove=function(i,r,n){var o=i.data,s=o.pointerType==="touch",a=o.pointerType==="mouse"||o.pointerType==="pen";a&&this.processPointerOverOut(i,r,n),(!this.moveWhenInside||n)&&(this.dispatchEvent(r,"pointermove",i),s&&this.dispatchEvent(r,"touchmove",i),a&&this.dispatchEvent(r,"mousemove",i))},t.prototype.onPointerOut=function(i){if(!(this.supportsTouchEvents&&i.pointerType==="touch")){var r=this.normalizeToPointerData(i),n=r[0];n.pointerType==="mouse"&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var o=this.getInteractionDataForPointerId(n),s=this.configureInteractionEventForDOMEvent(this.eventData,n,o);s.data.originalEvent=n,this.processInteractive(s,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",s),n.pointerType==="mouse"||n.pointerType==="pen"?this.emit("mouseout",s):this.releaseInteractionDataForPointerId(o.identifier)}},t.prototype.processPointerOverOut=function(i,r,n){var o=i.data,s=i.data.identifier,a=o.pointerType==="mouse"||o.pointerType==="pen",h=r.trackedPointers[s];n&&!h&&(h=r.trackedPointers[s]=new pn(s)),h!==void 0&&(n&&this.mouseOverRenderer?(h.over||(h.over=!0,this.delayDispatchEvent(r,"pointerover",i),a&&this.delayDispatchEvent(r,"mouseover",i)),a&&this.cursor===null&&(this.cursor=r.cursor)):h.over&&(h.over=!1,this.dispatchEvent(r,"pointerout",this.eventData),a&&this.dispatchEvent(r,"mouseout",i),h.none&&delete r.trackedPointers[s]))},t.prototype.onPointerOver=function(i){var r=this.normalizeToPointerData(i),n=r[0],o=this.getInteractionDataForPointerId(n),s=this.configureInteractionEventForDOMEvent(this.eventData,n,o);s.data.originalEvent=n,n.pointerType==="mouse"&&(this.mouseOverRenderer=!0),this.emit("pointerover",s),(n.pointerType==="mouse"||n.pointerType==="pen")&&this.emit("mouseover",s)},t.prototype.getInteractionDataForPointerId=function(i){var r=i.pointerId,n;return r===Zi||i.pointerType==="mouse"?n=this.mouse:this.activeInteractionData[r]?n=this.activeInteractionData[r]:(n=this.interactionDataPool.pop()||new ha,n.identifier=r,this.activeInteractionData[r]=n),n.copyEvent(i),n},t.prototype.releaseInteractionDataForPointerId=function(i){var r=this.activeInteractionData[i];r&&(delete this.activeInteractionData[i],r.reset(),this.interactionDataPool.push(r))},t.prototype.configureInteractionEventForDOMEvent=function(i,r,n){return i.data=n,this.mapPositionToPoint(n.global,r.clientX,r.clientY),r.pointerType==="touch"&&(r.globalX=n.global.x,r.globalY=n.global.y),n.originalEvent=r,i.reset(),i},t.prototype.normalizeToPointerData=function(i){var r=[];if(this.supportsTouchEvents&&i instanceof TouchEvent)for(var n=0,o=i.changedTouches.length;n<o;n++){var s=i.changedTouches[n];typeof s.button>"u"&&(s.button=i.touches.length?1:0),typeof s.buttons>"u"&&(s.buttons=i.touches.length?1:0),typeof s.isPrimary>"u"&&(s.isPrimary=i.touches.length===1&&i.type==="touchstart"),typeof s.width>"u"&&(s.width=s.radiusX||1),typeof s.height>"u"&&(s.height=s.radiusY||1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="touch"),typeof s.pointerId>"u"&&(s.pointerId=s.identifier||0),typeof s.pressure>"u"&&(s.pressure=s.force||.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),typeof s.layerX>"u"&&(s.layerX=s.offsetX=s.clientX),typeof s.layerY>"u"&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,r.push(s)}else if(!self.MouseEvent||i instanceof MouseEvent&&(!this.supportsPointerEvents||!(i instanceof self.PointerEvent))){var a=i;typeof a.isPrimary>"u"&&(a.isPrimary=!0),typeof a.width>"u"&&(a.width=1),typeof a.height>"u"&&(a.height=1),typeof a.tiltX>"u"&&(a.tiltX=0),typeof a.tiltY>"u"&&(a.tiltY=0),typeof a.pointerType>"u"&&(a.pointerType="mouse"),typeof a.pointerId>"u"&&(a.pointerId=Zi),typeof a.pressure>"u"&&(a.pressure=.5),typeof a.twist>"u"&&(a.twist=0),typeof a.tangentialPressure>"u"&&(a.tangentialPressure=0),a.isNormalized=!0,r.push(a)}else r.push(i);return r},t.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},t}(Le);/*!
* @pixi/canvas-renderer - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/canvas-renderer is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Qn=function(e,t){return Qn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},Qn(e,t)};function Ly(e,t){Qn(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var Ny=function(){function e(t){this._foundShapes=[],this.renderer=t}return e.prototype.pushMask=function(t){var i=this.renderer,r=t.maskObject||t;i.context.save();var n=this._foundShapes;if(this.recursiveFindShapes(r,n),n.length>0){var o=i.context;o.beginPath();for(var s=0;s<n.length;s++){var a=n[s],h=a.transform.worldTransform;this.renderer.setContextTransform(h),this.renderGraphicsShape(a)}n.length=0,o.clip()}},e.prototype.recursiveFindShapes=function(t,i){t.geometry&&t.geometry.graphicsData&&i.push(t);var r=t.children;if(r)for(var n=0;n<r.length;n++)this.recursiveFindShapes(r[n],i)},e.prototype.renderGraphicsShape=function(t){t.finishPoly();var i=this.renderer.context,r=t.geometry.graphicsData,n=r.length;if(n!==0)for(var o=0;o<n;o++){var s=r[o],a=s.shape;if(a.type===Y.POLY){var h=a.points,l=s.holes,u=void 0,c=void 0,d=void 0,f=void 0;i.moveTo(h[0],h[1]);for(var m=1;m<h.length/2;m++)i.lineTo(h[m*2],h[m*2+1]);if(l.length>0){u=0,d=h[0],f=h[1];for(var m=2;m+2<h.length;m+=2)u+=(h[m]-d)*(h[m+3]-f)-(h[m+2]-d)*(h[m+1]-f);for(var v=0;v<l.length;v++)if(h=l[v].shape.points,!!h){c=0,d=h[0],f=h[1];for(var m=2;m+2<h.length;m+=2)c+=(h[m]-d)*(h[m+3]-f)-(h[m+2]-d)*(h[m+1]-f);if(c*u<0){i.moveTo(h[0],h[1]);for(var m=2;m<h.length;m+=2)i.lineTo(h[m],h[m+1])}else{i.moveTo(h[h.length-2],h[h.length-1]);for(var m=h.length-4;m>=0;m-=2)i.lineTo(h[m],h[m+1])}l[v].shape.closeStroke&&i.closePath()}}h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&i.closePath()}else if(a.type===Y.RECT)i.rect(a.x,a.y,a.width,a.height),i.closePath();else if(a.type===Y.CIRC)i.arc(a.x,a.y,a.radius,0,2*Math.PI),i.closePath();else if(a.type===Y.ELIP){var y=a.width*2,g=a.height*2,x=a.x-y/2,_=a.y-g/2,E=.5522848,b=y/2*E,P=g/2*E,S=x+y,D=_+g,T=x+y/2,A=_+g/2;i.moveTo(x,A),i.bezierCurveTo(x,A-P,T-b,_,T,_),i.bezierCurveTo(T+b,_,S,A-P,S,A),i.bezierCurveTo(S,A+P,T+b,D,T,D),i.bezierCurveTo(T-b,D,x,A+P,x,A),i.closePath()}else if(a.type===Y.RREC){var M=a.x,O=a.y,R=a.width,H=a.height,C=a.radius,N=Math.min(R,H)/2;C=C>N?N:C,i.moveTo(M,O+C),i.lineTo(M,O+H-C),i.quadraticCurveTo(M,O+H,M+C,O+H),i.lineTo(M+R-C,O+H),i.quadraticCurveTo(M+R,O+H,M+R,O+H-C),i.lineTo(M+R,O+C),i.quadraticCurveTo(M+R,O,M+R-C,O),i.lineTo(M+C,O),i.quadraticCurveTo(M,O,M,O+C),i.closePath()}}},e.prototype.popMask=function(t){t.context.restore(),t.invalidateBlendMode()},e.prototype.destroy=function(){},e}();function ua(e){var t=document.createElement("canvas");t.width=6,t.height=1;var i=t.getContext("2d");return i.fillStyle=e,i.fillRect(0,0,6,1),t}function Mh(){if(typeof document>"u")return!1;var e=ua("#ff00ff"),t=ua("#ffff00"),i=document.createElement("canvas");i.width=6,i.height=1;var r=i.getContext("2d");r.globalCompositeOperation="multiply",r.drawImage(e,0,0),r.drawImage(t,2,0);var n=r.getImageData(2,0,1,1);if(!n)return!1;var o=n.data;return o[0]===255&&o[1]===0&&o[2]===0}function Ry(e){return e===void 0&&(e=[]),Mh()?(e[w.NORMAL]="source-over",e[w.ADD]="lighter",e[w.MULTIPLY]="multiply",e[w.SCREEN]="screen",e[w.OVERLAY]="overlay",e[w.DARKEN]="darken",e[w.LIGHTEN]="lighten",e[w.COLOR_DODGE]="color-dodge",e[w.COLOR_BURN]="color-burn",e[w.HARD_LIGHT]="hard-light",e[w.SOFT_LIGHT]="soft-light",e[w.DIFFERENCE]="difference",e[w.EXCLUSION]="exclusion",e[w.HUE]="hue",e[w.SATURATION]="saturate",e[w.COLOR]="color",e[w.LUMINOSITY]="luminosity"):(e[w.NORMAL]="source-over",e[w.ADD]="lighter",e[w.MULTIPLY]="source-over",e[w.SCREEN]="source-over",e[w.OVERLAY]="source-over",e[w.DARKEN]="source-over",e[w.LIGHTEN]="source-over",e[w.COLOR_DODGE]="source-over",e[w.COLOR_BURN]="source-over",e[w.HARD_LIGHT]="source-over",e[w.SOFT_LIGHT]="source-over",e[w.DIFFERENCE]="source-over",e[w.EXCLUSION]="source-over",e[w.HUE]="source-over",e[w.SATURATION]="source-over",e[w.COLOR]="source-over",e[w.LUMINOSITY]="source-over"),e[w.NORMAL_NPM]=e[w.NORMAL],e[w.ADD_NPM]=e[w.ADD],e[w.SCREEN_NPM]=e[w.SCREEN],e[w.SRC_IN]="source-in",e[w.SRC_OUT]="source-out",e[w.SRC_ATOP]="source-atop",e[w.DST_OVER]="destination-over",e[w.DST_IN]="destination-in",e[w.DST_OUT]="destination-out",e[w.DST_ATOP]="destination-atop",e[w.XOR]="xor",e[w.SUBTRACT]="source-over",e}var My=new J,ee=function(e){Ly(t,e);function t(i){var r=e.call(this,ze.CANVAS,i)||this;if(r.refresh=!0,r.maskManager=new Ny(r),r.smoothProperty="imageSmoothingEnabled",r.blendModes=Ry(),r.renderingToScreen=!1,r._activeBlendMode=null,r._projTransform=null,r._outerBlend=!1,r.rootContext=r.view.getContext("2d",{alpha:r.useContextAlpha}),r.context=r.rootContext,!r.rootContext.imageSmoothingEnabled){var n=r.rootContext;n.webkitImageSmoothingEnabled?r.smoothProperty="webkitImageSmoothingEnabled":n.mozImageSmoothingEnabled?r.smoothProperty="mozImageSmoothingEnabled":n.oImageSmoothingEnabled?r.smoothProperty="oImageSmoothingEnabled":n.msImageSmoothingEnabled&&(r.smoothProperty="msImageSmoothingEnabled")}return r.initPlugins(t.__plugins),yo("Canvas"),r.resize(r.options.width,r.options.height),r}return t.prototype.render=function(i,r){if(this.view){var n,o,s,a;r&&(r instanceof Lt||r instanceof Ir?(Ie("6.0.0","CanvasRenderer#render arguments changed, use options instead."),n=r,o=arguments[2],s=arguments[3],a=arguments[4]):(n=r.renderTexture,o=r.clear,s=r.transform,a=r.skipUpdateTransform)),this.renderingToScreen=!n,this.emit("prerender");var h=this.resolution;n?(n=n.castToBaseTexture(),n._canvasRenderTarget||(n._canvasRenderTarget=new xo(n.width,n.height,n.resolution),n.resource=new Eo(n._canvasRenderTarget.canvas),n.valid=!0),this.context=n._canvasRenderTarget.context,this.resolution=n._canvasRenderTarget.resolution):this.context=this.rootContext;var l=this.context;if(this._projTransform=s||null,n||(this._lastObjectRendered=i),!a){var u=i.enableTempParent();i.updateTransform(),i.disableTempParent(u)}if(l.save(),l.setTransform(1,0,0,1,0,0),l.globalAlpha=1,this._activeBlendMode=w.NORMAL,this._outerBlend=!1,l.globalCompositeOperation=this.blendModes[w.NORMAL],o!==void 0?o:this.clearBeforeRender)if(this.renderingToScreen)l.clearRect(0,0,this.width,this.height),this.backgroundAlpha>0&&(l.globalAlpha=this.useContextAlpha?this.backgroundAlpha:1,l.fillStyle=this._backgroundColorString,l.fillRect(0,0,this.width,this.height),l.globalAlpha=1);else{n=n,n._canvasRenderTarget.clear();var c=n.clearColor;c[3]>0&&(l.globalAlpha=this.useContextAlpha?c[3]:1,l.fillStyle=Si(Ai(c)),l.fillRect(0,0,n.realWidth,n.realHeight),l.globalAlpha=1)}var d=this.context;this.context=l,i.renderCanvas(this),this.context=d,l.restore(),this.resolution=h,this._projTransform=null,this.emit("postrender")}},t.prototype.setContextTransform=function(i,r,n){var o=i,s=this._projTransform,a=this.resolution;n=n||a,s&&(o=My,o.copyFrom(i),o.prepend(s)),r?this.context.setTransform(o.a*n,o.b*n,o.c*n,o.d*n,o.tx*a|0,o.ty*a|0):this.context.setTransform(o.a*n,o.b*n,o.c*n,o.d*n,o.tx*a,o.ty*a)},t.prototype.clear=function(i,r){i===void 0&&(i=this._backgroundColorString),r===void 0&&(r=this.backgroundAlpha);var n=this.context;n.clearRect(0,0,this.width,this.height),i&&(n.globalAlpha=this.useContextAlpha?r:1,n.fillStyle=i,n.fillRect(0,0,this.width,this.height),n.globalAlpha=1)},t.prototype.setBlendMode=function(i,r){var n=i===w.SRC_IN||i===w.SRC_OUT||i===w.DST_IN||i===w.DST_ATOP;!r&&n&&(i=w.NORMAL),this._activeBlendMode!==i&&(this._activeBlendMode=i,this._outerBlend=n,this.context.globalCompositeOperation=this.blendModes[i])},t.prototype.destroy=function(i){e.prototype.destroy.call(this,i),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},t.prototype.resize=function(i,r){e.prototype.resize.call(this,i,r),this.smoothProperty&&(this.rootContext[this.smoothProperty]=F.SCALE_MODE===ct.LINEAR)},t.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},t.registerPlugin=function(i,r){t.__plugins=t.__plugins||{},t.__plugins[i]=r},t}(Co),lt={canvas:null,getTintedCanvas:function(e,t){var i=e.texture;t=lt.roundColor(t);var r="#"+("00000"+(t|0).toString(16)).substr(-6);i.tintCache=i.tintCache||{};var n=i.tintCache[r],o;if(n){if(n.tintId===i._updateID)return i.tintCache[r];o=i.tintCache[r]}else o=document.createElement("canvas");return lt.tintMethod(i,t,o),o.tintId=i._updateID,i.tintCache[r]=o,o},getTintedPattern:function(e,t){t=lt.roundColor(t);var i="#"+("00000"+(t|0).toString(16)).substr(-6);e.patternCache=e.patternCache||{};var r=e.patternCache[i];return r&&r.tintId===e._updateID||(lt.canvas||(lt.canvas=document.createElement("canvas")),lt.tintMethod(e,t,lt.canvas),r=lt.canvas.getContext("2d").createPattern(lt.canvas,"repeat"),r.tintId=e._updateID,e.patternCache[i]=r),r},tintWithMultiply:function(e,t,i){var r=i.getContext("2d"),n=e._frame.clone(),o=e.baseTexture.resolution;n.x*=o,n.y*=o,n.width*=o,n.height*=o,i.width=Math.ceil(n.width),i.height=Math.ceil(n.height),r.save(),r.fillStyle="#"+("00000"+(t|0).toString(16)).substr(-6),r.fillRect(0,0,n.width,n.height),r.globalCompositeOperation="multiply";var s=e.baseTexture.getDrawableSource();r.drawImage(s,n.x,n.y,n.width,n.height,0,0,n.width,n.height),r.globalCompositeOperation="destination-atop",r.drawImage(s,n.x,n.y,n.width,n.height,0,0,n.width,n.height),r.restore()},tintWithOverlay:function(e,t,i){var r=i.getContext("2d"),n=e._frame.clone(),o=e.baseTexture.resolution;n.x*=o,n.y*=o,n.width*=o,n.height*=o,i.width=Math.ceil(n.width),i.height=Math.ceil(n.height),r.save(),r.globalCompositeOperation="copy",r.fillStyle="#"+("00000"+(t|0).toString(16)).substr(-6),r.fillRect(0,0,n.width,n.height),r.globalCompositeOperation="destination-atop",r.drawImage(e.baseTexture.getDrawableSource(),n.x,n.y,n.width,n.height,0,0,n.width,n.height),r.restore()},tintWithPerPixel:function(e,t,i){var r=i.getContext("2d"),n=e._frame.clone(),o=e.baseTexture.resolution;n.x*=o,n.y*=o,n.width*=o,n.height*=o,i.width=Math.ceil(n.width),i.height=Math.ceil(n.height),r.save(),r.globalCompositeOperation="copy",r.drawImage(e.baseTexture.getDrawableSource(),n.x,n.y,n.width,n.height,0,0,n.width,n.height),r.restore();for(var s=Te(t),a=s[0],h=s[1],l=s[2],u=r.getImageData(0,0,n.width,n.height),c=u.data,d=0;d<c.length;d+=4)c[d+0]*=a,c[d+1]*=h,c[d+2]*=l;r.putImageData(u,0,0)},roundColor:function(e){var t=lt.cacheStepsPerColorChannel,i=Te(e);return i[0]=Math.min(255,i[0]/t*t),i[1]=Math.min(255,i[1]/t*t),i[2]=Math.min(255,i[2]/t*t),Ai(i)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:Mh(),tintMethod:null};lt.tintMethod=lt.canUseMultiply?lt.tintWithMultiply:lt.tintWithPerPixel;var Dy=Ce.create;Ce.create=function(e){var t=e&&e.forceCanvas;if(!t)try{return Dy(e)}catch{}return new ee(e)},W.prototype.getDrawableSource=function(){var e=this.resource;return e?e.bitmap||e.source:null},Ir.prototype._canvasRenderTarget=null,z.prototype.patternCache=null,z.prototype.tintCache=null;/*!
* @pixi/canvas-extract - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/canvas-extract is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/var ca=new X,Fy=function(){function e(t){this.renderer=t}return e.prototype.image=function(t,i,r){var n=new Image;return n.src=this.base64(t,i,r),n},e.prototype.base64=function(t,i,r){return this.canvas(t).toDataURL(i,r)},e.prototype.canvas=function(t){var i=this.renderer,r,n,o,s;t&&(t instanceof Lt?s=t:s=i.generateTexture(t)),s?(r=s.baseTexture._canvasRenderTarget.context,n=s.baseTexture._canvasRenderTarget.resolution,o=s.frame):(r=i.rootContext,n=i.resolution,o=ca,o.width=this.renderer.width,o.height=this.renderer.height);var a=Math.floor(o.width*n+1e-4),h=Math.floor(o.height*n+1e-4),l=new xo(a,h,1),u=r.getImageData(o.x*n,o.y*n,a,h);return l.context.putImageData(u,0,0),l.canvas},e.prototype.pixels=function(t){var i=this.renderer,r,n,o,s;t&&(t instanceof Lt?s=t:s=i.generateTexture(t)),s?(r=s.baseTexture._canvasRenderTarget.context,n=s.baseTexture._canvasRenderTarget.resolution,o=s.frame):(r=i.rootContext,n=i.resolution,o=ca,o.width=i.width,o.height=i.height);var a=o.x*n,h=o.y*n,l=o.width*n,u=o.height*n;return r.getImageData(a,h,l,u).data},e.prototype.destroy=function(){this.renderer=null},e}();/*!
* @pixi/canvas-graphics - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/canvas-graphics is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/var pa=function(){function e(){}return e.offsetPolygon=function(t,i){var r=[],n=t.length;i=e.isPolygonClockwise(t)?i:-1*i;for(var o=0;o<n;o+=2){var s=o-2;s<0&&(s+=n);var a=(o+2)%n,h=t[o]-t[s],l=t[o+1]-t[s+1],u=Math.sqrt(h*h+l*l);h/=u,l/=u,h*=i,l*=i;var c=-l,d=h,f=[t[s]+c,t[s+1]+d],m=[t[o]+c,t[o+1]+d],v=t[a]-t[o],y=t[a+1]-t[o+1];u=Math.sqrt(v*v+y*y),v/=u,y/=u,v*=i,y*=i;var g=-y,x=v,_=[t[o]+g,t[o+1]+x],E=[t[a]+g,t[a+1]+x],b=e.findIntersection(f[0],f[1],m[0],m[1],_[0],_[1],E[0],E[1]);b&&r.push.apply(r,b)}return r},e.findIntersection=function(t,i,r,n,o,s,a,h){var l=(h-s)*(r-t)-(a-o)*(n-i),u=(a-o)*(i-s)-(h-s)*(t-o),c=(r-t)*(i-s)-(n-i)*(t-o);if(l===0)return u===0&&c===0?[(t+r)/2,(i+n)/2]:null;var d=u/l;return[t+d*(r-t),i+d*(n-i)]},e.isPolygonClockwise=function(t){for(var i=0,r=0;r<t.length-2;r+=2)i+=(t[r+2]-t[r])*(t[r+3]+t[r+1]);return i>0},e}(),By=function(){function e(t){this._svgMatrix=null,this._tempMatrix=new J,this.renderer=t}return e.prototype._calcCanvasStyle=function(t,i){var r;return t.texture&&t.texture.baseTexture!==z.WHITE.baseTexture?t.texture.valid?(r=lt.getTintedPattern(t.texture,i),this.setPatternTransform(r,t.matrix||J.IDENTITY)):r="#808080":r="#"+("00000"+(i|0).toString(16)).substr(-6),r},e.prototype.render=function(t){var i=this.renderer,r=i.context,n=t.worldAlpha,o=t.transform.worldTransform;i.setContextTransform(o),i.setBlendMode(t.blendMode);for(var s=t.geometry.graphicsData,a,h,l=(t.tint>>16&255)/255,u=(t.tint>>8&255)/255,c=(t.tint&255)/255,d=0;d<s.length;d++){var f=s[d],m=f.shape,v=f.fillStyle,y=f.lineStyle,g=f.fillStyle.color|0,x=f.lineStyle.color|0;if(f.matrix&&i.setContextTransform(o.copyTo(this._tempMatrix).append(f.matrix)),v.visible){var _=((g>>16&255)/255*l*255<<16)+((g>>8&255)/255*u*255<<8)+(g&255)/255*c*255;a=this._calcCanvasStyle(v,_)}if(y.visible){var E=((x>>16&255)/255*l*255<<16)+((x>>8&255)/255*u*255<<8)+(x&255)/255*c*255;h=this._calcCanvasStyle(y,E)}if(r.lineWidth=y.width,r.lineCap=y.cap,r.lineJoin=y.join,r.miterLimit=y.miterLimit,f.type===Y.POLY){r.beginPath();var b=m,P=b.points,S=f.holes,D=void 0,T=void 0,A=void 0,M=void 0,O=void 0;r.moveTo(P[0],P[1]);for(var R=2;R<P.length;R+=2)r.lineTo(P[R],P[R+1]);if(b.closeStroke&&r.closePath(),S.length>0){O=[],D=0,A=P[0],M=P[1];for(var R=2;R+2<P.length;R+=2)D+=(P[R]-A)*(P[R+3]-M)-(P[R+2]-A)*(P[R+1]-M);for(var H=0;H<S.length;H++)if(P=S[H].shape.points,!!P){T=0,A=P[0],M=P[1];for(var R=2;R+2<P.length;R+=2)T+=(P[R]-A)*(P[R+3]-M)-(P[R+2]-A)*(P[R+1]-M);if(T*D<0){r.moveTo(P[0],P[1]);for(var R=2;R<P.length;R+=2)r.lineTo(P[R],P[R+1])}else{r.moveTo(P[P.length-2],P[P.length-1]);for(var R=P.length-4;R>=0;R-=2)r.lineTo(P[R],P[R+1])}S[H].shape.closeStroke&&r.closePath(),O[H]=T*D<0}}v.visible&&(r.globalAlpha=v.alpha*n,r.fillStyle=a,r.fill()),y.visible&&this.paintPolygonStroke(b,y,h,S,O,n,r)}else if(f.type===Y.RECT){var b=m;if(v.visible&&(r.globalAlpha=v.alpha*n,r.fillStyle=a,r.fillRect(b.x,b.y,b.width,b.height)),y.visible){var C=y.width*(.5-(1-y.alignment)),N=b.width+2*C,B=b.height+2*C;r.globalAlpha=y.alpha*n,r.strokeStyle=h,r.strokeRect(b.x-C,b.y-C,N,B)}}else if(f.type===Y.CIRC){var b=m;if(r.beginPath(),r.arc(b.x,b.y,b.radius,0,2*Math.PI),r.closePath(),v.visible&&(r.globalAlpha=v.alpha*n,r.fillStyle=a,r.fill()),y.visible){if(y.alignment!==.5){var C=y.width*(.5-(1-y.alignment));r.beginPath(),r.arc(b.x,b.y,b.radius+C,0,2*Math.PI),r.closePath()}r.globalAlpha=y.alpha*n,r.strokeStyle=h,r.stroke()}}else if(f.type===Y.ELIP){var b=m,et=y.alignment===1;if(et||this.paintEllipse(b,v,y,a,n,r),y.visible){if(y.alignment!==.5){var Ft=.5522848,C=y.width*(.5-(1-y.alignment)),Bt=(b.width+C)*2,kt=(b.height+C)*2,bt=b.x-Bt/2,Pt=b.y-kt/2,le=Bt/2*Ft,ue=kt/2*Ft,Zt=bt+Bt,$t=Pt+kt,Ct=bt+Bt/2,pt=Pt+kt/2;r.beginPath(),r.moveTo(bt,pt),r.bezierCurveTo(bt,pt-ue,Ct-le,Pt,Ct,Pt),r.bezierCurveTo(Ct+le,Pt,Zt,pt-ue,Zt,pt),r.bezierCurveTo(Zt,pt+ue,Ct+le,$t,Ct,$t),r.bezierCurveTo(Ct-le,$t,bt,pt+ue,bt,pt),r.closePath()}r.globalAlpha=y.alpha*n,r.strokeStyle=h,r.stroke()}et&&this.paintEllipse(b,v,y,a,n,r)}else if(f.type===Y.RREC){var b=m,et=y.alignment===1;if(et||this.paintRoundedRectangle(b,v,y,a,n,r),y.visible){if(y.alignment!==.5){var N=b.width,B=b.height,C=y.width*(.5-(1-y.alignment)),$=b.x-C,K=b.y-C,it=b.width+2*C,Et=b.height+2*C,Li=C*(y.alignment>=1?Math.min(it/N,Et/B):Math.min(N/it,B/Et)),ft=b.radius+Li,Ni=Math.min(it,Et)/2;ft=ft>Ni?Ni:ft,r.beginPath(),r.moveTo($,K+ft),r.lineTo($,K+Et-ft),r.quadraticCurveTo($,K+Et,$+ft,K+Et),r.lineTo($+it-ft,K+Et),r.quadraticCurveTo($+it,K+Et,$+it,K+Et-ft),r.lineTo($+it,K+ft),r.quadraticCurveTo($+it,K,$+it-ft,K),r.lineTo($+ft,K),r.quadraticCurveTo($,K,$,K+ft),r.closePath()}r.globalAlpha=y.alpha*n,r.strokeStyle=h,r.stroke()}et&&this.paintRoundedRectangle(b,v,y,a,n,r)}}},e.prototype.paintPolygonStroke=function(t,i,r,n,o,s,a){if(i.alignment!==.5){var h=i.width*(.5-(1-i.alignment)),l=pa.offsetPolygon(t.points,h),u=void 0;a.beginPath(),a.moveTo(l[0],l[1]);for(var c=2;c<l.length;c+=2)a.lineTo(l[c],l[c+1]);t.closeStroke&&a.closePath();for(var d=0;d<n.length;d++){if(u=n[d].shape.points,l=pa.offsetPolygon(u,h),o[d]){a.moveTo(l[0],l[1]);for(var c=2;c<l.length;c+=2)a.lineTo(l[c],l[c+1])}else{a.moveTo(l[l.length-2],l[l.length-1]);for(var c=l.length-4;c>=0;c-=2)a.lineTo(l[c],l[c+1])}n[d].shape.closeStroke&&a.closePath()}}a.globalAlpha=i.alpha*s,a.strokeStyle=r,a.stroke()},e.prototype.paintEllipse=function(t,i,r,n,o,s){var a=t.width*2,h=t.height*2,l=t.x-a/2,u=t.y-h/2,c=.5522848,d=a/2*c,f=h/2*c,m=l+a,v=u+h,y=l+a/2,g=u+h/2;r.alignment===0&&s.save(),s.beginPath(),s.moveTo(l,g),s.bezierCurveTo(l,g-f,y-d,u,y,u),s.bezierCurveTo(y+d,u,m,g-f,m,g),s.bezierCurveTo(m,g+f,y+d,v,y,v),s.bezierCurveTo(y-d,v,l,g+f,l,g),s.closePath(),r.alignment===0&&s.clip(),i.visible&&(s.globalAlpha=i.alpha*o,s.fillStyle=n,s.fill()),r.alignment===0&&s.restore()},e.prototype.paintRoundedRectangle=function(t,i,r,n,o,s){var a=t.x,h=t.y,l=t.width,u=t.height,c=t.radius,d=Math.min(l,u)/2;c=c>d?d:c,r.alignment===0&&s.save(),s.beginPath(),s.moveTo(a,h+c),s.lineTo(a,h+u-c),s.quadraticCurveTo(a,h+u,a+c,h+u),s.lineTo(a+l-c,h+u),s.quadraticCurveTo(a+l,h+u,a+l,h+u-c),s.lineTo(a+l,h+c),s.quadraticCurveTo(a+l,h,a+l-c,h),s.lineTo(a+c,h),s.quadraticCurveTo(a,h,a,h+c),s.closePath(),r.alignment===0&&s.clip(),i.visible&&(s.globalAlpha=i.alpha*o,s.fillStyle=n,s.fill()),r.alignment===0&&s.restore()},e.prototype.setPatternTransform=function(t,i){if(this._svgMatrix!==!1){if(!this._svgMatrix){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");if(r&&r.createSVGMatrix&&(this._svgMatrix=r.createSVGMatrix()),!this._svgMatrix||!t.setTransform){this._svgMatrix=!1;return}}this._svgMatrix.a=i.a,this._svgMatrix.b=i.b,this._svgMatrix.c=i.c,this._svgMatrix.d=i.d,this._svgMatrix.e=i.tx,this._svgMatrix.f=i.ty,t.setTransform(this._svgMatrix.inverse())}},e.prototype.destroy=function(){this.renderer=null,this._svgMatrix=null,this._tempMatrix=null},e}(),dn,ei=new J;tt.prototype.generateCanvasTexture=function(e,t){t===void 0&&(t=1);var i=this.getLocalBounds(),r=Lt.create({width:i.width,height:i.height,scaleMode:e,resolution:t});dn||(dn=new ee),this.transform.updateLocalTransform(),this.transform.localTransform.copyTo(ei),ei.invert(),ei.tx-=i.x,ei.ty-=i.y,dn.render(this,{renderTexture:r,clear:!0,transform:ei});var n=z.from(r.baseTexture._canvasRenderTarget.canvas,{scaleMode:e});return n.baseTexture.setResolution(t),n},tt.prototype.cachedGraphicsData=[],tt.prototype._renderCanvas=function(e){this.isMask!==!0&&(this.finishPoly(),e.plugins.graphics.render(this))};/*!
* @pixi/prepare - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/prepare is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/F.UPLOADS_PER_FRAME=4;/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var to=function(e,t){return to=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},to(e,t)};function ky(e,t){to(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var Uy=function(){function e(t){this.maxItemsPerFrame=t,this.itemsLeft=0}return e.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},e.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},e}();function Xy(e,t){var i=!1;if(e&&e._textures&&e._textures.length){for(var r=0;r<e._textures.length;r++)if(e._textures[r]instanceof z){var n=e._textures[r].baseTexture;t.indexOf(n)===-1&&(t.push(n),i=!0)}}return i}function Yy(e,t){if(e.baseTexture instanceof W){var i=e.baseTexture;return t.indexOf(i)===-1&&t.push(i),!0}return!1}function Gy(e,t){if(e._texture&&e._texture instanceof z){var i=e._texture.baseTexture;return t.indexOf(i)===-1&&t.push(i),!0}return!1}function Hy(e,t){return t instanceof Ze?(t.updateText(!0),!0):!1}function Wy(e,t){if(t instanceof Se){var i=t.toFontString();return Tt.measureFont(i),!0}return!1}function zy(e,t){if(e instanceof Ze){t.indexOf(e.style)===-1&&t.push(e.style),t.indexOf(e)===-1&&t.push(e);var i=e._texture.baseTexture;return t.indexOf(i)===-1&&t.push(i),!0}return!1}function jy(e,t){return e instanceof Se?(t.indexOf(e)===-1&&t.push(e),!0):!1}var Dh=function(){function e(t){var i=this;this.limiter=new Uy(F.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){!i.queue||i.prepareItems()},this.registerFindHook(zy),this.registerFindHook(jy),this.registerFindHook(Xy),this.registerFindHook(Yy),this.registerFindHook(Gy),this.registerUploadHook(Hy),this.registerUploadHook(Wy)}return e.prototype.upload=function(t,i){typeof t=="function"&&(i=t,t=null),t&&this.add(t),this.queue.length?(i&&this.completes.push(i),this.ticking||(this.ticking=!0,dt.system.addOnce(this.tick,this,Ee.UTILITY))):i&&i()},e.prototype.tick=function(){setTimeout(this.delayedTick,0)},e.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var t=this.queue[0],i=!1;if(t&&!t._destroyed){for(var r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),i=!0;break}}i||this.queue.shift()}if(this.queue.length)dt.system.addOnce(this.tick,this,Ee.UTILITY);else{this.ticking=!1;var o=this.completes.slice(0);this.completes.length=0;for(var r=0,n=o.length;r<n;r++)o[r]()}},e.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},e.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},e.prototype.add=function(t){for(var i=0,r=this.addHooks.length;i<r&&!this.addHooks[i](t,this.queue);i++);if(t instanceof rt)for(var i=t.children.length-1;i>=0;i--)this.add(t.children[i]);return this},e.prototype.destroy=function(){this.ticking&&dt.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},e}();function Fh(e,t){return t instanceof W?(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0):!1}function Vy(e,t){if(!(t instanceof tt))return!1;var i=t.geometry;t.finishPoly(),i.updateBatches();for(var r=i.batches,n=0;n<r.length;n++){var o=r[n].style.texture;o&&Fh(e,o.baseTexture)}return i.batchable||e.geometry.bind(i,t._resolveDirectShader(e)),!0}function qy(e,t){return e instanceof tt?(t.push(e),!0):!1}(function(e){ky(t,e);function t(i){var r=e.call(this,i)||this;return r.uploadHookHelper=r.renderer,r.registerFindHook(qy),r.registerUploadHook(Fh),r.registerUploadHook(Vy),r}return t})(Dh);/*!
* @pixi/canvas-prepare - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/canvas-prepare is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var eo=function(e,t){return eo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},eo(e,t)};function Zy(e,t){eo(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var da=16;function $y(e,t){var i=e;if(t instanceof W){var r=t.source,n=r.width===0?i.canvas.width:Math.min(i.canvas.width,r.width),o=r.height===0?i.canvas.height:Math.min(i.canvas.height,r.height);return i.ctx.drawImage(r,0,0,n,o,0,0,i.canvas.width,i.canvas.height),!0}return!1}var Ky=function(e){Zy(t,e);function t(i){var r=e.call(this,i)||this;return r.uploadHookHelper=r,r.canvas=document.createElement("canvas"),r.canvas.width=da,r.canvas.height=da,r.ctx=r.canvas.getContext("2d"),r.registerUploadHook($y),r}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.ctx=null,this.canvas=null},t}(Dh);/*!
* @pixi/canvas-sprite - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/canvas-sprite is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*/var fa=new J,Jy=function(){function e(t){this.renderer=t}return e.prototype.render=function(t){var i=t._texture,r=this.renderer,n=r.context;if(i.valid){var o=i._frame.width,s=i._frame.height,a=t.transform.worldTransform,h=0,l=0,u=i.baseTexture.getDrawableSource();if(!(i.orig.width<=0||i.orig.height<=0||!i.valid||!u)){r.setBlendMode(t.blendMode,!0),r.context.globalAlpha=t.worldAlpha;var c=i.baseTexture.scaleMode===ct.LINEAR;r.smoothProperty&&r.context[r.smoothProperty]!==c&&(n[r.smoothProperty]=c),i.trim?(h=i.trim.width/2+i.trim.x-t.anchor.x*i.orig.width,l=i.trim.height/2+i.trim.y-t.anchor.y*i.orig.height):(h=(.5-t.anchor.x)*i.orig.width,l=(.5-t.anchor.y)*i.orig.height),i.rotate&&(a.copyTo(fa),a=fa,q.matrixAppendRotationInv(a,i.rotate,h,l),h=0,l=0),h-=o/2,l-=s/2,r.setContextTransform(a,t.roundPixels,1),t.roundPixels&&(h=h|0,l=l|0);var d=i.baseTexture.resolution,f=r._outerBlend;f&&(n.save(),n.beginPath(),n.rect(h*r.resolution,l*r.resolution,o*r.resolution,s*r.resolution),n.clip()),t.tint!==16777215?((t._cachedTint!==t.tint||t._tintedCanvas.tintId!==t._texture._updateID)&&(t._cachedTint=t.tint,t._tintedCanvas=lt.getTintedCanvas(t,t.tint)),n.drawImage(t._tintedCanvas,0,0,Math.floor(o*d),Math.floor(s*d),Math.floor(h*r.resolution),Math.floor(l*r.resolution),Math.floor(o*r.resolution),Math.floor(s*r.resolution))):n.drawImage(u,i._frame.x*d,i._frame.y*d,Math.floor(o*d),Math.floor(s*d),Math.floor(h*r.resolution),Math.floor(l*r.resolution),Math.floor(o*r.resolution),Math.floor(s*r.resolution)),f&&n.restore(),r.setBlendMode(w.NORMAL)}}},e.prototype.destroy=function(){this.renderer=null},e}();Rt.prototype._tintedCanvas=null,Rt.prototype._renderCanvas=function(e){e.plugins.sprite.render(this)};/*!
* @pixi/filter-color-matrix - v6.2.2
* Compiled Wed, 26 Jan 2022 16:23:27 UTC
*
* @pixi/filter-color-matrix is licensed under the MIT License.
* http://www.opensource.org/licenses/mit-license
*//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var io=function(e,t){return io=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},io(e,t)};function Qy(e,t){io(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var tv=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`,ro=function(e){Qy(t,e);function t(){var i=this,r={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return i=e.call(this,Qm,tv,r)||this,i.alpha=1,i}return t.prototype._loadMatrix=function(i,r){r===void 0&&(r=!1);var n=i;r&&(this._multiply(n,this.uniforms.m,i),n=this._colorMatrix(n)),this.uniforms.m=n},t.prototype._multiply=function(i,r,n){return i[0]=r[0]*n[0]+r[1]*n[5]+r[2]*n[10]+r[3]*n[15],i[1]=r[0]*n[1]+r[1]*n[6]+r[2]*n[11]+r[3]*n[16],i[2]=r[0]*n[2]+r[1]*n[7]+r[2]*n[12]+r[3]*n[17],i[3]=r[0]*n[3]+r[1]*n[8]+r[2]*n[13]+r[3]*n[18],i[4]=r[0]*n[4]+r[1]*n[9]+r[2]*n[14]+r[3]*n[19]+r[4],i[5]=r[5]*n[0]+r[6]*n[5]+r[7]*n[10]+r[8]*n[15],i[6]=r[5]*n[1]+r[6]*n[6]+r[7]*n[11]+r[8]*n[16],i[7]=r[5]*n[2]+r[6]*n[7]+r[7]*n[12]+r[8]*n[17],i[8]=r[5]*n[3]+r[6]*n[8]+r[7]*n[13]+r[8]*n[18],i[9]=r[5]*n[4]+r[6]*n[9]+r[7]*n[14]+r[8]*n[19]+r[9],i[10]=r[10]*n[0]+r[11]*n[5]+r[12]*n[10]+r[13]*n[15],i[11]=r[10]*n[1]+r[11]*n[6]+r[12]*n[11]+r[13]*n[16],i[12]=r[10]*n[2]+r[11]*n[7]+r[12]*n[12]+r[13]*n[17],i[13]=r[10]*n[3]+r[11]*n[8]+r[12]*n[13]+r[13]*n[18],i[14]=r[10]*n[4]+r[11]*n[9]+r[12]*n[14]+r[13]*n[19]+r[14],i[15]=r[15]*n[0]+r[16]*n[5]+r[17]*n[10]+r[18]*n[15],i[16]=r[15]*n[1]+r[16]*n[6]+r[17]*n[11]+r[18]*n[16],i[17]=r[15]*n[2]+r[16]*n[7]+r[17]*n[12]+r[18]*n[17],i[18]=r[15]*n[3]+r[16]*n[8]+r[17]*n[13]+r[18]*n[18],i[19]=r[15]*n[4]+r[16]*n[9]+r[17]*n[14]+r[18]*n[19]+r[19],i},t.prototype._colorMatrix=function(i){var r=new Float32Array(i);return r[4]/=255,r[9]/=255,r[14]/=255,r[19]/=255,r},t.prototype.brightness=function(i,r){var n=[i,0,0,0,0,0,i,0,0,0,0,0,i,0,0,0,0,0,1,0];this._loadMatrix(n,r)},t.prototype.tint=function(i,r){var n=i>>16&255,o=i>>8&255,s=i&255,a=[n/255,0,0,0,0,0,o/255,0,0,0,0,0,s/255,0,0,0,0,0,1,0];this._loadMatrix(a,r)},t.prototype.greyscale=function(i,r){var n=[i,i,i,0,0,i,i,i,0,0,i,i,i,0,0,0,0,0,1,0];this._loadMatrix(n,r)},t.prototype.blackAndWhite=function(i){var r=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(r,i)},t.prototype.hue=function(i,r){i=(i||0)/180*Math.PI;var n=Math.cos(i),o=Math.sin(i),s=Math.sqrt,a=1/3,h=s(a),l=n+(1-n)*a,u=a*(1-n)-h*o,c=a*(1-n)+h*o,d=a*(1-n)+h*o,f=n+a*(1-n),m=a*(1-n)-h*o,v=a*(1-n)-h*o,y=a*(1-n)+h*o,g=n+a*(1-n),x=[l,u,c,0,0,d,f,m,0,0,v,y,g,0,0,0,0,0,1,0];this._loadMatrix(x,r)},t.prototype.contrast=function(i,r){var n=(i||0)+1,o=-.5*(n-1),s=[n,0,0,0,o,0,n,0,0,o,0,0,n,0,o,0,0,0,1,0];this._loadMatrix(s,r)},t.prototype.saturate=function(i,r){i===void 0&&(i=0);var n=i*2/3+1,o=(n-1)*-.5,s=[n,o,o,0,0,o,n,o,0,0,o,o,n,0,0,0,0,0,1,0];this._loadMatrix(s,r)},t.prototype.desaturate=function(){this.saturate(-1)},t.prototype.negative=function(i){var r=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(r,i)},t.prototype.sepia=function(i){var r=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(r,i)},t.prototype.technicolor=function(i){var r=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(r,i)},t.prototype.polaroid=function(i){var r=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(r,i)},t.prototype.toBGR=function(i){var r=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(r,i)},t.prototype.kodachrome=function(i){var r=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(r,i)},t.prototype.browni=function(i){var r=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(r,i)},t.prototype.vintage=function(i){var r=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(r,i)},t.prototype.colorTone=function(i,r,n,o,s){i=i||.2,r=r||.15,n=n||16770432,o=o||3375104;var a=(n>>16&255)/255,h=(n>>8&255)/255,l=(n&255)/255,u=(o>>16&255)/255,c=(o>>8&255)/255,d=(o&255)/255,f=[.3,.59,.11,0,0,a,h,l,i,0,u,c,d,r,0,a-u,h-c,l-d,0,0];this._loadMatrix(f,s)},t.prototype.night=function(i,r){i=i||.1;var n=[i*-2,-i,0,0,0,-i,0,i,0,0,0,i,i*2,0,0,0,0,0,1,0];this._loadMatrix(n,r)},t.prototype.predator=function(i,r){var n=[11.224130630493164*i,-4.794486999511719*i,-2.8746118545532227*i,0*i,.40342438220977783*i,-3.6330697536468506*i,9.193157196044922*i,-2.951810836791992*i,0*i,-1.316135048866272*i,-3.2184197902679443*i,-4.2375030517578125*i,7.476448059082031*i,0*i,.8044459223747253*i,0,0,0,1,0];this._loadMatrix(n,r)},t.prototype.lsd=function(i){var r=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(r,i)},t.prototype.reset=function(){var i=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(i,!1)},Object.defineProperty(t.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(i){this.uniforms.m=i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(i){this.uniforms.uAlpha=i},enumerable:!1,configurable:!0}),t}(Ch);ro.prototype.grayscale=ro.prototype.greyscale;function ev(e){return function(t){if(!(this._activeParentLayer&&this._activeParentLayer!==t._activeLayer)){if(!this.visible){this.displayOrder=0;return}this.displayOrder=t.incDisplayOrder(),!(this.worldAlpha<=0||!this.renderable)&&(t._activeLayer=null,e.call(this,t),t._activeLayer=this._activeParentLayer)}}}function iv(e){if(!(this._activeParentLayer&&this._activeParentLayer!==e._activeLayer)){if(!this.visible){this.displayOrder=0;return}this.displayOrder=e.incDisplayOrder(),!(this.worldAlpha<=0||!this.renderable)&&(e._activeLayer=null,this.containerRenderWebGL(e),e._activeLayer=this._activeParentLayer)}}function rv(){if(Vt.prototype.displayOrder!==void 0)return;Object.assign(Vt.prototype,{parentLayer:null,_activeParentLayer:null,parentGroup:null,zOrder:0,zIndex:0,updateOrder:0,displayOrder:0,layerableChildren:!0,isLayer:!1});const e=rt.prototype;e.containerRenderWebGL=e.render,e.render=iv}class nv{constructor(){this._tempPoint=new G,this._queue=[[],[]],this._eventDisplayOrder=0,this.worksWithLayers=!0}recursiveFindHit(t,i,r,n,o){if(!i||!i.visible)return 0;let s=0,a=n=i.interactive||n;i.hitArea&&(a=!1),i._activeParentLayer&&(o=!1);const h=i._mask;r<1/0&&h&&h.containsPoint&&!h.containsPoint(t)&&(o=!0),r<1/0&&i.filterArea&&(i.filterArea.contains(t.x,t.y)||(o=!0));const l=i.children;if(i.interactiveChildren&&l)for(let u=l.length-1;u>=0;u--){const c=l[u],d=this.recursiveFindHit(t,c,r,a,o);if(d){if(!c.parent)continue;s=d,r=d}}return n&&(o?i.interactive&&this._queueAdd(i,0):(r<i.displayOrder&&(i.hitArea?(i.worldTransform.applyInverse(t,this._tempPoint),i.hitArea.contains(this._tempPoint.x,this._tempPoint.y)&&(s=i.displayOrder)):i.containsPoint&&i.containsPoint(t)&&(s=i.displayOrder)),i.interactive&&this._queueAdd(i,s===1/0?0:s))),s}findHit(t,i,r,n){const o=t.data.global;this._startInteractionProcess(),this.recursiveFindHit(o,i,n?0:1/0,!1,!1),this._finishInteractionProcess(t,r)}_startInteractionProcess(){this._eventDisplayOrder=1,this._queue||(this._queue=[[],[]]),this._queue[0].length=0,this._queue[1].length=0}_queueAdd(t,i){const r=this._queue;if(i<this._eventDisplayOrder)r[0].push(t);else{if(i>this._eventDisplayOrder){this._eventDisplayOrder=i;const n=r[1];for(let o=0,s=n.length;o<s;o++)r[0].push(n[o]);r[1].length=0}r[1].push(t)}}_finishInteractionProcess(t,i){const r=this._queue;let n=r[0];for(let o=0,s=n.length;o<s;o++)i&&i(t,n[o],!1);n=r[1];for(let o=0,s=n.length;o<s;o++)t.target||(t.target=n[o]),i&&i(t,n[o],!0)}}function ov(e){return function(t,i,r,n,o){(!i||!i.renderTexture&&!i.baseTexture)&&(this._lastDisplayOrder=0),this._activeLayer=null,t.isStage&&t.updateStage(),this.plugins.interaction&&!this.plugins.interaction.search.worksWithLayers&&(this.plugins.interaction.search=new nv),e.call(this,t,i,r,n,o)}}function Bh(e){const t=e.prototype;t._oldRender||(Object.assign(t,{_lastDisplayOrder:0,_activeLayer:null,incDisplayOrder(){return++this._lastDisplayOrder},_oldRender:Ce.prototype.render}),t._oldRender=t.render,t.render=ov(t.render))}function sv(e){if(!e){console.log("@pixi/layers: Canvas mixin was called with empty parameter. Are you sure that you even need this line?");return}Bh(e);const t=rt.prototype;t.containerRenderCanvas||(t.containerRenderCanvas=t.renderCanvas,t.renderCanvas=ev(t.renderCanvas))}class _t extends Le{constructor(t=0,i=!1){super(),this.useRenderTexture=!1,this.useDoubleBuffer=!1,this.sortPriority=0,this.clearColor=new Float32Array([0,0,0,0]),this.canDrawWithoutLayer=!1,this.canDrawInParentStage=!0,this._activeLayer=null,this._activeStage=null,this._activeChildren=[],this._lastUpdateId=-1,this.zIndex=t||0,this.enableSort=!!i,typeof i=="function"&&this.on("sort",i)}doSort(t,i){if(this.listeners("sort",!0))for(let r=0;r<i.length;r++)this.emit("sort",i[r]);i.sort(_t.compareZIndex)}static compareZIndex(t,i){return t.zOrder<i.zOrder?-1:t.zOrder>i.zOrder?1:t.updateOrder-i.updateOrder}clear(){this._activeLayer=null,this._activeStage=null,this._activeChildren.length=0}_resolveChildDisplayObject(t,i){this.check(t),i._activeParentLayer=this._activeLayer,this._activeLayer?this._activeLayer._activeChildren.push(i):this._activeChildren.push(i)}_resolveLayer(t,i){this.check(t),this._activeLayer&&_t.conflict(),this._activeLayer=i,this._activeStage=t}check(t){if(this._lastUpdateId<_t._layerUpdateId)this._lastUpdateId=_t._layerUpdateId,this.clear(),this._activeStage=t;else if(this.canDrawInParentStage){let i=this._activeStage;for(;i&&i!==t;)i=i._activeParentStage;this._activeStage=i,i===null&&this.clear()}}static conflict(){_t._lastLayerConflict+5e3<Date.now()&&(_t._lastLayerConflict=Date.now(),console.log("@pixi/layers found two layers with the same group in one stage - that's not healthy. Please place a breakpoint here and debug it"))}}_t._layerUpdateId=0,_t._lastLayerConflict=0;class ma{constructor(t){this.layer=t,this.renderTexture=null,this.doubleBuffer=null,this.currentBufferIndex=0,this._tempRenderTarget=null,this._tempRenderTargetSource=new X,this._tempRenderTargetDestination=new X}init(t){const i=t?t.screen.width:100,r=t?t.screen.height:100,n=t?t.resolution:F.RESOLUTION;this.renderTexture=Lt.create({width:i,height:r,resolution:n}),this.layer.group.useDoubleBuffer&&(this.doubleBuffer=[Lt.create({width:i,height:r,resolution:n}),Lt.create({width:i,height:r,resolution:n})])}getRenderTexture(){return this.renderTexture||this.init(),this.renderTexture}pushTexture(t){const i=t.screen;this.renderTexture||this.init(t);const r=this.renderTexture,n=this.layer.group,o=this.doubleBuffer;if((r.width!==i.width||r.height!==i.height||r.baseTexture.resolution!==t.resolution)&&(r.baseTexture.resolution=t.resolution,r.resize(i.width,i.height),o&&(o[0].baseTexture.resolution=t.resolution,o[0].resize(i.width,i.height),o[1].baseTexture.resolution=t.resolution,o[1].resize(i.width,i.height))),o&&(o[0].framebuffer.multisample=r.framebuffer.multisample,o[1].framebuffer.multisample=r.framebuffer.multisample),this._tempRenderTarget=t.renderTexture.current,this._tempRenderTargetSource.copyFrom(t.renderTexture.sourceFrame),this._tempRenderTargetDestination.copyFrom(t.renderTexture.destinationFrame),t.batch.flush(),n.useDoubleBuffer){let a=o[this.currentBufferIndex];a.baseTexture._glTextures[t.CONTEXT_UID]||(t.renderTexture.bind(a,void 0,void 0),t.texture.bind(a),n.clearColor&&t.renderTexture.clear(n.clearColor)),t.texture.unbind(r.baseTexture),r.baseTexture._glTextures=a.baseTexture._glTextures,r.baseTexture.framebuffer=a.baseTexture.framebuffer,a=o[1-this.currentBufferIndex],t.renderTexture.bind(a,void 0,void 0)}else t.renderTexture.bind(r,void 0,void 0);n.clearColor&&t.renderTexture.clear(n.clearColor);const s=t.filter.defaultFilterStack;s.length>1&&(s[s.length-1].renderTexture=t.renderTexture.current)}popTexture(t){t.batch.flush(),t.framebuffer.blit();const i=t.filter.defaultFilterStack;i.length>1&&(i[i.length-1].renderTexture=this._tempRenderTarget),t.renderTexture.bind(this._tempRenderTarget,this._tempRenderTargetSource,this._tempRenderTargetDestination),this._tempRenderTarget=null;const r=this.renderTexture,n=this.layer.group,o=this.doubleBuffer;if(n.useDoubleBuffer){t.texture.unbind(r.baseTexture),this.currentBufferIndex=1-this.currentBufferIndex;const s=o[this.currentBufferIndex];r.baseTexture._glTextures=s.baseTexture._glTextures,r.baseTexture.framebuffer=s.baseTexture.framebuffer}}destroy(){this.renderTexture&&(this.renderTexture.destroy(),this.doubleBuffer&&(this.doubleBuffer[0].destroy(!0),this.doubleBuffer[1].destroy(!0)))}}class yr extends rt{constructor(t=null){super(),this.isLayer=!0,this.group=null,this._activeChildren=[],this._tempChildren=null,this._activeStageParent=null,this._sortedChildren=[],this._tempLayerParent=null,this.insertChildrenBeforeActive=!0,this.insertChildrenAfterActive=!0,t?(this.group=t,this.zIndex=t.zIndex):this.group=new _t(0,!1),this._tempChildren=this.children}get useRenderTexture(){return this.group.useRenderTexture}set useRenderTexture(t){this.group.useRenderTexture=t}get useDoubleBuffer(){return this.group.useDoubleBuffer}set useDoubleBuffer(t){this.group.useDoubleBuffer=t}get clearColor(){return this.group.clearColor}set clearColor(t){this.group.clearColor=t}get sortPriority(){return this.group.sortPriority}set sortPriority(t){this.group.sortPriority=t}getRenderTexture(){return this.textureCache||(this.textureCache=new ma(this)),this.textureCache.getRenderTexture()}doSort(){this.group.doSort(this,this._sortedChildren)}destroy(t){this.textureCache&&(this.textureCache.destroy(),this.textureCache=null),super.destroy(t)}render(t){!this.prerender(t)||(this.group.useRenderTexture&&(this.textureCache||(this.textureCache=new ma(this)),this.textureCache.pushTexture(t)),this.containerRenderWebGL(t),this.postrender(t),this.group.useRenderTexture&&this.textureCache.popTexture(t))}layerRenderCanvas(t){this.prerender(t)&&(this.containerRenderCanvas(t),this.postrender(t))}_onBeginLayerSubtreeTraversal(t){const i=this._activeChildren;this._activeStageParent=t,this.group._resolveLayer(t,this);const r=this.group._activeChildren;i.length=0;for(let n=0;n<r.length;n++)r[n]._activeParentLayer=this,i.push(r[n]);r.length=0}_onEndLayerSubtreeTraversal(){const t=this.children,i=this._activeChildren,r=this._sortedChildren;for(let n=0;n<i.length;n++)this.emit("display",i[n]);if(r.length=0,this.insertChildrenBeforeActive)for(let n=0;n<t.length;n++)r.push(t[n]);for(let n=0;n<i.length;n++)r.push(i[n]);if(!this.insertChildrenBeforeActive&&this.insertChildrenAfterActive)for(let n=0;n<t.length;n++)r.push(t[n]);this.group.enableSort&&this.doSort()}prerender(t){return this._activeParentLayer&&this._activeParentLayer!=t._activeLayer?!1:this.visible?(this.displayOrder=t.incDisplayOrder(),this.worldAlpha<=0||!this.renderable?!1:(this.children!==this._sortedChildren&&this._tempChildren!==this.children&&(this._tempChildren=this.children),this._boundsID++,this.children=this._sortedChildren,this._tempLayerParent=t._activeLayer,t._activeLayer=this,!0)):(this.displayOrder=0,!1)}postrender(t){this.children=this._tempChildren,t._activeLayer=this._tempLayerParent,this._tempLayerParent=null}}yr.prototype.renderCanvas=yr.prototype.layerRenderCanvas;class wi extends yr{constructor(){super(...arguments),this.isStage=!0,this._tempGroups=[],this._activeLayers=[],this._activeParentStage=null}clear(){this._activeLayers.length=0,this._tempGroups.length=0}destroy(t){this.clear(),super.destroy(t)}updateStage(){this._activeParentStage=null,_t._layerUpdateId++,this._updateStageInner()}updateAsChildStage(t){this._activeParentStage=t,wi._updateOrderCounter=0,this._updateStageInner()}_updateStageInner(){this.clear(),this._addRecursive(this);const t=this._activeLayers;for(let i=0;i<t.length;i++){const r=t[i];if(r.group.sortPriority){r._onEndLayerSubtreeTraversal();const n=r._sortedChildren;for(let o=0;o<n.length;o++)this._addRecursiveChildren(n[o])}}for(let i=0;i<t.length;i++){const r=t[i];r.group.sortPriority||r._onEndLayerSubtreeTraversal()}}_addRecursive(t){if(!t.visible)return;if(t.isLayer){const o=t;this._activeLayers.push(o),o._onBeginLayerSubtreeTraversal(this)}if(t!==this&&t.isStage){t.updateAsChildStage(this);return}t._activeParentLayer=null;let i=t.parentGroup;i&&i._resolveChildDisplayObject(this,t);const r=t.parentLayer;if(r&&(i=r.group,i._resolveChildDisplayObject(this,t)),t.updateOrder=++wi._updateOrderCounter,t.alpha<=0||!t.renderable||!t.layerableChildren||i&&i.sortPriority)return;const n=t.children;if(n&&n.length)for(let o=0;o<n.length;o++)this._addRecursive(n[o])}_addRecursiveChildren(t){if(t.alpha<=0||!t.renderable||!t.layerableChildren)return;const i=t.children;if(i&&i.length)for(let r=0;r<i.length;r++)this._addRecursive(i[r])}}wi._updateOrderCounter=0,rv(),Bh(Ce);var vr={},St={},Xt={},ya;function Ao(){if(ya)return Xt;ya=1;var e=Wt&&Wt.__awaiter||function(s,a,h,l){function u(c){return c instanceof h?c:new h(function(d){d(c)})}return new(h||(h=Promise))(function(c,d){function f(y){try{v(l.next(y))}catch(g){d(g)}}function m(y){try{v(l.throw(y))}catch(g){d(g)}}function v(y){y.done?c(y.value):u(y.value).then(f,m)}v((l=l.apply(s,a||[])).next())})};Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.SpaceApiError=Xt.callSpaceAPIWithConfig=Xt.getRequestHeaders=void 0;const t=Oo();function i(s){var a;const h=new Headers;switch(s.type){case"secret":h.set("authorization",`AL-Secret-Token ${s.secretAccessToken}`);break;case"temporary":h.set("authorization",`${(a=s.temporaryAccessToken)===null||a===void 0?void 0:a.authorization}`)}return s.sdkVersion&&h.set("x-sdk-version",s.sdkVersion),h}Xt.getRequestHeaders=i;function r(s){return s.status>=200&&s.status<400?s:s.json().then(a=>{const h=(a==null?void 0:a.message)||(a==null?void 0:a.error)||a;switch(typeof h){case"string":return Promise.reject(new o(h,s.status,void 0));case"object":return Promise.reject(new o(h.message,s.status,h.data));default:return Promise.reject(new o(null,null,a))}})}function n(s,a,h={},l){return e(this,void 0,void 0,function*(){const u=new URL(t.spaceApiUrl+a),c=i(l);let d=!1;switch(l.type==="publishable"&&u.searchParams.set("pubtoken",l.publishableAccessToken),s){case"GET":h&&typeof h=="object"&&Object.entries(h).forEach(([f,m])=>{typeof m<"u"&&u.searchParams.set(f,m.toString())});break;case"POST":case"PUT":c.set("content-type","application/json"),d=!0;break;case"DELETE":break;default:return Promise.reject(new o("Programming error, unsupported method: "+s,void 0,void 0))}return fetch(u.toString(),{method:s,headers:c,body:d?JSON.stringify(h):void 0}).then(r,f=>{throw f}).then(f=>f.json()).catch(f=>Promise.reject(f))})}Xt.callSpaceAPIWithConfig=n;class o extends Error{constructor(a,h,l){super(a||"There was a problem. Please check your internet connection and try again."),this.name="SpaceApiError",this.stack=new Error().stack,this.code=h,this.data=l}}return Xt.SpaceApiError=o,Xt}var va;function Oo(){if(va)return St;va=1,Object.defineProperty(St,"__esModule",{value:!0}),St.getTokenConfig=St.setSpaceApiUrl=St.spaceApiUrl=void 0;const e=Ao();St.spaceApiUrl="https://api.archilogic.com",St.setSpaceApiUrl=i=>{St.spaceApiUrl=i};function t(i){let r;if(i.secretAccessToken)r={type:"secret",secretAccessToken:i.secretAccessToken};else if(i.temporaryAccessToken||i.temporaryAccessTokenFunction)r={type:"temporary",temporaryAccessToken:i.temporaryAccessToken};else if(i.publishableAccessToken)r={type:"publishable",publishableAccessToken:i.publishableAccessToken};else throw new e.SpaceApiError("Programming error: token is not provided.",void 0,void 0);return i.sdkVersion&&(r.sdkVersion=i.sdkVersion),r}return St.getTokenConfig=t,St}var Ti={},fn=Wt&&Wt.__awaiter||function(e,t,i,r){function n(o){return o instanceof i?o:new i(function(s){s(o)})}return new(i||(i=Promise))(function(o,s){function a(u){try{l(r.next(u))}catch(c){s(c)}}function h(u){try{l(r.throw(u))}catch(c){s(c)}}function l(u){u.done?o(u.value):n(u.value).then(a,h)}l((r=r.apply(e,t||[])).next())})};Object.defineProperty(Ti,"__esModule",{value:!0}),Ti.Connection=void 0;const av=Oo(),ii=Ao();class hv{constructor(t){this.tempScopes=[{resource:"floor",action:"readPublic"},{resource:"floor",action:"readPrivate"},{resource:"floor",action:"queryPublic"},{resource:"floor",action:"queryPrivate"},{resource:"floor",action:"archive"},{resource:"customFields",action:"readPublic"},{resource:"customFields",action:"readPrivate"},{resource:"customFields",action:"write"}],this.durationSeconds=3600,this.getTemporaryAccessToken=()=>fn(this,void 0,void 0,function*(){this.temporaryAccessTokenPromise||(this.temporaryAccessTokenPromise=new Promise((i,r)=>fn(this,void 0,void 0,function*(){var n;let o=this.initialTemporaryAccessToken;if(o&&o.expiresAt>new Date().getTime()/1e3?i(o):this.initialTemporaryAccessToken=void 0,this.temporaryAccessTokenFunction&&(o=yield(n=this.temporaryAccessTokenFunction)===null||n===void 0?void 0:n.call(this,{scopes:this.tempScopes,durationSeconds:this.durationSeconds}),o&&o.expiresAt>new Date().getTime()/1e3&&i(o)),o){const s=new Date;s.setTime(o.expiresAt*1e3),r(new ii.SpaceApiError(`Temporary access token expired at ${s.toString()}`,void 0,void 0))}else r(new ii.SpaceApiError("Temporary access token not defined",void 0,void 0))})));try{return yield this.temporaryAccessTokenPromise}catch(i){throw this.temporaryAccessTokenPromise=void 0,i}}),this.config=av.getTokenConfig(t),(t.temporaryAccessToken||t.temporaryAccessTokenFunction)&&(this.temporaryAccessTokenFunction=t.temporaryAccessTokenFunction,this.initialTemporaryAccessToken=t.temporaryAccessToken),t.temporaryAccessTokenScopes&&(this.tempScopes=t.temporaryAccessTokenScopes)}callSpaceAPI(t,i,r={},n=this.config){return fn(this,void 0,void 0,function*(){switch(n.type){case"secret":return ii.callSpaceAPIWithConfig(t,i,r,n);case"publishable":return ii.callSpaceAPIWithConfig(t,i,r,n);case"temporary":const o=yield this.getTemporaryAccessToken(),s=Object.assign(Object.assign({},n),{temporaryAccessToken:o});return ii.callSpaceAPIWithConfig(t,i,r,s)}})}}Ti.Connection=hv;var gr={};Object.defineProperty(gr,"__esModule",{value:!0}),gr.SpaceAPI=void 0;const lv=Ti;class uv{constructor(t,i={}){this.connection=new lv.Connection(t);for(const[r,n]of Object.entries(i))this[r]=n}getFloorById(t,i=!1){return this.connection.callSpaceAPI("GET",`/v2/floor/${t}/${i?"geo-json":""}`)}queryFloors(t){return this.connection.callSpaceAPI("GET","/v2/floor",t)}getFloorplanImage(t,i){return this.connection.callSpaceAPI("POST",`/v2/floor/${t}/2d-image`,i)}getSceneStructure(t,i=!1){return this.connection.callSpaceAPI("GET",`/v2/floor/${t}/scene-structure`,{includeMetadata:i})}getSpaceById(t,i=!1){return this.connection.callSpaceAPI("GET",`/v2/space/${t}/${i?"geo-json":""}`)}querySpaces(t){return this.connection.callSpaceAPI("GET","/v2/space",t)}getAllSpacesByFloorId(t,i=!1){return this.querySpaces({floorId:t,geometry:i})}getAssetById(t,i=!1){return this.connection.callSpaceAPI("GET",`/v2/asset/${t}/${i?"geo-json":""}`)}queryAssets(t){return this.connection.callSpaceAPI("GET","/v2/asset",t)}getAllAssetsByFloorId(t,i=!1){return this.queryAssets({floorId:t,geometry:i})}getAllAssetsBySpaceId(t,i=!1){return this.queryAssets({spaceId:t,geometry:i})}getCustomField(t,i,r){return this.connection.callSpaceAPI("GET",`/v2/${t}/${i}/custom-field/${r}`)}getAllCustomFields(t,i){return this.connection.callSpaceAPI("GET",`/v2/${t}/${i}/custom-field`)}setCustomField(t,i,r,n){return this.connection.callSpaceAPI("PUT",`/v2/${t}/${i}/custom-field/${r}`,n)}deleteCustomField(t,i,r){return this.connection.callSpaceAPI("DELETE",`/v2/${t}/${i}/custom-field/${r}`)}}gr.SpaceAPI=uv,function(e){var t=Wt&&Wt.__createBinding||(Object.create?function(r,n,o,s){s===void 0&&(s=o),Object.defineProperty(r,s,{enumerable:!0,get:function(){return n[o]}})}:function(r,n,o,s){s===void 0&&(s=o),r[s]=n[o]}),i=Wt&&Wt.__exportStar||function(r,n){for(var o in r)o!=="default"&&!Object.prototype.hasOwnProperty.call(n,o)&&t(n,r,o)};Object.defineProperty(e,"__esModule",{value:!0}),i(Oo(),e),i(Ao(),e),i(Ti,e),i(gr,e)}(vr);var p={};p.version="6.4.2.2",p.use_lines=!0,p.use_xyz=!1;var ga=function(e,t){var i;if(typeof Object.getOwnPropertyNames>"u"){for(i in t.prototype)(typeof e.prototype[i]>"u"||e.prototype[i]===Object.prototype[i])&&(e.prototype[i]=t.prototype[i]);for(i in t)typeof e[i]>"u"&&(e[i]=t[i]);e.$baseCtor=t}else{for(var r=Object.getOwnPropertyNames(t.prototype),n=0;n<r.length;n++)typeof Object.getOwnPropertyDescriptor(e.prototype,r[n])>"u"&&Object.defineProperty(e.prototype,r[n],Object.getOwnPropertyDescriptor(t.prototype,r[n]));for(i in t)typeof e[i]>"u"&&(e[i]=t[i]);e.$baseCtor=t}};p.Path=function(){return[]},p.Path.prototype.push=Array.prototype.push,p.Paths=function(){return[]},p.Paths.prototype.push=Array.prototype.push,p.PolyNode=function(){this.m_Parent=null,this.m_polygon=new p.Path,this.m_Index=0,this.m_jointype=0,this.m_endtype=0,this.m_Childs=[],this.IsOpen=!1},p.PolyNode.prototype.IsHoleNode=function(){for(var e=!0,t=this.m_Parent;t!==null;)e=!e,t=t.m_Parent;return e},p.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length},p.PolyNode.prototype.Contour=function(){return this.m_polygon},p.PolyNode.prototype.AddChild=function(e){var t=this.m_Childs.length;this.m_Childs.push(e),e.m_Parent=this,e.m_Index=t},p.PolyNode.prototype.GetNext=function(){return this.m_Childs.length>0?this.m_Childs[0]:this.GetNextSiblingUp()},p.PolyNode.prototype.GetNextSiblingUp=function(){return this.m_Parent===null?null:this.m_Index===this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]},p.PolyNode.prototype.Childs=function(){return this.m_Childs},p.PolyNode.prototype.Parent=function(){return this.m_Parent},p.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()},p.PolyTree=function(){this.m_AllPolys=[],p.PolyNode.call(this)},p.PolyTree.prototype.Clear=function(){for(var e=this,t=0,i=this.m_AllPolys.length;t<i;t++)e.m_AllPolys[t]=null;this.m_AllPolys.length=0,this.m_Childs.length=0},p.PolyTree.prototype.GetFirst=function(){return this.m_Childs.length>0?this.m_Childs[0]:null},p.PolyTree.prototype.Total=function(){var e=this.m_AllPolys.length;return e>0&&this.m_Childs[0]!==this.m_AllPolys[0]&&e--,e},ga(p.PolyTree,p.PolyNode),p.Clear=function(e){e.length=0},p.PI=3.141592653589793,p.PI2=2*3.141592653589793,p.FPoint=function(){var e=arguments,t=e.length;if(this.X=0,this.Y=0,p.use_xyz)if(this.Z=0,t===3)this.X=e[0],this.Y=e[1],this.Z=e[2];else if(t===2)this.X=e[0],this.Y=e[1],this.Z=0;else if(t===1)if(e[0]instanceof p.FPoint){var i=e[0];this.X=i.X,this.Y=i.Y,this.Z=0}else{var r=e[0];typeof r.Z>"u"&&(r.Z=0),this.X=r.X,this.Y=r.Y,this.Z=r.Z}else this.X=0,this.Y=0,this.Z=0;else if(t===2)this.X=e[0],this.Y=e[1];else if(t===1)if(e[0]instanceof p.FPoint){var i=e[0];this.X=i.X,this.Y=i.Y}else{var r=e[0];this.X=r.X,this.Y=r.Y}else this.X=0,this.Y=0},p.FPoint.op_Equality=function(e,t){return e.X===t.X&&e.Y===t.Y},p.FPoint.op_Inequality=function(e,t){return e.X!==t.X||e.Y!==t.Y},p.FPoint0=function(){this.X=0,this.Y=0,p.use_xyz&&(this.Z=0)},p.FPoint0.prototype=p.FPoint.prototype,p.FPoint1=function(e){this.X=e.X,this.Y=e.Y,p.use_xyz&&(typeof e.Z>"u"?this.Z=0:this.Z=e.Z)},p.FPoint1.prototype=p.FPoint.prototype,p.FPoint1dp=function(e){this.X=e.X,this.Y=e.Y,p.use_xyz&&(this.Z=0)},p.FPoint1dp.prototype=p.FPoint.prototype,p.FPoint2=function(e,t,i){this.X=e,this.Y=t,p.use_xyz&&(typeof i>"u"?this.Z=0:this.Z=i)},p.FPoint2.prototype=p.FPoint.prototype,p.FRect=function(){var e=arguments,t=e.length;if(t===4)this.left=e[0],this.top=e[1],this.right=e[2],this.bottom=e[3];else if(t===1){var i=e[0];this.left=i.left,this.top=i.top,this.right=i.right,this.bottom=i.bottom}else this.left=0,this.top=0,this.right=0,this.bottom=0},p.FRect0=function(){this.left=0,this.top=0,this.right=0,this.bottom=0},p.FRect0.prototype=p.FRect.prototype,p.FRect1=function(e){this.left=e.left,this.top=e.top,this.right=e.right,this.bottom=e.bottom},p.FRect1.prototype=p.FRect.prototype,p.FRect4=function(e,t,i,r){this.left=e,this.top=t,this.right=i,this.bottom=r},p.FRect4.prototype=p.FRect.prototype,p.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3},p.PolyType={ptSubject:0,ptClip:1},p.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3},p.JoinType={jtSquare:0,jtRound:1,jtMiter:2},p.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4},p.EdgeSide={esLeft:0,esRight:1},p.Direction={dRightToLeft:0,dLeftToRight:1},p.TEdge=function(){this.Bot=new p.FPoint0,this.Curr=new p.FPoint0,this.Top=new p.FPoint0,this.Delta=new p.FPoint0,this.Dx=0,this.PolyTyp=p.PolyType.ptSubject,this.Side=p.EdgeSide.esLeft,this.WindDelta=0,this.WindCnt=0,this.WindCnt2=0,this.OutIdx=0,this.Next=null,this.Prev=null,this.NextInLML=null,this.NextInAEL=null,this.PrevInAEL=null,this.NextInSEL=null,this.PrevInSEL=null},p.IntersectNode=function(){this.Edge1=null,this.Edge2=null,this.Pt=new p.FPoint0},p.MyIntersectNodeSort=function(){},p.MyIntersectNodeSort.Compare=function(e,t){var i=t.Pt.Y-e.Pt.Y;return i>0?1:i<0?-1:0},p.LocalMinima=function(){this.Y=0,this.LeftBound=null,this.RightBound=null,this.Next=null},p.Scanbeam=function(){this.Y=0,this.Next=null},p.Maxima=function(){this.X=0,this.Next=null,this.Prev=null},p.OutRec=function(){this.Idx=0,this.IsHole=!1,this.IsOpen=!1,this.FirstLeft=null,this.Pts=null,this.BottomPt=null,this.PolyNode=null},p.OutPt=function(){this.Idx=0,this.Pt=new p.FPoint0,this.Next=null,this.Prev=null},p.Join=function(){this.OutPt1=null,this.OutPt2=null,this.OffPt=new p.FPoint0},p.ClipperBase=function(){this.m_MinimaList=null,this.m_CurrentLM=null,this.m_edges=new Array,this.m_HasOpenPaths=!1,this.PreserveCollinear=!1,this.m_Scanbeam=null,this.m_PolyOuts=null,this.m_ActiveEdges=null},p.ClipperBase.horizontal=-34e37,p.ClipperBase.Skip=-2,p.ClipperBase.Unassigned=-1,p.ClipperBase.tolerance=1e-20,p.ClipperBase.maxValue=Math.sqrt(Number.MAX_VALUE),p.ClipperBase.minValue=Math.sqrt(Number.MIN_VALUE),p.ClipperBase.near_zero=function(e){return e>-p.ClipperBase.tolerance&&e<p.ClipperBase.tolerance},p.ClipperBase.IsHorizontal=function(e){return e.Delta.Y===0},p.ClipperBase.prototype.PointIsVertex=function(e,t){var i=t;do{if(p.FPoint.op_Equality(i.Pt,e))return!0;i=i.Next}while(i!==t);return!1},p.ClipperBase.prototype.PointOnLineSegment=function(e,t,i){return e.X===t.X&&e.Y===t.Y||e.X===i.X&&e.Y===i.Y||e.X>t.X==e.X<i.X&&e.Y>t.Y==e.Y<i.Y&&(e.X-t.X)*(i.Y-t.Y)===(i.X-t.X)*(e.Y-t.Y)},p.ClipperBase.prototype.PointOnPolygon=function(e,t){for(var i=this,r=t;;){if(i.PointOnLineSegment(e,r.Pt,r.Next.Pt))return!0;if(r=r.Next,r===t)break}return!1},p.ClipperBase.prototype.SlopesEqual=p.ClipperBase.SlopesEqual=function(){var e=arguments,t=e.length,i,r,n,o,s,a;return t===2?(i=e[0],r=e[1],i.Delta.Y*r.Delta.X===i.Delta.X*r.Delta.Y):t===3?(n=e[0],o=e[1],s=e[2],(n.Y-o.Y)*(o.X-s.X)-(n.X-o.X)*(o.Y-s.Y)===0):(n=e[0],o=e[1],s=e[2],a=e[3],(n.Y-o.Y)*(s.X-a.X)-(n.X-o.X)*(s.Y-a.Y)===0)},p.ClipperBase.SlopesEqual3=function(e,t){return e.Delta.Y*t.Delta.X===e.Delta.X*t.Delta.Y},p.ClipperBase.SlopesEqual4=function(e,t,i){return(e.Y-t.Y)*(t.X-i.X)-(e.X-t.X)*(t.Y-i.Y)===0},p.ClipperBase.SlopesEqual5=function(e,t,i,r){return(e.Y-t.Y)*(i.X-r.X)-(e.X-t.X)*(i.Y-r.Y)===0},p.ClipperBase.prototype.Clear=function(){var e=this;this.DisposeLocalMinimaList();for(var t=0,i=this.m_edges.length;t<i;++t){for(var r=0,n=this.m_edges[t].length;r<n;++r)e.m_edges[t][r]=null;p.Clear(e.m_edges[t])}p.Clear(this.m_edges),this.m_HasOpenPaths=!1},p.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(var e=this;this.m_MinimaList!==null;){var t=e.m_MinimaList.Next;e.m_MinimaList=null,e.m_MinimaList=t}this.m_CurrentLM=null},p.ClipperBase.prototype.RangeTest=function(e){(e.X>p.ClipperBase.maxValue||e.X<-p.ClipperBase.maxValue||e.Y>p.ClipperBase.maxValue||e.Y<-p.ClipperBase.maxValue||e.X>0&&e.X<p.ClipperBase.minValue||e.Y>0&&e.Y<p.ClipperBase.minValue||e.X<0&&e.X>-p.ClipperBase.minValue||e.Y<0&&e.Y>-p.ClipperBase.minValue)&&p.Error("Coordinate outside allowed range in RangeTest().")},p.ClipperBase.prototype.InitEdge=function(e,t,i,r){e.Next=t,e.Prev=i,e.Curr.X=r.X,e.Curr.Y=r.Y,p.use_xyz&&(e.Curr.Z=r.Z),e.OutIdx=-1},p.ClipperBase.prototype.InitEdge2=function(e,t){e.Curr.Y>=e.Next.Curr.Y?(e.Bot.X=e.Curr.X,e.Bot.Y=e.Curr.Y,p.use_xyz&&(e.Bot.Z=e.Curr.Z),e.Top.X=e.Next.Curr.X,e.Top.Y=e.Next.Curr.Y,p.use_xyz&&(e.Top.Z=e.Next.Curr.Z)):(e.Top.X=e.Curr.X,e.Top.Y=e.Curr.Y,p.use_xyz&&(e.Top.Z=e.Curr.Z),e.Bot.X=e.Next.Curr.X,e.Bot.Y=e.Next.Curr.Y,p.use_xyz&&(e.Bot.Z=e.Next.Curr.Z)),this.SetDx(e),e.PolyTyp=t},p.ClipperBase.prototype.FindNextLocMin=function(e){for(var t;;){for(;p.FPoint.op_Inequality(e.Bot,e.Prev.Bot)||p.FPoint.op_Equality(e.Curr,e.Top);)e=e.Next;if(e.Dx!==p.ClipperBase.horizontal&&e.Prev.Dx!==p.ClipperBase.horizontal)break;for(;e.Prev.Dx===p.ClipperBase.horizontal;)e=e.Prev;for(t=e;e.Dx===p.ClipperBase.horizontal;)e=e.Next;if(e.Top.Y!==e.Prev.Bot.Y){t.Prev.Bot.X<e.Bot.X&&(e=t);break}}return e},p.ClipperBase.prototype.ProcessBound=function(e,t){var i=this,r,n=e,o;if(n.OutIdx===p.ClipperBase.Skip){if(e=n,t){for(;e.Top.Y===e.Next.Bot.Y;)e=e.Next;for(;e!==n&&e.Dx===p.ClipperBase.horizontal;)e=e.Prev}else{for(;e.Top.Y===e.Prev.Bot.Y;)e=e.Prev;for(;e!==n&&e.Dx===p.ClipperBase.horizontal;)e=e.Next}if(e===n)t?n=e.Next:n=e.Prev;else{t?e=n.Next:e=n.Prev;var s=new p.LocalMinima;s.Next=null,s.Y=e.Bot.Y,s.LeftBound=null,s.RightBound=e,e.WindDelta=0,n=this.ProcessBound(e,t),this.InsertLocalMinima(s)}return n}if(e.Dx===p.ClipperBase.horizontal&&(t?r=e.Prev:r=e.Next,r.Dx===p.ClipperBase.horizontal?r.Bot.X!==e.Bot.X&&r.Top.X!==e.Bot.X&&this.ReverseHorizontal(e):r.Bot.X!==e.Bot.X&&this.ReverseHorizontal(e)),r=e,t){for(;n.Top.Y===n.Next.Bot.Y&&n.Next.OutIdx!==p.ClipperBase.Skip;)n=n.Next;if(n.Dx===p.ClipperBase.horizontal&&n.Next.OutIdx!==p.ClipperBase.Skip){for(o=n;o.Prev.Dx===p.ClipperBase.horizontal;)o=o.Prev;o.Prev.Top.X>n.Next.Top.X&&(n=o.Prev)}for(;e!==n;)e.NextInLML=e.Next,e.Dx===p.ClipperBase.horizontal&&e!==r&&e.Bot.X!==e.Prev.Top.X&&i.ReverseHorizontal(e),e=e.Next;e.Dx===p.ClipperBase.horizontal&&e!==r&&e.Bot.X!==e.Prev.Top.X&&this.ReverseHorizontal(e),n=n.Next}else{for(;n.Top.Y===n.Prev.Bot.Y&&n.Prev.OutIdx!==p.ClipperBase.Skip;)n=n.Prev;if(n.Dx===p.ClipperBase.horizontal&&n.Prev.OutIdx!==p.ClipperBase.Skip){for(o=n;o.Next.Dx===p.ClipperBase.horizontal;)o=o.Next;(o.Next.Top.X===n.Prev.Top.X||o.Next.Top.X>n.Prev.Top.X)&&(n=o.Next)}for(;e!==n;)e.NextInLML=e.Prev,e.Dx===p.ClipperBase.horizontal&&e!==r&&e.Bot.X!==e.Next.Top.X&&i.ReverseHorizontal(e),e=e.Prev;e.Dx===p.ClipperBase.horizontal&&e!==r&&e.Bot.X!==e.Next.Top.X&&this.ReverseHorizontal(e),n=n.Prev}return n},p.ClipperBase.prototype.AddPath=function(e,t,i){var r=this;p.use_lines?!i&&t===p.PolyType.ptClip&&p.Error("AddPath: Open paths must be subject."):i||p.Error("AddPath: Open paths have been disabled.");var n=e.length-1;if(i)for(;n>0&&p.FPoint.op_Equality(e[n],e[0]);)--n;for(;n>0&&p.FPoint.op_Equality(e[n],e[n-1]);)--n;if(i&&n<2||!i&&n<1)return!1;for(var o=new Array,s=0;s<=n;s++)o.push(new p.TEdge);var a=!0;o[1].Curr.X=e[1].X,o[1].Curr.Y=e[1].Y,p.use_xyz&&(o[1].Curr.Z=e[1].Z),this.RangeTest(e[0]),this.RangeTest(e[n]),this.InitEdge(o[0],o[1],o[n],e[0]),this.InitEdge(o[n],o[0],o[n-1],e[n]);for(var s=n-1;s>=1;--s)r.RangeTest(e[s]),r.InitEdge(o[s],o[s+1],o[s-1],e[s]);for(var h=o[0],l=h,u=h;;){if(l.Curr===l.Next.Curr&&(i||l.Next!==h)){if(l===l.Next)break;l===h&&(h=l.Next),l=r.RemoveEdge(l),u=l;continue}if(l.Prev===l.Next)break;if(i&&p.ClipperBase.SlopesEqual4(l.Prev.Curr,l.Curr,l.Next.Curr)&&(!r.PreserveCollinear||!r.Pt2IsBetweenPt1AndPt3(l.Prev.Curr,l.Curr,l.Next.Curr))){l===h&&(h=l.Next),l=r.RemoveEdge(l),l=l.Prev,u=l;continue}if(l=l.Next,l===u||!i&&l.Next===h)break}if(!i&&l===l.Next||i&&l.Prev===l.Next)return!1;i||(this.m_HasOpenPaths=!0,h.Prev.OutIdx=p.ClipperBase.Skip),l=h;do r.InitEdge2(l,t),l=l.Next,a&&l.Curr.Y!==h.Curr.Y&&(a=!1);while(l!==h);if(a){if(i)return!1;l.Prev.OutIdx=p.ClipperBase.Skip;var c=new p.LocalMinima;for(c.Next=null,c.Y=l.Bot.Y,c.LeftBound=null,c.RightBound=l,c.RightBound.Side=p.EdgeSide.esRight,c.RightBound.WindDelta=0;l.Bot.X!==l.Prev.Top.X&&r.ReverseHorizontal(l),l.Next.OutIdx!==p.ClipperBase.Skip;)l.NextInLML=l.Next,l=l.Next;return this.InsertLocalMinima(c),this.m_edges.push(o),!0}this.m_edges.push(o);var d,f=null;for(p.FPoint.op_Equality(l.Prev.Bot,l.Prev.Top)&&(l=l.Next);l=r.FindNextLocMin(l),l!==f;){f===null&&(f=l);var c=new p.LocalMinima;c.Next=null,c.Y=l.Bot.Y,l.Dx<l.Prev.Dx?(c.LeftBound=l.Prev,c.RightBound=l,d=!1):(c.LeftBound=l,c.RightBound=l.Prev,d=!0),c.LeftBound.Side=p.EdgeSide.esLeft,c.RightBound.Side=p.EdgeSide.esRight,i?c.LeftBound.Next===c.RightBound?c.LeftBound.WindDelta=-1:c.LeftBound.WindDelta=1:c.LeftBound.WindDelta=0,c.RightBound.WindDelta=-c.LeftBound.WindDelta,l=r.ProcessBound(c.LeftBound,d),l.OutIdx===p.ClipperBase.Skip&&(l=r.ProcessBound(l,d));var m=r.ProcessBound(c.RightBound,!d);m.OutIdx===p.ClipperBase.Skip&&(m=r.ProcessBound(m,!d)),c.LeftBound.OutIdx===p.ClipperBase.Skip?c.LeftBound=null:c.RightBound.OutIdx===p.ClipperBase.Skip&&(c.RightBound=null),r.InsertLocalMinima(c),d||(l=m)}return!0},p.ClipperBase.prototype.AddPaths=function(e,t,i){for(var r=this,n=!1,o=0,s=e.length;o<s;++o)r.AddPath(e[o],t,i)&&(n=!0);return n},p.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(e,t,i){return p.FPoint.op_Equality(e,i)||p.FPoint.op_Equality(e,t)||p.FPoint.op_Equality(i,t)?!1:e.X!==i.X?t.X>e.X==t.X<i.X:t.Y>e.Y==t.Y<i.Y},p.ClipperBase.prototype.RemoveEdge=function(e){e.Prev.Next=e.Next,e.Next.Prev=e.Prev;var t=e.Next;return e.Prev=null,t},p.ClipperBase.prototype.SetDx=function(e){e.Delta.X=e.Top.X-e.Bot.X,e.Delta.Y=e.Top.Y-e.Bot.Y,e.Delta.Y===0?e.Dx=p.ClipperBase.horizontal:e.Dx=e.Delta.X/e.Delta.Y},p.ClipperBase.prototype.InsertLocalMinima=function(e){if(this.m_MinimaList===null)this.m_MinimaList=e;else if(e.Y>=this.m_MinimaList.Y)e.Next=this.m_MinimaList,this.m_MinimaList=e;else{for(var t=this.m_MinimaList;t.Next!==null&&e.Y<t.Next.Y;)t=t.Next;e.Next=t.Next,t.Next=e}},p.ClipperBase.prototype.PopLocalMinima=function(e,t){return t.v=this.m_CurrentLM,this.m_CurrentLM!==null&&this.m_CurrentLM.Y===e?(this.m_CurrentLM=this.m_CurrentLM.Next,!0):!1},p.ClipperBase.prototype.ReverseHorizontal=function(e){var t=e.Top.X;e.Top.X=e.Bot.X,e.Bot.X=t,p.use_xyz&&(t=e.Top.Z,e.Top.Z=e.Bot.Z,e.Bot.Z=t)},p.ClipperBase.prototype.Reset=function(){var e=this;if(this.m_CurrentLM=this.m_MinimaList,this.m_CurrentLM!==null){this.m_Scanbeam=null;for(var t=this.m_MinimaList;t!==null;){e.InsertScanbeam(t.Y);var i=t.LeftBound;i!==null&&(i.Curr.X=i.Bot.X,i.Curr.Y=i.Bot.Y,p.use_xyz&&(i.Curr.Z=i.Bot.Z),i.OutIdx=p.ClipperBase.Unassigned),i=t.RightBound,i!==null&&(i.Curr.X=i.Bot.X,i.Curr.Y=i.Bot.Y,p.use_xyz&&(i.Curr.Z=i.Bot.Z),i.OutIdx=p.ClipperBase.Unassigned),t=t.Next}this.m_ActiveEdges=null}},p.ClipperBase.prototype.InsertScanbeam=function(e){if(this.m_Scanbeam===null)this.m_Scanbeam=new p.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=e;else if(e>this.m_Scanbeam.Y){var t=new p.Scanbeam;t.Y=e,t.Next=this.m_Scanbeam,this.m_Scanbeam=t}else{for(var i=this.m_Scanbeam;i.Next!==null&&e<=i.Next.Y;)i=i.Next;if(e===i.Y)return;var r=new p.Scanbeam;r.Y=e,r.Next=i.Next,i.Next=r}},p.ClipperBase.prototype.PopScanbeam=function(e){return this.m_Scanbeam===null?(e.v=0,!1):(e.v=this.m_Scanbeam.Y,this.m_Scanbeam=this.m_Scanbeam.Next,!0)},p.ClipperBase.prototype.LocalMinimaPending=function(){return this.m_CurrentLM!==null},p.ClipperBase.prototype.CreateOutRec=function(){var e=new p.OutRec;return e.Idx=p.ClipperBase.Unassigned,e.IsHole=!1,e.IsOpen=!1,e.FirstLeft=null,e.Pts=null,e.BottomPt=null,e.PolyNode=null,this.m_PolyOuts.push(e),e.Idx=this.m_PolyOuts.length-1,e},p.ClipperBase.prototype.DisposeOutRec=function(e){var t=this.m_PolyOuts[e];t.Pts=null,t=null,this.m_PolyOuts[e]=null},p.ClipperBase.prototype.UpdateEdgeIntoAEL=function(e){e.NextInLML===null&&p.Error("UpdateEdgeIntoAEL: invalid call");var t=e.PrevInAEL,i=e.NextInAEL;return e.NextInLML.OutIdx=e.OutIdx,t!==null?t.NextInAEL=e.NextInLML:this.m_ActiveEdges=e.NextInLML,i!==null&&(i.PrevInAEL=e.NextInLML),e.NextInLML.Side=e.Side,e.NextInLML.WindDelta=e.WindDelta,e.NextInLML.WindCnt=e.WindCnt,e.NextInLML.WindCnt2=e.WindCnt2,e=e.NextInLML,e.Curr.X=e.Bot.X,e.Curr.Y=e.Bot.Y,e.PrevInAEL=t,e.NextInAEL=i,p.ClipperBase.IsHorizontal(e)||this.InsertScanbeam(e.Top.Y),e},p.ClipperBase.prototype.SwapPositionsInAEL=function(e,t){if(!(e.NextInAEL===e.PrevInAEL||t.NextInAEL===t.PrevInAEL)){if(e.NextInAEL===t){var i=t.NextInAEL;i!==null&&(i.PrevInAEL=e);var r=e.PrevInAEL;r!==null&&(r.NextInAEL=t),t.PrevInAEL=r,t.NextInAEL=e,e.PrevInAEL=t,e.NextInAEL=i}else if(t.NextInAEL===e){var n=e.NextInAEL;n!==null&&(n.PrevInAEL=t);var o=t.PrevInAEL;o!==null&&(o.NextInAEL=e),e.PrevInAEL=o,e.NextInAEL=t,t.PrevInAEL=e,t.NextInAEL=n}else{var s=e.NextInAEL,a=e.PrevInAEL;e.NextInAEL=t.NextInAEL,e.NextInAEL!==null&&(e.NextInAEL.PrevInAEL=e),e.PrevInAEL=t.PrevInAEL,e.PrevInAEL!==null&&(e.PrevInAEL.NextInAEL=e),t.NextInAEL=s,t.NextInAEL!==null&&(t.NextInAEL.PrevInAEL=t),t.PrevInAEL=a,t.PrevInAEL!==null&&(t.PrevInAEL.NextInAEL=t)}e.PrevInAEL===null?this.m_ActiveEdges=e:t.PrevInAEL===null&&(this.m_ActiveEdges=t)}},p.ClipperBase.prototype.DeleteFromAEL=function(e){var t=e.PrevInAEL,i=e.NextInAEL;t===null&&i===null&&e!==this.m_ActiveEdges||(t!==null?t.NextInAEL=i:this.m_ActiveEdges=i,i!==null&&(i.PrevInAEL=t),e.NextInAEL=null,e.PrevInAEL=null)},p.Clipper=function(e){typeof e>"u"&&(e=0),this.m_PolyOuts=null,this.m_ClipType=p.ClipType.ctIntersection,this.m_Scanbeam=null,this.m_Maxima=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=null,this.m_IntersectNodeComparer=null,this.m_ExecuteLocked=!1,this.m_ClipFillType=p.PolyFillType.pftEvenOdd,this.m_SubjFillType=p.PolyFillType.pftEvenOdd,this.m_Joins=null,this.m_GhostJoins=null,this.m_UsingPolyTree=!1,this.ReverseSolution=!1,this.StrictlySimple=!1,p.ClipperBase.call(this),this.m_Scanbeam=null,this.m_Maxima=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=new Array,this.m_IntersectNodeComparer=p.MyIntersectNodeSort.Compare,this.m_ExecuteLocked=!1,this.m_UsingPolyTree=!1,this.m_PolyOuts=new Array,this.m_Joins=new Array,this.m_GhostJoins=new Array,this.ReverseSolution=(1&e)!==0,this.StrictlySimple=(2&e)!==0,this.PreserveCollinear=(4&e)!==0,p.use_xyz&&(this.ZFillFunction=null)},p.Clipper.ioReverseSolution=1,p.Clipper.ioStrictlySimple=2,p.Clipper.ioPreserveCollinear=4,p.Clipper.prototype.Clear=function(){this.m_edges.length!==0&&(this.DisposeAllPolyPts(),p.ClipperBase.prototype.Clear.call(this))},p.Clipper.prototype.InsertMaxima=function(e){var t=new p.Maxima;if(t.X=e,this.m_Maxima===null)this.m_Maxima=t,this.m_Maxima.Next=null,this.m_Maxima.Prev=null;else if(e<this.m_Maxima.X)t.Next=this.m_Maxima,t.Prev=null,this.m_Maxima=t;else{for(var i=this.m_Maxima;i.Next!==null&&e>=i.Next.X;)i=i.Next;if(e===i.X)return;t.Next=i.Next,t.Prev=i,i.Next!==null&&(i.Next.Prev=t),i.Next=t}},p.Clipper.prototype.Execute=function(){var e=arguments,t=e.length,i=e[1]instanceof p.PolyTree;if(t===4&&!i){var r=e[0],n=e[1],o=e[2],s=e[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&p.Error("Error: PolyTree struct is needed for open path clipping."),this.m_ExecuteLocked=!0,p.Clear(n),this.m_SubjFillType=o,this.m_ClipFillType=s,this.m_ClipType=r,this.m_UsingPolyTree=!1;try{var a=this.ExecuteInternal();a&&this.BuildResult(n)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return a}else if(t===4&&i){var r=e[0],h=e[1],o=e[2],s=e[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0,this.m_SubjFillType=o,this.m_ClipFillType=s,this.m_ClipType=r,this.m_UsingPolyTree=!0;try{var a=this.ExecuteInternal();a&&this.BuildResult2(h)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return a}else if(t===2&&!i){var r=e[0],n=e[1];return this.Execute(r,n,p.PolyFillType.pftEvenOdd,p.PolyFillType.pftEvenOdd)}else if(t===2&&i){var r=e[0],h=e[1];return this.Execute(r,h,p.PolyFillType.pftEvenOdd,p.PolyFillType.pftEvenOdd)}},p.Clipper.prototype.FixHoleLinkage=function(e){if(!(e.FirstLeft===null||e.IsHole!==e.FirstLeft.IsHole&&e.FirstLeft.Pts!==null)){for(var t=e.FirstLeft;t!==null&&(t.IsHole===e.IsHole||t.Pts===null);)t=t.FirstLeft;e.FirstLeft=t}},p.Clipper.prototype.ExecuteInternal=function(){var e=this;try{this.Reset(),this.m_SortedEdges=null,this.m_Maxima=null;var t={},i={};if(!this.PopScanbeam(t))return!1;for(this.InsertLocalMinimaIntoAEL(t.v);this.PopScanbeam(i)||this.LocalMinimaPending();){if(e.ProcessHorizontals(),e.m_GhostJoins.length=0,!e.ProcessIntersections(i.v))return!1;e.ProcessEdgesAtTopOfScanbeam(i.v),t.v=i.v,e.InsertLocalMinimaIntoAEL(t.v)}var r,n,o;for(n=0,o=this.m_PolyOuts.length;n<o;n++)r=e.m_PolyOuts[n],!(r.Pts===null||r.IsOpen)&&(r.IsHole^e.ReverseSolution)==e.Area$1(r)>0&&e.ReversePolyPtLinks(r.Pts);for(this.JoinCommonEdges(),n=0,o=this.m_PolyOuts.length;n<o;n++)r=e.m_PolyOuts[n],r.Pts!==null&&(r.IsOpen?e.FixupOutPolyline(r):e.FixupOutPolygon(r));return this.StrictlySimple&&this.DoSimplePolygons(),!0}finally{this.m_Joins.length=0,this.m_GhostJoins.length=0}},p.Clipper.prototype.DisposeAllPolyPts=function(){for(var e=this,t=0,i=this.m_PolyOuts.length;t<i;++t)e.DisposeOutRec(t);p.Clear(this.m_PolyOuts)},p.Clipper.prototype.AddJoin=function(e,t,i){var r=new p.Join;r.OutPt1=e,r.OutPt2=t,r.OffPt.X=i.X,r.OffPt.Y=i.Y,p.use_xyz&&(r.OffPt.Z=i.Z),this.m_Joins.push(r)},p.Clipper.prototype.AddGhostJoin=function(e,t){var i=new p.Join;i.OutPt1=e,i.OffPt.X=t.X,i.OffPt.Y=t.Y,p.use_xyz&&(i.OffPt.Z=t.Z),this.m_GhostJoins.push(i)},p.Clipper.prototype.SetZ=function(e,t,i){if(this.ZFillFunction!==null){if(e.Z!==0||this.ZFillFunction===null)return;p.FPoint.op_Equality(e,t.Bot)?e.Z=t.Bot.Z:p.FPoint.op_Equality(e,t.Top)?e.Z=t.Top.Z:p.FPoint.op_Equality(e,i.Bot)?e.Z=i.Bot.Z:p.FPoint.op_Equality(e,i.Top)?e.Z=i.Top.Z:this.ZFillFunction(t.Bot,t.Top,i.Bot,i.Top,e)}},p.Clipper.prototype.InsertLocalMinimaIntoAEL=function(e){for(var t=this,i={},r,n;this.PopLocalMinima(e,i);){r=i.v.LeftBound,n=i.v.RightBound;var o=null;if(r===null?(t.InsertEdgeIntoAEL(n,null),t.SetWindingCount(n),t.IsContributing(n)&&(o=t.AddOutPt(n,n.Bot))):n===null?(t.InsertEdgeIntoAEL(r,null),t.SetWindingCount(r),t.IsContributing(r)&&(o=t.AddOutPt(r,r.Bot)),t.InsertScanbeam(r.Top.Y)):(t.InsertEdgeIntoAEL(r,null),t.InsertEdgeIntoAEL(n,r),t.SetWindingCount(r),n.WindCnt=r.WindCnt,n.WindCnt2=r.WindCnt2,t.IsContributing(r)&&(o=t.AddLocalMinPoly(r,n,r.Bot)),t.InsertScanbeam(r.Top.Y)),n!==null&&(p.ClipperBase.IsHorizontal(n)?(n.NextInLML!==null&&t.InsertScanbeam(n.NextInLML.Top.Y),t.AddEdgeToSEL(n)):t.InsertScanbeam(n.Top.Y)),!(r===null||n===null)){if(o!==null&&p.ClipperBase.IsHorizontal(n)&&t.m_GhostJoins.length>0&&n.WindDelta!==0)for(var s=0,a=this.m_GhostJoins.length;s<a;s++){var h=t.m_GhostJoins[s];t.HorzSegmentsOverlap(h.OutPt1.Pt.X,h.OffPt.X,n.Bot.X,n.Top.X)&&t.AddJoin(h.OutPt1,o,h.OffPt)}if(r.OutIdx>=0&&r.PrevInAEL!==null&&r.PrevInAEL.Curr.X===r.Bot.X&&r.PrevInAEL.OutIdx>=0&&p.ClipperBase.SlopesEqual5(r.PrevInAEL.Curr,r.PrevInAEL.Top,r.Curr,r.Top)&&r.WindDelta!==0&&r.PrevInAEL.WindDelta!==0){var l=t.AddOutPt(r.PrevInAEL,r.Bot);t.AddJoin(o,l,r.Top)}if(r.NextInAEL!==n){if(n.OutIdx>=0&&n.PrevInAEL.OutIdx>=0&&p.ClipperBase.SlopesEqual5(n.PrevInAEL.Curr,n.PrevInAEL.Top,n.Curr,n.Top)&&n.WindDelta!==0&&n.PrevInAEL.WindDelta!==0){var l=t.AddOutPt(n.PrevInAEL,n.Bot);t.AddJoin(o,l,n.Top)}var u=r.NextInAEL;if(u!==null)for(;u!==n;)t.IntersectEdges(n,u,r.Curr),u=u.NextInAEL}}}},p.Clipper.prototype.InsertEdgeIntoAEL=function(e,t){if(this.m_ActiveEdges===null)e.PrevInAEL=null,e.NextInAEL=null,this.m_ActiveEdges=e;else if(t===null&&this.E2InsertsBeforeE1(this.m_ActiveEdges,e))e.PrevInAEL=null,e.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges.PrevInAEL=e,this.m_ActiveEdges=e;else{for(t===null&&(t=this.m_ActiveEdges);t.NextInAEL!==null&&!this.E2InsertsBeforeE1(t.NextInAEL,e);)t=t.NextInAEL;e.NextInAEL=t.NextInAEL,t.NextInAEL!==null&&(t.NextInAEL.PrevInAEL=e),e.PrevInAEL=t,t.NextInAEL=e}},p.Clipper.prototype.E2InsertsBeforeE1=function(e,t){return t.Curr.X===e.Curr.X?t.Top.Y>e.Top.Y?t.Top.X<p.Clipper.TopX(e,t.Top.Y):e.Top.X>p.Clipper.TopX(t,e.Top.Y):t.Curr.X<e.Curr.X},p.Clipper.prototype.IsEvenOddFillType=function(e){return e.PolyTyp===p.PolyType.ptSubject?this.m_SubjFillType===p.PolyFillType.pftEvenOdd:this.m_ClipFillType===p.PolyFillType.pftEvenOdd},p.Clipper.prototype.IsEvenOddAltFillType=function(e){return e.PolyTyp===p.PolyType.ptSubject?this.m_ClipFillType===p.PolyFillType.pftEvenOdd:this.m_SubjFillType===p.PolyFillType.pftEvenOdd},p.Clipper.prototype.IsContributing=function(e){var t,i;switch(e.PolyTyp===p.PolyType.ptSubject?(t=this.m_SubjFillType,i=this.m_ClipFillType):(t=this.m_ClipFillType,i=this.m_SubjFillType),t){case p.PolyFillType.pftEvenOdd:if(e.WindDelta===0&&e.WindCnt!==1)return!1;break;case p.PolyFillType.pftNonZero:if(Math.abs(e.WindCnt)!==1)return!1;break;case p.PolyFillType.pftPositive:if(e.WindCnt!==1)return!1;break;default:if(e.WindCnt!==-1)return!1;break}switch(this.m_ClipType){case p.ClipType.ctIntersection:switch(i){case p.PolyFillType.pftEvenOdd:case p.PolyFillType.pftNonZero:return e.WindCnt2!==0;case p.PolyFillType.pftPositive:return e.WindCnt2>0;default:return e.WindCnt2<0}case p.ClipType.ctUnion:switch(i){case p.PolyFillType.pftEvenOdd:case p.PolyFillType.pftNonZero:return e.WindCnt2===0;case p.PolyFillType.pftPositive:return e.WindCnt2<=0;default:return e.WindCnt2>=0}case p.ClipType.ctDifference:if(e.PolyTyp===p.PolyType.ptSubject)switch(i){case p.PolyFillType.pftEvenOdd:case p.PolyFillType.pftNonZero:return e.WindCnt2===0;case p.PolyFillType.pftPositive:return e.WindCnt2<=0;default:return e.WindCnt2>=0}else switch(i){case p.PolyFillType.pftEvenOdd:case p.PolyFillType.pftNonZero:return e.WindCnt2!==0;case p.PolyFillType.pftPositive:return e.WindCnt2>0;default:return e.WindCnt2<0}case p.ClipType.ctXor:if(e.WindDelta===0)switch(i){case p.PolyFillType.pftEvenOdd:case p.PolyFillType.pftNonZero:return e.WindCnt2===0;case p.PolyFillType.pftPositive:return e.WindCnt2<=0;default:return e.WindCnt2>=0}else return!0}return!0},p.Clipper.prototype.SetWindingCount=function(e){for(var t=e.PrevInAEL;t!==null&&(t.PolyTyp!==e.PolyTyp||t.WindDelta===0);)t=t.PrevInAEL;if(t===null){var i=e.PolyTyp===p.PolyType.ptSubject?this.m_SubjFillType:this.m_ClipFillType;e.WindDelta===0?e.WindCnt=i===p.PolyFillType.pftNegative?-1:1:e.WindCnt=e.WindDelta,e.WindCnt2=0,t=this.m_ActiveEdges}else if(e.WindDelta===0&&this.m_ClipType!==p.ClipType.ctUnion)e.WindCnt=1,e.WindCnt2=t.WindCnt2,t=t.NextInAEL;else if(this.IsEvenOddFillType(e)){if(e.WindDelta===0){for(var r=!0,n=t.PrevInAEL;n!==null;)n.PolyTyp===t.PolyTyp&&n.WindDelta!==0&&(r=!r),n=n.PrevInAEL;e.WindCnt=r?0:1}else e.WindCnt=e.WindDelta;e.WindCnt2=t.WindCnt2,t=t.NextInAEL}else t.WindCnt*t.WindDelta<0?Math.abs(t.WindCnt)>1?t.WindDelta*e.WindDelta<0?e.WindCnt=t.WindCnt:e.WindCnt=t.WindCnt+e.WindDelta:e.WindCnt=e.WindDelta===0?1:e.WindDelta:e.WindDelta===0?e.WindCnt=t.WindCnt<0?t.WindCnt-1:t.WindCnt+1:t.WindDelta*e.WindDelta<0?e.WindCnt=t.WindCnt:e.WindCnt=t.WindCnt+e.WindDelta,e.WindCnt2=t.WindCnt2,t=t.NextInAEL;if(this.IsEvenOddAltFillType(e))for(;t!==e;)t.WindDelta!==0&&(e.WindCnt2=e.WindCnt2===0?1:0),t=t.NextInAEL;else for(;t!==e;)e.WindCnt2+=t.WindDelta,t=t.NextInAEL},p.Clipper.prototype.AddEdgeToSEL=function(e){this.m_SortedEdges===null?(this.m_SortedEdges=e,e.PrevInSEL=null,e.NextInSEL=null):(e.NextInSEL=this.m_SortedEdges,e.PrevInSEL=null,this.m_SortedEdges.PrevInSEL=e,this.m_SortedEdges=e)},p.Clipper.prototype.PopEdgeFromSEL=function(e){if(e.v=this.m_SortedEdges,e.v===null)return!1;var t=e.v;return this.m_SortedEdges=e.v.NextInSEL,this.m_SortedEdges!==null&&(this.m_SortedEdges.PrevInSEL=null),t.NextInSEL=null,t.PrevInSEL=null,!0},p.Clipper.prototype.CopyAELToSEL=function(){var e=this.m_ActiveEdges;for(this.m_SortedEdges=e;e!==null;)e.PrevInSEL=e.PrevInAEL,e.NextInSEL=e.NextInAEL,e=e.NextInAEL},p.Clipper.prototype.SwapPositionsInSEL=function(e,t){if(!(e.NextInSEL===null&&e.PrevInSEL===null)&&!(t.NextInSEL===null&&t.PrevInSEL===null)){if(e.NextInSEL===t){var i=t.NextInSEL;i!==null&&(i.PrevInSEL=e);var r=e.PrevInSEL;r!==null&&(r.NextInSEL=t),t.PrevInSEL=r,t.NextInSEL=e,e.PrevInSEL=t,e.NextInSEL=i}else if(t.NextInSEL===e){var i=e.NextInSEL;i!==null&&(i.PrevInSEL=t);var r=t.PrevInSEL;r!==null&&(r.NextInSEL=e),e.PrevInSEL=r,e.NextInSEL=t,t.PrevInSEL=e,t.NextInSEL=i}else{var i=e.NextInSEL,r=e.PrevInSEL;e.NextInSEL=t.NextInSEL,e.NextInSEL!==null&&(e.NextInSEL.PrevInSEL=e),e.PrevInSEL=t.PrevInSEL,e.PrevInSEL!==null&&(e.PrevInSEL.NextInSEL=e),t.NextInSEL=i,t.NextInSEL!==null&&(t.NextInSEL.PrevInSEL=t),t.PrevInSEL=r,t.PrevInSEL!==null&&(t.PrevInSEL.NextInSEL=t)}e.PrevInSEL===null?this.m_SortedEdges=e:t.PrevInSEL===null&&(this.m_SortedEdges=t)}},p.Clipper.prototype.AddLocalMaxPoly=function(e,t,i){this.AddOutPt(e,i),t.WindDelta===0&&this.AddOutPt(t,i),e.OutIdx===t.OutIdx?(e.OutIdx=-1,t.OutIdx=-1):e.OutIdx<t.OutIdx?this.AppendPolygon(e,t):this.AppendPolygon(t,e)},p.Clipper.prototype.AddLocalMinPoly=function(e,t,i){var r,n,o;if(p.ClipperBase.IsHorizontal(t)||e.Dx>t.Dx?(r=this.AddOutPt(e,i),t.OutIdx=e.OutIdx,e.Side=p.EdgeSide.esLeft,t.Side=p.EdgeSide.esRight,n=e,n.PrevInAEL===t?o=t.PrevInAEL:o=n.PrevInAEL):(r=this.AddOutPt(t,i),e.OutIdx=t.OutIdx,e.Side=p.EdgeSide.esRight,t.Side=p.EdgeSide.esLeft,n=t,n.PrevInAEL===e?o=e.PrevInAEL:o=n.PrevInAEL),o!==null&&o.OutIdx>=0&&o.Top.Y<i.Y&&n.Top.Y<i.Y){var s=p.Clipper.TopX(o,i.Y),a=p.Clipper.TopX(n,i.Y);if(s===a&&n.WindDelta!==0&&o.WindDelta!==0&&p.ClipperBase.SlopesEqual5(new p.FPoint2(s,i.Y),o.Top,new p.FPoint2(a,i.Y),n.Top)){var h=this.AddOutPt(o,i);this.AddJoin(r,h,n.Top)}}return r},p.Clipper.prototype.AddOutPt=function(e,t){if(e.OutIdx<0){var i=this.CreateOutRec();i.IsOpen=e.WindDelta===0;var r=new p.OutPt;return i.Pts=r,r.Idx=i.Idx,r.Pt.X=t.X,r.Pt.Y=t.Y,p.use_xyz&&(r.Pt.Z=t.Z),r.Next=r,r.Prev=r,i.IsOpen||this.SetHoleState(e,i),e.OutIdx=i.Idx,r}else{var i=this.m_PolyOuts[e.OutIdx],n=i.Pts,o=e.Side===p.EdgeSide.esLeft;if(o&&p.FPoint.op_Equality(t,n.Pt))return n;if(!o&&p.FPoint.op_Equality(t,n.Prev.Pt))return n.Prev;var r=new p.OutPt;return r.Idx=i.Idx,r.Pt.X=t.X,r.Pt.Y=t.Y,p.use_xyz&&(r.Pt.Z=t.Z),r.Next=n,r.Prev=n.Prev,r.Prev.Next=r,n.Prev=r,o&&(i.Pts=r),r}},p.Clipper.prototype.GetLastOutPt=function(e){var t=this.m_PolyOuts[e.OutIdx];return e.Side===p.EdgeSide.esLeft?t.Pts:t.Pts.Prev},p.Clipper.prototype.SwapPoints=function(e,t){var i=new p.FPoint1(e.Value);e.Value.X=t.Value.X,e.Value.Y=t.Value.Y,p.use_xyz&&(e.Value.Z=t.Value.Z),t.Value.X=i.X,t.Value.Y=i.Y,p.use_xyz&&(t.Value.Z=i.Z)},p.Clipper.prototype.HorzSegmentsOverlap=function(e,t,i,r){var n;return e>t&&(n=e,e=t,t=n),i>r&&(n=i,i=r,r=n),e<r&&i<t},p.Clipper.prototype.SetHoleState=function(e,t){for(var i=e.PrevInAEL,r=null;i!==null;)i.OutIdx>=0&&i.WindDelta!==0&&(r===null?r=i:r.OutIdx===i.OutIdx&&(r=null)),i=i.PrevInAEL;r===null?(t.FirstLeft=null,t.IsHole=!1):(t.FirstLeft=this.m_PolyOuts[r.OutIdx],t.IsHole=!t.FirstLeft.IsHole)},p.Clipper.prototype.GetDx=function(e,t){return e.Y===t.Y?p.ClipperBase.horizontal:(t.X-e.X)/(t.Y-e.Y)},p.Clipper.prototype.FirstIsBottomPt=function(e,t){for(var i=e.Prev;p.FPoint.op_Equality(i.Pt,e.Pt)&&i!==e;)i=i.Prev;var r=Math.abs(this.GetDx(e.Pt,i.Pt));for(i=e.Next;p.FPoint.op_Equality(i.Pt,e.Pt)&&i!==e;)i=i.Next;var n=Math.abs(this.GetDx(e.Pt,i.Pt));for(i=t.Prev;p.FPoint.op_Equality(i.Pt,t.Pt)&&i!==t;)i=i.Prev;var o=Math.abs(this.GetDx(t.Pt,i.Pt));for(i=t.Next;p.FPoint.op_Equality(i.Pt,t.Pt)&&i!==t;)i=i.Next;var s=Math.abs(this.GetDx(t.Pt,i.Pt));return Math.max(r,n)===Math.max(o,s)&&Math.min(r,n)===Math.min(o,s)?this.Area(e)>0:r>=o&&r>=s||n>=o&&n>=s},p.Clipper.prototype.GetBottomPt=function(e){for(var t=this,i=null,r=e.Next;r!==e;)r.Pt.Y>e.Pt.Y?(e=r,i=null):r.Pt.Y===e.Pt.Y&&r.Pt.X<=e.Pt.X&&(r.Pt.X<e.Pt.X?(i=null,e=r):r.Next!==e&&r.Prev!==e&&(i=r)),r=r.Next;if(i!==null)for(;i!==r;)for(t.FirstIsBottomPt(r,i)||(e=i),i=i.Next;p.FPoint.op_Inequality(i.Pt,e.Pt);)i=i.Next;return e},p.Clipper.prototype.GetLowermostRec=function(e,t){e.BottomPt===null&&(e.BottomPt=this.GetBottomPt(e.Pts)),t.BottomPt===null&&(t.BottomPt=this.GetBottomPt(t.Pts));var i=e.BottomPt,r=t.BottomPt;return i.Pt.Y>r.Pt.Y?e:i.Pt.Y<r.Pt.Y?t:i.Pt.X<r.Pt.X?e:i.Pt.X>r.Pt.X||i.Next===i?t:r.Next===r||this.FirstIsBottomPt(i,r)?e:t},p.Clipper.prototype.OutRec1RightOfOutRec2=function(e,t){do if(e=e.FirstLeft,e===t)return!0;while(e!==null);return!1},p.Clipper.prototype.GetOutRec=function(e){for(var t=this,i=this.m_PolyOuts[e];i!==this.m_PolyOuts[i.Idx];)i=t.m_PolyOuts[i.Idx];return i},p.Clipper.prototype.AppendPolygon=function(e,t){var i=this.m_PolyOuts[e.OutIdx],r=this.m_PolyOuts[t.OutIdx],n;this.OutRec1RightOfOutRec2(i,r)?n=r:this.OutRec1RightOfOutRec2(r,i)?n=i:n=this.GetLowermostRec(i,r);var o=i.Pts,s=o.Prev,a=r.Pts,h=a.Prev;e.Side===p.EdgeSide.esLeft?t.Side===p.EdgeSide.esLeft?(this.ReversePolyPtLinks(a),a.Next=o,o.Prev=a,s.Next=h,h.Prev=s,i.Pts=h):(h.Next=o,o.Prev=h,a.Prev=s,s.Next=a,i.Pts=a):t.Side===p.EdgeSide.esRight?(this.ReversePolyPtLinks(a),s.Next=h,h.Prev=s,a.Next=o,o.Prev=a):(s.Next=a,a.Prev=s,o.Prev=h,h.Next=o),i.BottomPt=null,n===r&&(r.FirstLeft!==i&&(i.FirstLeft=r.FirstLeft),i.IsHole=r.IsHole),r.Pts=null,r.BottomPt=null,r.FirstLeft=i;var l=e.OutIdx,u=t.OutIdx;e.OutIdx=-1,t.OutIdx=-1;for(var c=this.m_ActiveEdges;c!==null;){if(c.OutIdx===u){c.OutIdx=l,c.Side=e.Side;break}c=c.NextInAEL}r.Idx=i.Idx},p.Clipper.prototype.ReversePolyPtLinks=function(e){if(e!==null){var t,i;t=e;do i=t.Next,t.Next=t.Prev,t.Prev=i,t=i;while(t!==e)}},p.Clipper.SwapSides=function(e,t){var i=e.Side;e.Side=t.Side,t.Side=i},p.Clipper.SwapPolyIndexes=function(e,t){var i=e.OutIdx;e.OutIdx=t.OutIdx,t.OutIdx=i},p.Clipper.prototype.IntersectEdges=function(e,t,i){var r=e.OutIdx>=0,n=t.OutIdx>=0;if(p.use_xyz&&this.SetZ(i,e,t),p.use_lines&&(e.WindDelta===0||t.WindDelta===0)){if(e.WindDelta===0&&t.WindDelta===0)return;e.PolyTyp===t.PolyTyp&&e.WindDelta!==t.WindDelta&&this.m_ClipType===p.ClipType.ctUnion?e.WindDelta===0?n&&(this.AddOutPt(e,i),r&&(e.OutIdx=-1)):r&&(this.AddOutPt(t,i),n&&(t.OutIdx=-1)):e.PolyTyp!==t.PolyTyp&&(e.WindDelta===0&&Math.abs(t.WindCnt)===1&&(this.m_ClipType!==p.ClipType.ctUnion||t.WindCnt2===0)?(this.AddOutPt(e,i),r&&(e.OutIdx=-1)):t.WindDelta===0&&Math.abs(e.WindCnt)===1&&(this.m_ClipType!==p.ClipType.ctUnion||e.WindCnt2===0)&&(this.AddOutPt(t,i),n&&(t.OutIdx=-1)));return}if(e.PolyTyp===t.PolyTyp)if(this.IsEvenOddFillType(e)){var o=e.WindCnt;e.WindCnt=t.WindCnt,t.WindCnt=o}else e.WindCnt+t.WindDelta===0?e.WindCnt=-e.WindCnt:e.WindCnt+=t.WindDelta,t.WindCnt-e.WindDelta===0?t.WindCnt=-t.WindCnt:t.WindCnt-=e.WindDelta;else this.IsEvenOddFillType(t)?e.WindCnt2=e.WindCnt2===0?1:0:e.WindCnt2+=t.WindDelta,this.IsEvenOddFillType(e)?t.WindCnt2=t.WindCnt2===0?1:0:t.WindCnt2-=e.WindDelta;var s,a,h,l;e.PolyTyp===p.PolyType.ptSubject?(s=this.m_SubjFillType,h=this.m_ClipFillType):(s=this.m_ClipFillType,h=this.m_SubjFillType),t.PolyTyp===p.PolyType.ptSubject?(a=this.m_SubjFillType,l=this.m_ClipFillType):(a=this.m_ClipFillType,l=this.m_SubjFillType);var u,c;switch(s){case p.PolyFillType.pftPositive:u=e.WindCnt;break;case p.PolyFillType.pftNegative:u=-e.WindCnt;break;default:u=Math.abs(e.WindCnt);break}switch(a){case p.PolyFillType.pftPositive:c=t.WindCnt;break;case p.PolyFillType.pftNegative:c=-t.WindCnt;break;default:c=Math.abs(t.WindCnt);break}if(r&&n)u!==0&&u!==1||c!==0&&c!==1||e.PolyTyp!==t.PolyTyp&&this.m_ClipType!==p.ClipType.ctXor?this.AddLocalMaxPoly(e,t,i):(this.AddOutPt(e,i),this.AddOutPt(t,i),p.Clipper.SwapSides(e,t),p.Clipper.SwapPolyIndexes(e,t));else if(r)(c===0||c===1)&&(this.AddOutPt(e,i),p.Clipper.SwapSides(e,t),p.Clipper.SwapPolyIndexes(e,t));else if(n)(u===0||u===1)&&(this.AddOutPt(t,i),p.Clipper.SwapSides(e,t),p.Clipper.SwapPolyIndexes(e,t));else if((u===0||u===1)&&(c===0||c===1)){var d,f;switch(h){case p.PolyFillType.pftPositive:d=e.WindCnt2;break;case p.PolyFillType.pftNegative:d=-e.WindCnt2;break;default:d=Math.abs(e.WindCnt2);break}switch(l){case p.PolyFillType.pftPositive:f=t.WindCnt2;break;case p.PolyFillType.pftNegative:f=-t.WindCnt2;break;default:f=Math.abs(t.WindCnt2);break}if(e.PolyTyp!==t.PolyTyp)this.AddLocalMinPoly(e,t,i);else if(u===1&&c===1)switch(this.m_ClipType){case p.ClipType.ctIntersection:d>0&&f>0&&this.AddLocalMinPoly(e,t,i);break;case p.ClipType.ctUnion:d<=0&&f<=0&&this.AddLocalMinPoly(e,t,i);break;case p.ClipType.ctDifference:(e.PolyTyp===p.PolyType.ptClip&&d>0&&f>0||e.PolyTyp===p.PolyType.ptSubject&&d<=0&&f<=0)&&this.AddLocalMinPoly(e,t,i);break;case p.ClipType.ctXor:this.AddLocalMinPoly(e,t,i);break}else p.Clipper.SwapSides(e,t)}},p.Clipper.prototype.DeleteFromSEL=function(e){var t=e.PrevInSEL,i=e.NextInSEL;t===null&&i===null&&e!==this.m_SortedEdges||(t!==null?t.NextInSEL=i:this.m_SortedEdges=i,i!==null&&(i.PrevInSEL=t),e.NextInSEL=null,e.PrevInSEL=null)},p.Clipper.prototype.ProcessHorizontals=function(){for(var e=this,t={};this.PopEdgeFromSEL(t);)e.ProcessHorizontal(t.v)},p.Clipper.prototype.GetHorzDirection=function(e,t){e.Bot.X<e.Top.X?(t.Left=e.Bot.X,t.Right=e.Top.X,t.Dir=p.Direction.dLeftToRight):(t.Left=e.Top.X,t.Right=e.Bot.X,t.Dir=p.Direction.dRightToLeft)},p.Clipper.prototype.ProcessHorizontal=function(e){var t=this,i={Dir:null,Left:null,Right:null};this.GetHorzDirection(e,i);for(var r=i.Dir,n=i.Left,o=i.Right,s=e.WindDelta===0,a=e,h=null;a.NextInLML!==null&&p.ClipperBase.IsHorizontal(a.NextInLML);)a=a.NextInLML;a.NextInLML===null&&(h=this.GetMaximaPair(a));var l=this.m_Maxima;if(l!==null)if(r===p.Direction.dLeftToRight){for(;l!==null&&l.X<=e.Bot.X;)l=l.Next;l!==null&&l.X>=a.Top.X&&(l=null)}else{for(;l.Next!==null&&l.Next.X<e.Bot.X;)l=l.Next;l.X<=a.Top.X&&(l=null)}for(var u=null;;){for(var c=e===a,d=t.GetNextInAEL(e,r);d!==null;){if(l!==null)if(r===p.Direction.dLeftToRight)for(;l!==null&&l.X<d.Curr.X;)e.OutIdx>=0&&!s&&t.AddOutPt(e,new p.FPoint2(l.X,e.Bot.Y)),l=l.Next;else for(;l!==null&&l.X>d.Curr.X;)e.OutIdx>=0&&!s&&t.AddOutPt(e,new p.FPoint2(l.X,e.Bot.Y)),l=l.Prev;if(r===p.Direction.dLeftToRight&&d.Curr.X>o||r===p.Direction.dRightToLeft&&d.Curr.X<n||d.Curr.X===e.Top.X&&e.NextInLML!==null&&d.Dx<e.NextInLML.Dx)break;if(e.OutIdx>=0&&!s){p.use_xyz&&(r===p.Direction.dLeftToRight?t.SetZ(d.Curr,e,d):t.SetZ(d.Curr,d,e)),u=t.AddOutPt(e,d.Curr);for(var f=t.m_SortedEdges;f!==null;){if(f.OutIdx>=0&&t.HorzSegmentsOverlap(e.Bot.X,e.Top.X,f.Bot.X,f.Top.X)){var m=t.GetLastOutPt(f);t.AddJoin(m,u,f.Top)}f=f.NextInSEL}t.AddGhostJoin(u,e.Bot)}if(d===h&&c){e.OutIdx>=0&&t.AddLocalMaxPoly(e,h,e.Top),t.DeleteFromAEL(e),t.DeleteFromAEL(h);return}if(r===p.Direction.dLeftToRight){var v=new p.FPoint2(d.Curr.X,e.Curr.Y);t.IntersectEdges(e,d,v)}else{var v=new p.FPoint2(d.Curr.X,e.Curr.Y);t.IntersectEdges(d,e,v)}var y=t.GetNextInAEL(d,r);t.SwapPositionsInAEL(e,d),d=y}if(e.NextInLML===null||!p.ClipperBase.IsHorizontal(e.NextInLML))break;e=t.UpdateEdgeIntoAEL(e),e.OutIdx>=0&&t.AddOutPt(e,e.Bot),i={Dir:r,Left:n,Right:o},t.GetHorzDirection(e,i),r=i.Dir,n=i.Left,o=i.Right}if(e.OutIdx>=0&&u===null){u=this.GetLastOutPt(e);for(var f=this.m_SortedEdges;f!==null;){if(f.OutIdx>=0&&t.HorzSegmentsOverlap(e.Bot.X,e.Top.X,f.Bot.X,f.Top.X)){var m=t.GetLastOutPt(f);t.AddJoin(m,u,f.Top)}f=f.NextInSEL}this.AddGhostJoin(u,e.Top)}if(e.NextInLML!==null)if(e.OutIdx>=0){if(u=this.AddOutPt(e,e.Top),e=this.UpdateEdgeIntoAEL(e),e.WindDelta===0)return;var g=e.PrevInAEL,y=e.NextInAEL;if(g!==null&&g.Curr.X===e.Bot.X&&g.Curr.Y===e.Bot.Y&&g.WindDelta===0&&g.OutIdx>=0&&g.Curr.Y>g.Top.Y&&p.ClipperBase.SlopesEqual3(e,g)){var m=this.AddOutPt(g,e.Bot);this.AddJoin(u,m,e.Top)}else if(y!==null&&y.Curr.X===e.Bot.X&&y.Curr.Y===e.Bot.Y&&y.WindDelta!==0&&y.OutIdx>=0&&y.Curr.Y>y.Top.Y&&p.ClipperBase.SlopesEqual3(e,y)){var m=this.AddOutPt(y,e.Bot);this.AddJoin(u,m,e.Top)}}else e=this.UpdateEdgeIntoAEL(e);else e.OutIdx>=0&&this.AddOutPt(e,e.Top),this.DeleteFromAEL(e)},p.Clipper.prototype.GetNextInAEL=function(e,t){return t===p.Direction.dLeftToRight?e.NextInAEL:e.PrevInAEL},p.Clipper.prototype.IsMinima=function(e){return e!==null&&e.Prev.NextInLML!==e&&e.Next.NextInLML!==e},p.Clipper.prototype.IsMaxima=function(e,t){return e!==null&&e.Top.Y===t&&e.NextInLML===null},p.Clipper.prototype.IsIntermediate=function(e,t){return e.Top.Y===t&&e.NextInLML!==null},p.Clipper.prototype.GetMaximaPair=function(e){return p.FPoint.op_Equality(e.Next.Top,e.Top)&&e.Next.NextInLML===null?e.Next:p.FPoint.op_Equality(e.Prev.Top,e.Top)&&e.Prev.NextInLML===null?e.Prev:null},p.Clipper.prototype.GetMaximaPairEx=function(e){var t=this.GetMaximaPair(e);return t===null||t.OutIdx===p.ClipperBase.Skip||t.NextInAEL===t.PrevInAEL&&!p.ClipperBase.IsHorizontal(t)?null:t},p.Clipper.prototype.ProcessIntersections=function(e){if(this.m_ActiveEdges===null)return!0;try{if(this.BuildIntersectList(e),this.m_IntersectList.length===0)return!0;if(this.m_IntersectList.length===1||this.FixupIntersectionOrder())this.ProcessIntersectList();else return!1}catch{this.m_SortedEdges=null,this.m_IntersectList.length=0,p.Error("ProcessIntersections error")}return this.m_SortedEdges=null,!0},p.Clipper.prototype.BuildIntersectList=function(e){var t=this;if(this.m_ActiveEdges!==null){var i=this.m_ActiveEdges;for(this.m_SortedEdges=i;i!==null;)i.PrevInSEL=i.PrevInAEL,i.NextInSEL=i.NextInAEL,i.Curr.X=p.Clipper.TopX(i,e),i=i.NextInAEL;for(var r=!0;r&&this.m_SortedEdges!==null;){for(r=!1,i=t.m_SortedEdges;i.NextInSEL!==null;){var n=i.NextInSEL,o=new p.FPoint0;if(i.Curr.X>n.Curr.X){t.IntersectPoint(i,n,o),o.Y<e&&(o=new p.FPoint2(p.Clipper.TopX(i,e),e));var s=new p.IntersectNode;s.Edge1=i,s.Edge2=n,s.Pt.X=o.X,s.Pt.Y=o.Y,p.use_xyz&&(s.Pt.Z=o.Z),t.m_IntersectList.push(s),t.SwapPositionsInSEL(i,n),r=!0}else i=n}if(i.PrevInSEL!==null)i.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=null}},p.Clipper.prototype.EdgesAdjacent=function(e){return e.Edge1.NextInSEL===e.Edge2||e.Edge1.PrevInSEL===e.Edge2},p.Clipper.IntersectNodeSort=function(e,t){return t.Pt.Y-e.Pt.Y},p.Clipper.prototype.FixupIntersectionOrder=function(){var e=this;this.m_IntersectList.sort(this.m_IntersectNodeComparer),this.CopyAELToSEL();for(var t=this.m_IntersectList.length,i=0;i<t;i++){if(!e.EdgesAdjacent(e.m_IntersectList[i])){for(var r=i+1;r<t&&!this.EdgesAdjacent(this.m_IntersectList[r]);)r++;if(r===t)return!1;var n=e.m_IntersectList[i];e.m_IntersectList[i]=e.m_IntersectList[r],e.m_IntersectList[r]=n}e.SwapPositionsInSEL(e.m_IntersectList[i].Edge1,e.m_IntersectList[i].Edge2)}return!0},p.Clipper.prototype.ProcessIntersectList=function(){for(var e=this,t=0,i=this.m_IntersectList.length;t<i;t++){var r=e.m_IntersectList[t];e.IntersectEdges(r.Edge1,r.Edge2,r.Pt),e.SwapPositionsInAEL(r.Edge1,r.Edge2)}this.m_IntersectList.length=0},p.Clipper.TopX=function(e,t){return t===e.Top.Y?e.Top.X:e.Bot.X+e.Dx*(t-e.Bot.Y)},p.Clipper.prototype.IntersectPoint=function(e,t,i){i.X=0,i.Y=0;var r,n;if(e.Dx===t.Dx){i.Y=e.Curr.Y,i.X=p.Clipper.TopX(e,i.Y);return}if(e.Delta.X===0)i.X=e.Bot.X,p.ClipperBase.IsHorizontal(t)?i.Y=t.Bot.Y:(n=t.Bot.Y-t.Bot.X/t.Dx,i.Y=i.X/t.Dx+n);else if(t.Delta.X===0)i.X=t.Bot.X,p.ClipperBase.IsHorizontal(e)?i.Y=e.Bot.Y:(r=e.Bot.Y-e.Bot.X/e.Dx,i.Y=i.X/e.Dx+r);else{r=e.Bot.X-e.Bot.Y*e.Dx,n=t.Bot.X-t.Bot.Y*t.Dx;var o=(n-r)/(e.Dx-t.Dx);i.Y=o,Math.abs(e.Dx)<Math.abs(t.Dx)?i.X=e.Dx*o+r:i.X=t.Dx*o+n}if(i.Y<e.Top.Y||i.Y<t.Top.Y){if(e.Top.Y>t.Top.Y)return i.Y=e.Top.Y,i.X=p.Clipper.TopX(t,e.Top.Y),i.X<e.Top.X;i.Y=t.Top.Y,Math.abs(e.Dx)<Math.abs(t.Dx)?i.X=p.Clipper.TopX(e,i.Y):i.X=p.Clipper.TopX(t,i.Y)}i.Y>e.Curr.Y&&(i.Y=e.Curr.Y,Math.abs(e.Dx)>Math.abs(t.Dx)?i.X=p.Clipper.TopX(t,i.Y):i.X=p.Clipper.TopX(e,i.Y))},p.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(e){for(var t=this,i=this.m_ActiveEdges;i!==null;){var r=t.IsMaxima(i,e);if(r){var n=t.GetMaximaPairEx(i);r=n===null||!p.ClipperBase.IsHorizontal(n)}if(r){t.StrictlySimple&&t.InsertMaxima(i.Top.X);var o=i.PrevInAEL;t.DoMaxima(i),o===null?i=t.m_ActiveEdges:i=o.NextInAEL}else{if(t.IsIntermediate(i,e)&&p.ClipperBase.IsHorizontal(i.NextInLML)?(i=t.UpdateEdgeIntoAEL(i),i.OutIdx>=0&&t.AddOutPt(i,i.Bot),t.AddEdgeToSEL(i)):(i.Curr.X=p.Clipper.TopX(i,e),i.Curr.Y=e),p.use_xyz&&(i.Top.Y===e?i.Curr.Z=i.Top.Z:i.Bot.Y===e?i.Curr.Z=i.Bot.Z:i.Curr.Z=0),t.StrictlySimple){var o=i.PrevInAEL;if(i.OutIdx>=0&&i.WindDelta!==0&&o!==null&&o.OutIdx>=0&&o.Curr.X===i.Curr.X&&o.WindDelta!==0){var s=new p.FPoint1(i.Curr);p.use_xyz&&t.SetZ(s,o,i);var a=t.AddOutPt(o,s),h=t.AddOutPt(i,s);t.AddJoin(a,h,s)}}i=i.NextInAEL}}for(this.ProcessHorizontals(),this.m_Maxima=null,i=this.m_ActiveEdges;i!==null;){if(t.IsIntermediate(i,e)){var a=null;i.OutIdx>=0&&(a=t.AddOutPt(i,i.Top)),i=t.UpdateEdgeIntoAEL(i);var o=i.PrevInAEL,l=i.NextInAEL;if(o!==null&&o.Curr.X===i.Bot.X&&o.Curr.Y===i.Bot.Y&&a!==null&&o.OutIdx>=0&&o.Curr.Y===o.Top.Y&&p.ClipperBase.SlopesEqual5(i.Curr,i.Top,o.Curr,o.Top)&&i.WindDelta!==0&&o.WindDelta!==0){var h=t.AddOutPt(ePrev2,i.Bot);t.AddJoin(a,h,i.Top)}else if(l!==null&&l.Curr.X===i.Bot.X&&l.Curr.Y===i.Bot.Y&&a!==null&&l.OutIdx>=0&&l.Curr.Y===l.Top.Y&&p.ClipperBase.SlopesEqual5(i.Curr,i.Top,l.Curr,l.Top)&&i.WindDelta!==0&&l.WindDelta!==0){var h=t.AddOutPt(l,i.Bot);t.AddJoin(a,h,i.Top)}}i=i.NextInAEL}},p.Clipper.prototype.DoMaxima=function(e){var t=this,i=this.GetMaximaPairEx(e);if(i===null){e.OutIdx>=0&&this.AddOutPt(e,e.Top),this.DeleteFromAEL(e);return}for(var r=e.NextInAEL;r!==null&&r!==i;)t.IntersectEdges(e,r,e.Top),t.SwapPositionsInAEL(e,r),r=e.NextInAEL;e.OutIdx===-1&&i.OutIdx===-1?(this.DeleteFromAEL(e),this.DeleteFromAEL(i)):e.OutIdx>=0&&i.OutIdx>=0?(e.OutIdx>=0&&this.AddLocalMaxPoly(e,i,e.Top),this.DeleteFromAEL(e),this.DeleteFromAEL(i)):p.use_lines&&e.WindDelta===0?(e.OutIdx>=0&&(this.AddOutPt(e,e.Top),e.OutIdx=p.ClipperBase.Unassigned),this.DeleteFromAEL(e),i.OutIdx>=0&&(this.AddOutPt(i,e.Top),i.OutIdx=p.ClipperBase.Unassigned),this.DeleteFromAEL(i)):p.Error("DoMaxima error")},p.Clipper.ReversePaths=function(e){for(var t=0,i=e.length;t<i;t++)e[t].reverse()},p.Clipper.Orientation=function(e){return p.Clipper.Area(e)>=0},p.Clipper.prototype.PointCount=function(e){if(e===null)return 0;var t=0,i=e;do t++,i=i.Next;while(i!==e);return t},p.Clipper.prototype.BuildResult=function(e){var t=this;p.Clear(e);for(var i=0,r=this.m_PolyOuts.length;i<r;i++){var n=t.m_PolyOuts[i];if(n.Pts!==null){var o=n.Pts.Prev,s=t.PointCount(o);if(!(s<2)){for(var a=new Array(s),h=0;h<s;h++)a[h]=o.Pt,o=o.Prev;e.push(a)}}}},p.Clipper.prototype.BuildResult2=function(e){var t=this;e.Clear();for(var i=0,r=this.m_PolyOuts.length;i<r;i++){var n=t.m_PolyOuts[i],o=t.PointCount(n.Pts);if(!(n.IsOpen&&o<2||!n.IsOpen&&o<3)){t.FixHoleLinkage(n);var s=new p.PolyNode;e.m_AllPolys.push(s),n.PolyNode=s,s.m_polygon.length=o;for(var a=n.Pts.Prev,h=0;h<o;h++)s.m_polygon[h]=a.Pt,a=a.Prev}}for(var i=0,r=this.m_PolyOuts.length;i<r;i++){var n=t.m_PolyOuts[i];n.PolyNode!==null&&(n.IsOpen?(n.PolyNode.IsOpen=!0,e.AddChild(n.PolyNode)):n.FirstLeft!==null&&n.FirstLeft.PolyNode!==null?n.FirstLeft.PolyNode.AddChild(n.PolyNode):e.AddChild(n.PolyNode))}},p.Clipper.prototype.FixupOutPolyline=function(e){for(var t=e.Pts,i=t.Prev;t!==i;)if(t=t.Next,p.FPoint.op_Equality(t.Pt,t.Prev.Pt)){t===i&&(i=t.Prev);var r=t.Prev;r.Next=t.Next,t.Next.Prev=r,t=r}t===t.Prev&&(e.Pts=null)},p.Clipper.prototype.FixupOutPolygon=function(e){var t=this,i=null;e.BottomPt=null;for(var r=e.Pts,n=this.PreserveCollinear||this.StrictlySimple;;){if(r.Prev===r||r.Prev===r.Next){e.Pts=null;return}if(p.FPoint.op_Equality(r.Pt,r.Next.Pt)||p.FPoint.op_Equality(r.Pt,r.Prev.Pt)||p.ClipperBase.SlopesEqual4(r.Prev.Pt,r.Pt,r.Next.Pt)&&(!n||!t.Pt2IsBetweenPt1AndPt3(r.Prev.Pt,r.Pt,r.Next.Pt)))i=null,r.Prev.Next=r.Next,r.Next.Prev=r.Prev,r=r.Prev;else{if(r===i)break;i===null&&(i=r),r=r.Next}}e.Pts=r},p.Clipper.prototype.DupOutPt=function(e,t){var i=new p.OutPt;return i.Pt.X=e.Pt.X,i.Pt.Y=e.Pt.Y,p.use_xyz&&(i.Pt.Z=e.Pt.Z),i.Idx=e.Idx,t?(i.Next=e.Next,i.Prev=e,e.Next.Prev=i,e.Next=i):(i.Prev=e.Prev,i.Next=e,e.Prev.Next=i,e.Prev=i),i},p.Clipper.prototype.GetOverlap=function(e,t,i,r,n){return e<t?i<r?(n.Left=Math.max(e,i),n.Right=Math.min(t,r)):(n.Left=Math.max(e,r),n.Right=Math.min(t,i)):i<r?(n.Left=Math.max(t,i),n.Right=Math.min(e,r)):(n.Left=Math.max(t,r),n.Right=Math.min(e,i)),n.Left<n.Right},p.Clipper.prototype.JoinHorz=function(e,t,i,r,n,o){var s=e.Pt.X>t.Pt.X?p.Direction.dRightToLeft:p.Direction.dLeftToRight,a=i.Pt.X>r.Pt.X?p.Direction.dRightToLeft:p.Direction.dLeftToRight;if(s===a)return!1;if(s===p.Direction.dLeftToRight){for(;e.Next.Pt.X<=n.X&&e.Next.Pt.X>=e.Pt.X&&e.Next.Pt.Y===n.Y;)e=e.Next;o&&e.Pt.X!==n.X&&(e=e.Next),t=this.DupOutPt(e,!o),p.FPoint.op_Inequality(t.Pt,n)&&(e=t,e.Pt.X=n.X,e.Pt.Y=n.Y,p.use_xyz&&(e.Pt.Z=n.Z),t=this.DupOutPt(e,!o))}else{for(;e.Next.Pt.X>=n.X&&e.Next.Pt.X<=e.Pt.X&&e.Next.Pt.Y===n.Y;)e=e.Next;!o&&e.Pt.X!==n.X&&(e=e.Next),t=this.DupOutPt(e,o),p.FPoint.op_Inequality(t.Pt,n)&&(e=t,e.Pt.X=n.X,e.Pt.Y=n.Y,p.use_xyz&&(e.Pt.Z=n.Z),t=this.DupOutPt(e,o))}if(a===p.Direction.dLeftToRight){for(;i.Next.Pt.X<=n.X&&i.Next.Pt.X>=i.Pt.X&&i.Next.Pt.Y===n.Y;)i=i.Next;o&&i.Pt.X!==n.X&&(i=i.Next),r=this.DupOutPt(i,!o),p.FPoint.op_Inequality(r.Pt,n)&&(i=r,i.Pt.X=n.X,i.Pt.Y=n.Y,p.use_xyz&&(i.Pt.Z=n.Z),r=this.DupOutPt(i,!o))}else{for(;i.Next.Pt.X>=n.X&&i.Next.Pt.X<=i.Pt.X&&i.Next.Pt.Y===n.Y;)i=i.Next;!o&&i.Pt.X!==n.X&&(i=i.Next),r=this.DupOutPt(i,o),p.FPoint.op_Inequality(r.Pt,n)&&(i=r,i.Pt.X=n.X,i.Pt.Y=n.Y,p.use_xyz&&(i.Pt.Z=n.Z),r=this.DupOutPt(i,o))}return s===p.Direction.dLeftToRight===o?(e.Prev=i,i.Next=e,t.Next=r,r.Prev=t):(e.Next=i,i.Prev=e,t.Prev=r,r.Next=t),!0},p.Clipper.prototype.JoinPoints=function(e,t,i){var r=e.OutPt1,n=new p.OutPt,o=e.OutPt2,s=new p.OutPt,a=e.OutPt1.Pt.Y===e.OffPt.Y;if(a&&p.FPoint.op_Equality(e.OffPt,e.OutPt1.Pt)&&p.FPoint.op_Equality(e.OffPt,e.OutPt2.Pt)){if(t!==i)return!1;for(n=e.OutPt1.Next;n!==r&&p.FPoint.op_Equality(n.Pt,e.OffPt);)n=n.Next;var h=n.Pt.Y>e.OffPt.Y;for(s=e.OutPt2.Next;s!==o&&p.FPoint.op_Equality(s.Pt,e.OffPt);)s=s.Next;var l=s.Pt.Y>e.OffPt.Y;return h===l?!1:h?(n=this.DupOutPt(r,!1),s=this.DupOutPt(o,!0),r.Prev=o,o.Next=r,n.Next=s,s.Prev=n,e.OutPt1=r,e.OutPt2=n,!0):(n=this.DupOutPt(r,!0),s=this.DupOutPt(o,!1),r.Next=o,o.Prev=r,n.Prev=s,s.Next=n,e.OutPt1=r,e.OutPt2=n,!0)}else if(a){for(n=r;r.Prev.Pt.Y===r.Pt.Y&&r.Prev!==n&&r.Prev!==o;)r=r.Prev;for(;n.Next.Pt.Y===n.Pt.Y&&n.Next!==r&&n.Next!==o;)n=n.Next;if(n.Next===r||n.Next===o)return!1;for(s=o;o.Prev.Pt.Y===o.Pt.Y&&o.Prev!==s&&o.Prev!==n;)o=o.Prev;for(;s.Next.Pt.Y===s.Pt.Y&&s.Next!==o&&s.Next!==r;)s=s.Next;if(s.Next===o||s.Next===r)return!1;var u={Left:null,Right:null};if(!this.GetOverlap(r.Pt.X,n.Pt.X,o.Pt.X,s.Pt.X,u))return!1;var c=u.Left,d=u.Right,f=new p.FPoint0,m;return r.Pt.X>=c&&r.Pt.X<=d?(f.X=r.Pt.X,f.Y=r.Pt.Y,p.use_xyz&&(f.Z=r.Pt.Z),m=r.Pt.X>n.Pt.X):o.Pt.X>=c&&o.Pt.X<=d?(f.X=o.Pt.X,f.Y=o.Pt.Y,p.use_xyz&&(f.Z=o.Pt.Z),m=o.Pt.X>s.Pt.X):n.Pt.X>=c&&n.Pt.X<=d?(f.X=n.Pt.X,f.Y=n.Pt.Y,p.use_xyz&&(f.Z=n.Pt.Z),m=n.Pt.X>r.Pt.X):(f.X=s.Pt.X,f.Y=s.Pt.Y,p.use_xyz&&(f.Z=s.Pt.Z),m=s.Pt.X>o.Pt.X),e.OutPt1=r,e.OutPt2=o,this.JoinHorz(r,n,o,s,f,m)}else{for(n=r.Next;p.FPoint.op_Equality(n.Pt,r.Pt)&&n!==r;)n=n.Next;var v=n.Pt.Y>r.Pt.Y||!p.ClipperBase.SlopesEqual4(r.Pt,n.Pt,e.OffPt);if(v){for(n=r.Prev;p.FPoint.op_Equality(n.Pt,r.Pt)&&n!==r;)n=n.Prev;if(n.Pt.Y>r.Pt.Y||!p.ClipperBase.SlopesEqual4(r.Pt,n.Pt,e.OffPt))return!1}for(s=o.Next;p.FPoint.op_Equality(s.Pt,o.Pt)&&s!==o;)s=s.Next;var y=s.Pt.Y>o.Pt.Y||!p.ClipperBase.SlopesEqual4(o.Pt,s.Pt,e.OffPt);if(y){for(s=o.Prev;p.FPoint.op_Equality(s.Pt,o.Pt)&&s!==o;)s=s.Prev;if(s.Pt.Y>o.Pt.Y||!p.ClipperBase.SlopesEqual4(o.Pt,s.Pt,e.OffPt))return!1}return n===r||s===o||n===s||t===i&&v===y?!1:v?(n=this.DupOutPt(r,!1),s=this.DupOutPt(o,!0),r.Prev=o,o.Next=r,n.Next=s,s.Prev=n,e.OutPt1=r,e.OutPt2=n,!0):(n=this.DupOutPt(r,!0),s=this.DupOutPt(o,!1),r.Next=o,o.Prev=r,n.Prev=s,s.Next=n,e.OutPt1=r,e.OutPt2=n,!0)}},p.Clipper.GetBounds=function(e){for(var t=0,i=e.length;t<i&&e[t].length===0;)t++;if(t===i)return new p.FRect(0,0,0,0);var r=new p.FRect;for(r.left=e[t][0].X,r.right=r.left,r.top=e[t][0].Y,r.bottom=r.top;t<i;t++)for(var n=0,o=e[t].length;n<o;n++)e[t][n].X<r.left?r.left=e[t][n].X:e[t][n].X>r.right&&(r.right=e[t][n].X),e[t][n].Y<r.top?r.top=e[t][n].Y:e[t][n].Y>r.bottom&&(r.bottom=e[t][n].Y);return r},p.Clipper.prototype.GetBounds2=function(e){var t=e,i=new p.FRect;for(i.left=e.Pt.X,i.right=e.Pt.X,i.top=e.Pt.Y,i.bottom=e.Pt.Y,e=e.Next;e!==t;)e.Pt.X<i.left&&(i.left=e.Pt.X),e.Pt.X>i.right&&(i.right=e.Pt.X),e.Pt.Y<i.top&&(i.top=e.Pt.Y),e.Pt.Y>i.bottom&&(i.bottom=e.Pt.Y),e=e.Next;return i},p.Clipper.PointInPolygon=function(e,t){var i=0,r=t.length;if(r<3)return 0;for(var n=t[0],o=1;o<=r;++o){var s=o===r?t[0]:t[o];if(s.Y===e.Y&&(s.X===e.X||n.Y===e.Y&&s.X>e.X==n.X<e.X))return-1;if(n.Y<e.Y!=s.Y<e.Y){if(n.X>=e.X)if(s.X>e.X)i=1-i;else{var a=(n.X-e.X)*(s.Y-e.Y)-(s.X-e.X)*(n.Y-e.Y);if(a===0)return-1;a>0==s.Y>n.Y&&(i=1-i)}else if(s.X>e.X){var a=(n.X-e.X)*(s.Y-e.Y)-(s.X-e.X)*(n.Y-e.Y);if(a===0)return-1;a>0==s.Y>n.Y&&(i=1-i)}}n=s}return i},p.Clipper.prototype.PointInPolygon=function(e,t){var i=0,r=t,n=e.X,o=e.Y,s=t.Pt.X,a=t.Pt.Y;do{t=t.Next;var h=t.Pt.X,l=t.Pt.Y;if(l===o&&(h===n||a===o&&h>n==s<n))return-1;if(a<o!=l<o){if(s>=n)if(h>n)i=1-i;else{var u=(s-n)*(l-o)-(h-n)*(a-o);if(u===0)return-1;u>0==l>a&&(i=1-i)}else if(h>n){var u=(s-n)*(l-o)-(h-n)*(a-o);if(u===0)return-1;u>0==l>a&&(i=1-i)}}s=h,a=l}while(r!==t);return i},p.Clipper.prototype.Poly2ContainsPoly1=function(e,t){var i=this,r=e;do{var n=i.PointInPolygon(r.Pt,t);if(n>=0)return n>0;r=r.Next}while(r!==e);return!0},p.Clipper.prototype.FixupFirstLefts1=function(e,t){for(var i=this,r,n,o=0,s=this.m_PolyOuts.length;o<s;o++)r=i.m_PolyOuts[o],n=p.Clipper.ParseFirstLeft(r.FirstLeft),r.Pts!==null&&n===e&&i.Poly2ContainsPoly1(r.Pts,t.Pts)&&(r.FirstLeft=t)},p.Clipper.prototype.FixupFirstLefts2=function(e,t){for(var i=this,r=t.FirstLeft,n,o,s=0,a=this.m_PolyOuts.length;s<a;s++)n=i.m_PolyOuts[s],!(n.Pts===null||n===t||n===e)&&(o=p.Clipper.ParseFirstLeft(n.FirstLeft),!(o!==r&&o!==e&&o!==t)&&(i.Poly2ContainsPoly1(n.Pts,e.Pts)?n.FirstLeft=e:i.Poly2ContainsPoly1(n.Pts,t.Pts)?n.FirstLeft=t:(n.FirstLeft===e||n.FirstLeft===t)&&(n.FirstLeft=r)))},p.Clipper.prototype.FixupFirstLefts3=function(e,t){for(var i=this,r,n,o=0,s=this.m_PolyOuts.length;o<s;o++)r=i.m_PolyOuts[o],n=p.Clipper.ParseFirstLeft(r.FirstLeft),r.Pts!==null&&n===e&&(r.FirstLeft=t)},p.Clipper.ParseFirstLeft=function(e){for(;e!==null&&e.Pts===null;)e=e.FirstLeft;return e},p.Clipper.prototype.JoinCommonEdges=function(){for(var e=this,t=0,i=this.m_Joins.length;t<i;t++){var r=e.m_Joins[t],n=e.GetOutRec(r.OutPt1.Idx),o=e.GetOutRec(r.OutPt2.Idx);if(!(n.Pts===null||o.Pts===null)&&!(n.IsOpen||o.IsOpen)){var s;n===o?s=n:e.OutRec1RightOfOutRec2(n,o)?s=o:e.OutRec1RightOfOutRec2(o,n)?s=n:s=e.GetLowermostRec(n,o),e.JoinPoints(r,n,o)&&(n===o?(n.Pts=r.OutPt1,n.BottomPt=null,o=e.CreateOutRec(),o.Pts=r.OutPt2,e.UpdateOutPtIdxs(o),e.Poly2ContainsPoly1(o.Pts,n.Pts)?(o.IsHole=!n.IsHole,o.FirstLeft=n,e.m_UsingPolyTree&&e.FixupFirstLefts2(o,n),(o.IsHole^e.ReverseSolution)==e.Area$1(o)>0&&e.ReversePolyPtLinks(o.Pts)):e.Poly2ContainsPoly1(n.Pts,o.Pts)?(o.IsHole=n.IsHole,n.IsHole=!o.IsHole,o.FirstLeft=n.FirstLeft,n.FirstLeft=o,e.m_UsingPolyTree&&e.FixupFirstLefts2(n,o),(n.IsHole^e.ReverseSolution)==e.Area$1(n)>0&&e.ReversePolyPtLinks(n.Pts)):(o.IsHole=n.IsHole,o.FirstLeft=n.FirstLeft,e.m_UsingPolyTree&&e.FixupFirstLefts1(n,o))):(o.Pts=null,o.BottomPt=null,o.Idx=n.Idx,n.IsHole=s.IsHole,s===o&&(n.FirstLeft=o.FirstLeft),o.FirstLeft=n,e.m_UsingPolyTree&&e.FixupFirstLefts3(o,n)))}}},p.Clipper.prototype.UpdateOutPtIdxs=function(e){var t=e.Pts;do t.Idx=e.Idx,t=t.Prev;while(t!==e.Pts)},p.Clipper.prototype.DoSimplePolygons=function(){for(var e=this,t=0;t<this.m_PolyOuts.length;){var i=e.m_PolyOuts[t++],r=i.Pts;if(!(r===null||i.IsOpen))do{for(var n=r.Next;n!==i.Pts;){if(p.FPoint.op_Equality(r.Pt,n.Pt)&&n.Next!==r&&n.Prev!==r){var o=r.Prev,s=n.Prev;r.Prev=s,s.Next=r,n.Prev=o,o.Next=n,i.Pts=r;var a=e.CreateOutRec();a.Pts=n,e.UpdateOutPtIdxs(a),e.Poly2ContainsPoly1(a.Pts,i.Pts)?(a.IsHole=!i.IsHole,a.FirstLeft=i,e.m_UsingPolyTree&&e.FixupFirstLefts2(a,i)):e.Poly2ContainsPoly1(i.Pts,a.Pts)?(a.IsHole=i.IsHole,i.IsHole=!a.IsHole,a.FirstLeft=i.FirstLeft,i.FirstLeft=a,e.m_UsingPolyTree&&e.FixupFirstLefts2(i,a)):(a.IsHole=i.IsHole,a.FirstLeft=i.FirstLeft,e.m_UsingPolyTree&&e.FixupFirstLefts1(i,a)),n=r}n=n.Next}r=r.Next}while(r!==i.Pts)}},p.Clipper.Area=function(e){if(!Array.isArray(e))return 0;var t=e.length;if(t<3)return 0;for(var i=0,r=0,n=t-1;r<t;++r)i+=(e[n].X+e[r].X)*(e[n].Y-e[r].Y),n=r;return-i*.5},p.Clipper.prototype.Area=function(e){var t=e;if(e===null)return 0;var i=0;do i=i+(e.Prev.Pt.X+e.Pt.X)*(e.Prev.Pt.Y-e.Pt.Y),e=e.Next;while(e!==t);return i*.5},p.Clipper.prototype.Area$1=function(e){return this.Area(e.Pts)},p.Clipper.SimplifyPolygon=function(e,t){var i=new Array,r=new p.Clipper(0);return r.StrictlySimple=!0,r.AddPath(e,p.PolyType.ptSubject,!0),r.Execute(p.ClipType.ctUnion,i,t,t),i},p.Clipper.SimplifyPolygons=function(e,t){typeof t>"u"&&(t=p.PolyFillType.pftEvenOdd);var i=new Array,r=new p.Clipper(0);return r.StrictlySimple=!0,r.AddPaths(e,p.PolyType.ptSubject,!0),r.Execute(p.ClipType.ctUnion,i,t,t),i},p.Clipper.DistanceSqrd=function(e,t){var i=e.X-t.X,r=e.Y-t.Y;return i*i+r*r},p.Clipper.DistanceFromLineSqrd=function(e,t,i){var r=t.Y-i.Y,n=i.X-t.X,o=r*t.X+n*t.Y;return o=r*e.X+n*e.Y-o,o*o/(r*r+n*n)},p.Clipper.SlopesNearCollinear=function(e,t,i,r){return Math.abs(e.X-t.X)>Math.abs(e.Y-t.Y)?e.X>t.X==e.X<i.X?p.Clipper.DistanceFromLineSqrd(e,t,i)<r:t.X>e.X==t.X<i.X?p.Clipper.DistanceFromLineSqrd(t,e,i)<r:p.Clipper.DistanceFromLineSqrd(i,e,t)<r:e.Y>t.Y==e.Y<i.Y?p.Clipper.DistanceFromLineSqrd(e,t,i)<r:t.Y>e.Y==t.Y<i.Y?p.Clipper.DistanceFromLineSqrd(t,e,i)<r:p.Clipper.DistanceFromLineSqrd(i,e,t)<r},p.Clipper.PointsAreClose=function(e,t,i){var r=e.X-t.X,n=e.Y-t.Y;return r*r+n*n<=i},p.Clipper.ExcludeOp=function(e){var t=e.Prev;return t.Next=e.Next,e.Next.Prev=t,t.Idx=0,t},p.Clipper.CleanPolygon=function(e,t){typeof t>"u"&&(t=1.415);var i=e.length;if(i===0)return new Array;for(var r=new Array(i),n=0;n<i;++n)r[n]=new p.OutPt;for(var n=0;n<i;++n)r[n].Pt=e[n],r[n].Next=r[(n+1)%i],r[n].Next.Prev=r[n],r[n].Idx=0;for(var o=t*t,s=r[0];s.Idx===0&&s.Next!==s.Prev;)p.Clipper.PointsAreClose(s.Pt,s.Prev.Pt,o)?(s=p.Clipper.ExcludeOp(s),i--):p.Clipper.PointsAreClose(s.Prev.Pt,s.Next.Pt,o)?(p.Clipper.ExcludeOp(s.Next),s=p.Clipper.ExcludeOp(s),i-=2):p.Clipper.SlopesNearCollinear(s.Prev.Pt,s.Pt,s.Next.Pt,o)?(s=p.Clipper.ExcludeOp(s),i--):(s.Idx=1,s=s.Next);i<3&&(i=0);for(var a=new Array(i),n=0;n<i;++n)a[n]=new p.FPoint1(s.Pt),s=s.Next;return r=null,a},p.Clipper.CleanPolygons=function(e,t){for(var i=new Array(e.length),r=0,n=e.length;r<n;r++)i[r]=p.Clipper.CleanPolygon(e[r],t);return i},p.Clipper.Minkowski=function(e,t,i,r){var n=r?1:0,o=e.length,s=t.length,a=new Array;if(i)for(var h=0;h<s;h++){for(var l=new Array(o),u=0,c=e.length,d=e[u];u<c;u++,d=e[u])l[u]=new p.FPoint2(t[h].X+d.X,t[h].Y+d.Y);a.push(l)}else for(var h=0;h<s;h++){for(var l=new Array(o),u=0,c=e.length,d=e[u];u<c;u++,d=e[u])l[u]=new p.FPoint2(t[h].X-d.X,t[h].Y-d.Y);a.push(l)}for(var f=new Array,h=0;h<s-1+n;h++)for(var u=0;u<o;u++){var m=new Array;m.push(a[h%s][u%o]),m.push(a[(h+1)%s][u%o]),m.push(a[(h+1)%s][(u+1)%o]),m.push(a[h%s][(u+1)%o]),p.Clipper.Orientation(m)||m.reverse(),f.push(m)}return f},p.Clipper.MinkowskiSum=function(e,t,i){if(t[0]instanceof Array){for(var r=t,n=new p.Paths,o=new p.Clipper,s=0;s<r.length;++s){var a=p.Clipper.Minkowski(e,r[s],!0,i);if(o.AddPaths(a,p.PolyType.ptSubject,!0),i){var h=p.Clipper.TranslatePath(r[s],e[0]);o.AddPath(h,p.PolyType.ptClip,!0)}}return o.Execute(p.ClipType.ctUnion,n,p.PolyFillType.pftNonZero,p.PolyFillType.pftNonZero),n}else{var h=t,r=p.Clipper.Minkowski(e,h,!0,i),o=new p.Clipper;return o.AddPaths(r,p.PolyType.ptSubject,!0),o.Execute(p.ClipType.ctUnion,r,p.PolyFillType.pftNonZero,p.PolyFillType.pftNonZero),r}},p.Clipper.TranslatePath=function(e,t){for(var i=new p.Path,r=0;r<e.length;r++)i.push(new p.FPoint2(e[r].X+t.X,e[r].Y+t.Y));return i},p.Clipper.MinkowskiDiff=function(e,t){var i=p.Clipper.Minkowski(e,t,!1,!0),r=new p.Clipper;return r.AddPaths(i,p.PolyType.ptSubject,!0),r.Execute(p.ClipType.ctUnion,i,p.PolyFillType.pftNonZero,p.PolyFillType.pftNonZero),i},p.Clipper.PolyTreeToPaths=function(e){var t=new Array;return p.Clipper.AddPolyNodeToPaths(e,p.Clipper.NodeType.ntAny,t),t},p.Clipper.AddPolyNodeToPaths=function(e,t,i){var r=!0;switch(t){case p.Clipper.NodeType.ntOpen:return;case p.Clipper.NodeType.ntClosed:r=!e.IsOpen;break}e.m_polygon.length>0&&r&&i.push(e.m_polygon);for(var n=0,o=e.Childs(),s=o.length,a=o[n];n<s;n++,a=o[n])p.Clipper.AddPolyNodeToPaths(a,t,i)},p.Clipper.OpenPathsFromPolyTree=function(e){for(var t=new p.Paths,i=0,r=e.ChildCount();i<r;i++)e.Childs()[i].IsOpen&&t.push(e.Childs()[i].m_polygon);return t},p.Clipper.ClosedPathsFromPolyTree=function(e){var t=new p.Paths;return p.Clipper.AddPolyNodeToPaths(e,p.Clipper.NodeType.ntClosed,t),t},ga(p.Clipper,p.ClipperBase),p.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2},p.ClipperOffset=function(e,t){typeof e>"u"&&(e=2),typeof t>"u"&&(t=p.ClipperOffset.def_arc_tolerance),this.m_destPolys=new p.Paths,this.m_srcPoly=new p.Path,this.m_destPoly=new p.Path,this.m_normals=new Array,this.m_delta=0,this.m_sinA=0,this.m_sin=0,this.m_cos=0,this.m_miterLim=0,this.m_StepsPerRad=0,this.m_lowest=new p.FPoint0,this.m_polyNodes=new p.PolyNode,this.MiterLimit=e,this.ArcTolerance=t,this.m_lowest.X=-1},p.ClipperOffset.two_pi=6.28318530717959,p.ClipperOffset.def_arc_tolerance=.25,p.ClipperOffset.prototype.Clear=function(){p.Clear(this.m_polyNodes.Childs()),this.m_lowest.X=-1},p.ClipperOffset.prototype.AddPath=function(e,t,i){var r=e.length-1;if(!(r<0)){var n=new p.PolyNode;if(n.m_jointype=t,n.m_endtype=i,i===p.EndType.etClosedLine||i===p.EndType.etClosedPolygon)for(;r>0&&p.FPoint.op_Equality(e[0],e[r]);)r--;n.m_polygon.push(e[0]);for(var o=0,s=0,a=1;a<=r;a++)p.FPoint.op_Inequality(n.m_polygon[o],e[a])&&(o++,n.m_polygon.push(e[a]),(e[a].Y>n.m_polygon[s].Y||e[a].Y===n.m_polygon[s].Y&&e[a].X<n.m_polygon[s].X)&&(s=o));if(!(i===p.EndType.etClosedPolygon&&o<2)&&(this.m_polyNodes.AddChild(n),i===p.EndType.etClosedPolygon))if(this.m_lowest.X<0)this.m_lowest=new p.FPoint2(this.m_polyNodes.ChildCount()-1,s);else{var h=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y];(n.m_polygon[s].Y>h.Y||n.m_polygon[s].Y===h.Y&&n.m_polygon[s].X<h.X)&&(this.m_lowest=new p.FPoint2(this.m_polyNodes.ChildCount()-1,s))}}},p.ClipperOffset.prototype.AddPaths=function(e,t,i){for(var r=this,n=0,o=e.length;n<o;n++)r.AddPath(e[n],t,i)},p.ClipperOffset.prototype.FixOrientations=function(){var e=this;if(this.m_lowest.X>=0&&!p.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var t=0;t<this.m_polyNodes.ChildCount();t++){var i=e.m_polyNodes.Childs()[t];(i.m_endtype===p.EndType.etClosedPolygon||i.m_endtype===p.EndType.etClosedLine&&p.Clipper.Orientation(i.m_polygon))&&i.m_polygon.reverse()}else for(var t=0;t<this.m_polyNodes.ChildCount();t++){var i=e.m_polyNodes.Childs()[t];i.m_endtype===p.EndType.etClosedLine&&!p.Clipper.Orientation(i.m_polygon)&&i.m_polygon.reverse()}},p.ClipperOffset.GetUnitNormal=function(e,t){var i=t.X-e.X,r=t.Y-e.Y;if(i===0&&r===0)return new p.FPoint2(0,0);var n=1/Math.sqrt(i*i+r*r);return i*=n,r*=n,new p.FPoint2(r,-i)},p.ClipperOffset.prototype.DoOffset=function(e){var t=this;if(this.m_destPolys=new Array,this.m_delta=e,p.ClipperBase.near_zero(e)){for(var i=0;i<this.m_polyNodes.ChildCount();i++){var r=t.m_polyNodes.Childs()[i];r.m_endtype===p.EndType.etClosedPolygon&&t.m_destPolys.push(r.m_polygon)}return}this.MiterLimit>2?this.m_miterLim=2/(this.MiterLimit*this.MiterLimit):this.m_miterLim=.5;var n;this.ArcTolerance<=0?n=p.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(e)*p.ClipperOffset.def_arc_tolerance?n=Math.abs(e)*p.ClipperOffset.def_arc_tolerance:n=this.ArcTolerance;var o=3.14159265358979/Math.acos(1-n/Math.abs(e));this.m_sin=Math.sin(p.ClipperOffset.two_pi/o),this.m_cos=Math.cos(p.ClipperOffset.two_pi/o),this.m_StepsPerRad=o/p.ClipperOffset.two_pi,e<0&&(this.m_sin=-this.m_sin);for(var i=0;i<this.m_polyNodes.ChildCount();i++){var r=t.m_polyNodes.Childs()[i];t.m_srcPoly=r.m_polygon;var s=t.m_srcPoly.length;if(!(s===0||e<=0&&(s<3||r.m_endtype!==p.EndType.etClosedPolygon))){if(t.m_destPoly=new Array,s===1){if(r.m_jointype===p.JoinType.jtRound)for(var a=1,h=0,l=1;l<=o;l++){t.m_destPoly.push(new p.FPoint2(t.m_srcPoly[0].X+a*e,t.m_srcPoly[0].Y+h*e));var u=a;a=a*t.m_cos-t.m_sin*h,h=u*t.m_sin+h*t.m_cos}else for(var a=-1,h=-1,l=0;l<4;++l)t.m_destPoly.push(new p.FPoint2(t.m_srcPoly[0].X+a*e,t.m_srcPoly[0].Y+h*e)),a<0?a=1:h<0?h=1:a=-1;t.m_destPolys.push(t.m_destPoly);continue}t.m_normals.length=0;for(var l=0;l<s-1;l++)t.m_normals.push(p.ClipperOffset.GetUnitNormal(t.m_srcPoly[l],t.m_srcPoly[l+1]));if(r.m_endtype===p.EndType.etClosedLine||r.m_endtype===p.EndType.etClosedPolygon?t.m_normals.push(p.ClipperOffset.GetUnitNormal(t.m_srcPoly[s-1],t.m_srcPoly[0])):t.m_normals.push(new p.FPoint1(t.m_normals[s-2])),r.m_endtype===p.EndType.etClosedPolygon){for(var c=s-1,l=0;l<s;l++)c=t.OffsetPoint(l,c,r.m_jointype);t.m_destPolys.push(t.m_destPoly)}else if(r.m_endtype===p.EndType.etClosedLine){for(var c=s-1,l=0;l<s;l++)c=t.OffsetPoint(l,c,r.m_jointype);t.m_destPolys.push(t.m_destPoly),t.m_destPoly=new Array;for(var d=t.m_normals[s-1],l=s-1;l>0;l--)t.m_normals[l]=new p.FPoint2(-t.m_normals[l-1].X,-t.m_normals[l-1].Y);t.m_normals[0]=new p.FPoint2(-d.X,-d.Y),c=0;for(var l=s-1;l>=0;l--)c=t.OffsetPoint(l,c,r.m_jointype);t.m_destPolys.push(t.m_destPoly)}else{for(var c=0,l=1;l<s-1;++l)c=t.OffsetPoint(l,c,r.m_jointype);var f;if(r.m_endtype===p.EndType.etOpenButt){var l=s-1;f=new p.FPoint2(t.m_srcPoly[l].X+t.m_normals[l].X*e,t.m_srcPoly[l].Y+t.m_normals[l].Y*e),t.m_destPoly.push(f),f=new p.FPoint2(t.m_srcPoly[l].X-t.m_normals[l].X*e,t.m_srcPoly[l].Y-t.m_normals[l].Y*e),t.m_destPoly.push(f)}else{var l=s-1;c=s-2,t.m_sinA=0,t.m_normals[l]=new p.FPoint2(-t.m_normals[l].X,-t.m_normals[l].Y),r.m_endtype===p.EndType.etOpenSquare?t.DoSquare(l,c):t.DoRound(l,c)}for(var l=s-1;l>0;l--)t.m_normals[l]=new p.FPoint2(-t.m_normals[l-1].X,-t.m_normals[l-1].Y);t.m_normals[0]=new p.FPoint2(-t.m_normals[1].X,-t.m_normals[1].Y),c=s-1;for(var l=c-1;l>0;--l)c=t.OffsetPoint(l,c,r.m_jointype);r.m_endtype===p.EndType.etOpenButt?(f=new p.FPoint2(t.m_srcPoly[0].X-t.m_normals[0].X*e,t.m_srcPoly[0].Y-t.m_normals[0].Y*e),t.m_destPoly.push(f),f=new p.FPoint2(t.m_srcPoly[0].X+t.m_normals[0].X*e,t.m_srcPoly[0].Y+t.m_normals[0].Y*e),t.m_destPoly.push(f)):(c=1,t.m_sinA=0,r.m_endtype===p.EndType.etOpenSquare?t.DoSquare(0,1):t.DoRound(0,1)),t.m_destPolys.push(t.m_destPoly)}}}},p.ClipperOffset.prototype.Execute=function(){var e=arguments,t=e[0]instanceof p.PolyTree;if(t){var i=e[0],r=e[1];i.Clear(),this.FixOrientations(),this.DoOffset(r);var n=new p.Clipper(0);if(n.AddPaths(this.m_destPolys,p.PolyType.ptSubject,!0),r>0)n.Execute(p.ClipType.ctUnion,i,p.PolyFillType.pftPositive,p.PolyFillType.pftPositive);else{var o=p.Clipper.GetBounds(this.m_destPolys),s=new p.Path;if(s.push(new p.FPoint2(o.left-10,o.bottom+10)),s.push(new p.FPoint2(o.right+10,o.bottom+10)),s.push(new p.FPoint2(o.right+10,o.top-10)),s.push(new p.FPoint2(o.left-10,o.top-10)),n.AddPath(s,p.PolyType.ptSubject,!0),n.ReverseSolution=!0,n.Execute(p.ClipType.ctUnion,i,p.PolyFillType.pftNegative,p.PolyFillType.pftNegative),i.ChildCount()===1&&i.Childs()[0].ChildCount()>0){var a=i.Childs()[0];i.Childs()[0]=a.Childs()[0],i.Childs()[0].m_Parent=i;for(var h=1;h<a.ChildCount();h++)i.AddChild(a.Childs()[h])}else i.Clear()}}else{var i=e[0],r=e[1];p.Clear(i),this.FixOrientations(),this.DoOffset(r);var n=new p.Clipper(0);if(n.AddPaths(this.m_destPolys,p.PolyType.ptSubject,!0),r>0)n.Execute(p.ClipType.ctUnion,i,p.PolyFillType.pftPositive,p.PolyFillType.pftPositive);else{var o=p.Clipper.GetBounds(this.m_destPolys),s=new p.Path;s.push(new p.FPoint2(o.left-10,o.bottom+10)),s.push(new p.FPoint2(o.right+10,o.bottom+10)),s.push(new p.FPoint2(o.right+10,o.top-10)),s.push(new p.FPoint2(o.left-10,o.top-10)),n.AddPath(s,p.PolyType.ptSubject,!0),n.ReverseSolution=!0,n.Execute(p.ClipType.ctUnion,i,p.PolyFillType.pftNegative,p.PolyFillType.pftNegative),i.length>0&&i.splice(0,1)}}},p.ClipperOffset.prototype.OffsetPoint=function(e,t,i){if(this.m_sinA=this.m_normals[t].X*this.m_normals[e].Y-this.m_normals[e].X*this.m_normals[t].Y,this.m_sinA===0)return t;if(this.m_sinA>1?this.m_sinA=1:this.m_sinA<-1&&(this.m_sinA=-1),this.m_sinA*this.m_delta<0)this.m_destPoly.push(new p.FPoint2(this.m_srcPoly[e].X+this.m_normals[t].X*this.m_delta,this.m_srcPoly[e].Y+this.m_normals[t].Y*this.m_delta)),this.m_destPoly.push(new p.FPoint1(this.m_srcPoly[e])),this.m_destPoly.push(new p.FPoint2(this.m_srcPoly[e].X+this.m_normals[e].X*this.m_delta,this.m_srcPoly[e].Y+this.m_normals[e].Y*this.m_delta));else switch(i){case p.JoinType.jtMiter:var r=1+(this.m_normals[e].X*this.m_normals[t].X+this.m_normals[e].Y*this.m_normals[t].Y);r>=this.m_miterLim?this.DoMiter(e,t,r):this.DoSquare(e,t);break;case p.JoinType.jtSquare:this.DoSquare(e,t);break;case p.JoinType.jtRound:this.DoRound(e,t);break}return t=e,t},p.ClipperOffset.prototype.DoSquare=function(e,t){var i=Math.tan(Math.atan2(this.m_sinA,this.m_normals[t].X*this.m_normals[e].X+this.m_normals[t].Y*this.m_normals[e].Y)/4);this.m_destPoly.push(new p.FPoint2(this.m_srcPoly[e].X+this.m_delta*(this.m_normals[t].X-this.m_normals[t].Y*i),this.m_srcPoly[e].Y+this.m_delta*(this.m_normals[t].Y+this.m_normals[t].X*i))),this.m_destPoly.push(new p.FPoint2(this.m_srcPoly[e].X+this.m_delta*(this.m_normals[e].X+this.m_normals[e].Y*i),this.m_srcPoly[e].Y+this.m_delta*(this.m_normals[e].Y-this.m_normals[e].X*i)))},p.ClipperOffset.prototype.DoMiter=function(e,t,i){var r=this.m_delta/i;this.m_destPoly.push(new p.FPoint2(this.m_srcPoly[e].X+(this.m_normals[t].X+this.m_normals[e].X)*r,this.m_srcPoly[e].Y+(this.m_normals[t].Y+this.m_normals[e].Y)*r))},p.ClipperOffset.prototype.DoRound=function(e,t){for(var i=this,r=Math.atan2(this.m_sinA,this.m_normals[t].X*this.m_normals[e].X+this.m_normals[t].Y*this.m_normals[e].Y),n=Math.max(Math.round(this.m_StepsPerRad*Math.abs(r)),1),o=this.m_normals[t].X,s=this.m_normals[t].Y,a,h=0;h<n;++h)i.m_destPoly.push(new p.FPoint2(i.m_srcPoly[e].X+o*i.m_delta,i.m_srcPoly[e].Y+s*i.m_delta)),a=o,o=o*i.m_cos-i.m_sin*s,s=a*i.m_sin+s*i.m_cos;this.m_destPoly.push(new p.FPoint2(this.m_srcPoly[e].X+this.m_normals[e].X*this.m_delta,this.m_srcPoly[e].Y+this.m_normals[e].Y*this.m_delta))},p.Error=function(e){try{throw new Error(e)}catch(t){alert(t.message)}},p.JS={},p.JS.AreaOfPolygon=function(e){return p.Clipper.Area(e)},p.JS.AreaOfPolygons=function(e){for(var t=0,i=0;i<e.length;i++)t+=p.Clipper.Area(e[i]);return t},p.JS.BoundsOfPath=function(e){return p.JS.BoundsOfPaths([e])},p.JS.BoundsOfPaths=function(e){var t=p.Clipper.GetBounds(e);return t},p.JS.Clean=function(r,t){if(!(r instanceof Array))return[];var i=r[0]instanceof Array,r=p.JS.Clone(r);if(typeof t!="number"||t===null)return p.Error("Delta is not a number in Clean()."),r;if(r.length===0||r.length===1&&r[0].length===0||t<0)return r;i||(r=[r]);for(var n=r.length,o,s,a,h,l,u,c,d=[],f=0;f<n;f++)if(s=r[f],o=s.length,o!==0){if(o<3){a=s,d.push(a);continue}for(a=s,h=t*t,l=s[0],u=1,c=1;c<o;c++)(s[c].X-l.X)*(s[c].X-l.X)+(s[c].Y-l.Y)*(s[c].Y-l.Y)<=h||(a[u]=s[c],l=s[c],u++);l=s[u-1],(s[0].X-l.X)*(s[0].X-l.X)+(s[0].Y-l.Y)*(s[0].Y-l.Y)<=h&&u--,u<o&&a.splice(u,o-u),a.length&&d.push(a)}return!i&&d.length?d=d[0]:!i&&d.length===0?d=[]:i&&d.length===0&&(d=[[]]),d},p.JS.Clone=function(e){if(!(e instanceof Array))return[];if(e.length===0)return[];if(e.length===1&&e[0].length===0)return[[]];var t=e[0]instanceof Array;t||(e=[e]);var i=e.length,r,n,o,s,a=new Array(i);for(n=0;n<i;n++){for(r=e[n].length,s=new Array(r),o=0;o<r;o++)s[o]={X:e[n][o].X,Y:e[n][o].Y};a[n]=s}return t||(a=a[0]),a},p.JS.Lighten=function(e,t){if(!(e instanceof Array))return[];if(typeof t!="number"||t===null)return p.Error("Tolerance is not a number in Lighten()."),p.JS.Clone(e);if(e.length===0||e.length===1&&e[0].length===0||t<0)return p.JS.Clone(e);var i=e[0]instanceof Array;i||(e=[e]);var r,n,o,s,a,h,l,u,c,d,f,m,v,y,g,x,_,E=e.length,b=t*t,P=[];for(r=0;r<E;r++)if(o=e[r],h=o.length,h!==0){for(s=0;s<1e6;s++){for(a=[],h=o.length,o[h-1].X!==o[0].X||o[h-1].Y!==o[0].Y?(m=1,o.push({X:o[0].X,Y:o[0].Y}),h=o.length):m=0,f=[],n=0;n<h-2;n++)l=o[n],c=o[n+1],u=o[n+2],x=l.X,_=l.Y,v=u.X-x,y=u.Y-_,(v!==0||y!==0)&&(g=((c.X-x)*v+(c.Y-_)*y)/(v*v+y*y),g>1?(x=u.X,_=u.Y):g>0&&(x+=v*g,_+=y*g)),v=c.X-x,y=c.Y-_,d=v*v+y*y,d<=b&&(f[n+1]=1,n++);for(a.push({X:o[0].X,Y:o[0].Y}),n=1;n<h-1;n++)f[n]||a.push({X:o[n].X,Y:o[n].Y});if(a.push({X:o[h-1].X,Y:o[h-1].Y}),m&&o.pop(),f.length)o=a;else break}h=a.length,a[h-1].X===a[0].X&&a[h-1].Y===a[0].Y&&a.pop(),a.length>2&&P.push(a)}return i||(P=P[0]),typeof P>"u"&&(P=[]),P},p.JS.PerimeterOfPath=function(e,t){if(typeof e>"u")return 0;var i=Math.sqrt,r=0,n,o,s=0,a=0,h=0,l=0,u=e.length;if(u<2)return 0;for(t&&(e[u]=e[0],u++);--u;)n=e[u],s=n.X,a=n.Y,o=e[u-1],h=o.X,l=o.Y,r+=i((s-h)*(s-h)+(a-l)*(a-l));return t&&e.pop(),r},p.JS.PerimeterOfPaths=function(e,t){for(var i=0,r=0;r<e.length;r++)i+=p.JS.PerimeterOfPath(e[r],t);return i},p.ExPolygons=function(){return[]},p.ExPolygon=function(){this.outer=null,this.holes=null},p.JS.AddOuterPolyNodeToExPolygons=function(e,t){var i=new p.ExPolygon;i.outer=e.Contour();var r=e.Childs(),n=r.length;i.holes=new Array(n);var o,s,a,h,l,u;for(a=0;a<n;a++)for(o=r[a],i.holes[a]=o.Contour(),h=0,l=o.Childs(),u=l.length;h<u;h++)s=l[h],p.JS.AddOuterPolyNodeToExPolygons(s,t);t.push(i)},p.JS.ExPolygonsToPaths=function(e){var t,i,r,n,o=new p.Paths;for(t=0,r=e.length;t<r;t++)for(o.push(e[t].outer),i=0,n=e[t].holes.length;i<n;i++)o.push(e[t].holes[i]);return o},p.JS.PolyTreeToExPolygons=function(e){var t=new p.ExPolygons,i,r,n,o;for(r=0,n=e.Childs(),o=n.length;r<o;r++)i=n[r],p.JS.AddOuterPolyNodeToExPolygons(i,t);return t};var k=p,no={exports:{}};class cv{constructor(t=[],i=pv){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:r}=this,n=i[t];for(;t>0;){const o=t-1>>1,s=i[o];if(r(n,s)>=0)break;i[t]=s,t=o}i[t]=n}_down(t){const{data:i,compare:r}=this,n=this.length>>1,o=i[t];for(;t<n;){let s=(t<<1)+1,a=i[s];const h=s+1;if(h<this.length&&r(i[h],a)<0&&(s=h,a=i[h]),r(a,o)>=0)break;i[t]=a,t=s}i[t]=o}}function pv(e,t){return e<t?-1:e>t?1:0}var dv=Object.freeze({__proto__:null,default:cv}),fv=Zl(dv),tr=fv;tr.default&&(tr=tr.default),no.exports=_a,no.exports.default=_a;function _a(e,t,i){t=t||1;for(var r,n,o,s,a=0;a<e[0].length;a++){var h=e[0][a];(!a||h[0]<r)&&(r=h[0]),(!a||h[1]<n)&&(n=h[1]),(!a||h[0]>o)&&(o=h[0]),(!a||h[1]>s)&&(s=h[1])}var l=o-r,u=s-n,c=Math.min(l,u),d=c/2;if(c===0){var f=[r,n];return f.distance=0,f}for(var m=new tr(void 0,mv),v=r;v<o;v+=c)for(var y=n;y<s;y+=c)m.push(new te(v+d,y+d,d,e));var g=vv(e),x=new te(r+l/2,n+u/2,0,e);x.d>g.d&&(g=x);for(var _=m.length;m.length;){var E=m.pop();E.d>g.d&&(g=E,i&&console.log("found best %d after %d probes",Math.round(1e4*E.d)/1e4,_)),!(E.max-g.d<=t)&&(d=E.h/2,m.push(new te(E.x-d,E.y-d,d,e)),m.push(new te(E.x+d,E.y-d,d,e)),m.push(new te(E.x-d,E.y+d,d,e)),m.push(new te(E.x+d,E.y+d,d,e)),_+=4)}i&&(console.log("num probes: "+_),console.log("best distance: "+g.d));var b=[g.x,g.y];return b.distance=g.d,b}function mv(e,t){return t.max-e.max}function te(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=yv(e,t,r),this.max=this.d+this.h*Math.SQRT2}function yv(e,t,i){for(var r=!1,n=1/0,o=0;o<i.length;o++)for(var s=i[o],a=0,h=s.length,l=h-1;a<h;l=a++){var u=s[a],c=s[l];u[1]>t!=c[1]>t&&e<(c[0]-u[0])*(t-u[1])/(c[1]-u[1])+u[0]&&(r=!r),n=Math.min(n,gv(e,t,u,c))}return n===0?0:(r?1:-1)*Math.sqrt(n)}function vv(e){for(var t=0,i=0,r=0,n=e[0],o=0,s=n.length,a=s-1;o<s;a=o++){var h=n[o],l=n[a],u=h[0]*l[1]-l[0]*h[1];i+=(h[0]+l[0])*u,r+=(h[1]+l[1])*u,t+=u*3}return t===0?new te(n[0][0],n[0][1],0,e):new te(i/t,r/t,0,e)}function gv(e,t,i,r){var n=i[0],o=i[1],s=r[0]-n,a=r[1]-o;if(s!==0||a!==0){var h=((e-n)*s+(t-o)*a)/(s*s+a*a);h>1?(n=r[0],o=r[1]):h>0&&(n+=s*h,o+=a*h)}return s=e-n,a=t-o,s*s+a*a}var _v=1e-6,yt=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function kh(){var e=new yt(6);return yt!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e}function xv(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],h=t[5],l=Math.sin(i),u=Math.cos(i);return e[0]=r*u+o*l,e[1]=n*u+s*l,e[2]=r*-l+o*u,e[3]=n*-l+s*u,e[4]=a,e[5]=h,e}function bv(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],h=t[5],l=i[0],u=i[1];return e[0]=r,e[1]=n,e[2]=o,e[3]=s,e[4]=r*l+o*u+a,e[5]=n*l+s*u+h,e}function Pv(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e}function Ev(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function wv(){var e=new yt(9);return yt!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Uh(){var e=new yt(3);return yt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Tv(e){var t=e[0],i=e[1],r=e[2];return Math.hypot(t,i,r)}function xa(e,t,i){var r=new yt(3);return r[0]=e,r[1]=t,r[2]=i,r}function Iv(e,t){var i=t[0],r=t[1],n=t[2],o=i*i+r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function Cv(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function mn(e,t,i){var r=t[0],n=t[1],o=t[2],s=i[0],a=i[1],h=i[2];return e[0]=n*h-o*a,e[1]=o*s-r*h,e[2]=r*a-n*s,e}var Sv=Tv;(function(){var e=Uh();return function(t,i,r,n,o,s){var a,h;for(i||(i=3),r||(r=0),n?h=Math.min(n*i+r,t.length):h=t.length,a=r;a<h;a+=i)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}})();function Av(){var e=new yt(4);return yt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ov(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=i*i+r*r+n*n+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=i*s,e[1]=r*s,e[2]=n*s,e[3]=o*s,e}(function(){var e=Av();return function(t,i,r,n,o,s){var a,h;for(i||(i=4),r||(r=0),n?h=Math.min(n*i+r,t.length):h=t.length,a=r;a<h;a+=i)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}})();function ba(){var e=new yt(4);return yt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Lv(e,t,i){i=i*.5;var r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function yn(e,t,i,r){var n=t[0],o=t[1],s=t[2],a=t[3],h=i[0],l=i[1],u=i[2],c=i[3],d,f,m,v,y;return f=n*h+o*l+s*u+a*c,f<0&&(f=-f,h=-h,l=-l,u=-u,c=-c),1-f>_v?(d=Math.acos(f),m=Math.sin(d),v=Math.sin((1-r)*d)/m,y=Math.sin(r*d)/m):(v=1-r,y=r),e[0]=v*n+y*h,e[1]=v*o+y*l,e[2]=v*s+y*u,e[3]=v*a+y*c,e}function Nv(e,t){var i=t[0]+t[4]+t[8],r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);var o=(n+1)%3,s=(n+2)%3;r=Math.sqrt(t[n*3+n]-t[o*3+o]-t[s*3+s]+1),e[n]=.5*r,r=.5/r,e[3]=(t[o*3+s]-t[s*3+o])*r,e[o]=(t[o*3+n]+t[n*3+o])*r,e[s]=(t[s*3+n]+t[n*3+s])*r}return e}var Pa=Ov;(function(){var e=Uh(),t=xa(1,0,0),i=xa(0,1,0);return function(r,n,o){var s=Cv(n,o);return s<-.999999?(mn(e,t,n),Sv(e)<1e-6&&mn(e,i,n),Iv(e,e),Lv(r,e,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(mn(e,n,o),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+s,Pa(r,r))}})(),function(){var e=ba(),t=ba();return function(i,r,n,o,s,a){return yn(e,r,s,a),yn(t,n,o,a),yn(i,e,t,2*a*(1-a)),i}}(),function(){var e=wv();return function(t,i,r,n){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-i[0],e[5]=-i[1],e[8]=-i[2],Pa(t,Nv(t,e))}}();function _r(){var e=new yt(2);return yt!=Float32Array&&(e[0]=0,e[1]=0),e}function xr(e,t){var i=new yt(2);return i[0]=e,i[1]=t,i}function Rv(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Xh(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n+i[4],e[1]=i[1]*r+i[3]*n+i[5],e}(function(){var e=_r();return function(t,i,r,n,o,s){var a,h;for(i||(i=2),r||(r=0),n?h=Math.min(n*i+r,t.length):h=t.length,a=r;a<h;a+=i)e[0]=t[a],e[1]=t[a+1],o(e,e,s),t[a]=e[0],t[a+1]=e[1];return t}})();var Yh={exports:{}};function oo(){}oo.prototype={on:function(e,t,i){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:i}),this},once:function(e,t,i){var r=this;function n(){r.off(e,n),t.apply(i,arguments)}return n._=t,this.on(e,n,i)},emit:function(e){var t=[].slice.call(arguments,1),i=((this.e||(this.e={}))[e]||[]).slice(),r=0,n=i.length;for(r;r<n;r++)i[r].fn.apply(i[r].ctx,t);return this},off:function(e,t){var i=this.e||(this.e={}),r=i[e],n=[];if(r&&t)for(var o=0,s=r.length;o<s;o++)r[o].fn!==t&&r[o].fn._!==t&&n.push(r[o]);return n.length?i[e]=n:delete i[e],this}},Yh.exports=oo;var Lo=Yh.exports.TinyEmitter=oo,Gh={exports:{}};(function(e,t){var i=function(){var r={},n=Math.PI/180,o=180/Math.PI,s=6378137,a=20037508342789244e-9;function h(u){return Number(u)===u&&u%1!==0}function l(u){if(u=u||{},this.size=u.size||256,this.expansion=u.antimeridian===!0?2:1,!r[this.size]){var c=this.size,d=r[this.size]={};d.Bc=[],d.Cc=[],d.zc=[],d.Ac=[];for(var f=0;f<30;f++)d.Bc.push(c/360),d.Cc.push(c/(2*Math.PI)),d.zc.push(c/2),d.Ac.push(c),c*=2}this.Bc=r[this.size].Bc,this.Cc=r[this.size].Cc,this.zc=r[this.size].zc,this.Ac=r[this.size].Ac}return l.prototype.px=function(u,c){if(h(c)){var d=this.size*Math.pow(2,c),f=d/2,m=d/360,v=d/(2*Math.PI),y=d,g=Math.min(Math.max(Math.sin(n*u[1]),-.9999),.9999),x=f+u[0]*m,_=f+.5*Math.log((1+g)/(1-g))*-v;return x>y*this.expansion&&(x=y*this.expansion),_>y&&(_=y),[x,_]}else{var f=this.zc[c],g=Math.min(Math.max(Math.sin(n*u[1]),-.9999),.9999),x=Math.round(f+u[0]*this.Bc[c]),_=Math.round(f+.5*Math.log((1+g)/(1-g))*-this.Cc[c]);return x>this.Ac[c]*this.expansion&&(x=this.Ac[c]*this.expansion),_>this.Ac[c]&&(_=this.Ac[c]),[x,_]}},l.prototype.ll=function(u,c){if(h(c)){var d=this.size*Math.pow(2,c),f=d/360,m=d/(2*Math.PI),v=d/2,y=(u[1]-v)/-m,g=(u[0]-v)/f,x=o*(2*Math.atan(Math.exp(y))-.5*Math.PI);return[g,x]}else{var y=(u[1]-this.zc[c])/-this.Cc[c],g=(u[0]-this.zc[c])/this.Bc[c],x=o*(2*Math.atan(Math.exp(y))-.5*Math.PI);return[g,x]}},l.prototype.bbox=function(u,c,d,f,m){f&&(c=Math.pow(2,d)-1-c);var v=[u*this.size,(+c+1)*this.size],y=[(+u+1)*this.size,c*this.size],g=this.ll(v,d).concat(this.ll(y,d));return m==="900913"?this.convert(g,"900913"):g},l.prototype.xyz=function(u,c,d,f){f==="900913"&&(u=this.convert(u,"WGS84"));var m=[u[0],u[1]],v=[u[2],u[3]],y=this.px(m,c),g=this.px(v,c),x=[Math.floor(y[0]/this.size),Math.floor((g[0]-1)/this.size)],_=[Math.floor(g[1]/this.size),Math.floor((y[1]-1)/this.size)],E={minX:Math.min.apply(Math,x)<0?0:Math.min.apply(Math,x),minY:Math.min.apply(Math,_)<0?0:Math.min.apply(Math,_),maxX:Math.max.apply(Math,x),maxY:Math.max.apply(Math,_)};if(d){var b={minY:Math.pow(2,c)-1-E.maxY,maxY:Math.pow(2,c)-1-E.minY};E.minY=b.minY,E.maxY=b.maxY}return E},l.prototype.convert=function(u,c){return c==="900913"?this.forward(u.slice(0,2)).concat(this.forward(u.slice(2,4))):this.inverse(u.slice(0,2)).concat(this.inverse(u.slice(2,4)))},l.prototype.forward=function(u){var c=[s*u[0]*n,s*Math.log(Math.tan(Math.PI*.25+.5*u[1]*n))];return c[0]>a&&(c[0]=a),c[0]<-a&&(c[0]=-a),c[1]>a&&(c[1]=a),c[1]<-a&&(c[1]=-a),c},l.prototype.inverse=function(u){return[u[0]*o/s,(Math.PI*.5-2*Math.atan(Math.exp(-u[1]/s)))*o]},l}();e.exports=i})(Gh);var Mv=Gh.exports;function Hh(e,t){t||(t={x:0,z:0});const i=Fv(t,e);return Math.sqrt(i.x*i.x+i.z*i.z)}function Ea(e){const t=Hh(e);return{x:e.x/t,z:e.z/t}}function Dv(e,t){return e||(e={x:0,z:0}),Bv(Math.atan2(-t.z+e.z,t.x-e.x)*180/Math.PI,2)}function Fv(e,t){return{x:e.x-t.x,z:e.z-t.z}}function Bv(e,t=0){const i=Math.pow(10,t);return Math.round(e*i)/i}function Sr(e){const t=Mt(e),i=k.Clipper.GetBounds(t);return{x:i.left,x2:i.right,z:i.top,z2:i.bottom,length:i.right-i.left,width:i.bottom-i.top}}function Wh(e){if(Array.isArray(e)){if(!e.length||!e[0])throw new Error("Union failed, empty Array")}else throw new Error("Union failed, input not Array");const t=Mt(e),i=[t[0]],r=t.slice(1),n=new k.Clipper;n.AddPaths(i,k.PolyType.ptSubject,!0),n.AddPaths(r,k.PolyType.ptClip,!0);var o=new k.Paths;return n.Execute(k.ClipType.ctUnion,o,k.PolyFillType.pftNonZero,k.PolyFillType.pftNonZero),Oi(o)}var wa;(function(e){e[e.etOpenSquare=0]="etOpenSquare",e[e.etOpenRound=1]="etOpenRound",e[e.etOpenButt=2]="etOpenButt",e[e.etClosedLine=3]="etClosedLine",e[e.etClosedPolygon=4]="etClosedPolygon"})(wa||(wa={}));function Ar(e,t=.1,i,r){if(i===void 0&&(i=k.EndType.etClosedPolygon),e=r?e:zh(e),!e.length||!e[0].length)return[];t=t&&typeof t=="number"?t:.1;const n=Mt(e),o=new k.ClipperOffset(2),s=new k.Paths;return o.AddPaths(n,k.JoinType.jtMiter,i),o.Execute(s,t),Oi(s)}function kv(e,t,i,r){if(Array.isArray(e)){if(!e.length||!e[0])throw new Error("Difference failed, empty Array")}else throw new Error("Difference failed, input not Array");const n=Mt(e),o=Mt(i?Ar(t,i):t),s=new k.Clipper;s.AddPaths(n,k.PolyType.ptSubject,!r),s.AddPaths(o,k.PolyType.ptClip,!0);var a=r?new k.PolyTree:new k.Paths;s.Execute(k.ClipType.ctDifference,a,k.PolyFillType.pftNonZero,k.PolyFillType.pftNonZero);var h=r?k.Clipper.PolyTreeToPaths(a):a;return Oi(h)}function Uv(e=[],t=[],i=!1){if(Array.isArray(e)){if(!e.length||!e[0])throw new Error("Intersection failed, empty Array")}else throw new Error("Intersection failed, input not Array");const r=Mt(e),n=t.length&&Mt(t),o=n?r:[r[0]],s=n||r.slice(1),a=new k.Clipper;a.AddPaths(o,k.PolyType.ptSubject,!i),a.AddPaths(s,k.PolyType.ptClip,!0);var h=k.PolyFillType.pftNonZero,l=k.PolyFillType.pftNonZero,u=k.ClipType.ctIntersection,c=i?new k.PolyTree:new k.Paths;a.Execute(u,c,h,l);var d=i?k.Clipper.PolyTreeToPaths(c):c;return Oi(d)}function Ge(e,t,i=[]){const r=new k.FPoint(e[0],e[1]),n=Mt([t])[0];let o=k.Clipper.PointInPolygon(r,n);return i.forEach(s=>{let a=Ge(e,s);a===1?o=0:a===-1&&(o=-1)}),o}function Ae(e){let t=Mt([e]);return k.JS.AreaOfPolygon(t[0])}function Ii(e){return Math.abs(Ae(e))}function zh(e,t=.01){let i=Mt(e);const r=k.Clipper.CleanPolygons(i,t);return Oi(r)}function Ta(e,t=.01){return zh([e],t)[0]}function Mt(e=[]){let t=[];for(var i=0;i<e.length;i++){var r=e[i]||[];t[i]=[];for(var n=0;n<r.length;n++){var o=r[n];Number.isFinite(o[0])&&Number.isFinite(o[1])?t[i][n]={X:o[0],Y:o[1]}:console.warn("invalid number",o[0],o[1])}}const s=[];for(const a of t)a.length?s.push(a):console.warn("empty polygon");if(!s.length)throw new Error("empty polygon invalid input");return s}function Oi(e){let t=[];for(var i=0;i<e.length;i++){var r=e[i]||[];t[i]=[];for(var n=0;n<r.length;n++){var o=r[n];t[i][n]=[o.X,o.Y]}}return t}function Xv(e){let t=[1/0,1/0],i=[-1/0,-1/0];return e.forEach(r=>{r[0]<t[0]&&(t[0]=r[0]),r[1]<t[1]&&(t[1]=r[1]),r[0]>i[0]&&(i[0]=r[0]),r[1]>i[1]&&(i[1]=r[1])}),{min:t,max:i}}function Yv(e,t=!0){let i=0;const r=t?e.length:e.length-1;for(var n=0;n<r;n++){let o={x:e[n][0],z:e[n][1]},s={x:e[n<e.length-1?n+1:0][0],z:e[n<e.length-1?n+1:0][1]};i+=Hh(o,s)}return i}function Gv(e){const{min:t,max:i}=Xv(e);return[t[0]+(i[0]-t[0])/2,t[1]+(i[1]-t[1])/2]}function jh(e,t=[]){return Ii(e)<.1?Gv(e):no.exports([e,...t],.1)}function No(e,t,i=!1){let r=0,n=t.x,o=t.z;if(t.controlLine&&t.w&&(r=t.controlLine==="front"?t.w:t.controlLine==="center"?t.w/2:0),r){let m=t.ry/180*Math.PI;n-=r*Math.sin(m),o-=r*Math.cos(m)}const s=e.ry||0,a=t.ry||0,h=xr(e.x,e.z),l=xr(n,o),u=-a*Math.PI/180;let c=kh(),d=_r();Ev(c,l),xv(c,c,u),Xh(d,h,c);const f={x:d[0],z:d[1],y:e.y+t.y||0,ry:s+a};return i?Object.assign(e,f):Object.assign({},e,f)}function Hv(e,t,i=!1){let r=0,n=t.x,o=t.z;if(t.controlLine&&t.w&&(r=t.controlLine==="front"?t.w:t.controlLine==="center"?t.w/2:0),r){let v=t.ry/180*Math.PI;n-=r*Math.sin(v),o-=r*Math.cos(v)}const s=e.ry||0,a=t.ry||0,h=xr(e.x,e.z),l=xr(n,o),u=a*Math.PI/180;let c=kh(),d=_r(),f=_r();Rv(f,l),Pv(c,u),bv(c,c,f),Xh(d,h,c);const m={x:d[0],z:d[1],y:e.y-t.y||0,ry:s-a};return i?Object.assign(e,m):Object.assign({},e,m)}function Wv(e){if(typeof e!="object")throw new Error("Get el data, invalid type");let{x:t,z:i,l:r,ry:n}={...e},o=e.type==="a:helper:spaceDivider";if(!o&&!Number.isFinite(e.w)||!Number.isFinite(r)||!Number.isFinite(t)||!Number.isFinite(i)){let b={type:e.type,id:e.id,x:t,z:i,l:r,ry:n,w:e.w};throw new Error(`Get el vectors, params missing ${JSON.stringify(b)}`)}let s,a,h,l,u,c,d,f,m,v,y,g,x,_,E;return s=n/180*Math.PI,a=e.barCounter?e.w+.25:e.w,o&&(a=0),u={x:a*Math.sin(s),z:a*Math.cos(s)},c=o?u:Ea(u),d={x:r*Math.cos(s),z:-r*Math.sin(s)},f=Ea(d),h=e.barCounter?t+c.x*-.25:t,l=e.barCounter?i+c.z*-.25:i,E=0,e.controlLine==="front"?E=-e.w:e.controlLine==="center"&&(E=-e.w/2),x={x:h,z:l},_={x:h+d.x,z:l+d.z},m={x:x.x+c.x*E,z:x.z+c.z*E},v={x:m.x+d.x,z:m.z+d.z},y={x:m.x+u.x,z:m.z+u.z},g={x:v.x+u.x,z:v.z+u.z},{l1:x,l2:_,p1:m,p2:v,p3:y,p4:g,w:u,l:d,nW:c,nL:f}}function zv(e){if(e.type!=="column")return;let t=[];if(e.shape==="square"){let i=e.l/2;t=[[-i,-i],[i,-i],[i,i],[-i,i]],t=Dt(e,t)}else if(e.shape==="circle"){const i=Math.PI*2/25;let r=0,n=e.l/2;for(let o=0;o<25;o++)t.push([e.x-n*Math.cos(r),e.z+n*Math.sin(r)]),r+=i}else e.shape==="polygon"&&(t=Dt(e,e.polygon));return t}function so(e){let t,i,r;return e.type==="column"?i=zv(e):(t=Wv(e),e.type==="a:helper:spaceDivider"?r=[t.l1,t.l2]:r=[t.p1,t.p2,t.p4,t.p3],i=r.map(n=>[n.x,n.z])),i}function Dt(e,t){return t.map(i=>{let r=No({x:i[0],z:i[1]},e);return[r.x,r.z]})}const Ro=(e,t={})=>{let i={};const r=t.keepTransient;return Object.keys(e).forEach(n=>{let o=n.slice(0,1)==="_";if(n==="_ryOrg"){i.ry=e[n];return}else{if(o&&!r||e[n]===null||e[n]===void 0)return;n!=="children"&&(i[n]=e[n])}}),e.children?i.children=e.children.map(n=>Ro(n,t)):i.children=[],i};function jv(e,t){const i=[],r=e.map(Ii),n=t.map(Ii);for(let s=0;s<e.length;s++){let a=e[s];for(let h=0;h<t.length;h++)if(r[s]>n[h]+.1&&Ge(t[h][0],a))if(i[h]){const l=r[i[h]],u=r[s];l>u&&(i[h]=s)}else i[h]=s}const o=[];return i.forEach((s,a)=>{o[s]||(o[s]=[]),o[s].push(t[a])}),o}function Vv(e){let t=e.filter(r=>Ae(r)>0),i=e.filter(r=>Ae(r)<0);return{counterClockwise:t,clockwise:i}}function qv(e){let t=[...e];return Ae(t)<0?t:t.reverse()}function Zv(e){let t=[...e];return Ae(t)>0?t:t.reverse()}function Vh({uuid:e,scene:t,node:i}){if(i=i||t.nodesById[e],!i)return[];let r=i.getWorldPosition();if(!r.polygon||!r.polygon.length)throw new Error("Invalid space"+JSON.stringify(r,null,2));let n=Zv(r.polygon);if(n=Ta(n),!n||!n.length)return[];let o=r.polygonHoles||[];o=o.map(h=>{let l=qv(h);return Ta(l)}).filter(h=>h.length),o=o.filter(h=>h.length);let s=Dt(r,n),a=o.map(h=>Dt(r,h));return[s,...a]}function $v(e){let t=Ro(e);return He(t)}function qh(e,t="",i=!1,r,n){const o={"a:helper:spaceDivider":["plan","level","group"],wall:["plan","level","group"],interior:["plan","level","interior","group","level"],window:["plan","level","wall"],door:["plan","level","wall"],polyfloor:["plan","level"],group:["plan","level","group"]};let s=i?$v(e):e;var a=[],h;if(i&&r&&(s=No(s,r)),!n&&s.type===t)a.push(s);else if(n&&s.id===n)return[s];let l=0;if(s.children&&(!o[t]||o[t].includes(s.type)))for(var u=0;u<s.children.length;u++){const c=s.children[u];c.type==="level"&&l++,!(l>1)&&(h=qh(c,t,i,s,n),a=a.concat(h))}return a}function Ia(e,t){return qh(e,t,!0)}const er=["a:helper:spaceDivider","a:reference:externalId","a:reference:ifcElement","a:reference:ifcFile","a:relation:wall","a:settings:display","a:settings:generatedGroup","box","camera-bookmark","closet","column","curtain","door","floor","floorplan","floorplanDxf","group","interior","kitchen","level","object","pic","plan","polybox","polyfloor","railing","stairs","tag","wall","window"],Ca=()=>er.reduce((e,t)=>({...e,[t]:[]}),{}),Zh=(e,t)=>{if(!t||!t.properties){console.warn(`schema is missing for type ${e}`);return}const i={};return Object.keys(t.properties).forEach(r=>{const n=t.properties[r],o=n.const||n.default;o!==void 0&&(i[r]=o)}),e==="interior"&&!i.src&&(i.src="!7dddc882-1def-4497-80e3-d1de834a1a7b"),He(i)};function Kv(e,t={}){const i=$h(e,{});return Kh(e,null,null,i),t.exportIdMap&&(e.idMap=i),e}function $h(e,t){return e.id!==void 0&&(t[e.id]=be()),e.children.forEach(i=>$h(i,t)),t}const Sa=e=>Object.prototype.toString.call(e)==="[object Object]",Jv=e=>Object.prototype.toString.call(e)==="[object Array]";function Kh(e,t,i,r){typeof e=="string"?(t!==void 0&&i!==void 0&&r[e]&&(t[i]=r[e]),typeof i=="string"&&t!==void 0&&i!==void 0&&r[i]&&(t[r[i]]=e,delete t[i])):(Sa(e)||Jv(e))&&(Sa(e)&&e.type&&e.id===void 0&&(e.id=be()),Object.entries(e).forEach(([n,o])=>Kh(o,e,n,r)))}const Qv={properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"},ry:{type:"number"},id:{type:"string"}}},tg=(e,t,i,r)=>{let n=i;if(typeof i=="string"&&(n=Number(n),console.log(e.type+"."+t,"converted from string to number")),!Number.isFinite(n))throw new Error(`${e.type}.${t} = ${i} is invalid`);const{minimum:o,maximum:s}=r,a=Number.isFinite(o)&&n<o,h=Number.isFinite(s)&&n>s;if(a||h){let l=a?"min:"+o:"max:"+s;throw new Error(`${e.type}.${t} = ${n} is out of range ${l}`)}return n},eg=(e,t,i,r)=>{if(typeof i!="string")throw new Error(`${e.type}.${t} = '${i}' is invalid`);if(r.enum&&!r.enum.includes(i))throw new Error(`${e.type}.${t} = '${i}' is invalid`);return i},ig=(e,t,i,r)=>r.type==="number"?tg(e,t,i,r):r.type==="string"?eg(e,t,i,r):i,Aa=(e,t,i)=>{const{properties:r}=i||Qv;for(const n in t){const o=r==null?void 0:r[n],s=i&&!o,a=n.startsWith("_");if(s&&!a){delete t[n];continue}e[n]=ig(e,n,t[n],o||{type:void 0}),a&&!e[n]&&delete e[n]}return e};function rg({uuid:e,polygons:t,scene:i,interiors:r}){let n;t&&t.length?n=t:n=Vh({uuid:e,scene:i});let o=n[0],s=n.slice(1);return o=Ar([o],.05)[0],r||(r=i.nodesByType.interior.map(a=>a.getWorldPosition())),{interiors:r.filter(a=>{if(!(!a.src||!a.x||!a.z))return Ge([a.x,a.z],o,s)})}}const ng=e=>{var t;return((t=e.src)==null?void 0:t.substring(1))||""},Jh={colorDiffuse:{type:"array"},colorSpecular:{type:"array"},wireframeColor:{type:"array"},size:{type:"array"},specularCoef:{type:"number"},opacity:{type:"number"},wireframeOpacity:{type:"number"},wireframeThickness:{type:"number"},wireframeThresholdAngle:{type:"number"},lightEmissionCoef:{type:"number"},bsdfType:{type:"string"},wrap:{type:"string"},receiveRealTimeShadows:{type:"boolean"},hideAfterBaking:{type:"boolean"},castRealTimeShadows:{type:"boolean"},no2dOutline:{type:"boolean"},mapDiffuse:{type:"string"},mapDiffusePreview:{type:"string"},mapDiffuseSource:{type:"string"},mapDiffuseKey:{type:"string"},mapSpecular:{type:"string"},mapSpecularPreview:{type:"string"},mapSpecularSource:{type:"string"},mapSpecularKey:{type:"string"},mapNormal:{type:"string"},mapNormalPreview:{type:"string"},mapNormalSource:{type:"string"},mapNormalKey:{type:"string"},mapAlpha:{type:"string"},mapAlphaPreview:{type:"string"},mapAlphaSource:{type:"string"},mapAlphaKey:{type:"string"}},Oa=e=>{let t=typeof e;return e===null?"null":t==="object"&&Array.isArray(e)?"array":t==="number"&&!Number.isFinite(e)?"undefined":t},og=Object.keys(Jh),sg=e=>{const t=Oa(e),i=t==="string",r=t==="object"&&Object.keys(e).every(n=>{var o;const s=og.includes(n),a=s&&Oa(e[n])===((o=Jh[n])==null?void 0:o.type);return s&&a});return i||r};function Qh(e,t){let i=ag(e.materials,t==null?void 0:t.colours);return i&&tl(e.materials[i])}function tl(e){return!e||typeof e!="string"?"":e.toLowerCase().replace(/[()+&!?;,:_)]/g,"").replace(/\s+/g,"-")}function ag(e={},t=[]){let i=(t==null?void 0:t.length)&&t[0].split(":")[0],r=Object.keys(e);return i&&i!=="default"&&(r=r.filter(n=>n===i)),r.length===1?r[0]:r.filter(n=>!n.toLowerCase().includes("base"))[0]}function hg(e,t){let i=ng(e),r=Qh(e,t);return r?r="_"+r:r="",i+r}const lg={group:"a:settings:generatedGroup"};class ug{}class Ci extends ug{constructor({node:t,parent:i,scene:r,emitter:n,options:o={}}){super();var s;if(typeof t!="object")throw new Error("node has to be type object: "+t);if(!t.type)throw new Error("node invalid, type is missing: "+JSON.stringify(t));o.setDefaults===void 0&&(o.setDefaults=!1),o.regenerateIds===void 0&&(o.regenerateIds=!1),this._scene=r,this._emitter=n;const a=t.children||[];t.children=[],!t.id||o.setDefaults||o.regenerateIds?this._update(cg(t,this.schema,o)):this._update(t),this._parent=i,i&&i.children.push(this),(s=this._scene)!=null&&s.registerNode&&this._scene.registerNode(this);const h="add-child";this._emitter&&this._emitter.emit(h,{node:i,args:this,options:o,event:h}),a.filter(l=>(l.type||console.warn("Prevent import from scene structure: Invalid type",l.type+""),l.type)).forEach(l=>this.addChild(l,o))}get parent(){return this._parent}get scene(){return this._scene}get schema(){var t;return(t=this._scene)==null?void 0:t.schema}_update(t={}){var i,r;Aa(this,t,(r=(i=this._scene)==null?void 0:i.schema)==null?void 0:r[this.type])}set(t={},i={}){if(this.locked&&!i.force){let n=[];for(let o in t)switch(o){case"locked":case"_highlight":case"_isSelected":n.push(o)}if(n.length>0){let o={};for(const s of n)o[s]=t[s];t=o}else{console.log(`Node ID ${this.id} is locked and cannot be altered.`);return}}t.id&&delete t.id,t.src&&delete t.src,t.children&&delete t.children;let r={};for(let n in t)r[n]=this[n];try{this._update(t)}catch(n){console.warn(n.message);return}if(this._emitter){let n=0,o=0;for(let a in t)switch(t[a]===r[a]&&(delete t[a],delete r[a]),n++,a){case"x":case"y":case"z":case"ry":o++;break}const s=o===n?"set-transform":"set";Object.keys(t).length&&this._emitter.emit(s,{node:this,args:t,prevState:r,options:i,event:s})}}setTransform({x:t,y:i,z:r,ry:n}={},o={}){if(this.locked&&!o.force){console.log(`Node ID ${this.id} is locked and cannot be altered.`);return}let s={},a={};if(t!==void 0){let l=Number(t);this.x!==l&&Number.isFinite(l)&&(a.x=this.x,s.x=this.x=l)}if(i!==void 0){let l=Number(i);this.y!==l&&Number.isFinite(l)&&(a.y=this.y,s.y=this.y=l)}if(r!==void 0){let l=Number(r);this.z!==l&&Number.isFinite(l)&&(a.z=this.z,s.z=this.z=l)}if(n!==void 0){let l=Number(n);this.ry!==l&&Number.isFinite(l)&&(a.ry=this.ry,s.ry=this.ry=l)}const h="set-transform";this._emitter&&Object.keys(s).length&&this._emitter.emit(h,{node:this,args:s,prevState:a,options:o,event:h})}setMaterials(t={},i={}){if(this.locked&&!i.force){console.log(`Node ID ${this.id} is locked and cannot set materials.`);return}let r=0,n={};for(let a in t){const h=t[a];sg(h)&&(n[a]=(this.materials||{})[a],t[a],r++)}if(r<1){console.log("no valid material definitions in",t);return}const o={...this.materials||{},...t};try{this._update({materials:o})}catch(a){console.warn(a.message);return}const s="set-materials";this._emitter&&this._emitter.emit(s,{node:this,args:t,prevState:n,options:i,event:s})}setTransient(t={},i={}){let r={},n=0,o={};for(let a in t)a[0]==="_"&&(o[a]=this[a],r[a]=t[a],n++);if(n<1){console.log("no transient values in",t,"use underscore");return}try{this._update({...r})}catch(a){console.warn(a.message);return}const s="set-transient";this._emitter&&this._emitter.emit(s,{node:this,args:t,prevState:o,options:i,event:s})}setHighlight(t={},i={}){let r={_highlight:this._highlight};const{fill:n,fillOpacity:o,outline:s,outlineWidth:a}=t;let h;n&&Array.isArray(n)&&(h={fill:n,fillOpacity:o}),s&&Array.isArray(s)&&(h={...h||{},outline:s,outlineWidth:a});const l={_highlight:h};try{this._update(l)}catch(c){console.warn(c.message);return}const u="set-transient";this._emitter&&this._emitter.emit(u,{node:this,args:l,prevState:r,options:i,event:u})}find(t={}){if(!t.id&&(!t.type||typeof t.type!="string"||!er.includes(t.type)))return console.warn("type missing or invalid"),null;let i;return this.traverse(r=>{i||(t.id&&r.id===t.id||t.type&&r.type===t.type)&&(i=r)}),i}findAll(t={}){if(!t.type||typeof t.type!="string"||!er.includes(t.type))return console.warn("type missing or invalid"),[];let i=[];return this.traverse(r=>r.type===t.type&&i.push(r)),i}addChild(t,i={}){var r,n,o;if(!t.type||typeof t.type!="string"||!er.includes(t.type)){console.warn("type missing or invalid");return}else if(this.locked&&!["level","plan"].includes(this.type)&&!i.force){console.log(`Node ID ${this.id} is locked and cannot add children.`);return}if(t.id&&((n=(r=this.scene)==null?void 0:r.nodesById)==null?void 0:n[t.id])&&!i.regenerateIds){console.warn(`Node with id ${t.id} already exists and can not be added - use options.regenerateIds = true`);return}const s=i.setDefaults!==!1;let a;if(s){const h=(o=this.schema)==null?void 0:o[t.type],l=Zh(t.type,h)||{};a=Aa(l,t,h)}else a=t;return new Ci({node:a,parent:this,scene:this._scene,emitter:this._emitter,options:{...i,setDefaults:s}})}removeChild(t,i={}){var r;if(t.id){if(this.locked&&!["level","plan"].includes(this.type)&&!i.force){console.log(`Node ID ${this.id} is locked and cannot remove children.`);return}}else{console.error("not valid");return}let n;for(let a=0;a<this.children.length;a++)if(this.children[a].id===t.id){n=a;break}if(!Number.isFinite(n)){console.warn("Node does not exist or is already removed",t);return}let o=t.children||[];for(let a=o.length-1;a>=0;a--)t instanceof Ci&&o[a]&&t.removeChild(o[a],i);(r=this._scene)!=null&&r.unregisterNode&&this._scene.unregisterNode(t),this.children.splice(n,1);const s="remove-child";this._emitter&&this._emitter.emit(s,{node:this,args:t,options:i,event:s}),(t!=null&&t.getReferringNodes?t.getReferringNodes():[]).forEach(a=>a.remove(i))}remove(t){if(this.locked&&!t.force){console.warn(`Node ID ${this.id} is locked and cannot be removed.`);return}else this.parent.removeChild(this,t)}getReferringNodes(){var t,i;let r=[],n=(t=this._scene)==null?void 0:t.nodesByType["a:relation:"+this.type];n&&n.forEach(a=>{var h;(h=a==null?void 0:a.nodeIds)!=null&&h.hasOwnProperty(this.id)&&r.push(a)});let o=lg[this.type]||"a:settings:"+this.type,s=(i=this._scene)==null?void 0:i.nodesByType[o];return s&&s.forEach(a=>{(a==null?void 0:a.nodeId)==this.id&&r.push(a)}),r}getWorldPosition(){return el(this)}getLocalPositionFromWorld(t){const i=this.getParents();return i!=null&&i.length&&i.reverse().forEach(r=>{t=Hv(t,r)}),t}getParents(){return il(this)}toJson(t={}){let i=Ro(this,t),r=He(i);return t.regenerateIds&&Kv(r,t),r}traverse(t){typeof t=="function"&&(t(this),this.children.forEach(i=>{i.traverse(t)}))}}const el=(e,t)=>{const i=t?t.parent:e.parent;if(!i)return console.warn("no parent found"),e;let r=No(e,i);return i.parent&&(r=el(r,i)),r},il=e=>{let t=[];const i=e.parent;return i&&t.push(i),i!=null&&i.parent&&(t=t.concat(il(i))),t},cg=(e,t,{setDefaults:i,regenerateIds:r})=>{if(!t&&i)throw new Error("schema is missing");if(!e)throw new Error("node missing");const n=t&&t[e.type];let o;if(n&&i){if(o=Zh(e.type,n),!o)throw new Error("no defaults found")}else o={};let s=Object.assign({},o,e);if(!s)throw new Error("applying defaults failed");return(!e.id||r)&&(s.id=be()),s};var I;(function(e){e.residential="residential",e.office="office",e.parking="parking"})(I||(I={}));const Ki={work:{name:"Work",isHidden:!0,description:"space for individual head-down work",spaceUsage:{privateOffice:{name:"Private office",category:[I.office]},focusRoom:{name:"Focus room",category:[I.office]},openWorkspace:{name:"Open workspace",category:[I.office]},enclosedWorkspace:{name:"Enclosed workspace",category:[I.office]},closedWorkspace:{name:"Closed workspace",isDeprecated:!0,category:[I.office]},executiveOffice:{name:"Executive office",isDeprecated:!0,category:[I.office]}}},meet:{name:"Meet",isHidden:!0,spaceUsage:{meetingRoom:{name:"Meeting room",category:[I.office]},hub:{name:"Hub",category:[I.office]},assembly:{name:"Assembly",category:[I.office]},boardRoom:{name:"Board room",category:[I.office]},trainingRoom:{name:"Training room",category:[I.office]},collaboration:{name:"Collaboration",isDeprecated:!0,category:[I.office]}}},live:{name:"live",isHidden:!0,spaceUsage:{living:{name:"Living",category:[I.residential]},dining:{name:"Dining",category:[I.residential]},dining_living:{name:"Living & Dining",category:[I.residential]},homeOffice:{name:"Home office",category:[I.residential]},bedroom:{name:"Bedroom",category:[I.residential]}}},socialize:{name:"Socialize",isHidden:!0,spaceUsage:{lobby:{name:"Lobby",category:[I.office,I.residential]},reception:{name:"Reception",category:[I.office]},lounge:{name:"Lounge",category:[I.office]},cafe:{name:"Cafe",category:[I.office]},canteen:{name:"Canteen",category:[I.office]},pantry:{name:"Pantry",category:[I.office]},terrace:{name:"Terrace",isOutdoor:!0,category:[I.office,I.residential]},balcony:{name:"Balcony",isOutdoor:!0,category:[I.office,I.residential]},rooftop:{name:"Rooftop",isOutdoor:!0,category:[I.office,I.residential]},courtyard:{name:"Courtyard",isOutdoor:!0,category:[I.office,I.residential]},garden:{name:"Garden",isOutdoor:!0,category:[I.residential]},common:{name:"Common",isDeprecated:!0,category:[I.office]}}},support:{name:"Support",isHidden:!0,spaceUsage:{serviceKitchen:{name:"Service kitchen",category:[I.office]},printStation:{name:"Print station",category:[I.office]},storage:{name:"Storage",category:[I.residential,I.office,I.parking]},mailRoom:{name:"Mail room",category:[I.office]},operationalRoom:{name:"Operational room",category:[I.office,I.parking]},serviceRoom:{name:"Service room",category:[I.office]},laundryRoom:{name:"Laundry room",category:[I.residential]},operate:{name:"Operate",isDeprecated:!0,category:[I.office]},services:{name:"Services",isDeprecated:!0,category:[I.office,I.residential]}}},care:{name:"Care",isHidden:!0,spaceUsage:{kitchen:{name:"Kitchen",category:[I.residential]},wellnessRoom:{name:"Wellness room",category:[I.office]},restroom:{name:"Restroom",category:[I.office,I.parking]},bathroom:{name:"Bathroom",category:[I.residential]},shower:{name:"Shower",category:[I.office,I.residential]},toilet:{name:"Toilet",category:[I.residential]}}},circulate:{name:"Circulate",isHidden:!0,spaceUsage:{corridor:{name:"Corridor",category:[I.residential,I.office,I.parking]},foyer:{name:"Foyer",category:[I.residential,I.office,I.parking]},staircase:{name:"Staircase",isVertical:!0,category:[I.residential,I.office,I.parking]},elevator:{name:"Elevator",isVertical:!0,category:[I.residential,I.office,I.parking]}}},drive:{name:"Drive",isHidden:!0,spaceUsage:{parkingSpot:{name:"Parking spot",category:[I.parking]},driveway:{name:"Driveway",category:[I.parking]},garage:{name:"Garage",category:[I.residential]}}},void:{isHidden:!0,name:"Void",spaceUsage:{shaft:{name:"Shaft",isVertical:!0,category:[I.residential,I.office,I.parking]},buildingOpening:{name:"Building opening",isVertical:!0,category:[I.residential,I.office,I.parking]},floorOpening:{name:"Floor opening",isVertical:!0,category:[I.residential,I.office,I.parking]}}},undefined:{isHidden:!0,spaceUsage:{undefined:{name:"Undefined",category:[I.residential,I.office],isHidden:!0}}}},ge={};Object.keys(Ki).forEach(e=>{const t=Ki[e];ge[e]={name:t.name,type:"program",category:[]},t.isHidden&&(ge[e].isHidden=t.isHidden);const i={};Object.keys(Ki[e].spaceUsage).forEach(r=>{const n=Ki[e].spaceUsage[r];ge[r]={...n,type:"space",program:e},n.category.forEach(o=>{i[o]=!0})}),ge[e].category=Object.keys(i)});const rl=(e="")=>{e==="officeWorking"?e="work":e==="officeMeeting"&&(e="meet");let t=ge[e];return t?t.name:""},Or=(e="")=>{const t=ge[e];let i;return t&&(i=t.type==="program"?e:t.program),i};function nl({scene:e,uuid:t}){let i=e.nodesByType.polyfloor;t&&(i=i.filter(n=>n.id===t));const r=e.nodesByType.interior.map(n=>n.getWorldPosition());return i.map(n=>{let o=Vh({node:n});if(!o.length)return;const s=Math.abs(o.reduce((u,c)=>u+Ae(c),0)),a=jh(o[0],o.slice(1)),h=Sr(o),{interiors:l}=rg({polygons:o,scene:e,interiors:r});return{node:n,boundingBox:h,id:n.id,usage:n.usage,usageName:rl(n.usage),program:Or(n.usage),polygons:o,interiors:l,area:s,center:a,customId:n.customId,name:n.name}}).flatMap(n=>n?[n]:[])}const vn=(e,t=!0,i=!1)=>{const r=e.nodesByType.column.map(c=>c.getWorldPosition()),n=e.nodesByType.wall.map(c=>c.getWorldPosition()),o=.001,s=[...n,...r].map(c=>{let d=so(c);if(t&&(d=Ar([d],o)[0]),i)return[d];let f=Ia(c,"window"),m=Ia(c,"door"),v=f.concat(m);if(v=v.map(y=>(y.w=c.w,y)),v==null?void 0:v.length){let y=v.map(so);return kv([d],y,o*2)}else return[d]}).reduce((c,d)=>c.concat(d),[]),a=s.length?Wh(s):[],{counterClockwise:h,clockwise:l}=Vv(a),u=jv(h,l);return h.map((c,d)=>[c,...u[d]||[]])},pg={spaceContourAreaThreshold:.1};class dg{constructor({schema:t,options:i={}}={}){this.sceneId=null,this.node=null,this._apiVersion="3.5.2",this.nodesById={},this.nodesByType=Ca(),this.nodesByName={},this.options={...pg,...i},this._schema=t||{},this._emitter=new Lo}get emitter(){return this._emitter}get schema(){return this._schema}set schema(t){typeof t=="object"&&(this._schema=t)}loadSceneStructure(t,i={}){if(this._emitter.emit("scene-structure-loading",this),!t||t.type!=="plan")throw new Error("invalid sceneStructure");this.nodesById={},this.nodesByType=Ca(),this.node=null;let r=He(t);return Number.isFinite(i.planRotation)&&(r._ryOrg=t.ry,r.ry=i.planRotation),this.node=new Ci({node:r,scene:this,emitter:this.emitter,options:i}),this.setSpaceCategories(),this._emitter.emit("scene-structure-loaded",this),this.node}setSceneType(){this.setSpaceCategories()}_setSceneType(){const t=this.node.class;if(t!=null&&t.length)t.includes(I.residential)?this.type=I.residential:t.includes("commercial")||t.includes(I.office)?this.type=I.office:t.includes(I.parking)&&(this.type=I.parking);else{const i=this.nodesByType.polyfloor.map(r=>r.usage);i.includes("bedroom")?this.type=I.residential:(i.includes("work")||i.includes("meetingRoom")||i.includes("openWorkspace"))&&(this.type=I.office)}}setSpaceCategories(){let t=[];const i=this.node.class;if(i!=null&&i.length)t=Array.from(i.reduce((r,n)=>(n==="commercial"?r.add(I.office):I[n]&&r.add(I[n]),r),new Set));else{const r=this.nodesByType.polyfloor.map(n=>n.usage);r.includes("bedroom")&&t.push(I.residential),(r.includes("work")||r.includes("meetingRoom")||r.includes("openWorkspace"))&&t.push(I.office)}this.spaceCategories=t,this._setSceneType()}getFloorArea(){const t=nl({scene:this}).reduce((i,r)=>r.program==="void"?i:i+r.area,0);return Math.round(t*10)/10}registerNode(t){this.nodesById[t.id]&&console.error("Duplicate id",t.id),this.nodesById[t.id]=t,this.nodesByType[t.type]=this.nodesByType[t.type]||[],this.nodesByType[t.type].push(t),t.name&&(this.nodesByName[t.name]=this.nodesByName[t.name]||[],this.nodesByName[t.name].push(t))}unregisterNode(t){t.id&&delete this.nodesById[t.id];const i=(r,n)=>{if(r[t[n]]){let o=r[t[n]].findIndex(s=>s.id===t.id);Number.isFinite(o)&&r[t[n]].splice(o,1)}};i(this.nodesByType,"type"),i(this.nodesByName,"name")}on(t,i,r){t&&i?this._emitter.on(t,i,r):console.log("invalid event listener")}once(t,i,r){t&&i?this._emitter.once(t,i,r):console.log("invalid event listener")}off(t,i){t?this._emitter.off(t,i):console.log("invalid request")}emit(t,i,r,n,o){this._emitter.emit(t,i,r,n,o)}get apiVersion(){return this._apiVersion}}function fg(e){let t=[];return e.shape==="square"?t.push({type:"rectangle",position:[-e.l/2,-e.l/2],dimensions:[e.l,e.l]}):e.shape==="circle"?t.push({type:"circle",position:[0,0],radius:e.l/2}):e.shape==="polygon"&&t.push({type:"polygon",points:e.polygon}),t}function mg(e,t){const i=e.doorType||"singleSwing",r=e.l,n=t.w;let o=[],s=e.doorAngle;const a=e.hinge==="right",h=e.side==="back",l=t.controlLine==="front"?-n:t.controlLine==="center"?-n/2:0;if(s<20&&(s=20),i==="singleSwing"){let u=s*Math.PI/180,c,d,f,m;h?(c=a?0:180-s,d=a?s:180,f=a?[0,l]:[r,l],m=[f[0]+r*Math.cos(u)*(a?1:-1),f[1]+-r*Math.sin(u)]):(c=a?-180:360-s,d=a?-180+s:360,f=a?[r,n+l]:[0,n+l],m=[f[0]+r*Math.cos(u)*(a?-1:1),f[1]+r*Math.sin(u)]),o.push({type:"arc",radius:r,position:f,startAngle:c,endAngle:d},{type:"line",start:f,end:m})}else if(i==="doubleSwing"){const u=s*Math.PI/180;let c,d,f,m,v,y,g,x;h?(c=0,d=s,f=[0,l],m=[f[0]+r/2*Math.cos(u),f[1]+-r/2*Math.sin(u)],g=[r,l],x=[g[0]+-r/2*Math.cos(u),g[1]+-r/2*Math.sin(u)],v=180-s,y=180):(c=360-s,d=360,f=[0,n+l],m=[f[0]+r/2*Math.cos(u),f[1]+r/2*Math.sin(u)],g=[r,n+l],x=[g[0]+-r/2*Math.cos(u),g[1]+r/2*Math.sin(u)],v=180,y=180+s),o.push({type:"arc",radius:r/2,position:f,startAngle:c,endAngle:d},{type:"line",start:f,end:m}),o.push({type:"arc",radius:r/2,position:g,startAngle:v,endAngle:y},{type:"line",start:g,end:x})}return o.push({type:"rectangle",position:[0,l],dimensions:[e.l,n]}),o}function yg(e){let t=[];const i=/90$/g.test(e.cooktopType),r=vg(e),n=gg(e,r,i),o=_g(e,n),s=xg(e,n),a=bg(e,n),h=.25,l=.6;t.push(Be([0,e.barCounter?-h:0],e.l,e.barCounter?e.w+h:e.w)),n.forEach(c=>{t.push(wt([c,e.w],[c,e.w-.075]))}),r&&e.barCounter&&t.push(wt([e.highCabinetLeft*e.elementLength,0],[e.l-e.highCabinetRight*e.elementLength,0]));for(let c of o){const d=n[c],f=d-l;t.push(wt([f||0,e.w],[f||0,0]),wt([f||0,0],[d,e.w]),wt([f||0,e.w],[d,0]),wt([d,e.w],[d,0]))}const u={fill:!1};if(s&&n[s-2]){let c={type:"group",position:[n[s-2],0],children:[Be([.05,e.w-.5],e.sinkType!=="double"?.5:1.1,.45,u),Be([.1,e.w-.4],e.sinkType!=="double"?.4:.35,.3,u),Be([e.sinkType!=="double"?e.elementLength/2-.02:.48,e.w-.45],.04,.18,u)]};e.sinkType==="double"&&c.children.push(Be([.55,e.w-.4],.35,.3,u),wt([.95,e.w-.4],[.95,e.w-.1]),wt([1,e.w-.4],[1,e.w-.1]),wt([1.05,e.w-.4],[1.05,e.w-.1]),wt([1.1,e.w-.4],[1.1,e.w-.1])),t.push(c)}if(a&&n[a-2]){let c={type:"group",position:[n[a-2],0],children:[Be([.05,e.w-.55],i?.8:.5,.5,u)]};i?c.children.push(Yt([.225,e.w-.4],.08,u),Yt([.675,e.w-.4],.08,u),Yt([.45,e.w-.3],.08,u),Yt([.225,e.w-.2],.08,u),Yt([.675,e.w-.2],.08,u)):c.children.push(Yt([.2,e.w-.4],.08,u),Yt([.4,e.w-.4],.08,u),Yt([.2,e.w-.2],.08,u),Yt([.4,e.w-.2],.08,u)),t.push(c)}return r&&e.wallCabinet&&t.push(wt([e.highCabinetLeft*e.elementLength,e.wallCabinetWidth],[e.l-e.highCabinetRight*e.elementLength,e.wallCabinetWidth])),t}function vg(e){const t=e.elementLength,i=e.highCabinetLeft*t,r=e.highCabinetRight*t;return Math.max(0,e.l-i-r)}function gg(e,t,i){const r=e.elementLength,n=.9,o=e.highCabinetLeft*r;let s,a=[],h=0,l=0;for(s=0;s<e.highCabinetLeft;s++){let u=e.l-h;h+=u>r?r:u,a[s]=h,l++}for(;h+r<o+t;){let u=l===e.cooktopPos-1&&e.cooktopType!=="none"&&i;h+=u?n:r,l++,a.push(h)}for(s=e.highCabinetRight;s>0;s--)h=e.l-r*s+r,a.push(h);return a=a.map(u=>Math.round(u*10)/10),a}function _g(e,t){let i,r=[];for(i=0;i<e.highCabinetLeft;i++)r.push(i);for(i=0;i<e.highCabinetRight;i++)r.push(t.length-1-i);return r}function xg(e,t){return typeof e.sinkPos=="number"&&e.sinkPos>e.highCabinetLeft&&e.sinkPos<=t.length-e.highCabinetRight&&e.sinkType!=="none"?e.sinkPos:null}function bg(e,t){return typeof e.cooktopPos=="number"&&e.cooktopPos>e.highCabinetLeft&&e.cooktopPos<=t.length-e.highCabinetRight&&e.cooktopType!=="none"?e.cooktopPos:null}function wt(e,t){return{type:"line",start:e,end:t}}function Be(e,t,i,r){return{type:"rectangle",position:e,dimensions:[t,i],style:r}}function Yt(e,t,i){return{type:"circle",position:e,radius:t,style:i}}function Pg(e){let t;return e.controlLine==="center"?t=-e.w/2:e.controlLine==="front"?t=-e.w:t=0,[{type:"rectangle",position:[0,t],dimensions:[e.l,e.w]}]}function ci(e,t,i=.5){let r=[t[0]-e[0],t[1]-e[1]];return[e[0]+r[0]*i,e[1]+r[1]*i]}function Eg(e,t,i,r=5){const n=[];let o,s,a,h=0;for(let l=0;l<=r;++l)h=l/r,o=ci(e,t,h),s=ci(t,i,h),a=ci(o,s,h),n.push(a);return n}const wg=48,Tg=12,Ig=100,ol=(e,t)=>{const i=Math.ceil(wg/(Math.PI*2)*e*t),r=Math.ceil(Tg/(Math.PI*2)*e);return Math.min(Ig,Math.max(r,i))},sl=e=>{const t={type:"polygon",points:[]};switch(e.type){case"circle":const i=e.radius,r=ol(Math.PI*2,i),n=e.position,o=Math.PI*2/r;let s=0;for(let h=0;h<r;h++)t.points.push([i*Math.cos(s)+n[0],-i*Math.sin(s)+n[1]]),s+=o;break;case"polygon":t.points=e.points;break;case"rectangle":const a=e.dimensions;t.points=[[0,0],[0,a[1]],[a[0],a[1]],[a[0],0]];break;case"composite":for(const h of e.segments){let l=Mo(h);t.points.push(...l.points)}break}return t},Mo=e=>{const t={type:"polyline",points:[]};switch(e.type){case"line":t.points=[e.start,e.end];break;case"arc":const i=e.startAngle/180*Math.PI,r=e.endAngle/180*Math.PI-i,n=e.radius,o=ol(Math.abs(r),n),s=e.position,a=r/o;let h=i;for(let l=0;l<o+1;l++)t.points.push([n*Math.cos(h)+s[0],-n*Math.sin(h)+s[1]]),h+=a;break;case"polyline":t.points=e.points;break;case"quadraticBezier":t.points.push(e.points[0]);for(let l=0;l<=e.points.length-3;l++){let u=e.points[l],c=e.points[l+1],d=e.points[l+2],f=l===0?u:ci(u,c),m=l===e.points.length-3?d:ci(c,d),v=Eg(f,c,m);t.points.push(...v.slice(1))}break}return t};function Cg(e,t={}){const i="straight",r=t.style!=="labelled",n=e.circulation==="left",o=.3;let s=e.stairType||i,a=e.l;const h=e.stepWidth;e.stairType==="straightLanding"?a=e.l-1:e.stairType==="lShaped"?a=e.l+e.w-2*h:e.stairType==="winder"?a=e.l+e.w-h:e.stairType==="halfLanding"?a=(e.l-h)*2:e.stairType==="2QuarterLanding"?a=(e.l-h)*2+e.w-h*2:e.stairType==="doubleWinder"&&(a=e.l*2+e.w-h*2);const l=(a/e.h+1.2321)/.10357/100,u=Math.round(a/l),c=!n&&e.railing==="left"||n&&e.railing==="right"||e.railing==="both",d=!n&&e.railing==="right"||n&&e.railing==="left"||e.railing==="both",f=.05;let m=a/u,v={shape:[],runs:[],railings:[]},y,g,x;switch(s){case"straight":case"straightLanding":v.shape=[[0,0],[e.l,0],[e.l,e.w],[0,e.w]];break;case"lShaped":case"winder":v.shape=[[0,0],[e.l,0],[e.l,e.w],[e.l-h,e.w],[e.l-h,h],[0,h]];break;case"halfLanding":case"2QuarterLanding":case"doubleWinder":v.shape=[[0,0],[e.l,0],[e.l,e.w],[0,e.w],[0,e.w-h],[e.l-h,e.w-h],[e.l-h,h],[0,h]];break}if(v.railings=Og(v.shape,f,c,d),r)switch(s){case"straight":v.runs=[{type:"straight",data:[0,0,u,m,0]}];break;case"straightLanding":y=Math.ceil(u/2),g=u-y,v.runs=[{type:"straight",data:[0,0,y,m,0]},{type:"straight",data:[y*m+1,0,g,m,0]}];break;case"lShaped":y=Math.floor((e.l-h)/m),g=u-y,v.runs=[{type:"straight",data:[0,0,y,(e.l-h)/y,0]},{type:"straight",data:[e.l,h,g,(e.w-h)/g,-90]}];break;case"winder":g=2*Math.round((h/2+o)/m),y=Math.round((e.l-h-o)/m),x=u-y-g,v.runs=[{type:"straight",data:[0,0,y,(e.l-h-o)/y,0]},{type:"winder",data:[e.l-h-o,0,g,0]}],x>0&&v.runs.push({type:"straight",data:[e.l,h+o,x,(e.w-h-o)/x,-90]});break;case"halfLanding":y=u/2,g=u/2,v.runs=[{type:"straight",data:[0,0,y,m,0]},{type:"straight",data:[y*m,e.w,g,m,180]}];break;case"2QuarterLanding":y=Math.round((e.l-h)/m),x=y,g=u-y*2,m=(e.l-h)/y,v.runs=[{type:"straight",data:[0,0,y,(e.l-h)/y,0]},{type:"straight",data:[e.l,h,g,(e.w-h*2)/g,-90]},{type:"straight",data:[y*m,e.w,x,(e.l-h)/y,180]}];break;case"doubleWinder":g=4*Math.round((h/2+o)/m),x=Math.round((e.w-(h+o)*2)/m),y=Math.round((u-g-x)/2),v.runs=[],y>0&&v.runs.push({type:"straight",data:[0,0,y,(e.l-h-o)/y,0]}),v.runs.push({type:"winder",data:[e.l-h-o,0,g/2,0]}),x>0&&v.runs.push({type:"straight",data:[e.l,h+o,x,(e.w-(h+o)*2)/x,-90]}),v.runs.push({type:"winder",data:[e.l,e.w-h-o,g/2,-90]}),y>0&&v.runs.push({type:"straight",data:[e.l-h-o,e.w,y,(e.l-h-o)/y,180]});break}let _,E=[];if(t.style!=="labelled"){let S=[[m/2-.06,h/2+.12],[m/2+.06,h/2],[m/2-.06,h/2-.12]];E.push({type:"polyline",points:S})}if(s!=="spiral")_={type:"polygon",points:v.shape},v.runs.forEach(S=>{S.type==="straight"?E=E.concat(Sg(...S.data,h)):S.type==="winder"&&(E=E.concat(Ag(...S.data,h,o)))});else if(s==="spiral"){const S=e.w,D=S-h,T=D+h/2;let A=e.l/T;const M=A/u;A>2*Math.PI&&(A=2*Math.PI-.01);let O=[0,e.w],R=A/Math.PI*180-90;_={type:"composite",segments:[{type:"arc",radius:S,position:O,startAngle:-R,endAngle:90},{type:"arc",radius:D,position:O,startAngle:90,endAngle:-R}]},v.railings=[];const H=S-f,C=D+f;if(c&&v.railings.push({type:"arc",radius:H,position:O,startAngle:-R,endAngle:90}),d&&v.railings.push({type:"arc",radius:C,position:O,startAngle:-R,endAngle:90}),r){let N=0;for(var b=0;b<u&&!(N>=A);b++){const B=[Math.sin(N)*S,Math.cos(N)*S-S],et=[Math.sin(N)*D,Math.cos(N)*D-S];E.push({type:"polyline",points:[[B[0],-B[1]],[et[0],-et[1]]]}),N+=M}}}let P=[_,...E,...v.railings];return n&&(P=P.map(S=>(S.type==="composite"&&(S=sl(S)),S.type==="arc"&&(S=Mo(S)),(S.type==="polygon"||S.type==="polyline")&&S.points.forEach(D=>{D[1]=-D[1]+e.w}),S))),P}function Sg(e,t,i,r,n=0,o){n=n||0;const s=[];for(var a=0;a<i;a++){let h=[[a*r,0],[a*r,o]];h=Dt({x:e,z:t,ry:n},h),s.push({type:"polyline",points:h})}return s}function Ag(e,t,i,r,n,o){let s=0,a=0;r=r||0;const h=[];let l=o,u=i/2,c=(n+l)/u,d=l/u,f=0,m=0;for(var v=0;v<u;v++){let y=[[s+f,a+n],[s+m,a]];y=Dt({x:e,z:t,ry:r},y),h.push({type:"polyline",points:y}),f+=d,m+=c}for(s+=f,f=0,m=0,v=0;v<u;v++){let y=[[s,a+n+f],[s+n,a+m]];y=Dt({x:e,z:t,ry:r},y),h.push({type:"polyline",points:y}),f+=d,m+=c}return h}function Og(e,t,i,r){const n=[];if(!i&&!r)return[];let o=[];e.length===4?o=e.map((h,l)=>[h[0],h[1]+(l<2?t:-t)]):e.length===6?o=e.map((h,l)=>{let u=[...h];return l<2?u[1]+=t:l>3&&(u[1]-=t),l===1||l===2?u[0]-=t:(l===3||l===4)&&(u[0]+=t),u}):e.length===8&&(o=e.map((h,l)=>{let u=[...h];return l<2||l>3&&l<6?u[1]+=t:(l<4||l>5)&&(u[1]-=t),(l===1||l===2)&&(u[0]-=t),(l===5||l===6)&&(u[0]+=t),u}));const s=o.slice(0,o.length/2),a=o.slice(o.length/2,o.length);return i&&n.push({type:"polyline",points:s}),r&&n.push({type:"polyline",points:a}),n}new Mv({size:256});function Do(e){return new Promise((t,i)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>i(e.error)})}function al(e,t){const i=indexedDB.open(e);i.onupgradeneeded=()=>i.result.createObjectStore(t);const r=Do(i);return(n,o)=>r.then(s=>o(s.transaction(t,n).objectStore(t)))}let gn;function hl(){return gn||(gn=al("keyval-store","keyval")),gn}function Lg(e,t=hl()){return t("readonly",i=>Do(i.get(e)))}function Ng(e,t,i=hl()){return i("readwrite",r=>(r.put(t,e),Do(r.transaction)))}const It={api:{sdkVersion:"5.0.0-beta.0",productDataCacheAge:24*3600*1e3,productContourCacheAge:10*24*3600*1e3},hideElements:[],panZoom:!0,planRotation:0,preserveViewbox:"center-center",roomStampSize:null,showCeilingLamps:!1,xrayMode:!1,destroyOnDomRemove:!1,ui:{scale:!0,coordinates:!1},spaceLabelMapping:{},theme:{fontFamily:"Avenir, Verdana, sans-serif",background:{color:"#f3f5f8",showGrid:!1},wallContours:!1,showAssetTextures:!1,nativeLines:!0,elements:{roomStamp:{showArea:!0,showUsage:!0}}},units:{system:"metric",areaDecimals:0,lengthDecimals:3,roomDimensions:"area"},zoomRange:[3,300]},Rg=e=>"publishableToken"in e?(console.warn("token.publishableToken is deprecated, please use the token.publishableAccessToken option"),vr.getTokenConfig({publishableAccessToken:e.publishableToken,...e})):vr.getTokenConfig(e);let _n="archilogic/product",ir="https://storage.3d.io";const Mg=e=>{e&&typeof e=="object"&&(It.api={...It.api,...e})},Dg={async getSceneStructure(e,t){return vr.callSpaceAPIWithConfig("GET",`/v2/floor/${e}/scene-structure`,{},t)}},Lr={getProduct(e){return La(`${ir}/${_n}/json/${e}.json`)},getProductThumbnailUrl(e){return`${ir}/${_n}/thumb/${e}.png`},getProductOutline(e){return La(`${ir}/${_n}/outline/${e}.json`)}};function La(e){return fetch(e).then(t=>{if(t.ok)return t.json();throw Error(t.statusText)})}function Fg(e){const t=document.createElement("div"),i=document.createElement("div"),r=document.createElement("div"),n=document.createElement("div");return t.classList.add("fpe-err"),i.classList.add("fpe-err__box"),r.classList.add("fpe-err__title"),n.classList.add("fpe-err__msg"),e.append(t),t.append(i),i.append(r),i.append(n),r.textContent="Something went wrong",e.append(t),e}function Bg(e,t="Floor plan engine couldn't load properly on this page. For technical details check the browser console."){var i;const r=document.getElementById(e),n=(i=r.querySelector(".fpe-err"))!=null?i:Fg(r);n.querySelector(".fpe-err__msg").textContent=t}function kg(e){var t;(t=document.querySelector(`#${e} .fpe-err`))==null||t.remove()}const Ug="al-kvs",Xg="al-keyval",Fo=typeof window>"u"||typeof process<"u",ll=!Fo&&al(Ug,Xg);let ul=!0;async function cl(e,t,i){if(Fo)return Promise.resolve();i=i||30*24*3600*1e3;try{const r={timeStamp:new Date().getTime(),content:t,maxAge:i};return ul&&await Ng(e,r,ll),e}catch{return}}async function pl(e,t){if(Fo)return Promise.resolve();const i=t||30*24*3600*1e3,r=new Date().getTime();let n;try{ul&&(n=await Lg(e,ll));const o=r-n.timeStamp,s=Math.min(n.maxAge,i);if(o>s)return;if(n.content)return n.content}catch{return}}function Yg(e){const t={10:["ceilingLight","wallLight"],9:["modularMeetingRoom","phoneBooth"],8:["floorLamp","tableLamp","deskDivider","cushion","plant","officeSupply","tableware","decoration","laundry","electronics","kitchen","car"],7:["shelf","cabinet","wardrobe","storageCombination","outdoor","bicycle","people","sink"],6:["highTable","diningTable","conferenceTable","desk"],5:["sofa","armchair","loungeChair","ottoman","sideboard","pedestal"],4:["taskChair","diningChair","conferenceChair","stool","barStool","bench"],3:["shower"],2:["singleBed","doubleBed","daybed","toilet","bathtub"],1:["sideTable","coffeeTable","radiator","nightstand"],0:["rug"]};let i=0;return e.subCategories.forEach(r=>{Object.keys(t).forEach(n=>{let o=parseInt(n);t[n].includes(r)&&o>i&&(i=o)})}),i===1&&e.categories.includes("tables")&&e.boundingBox.height>.6&&(i=6),i}const Na={kitchen:yg,column:fg,stairs:Cg,wall:Pg,door:mg};function Gg(e,t,i){if(Na[e.type])return Na[e.type](e,t);if(ao[e.type])return ao[e.type](e,t,i)}const ao={box:e=>ri(e),curtain:e=>{const t=Math.min(Math.max(e.folds||10,Math.round(e.l*5)),Math.max(1,Math.round(e.l*15))),i=.05,r=e.w,n=e.l/t;let o=[],s=[];var a,h,l,u=0,c=r/2,d=i/2;let f=e.id.replace(/-/gi,""),m=f.length;for(var v=0;v<t;v++){h=d,l=c;let y=parseInt(f[v%m],16)/20;d=i/2+y*i/2*(v%2===0?-1:1),c=r/2+y*r/2*(v%2===0?-1:1),a=u,u=n*(v+1),s.push([a,l]),o.push([a,h]),v===t-1&&(s.push([u,c]),o.push([u,d]))}return[{type:"composite",segments:[{type:"quadraticBezier",points:o},{type:"quadraticBezier",points:s.reverse()}]}]},railing:e=>ri(e),floor:e=>ri(e),window:(e,t)=>ri(e,t),closet:e=>ri(e),interior:(e,t,i)=>{if(!i)return[{type:"circle",position:[0,0],radius:.01}];if(i=i.sort((r,n)=>Ii(r)>Ii(n)?-1:1),!(!i||!i.length))return[{type:"polygon",points:i[0],holes:i.slice(1)}]},polyfloor:e=>[{type:"polygon",points:e.polygon,holes:e.polygonHoles||[]}],polybox:e=>[{type:"polygon",points:e.polygon}],"a:helper:spaceDivider":e=>[{type:"rectangle",position:[0,-.02],dimensions:[e.l,.04]}],floorplan:e=>[{type:"rectangle",position:[-e.l/2,-e.w/2],dimensions:[e.l,e.w],style:{fill:!1}}]};function ri(e,t){let i=0,r=e.w;return e.type==="wall"&&(i=e.controlLine==="front"?e.w:e.controlLine==="center"?e.w/2:0),e.type==="window"&&(r=t.w,i=t.controlLine==="front"?t.w:t.controlLine==="center"?t.w/2:0),[{type:"polygon",points:[[0,0-i],[e.l,0-i],[e.l,r-i],[0,r-i]]}]}const Ne=e=>{var t;return((t=e.src)==null?void 0:t.substring(1))||""},Hg="fpe-pr1-",dl="fpe-dc2-";class Wg extends Lo{constructor(t,i){var r,n,o;super(),this.productQueue={},this.textureQueue={},this.promiseCache=new Map,this.loadStages={product:!0,productContour:!0,productTexture:!1},this.isSceneStructureLoaded=!1,this.initialLoading=!0,this._loadCounter=0,this.resources=t,this.productContourCacheAge=(r=i.api)==null?void 0:r.productContourCacheAge,this.productDataCacheAge=(n=i.api)==null?void 0:n.productDataCacheAge,this.loadStages.productTexture=!!((o=i.theme)!=null&&o.showAssetTextures)&&i.loadTextures!==!1,this.on("product-load-stage",this.loadStatus,this)}loadStatus({args:t}){const i=Object.values(this.textureQueue).reduce((o,s)=>o+s.nodes.size,0),r=Object.values(this.productQueue).reduce((o,s)=>o+s.nodes.size,0),n=i+r;this._loadCounter++,this.emit("loading-status",{totalCount:n,doneCount:this._loadCounter}),n===this._loadCounter&&this.emit("loading-done",{totalCount:n})}reset(){this.resources.spaces=[],this.resources.assets=[],this.resources.products={},this.resources.productContours={},this.resources.productBoundingBoxes={},this.textureQueue={},this.productQueue={},this._loadCounter=0,this.promiseCache=new Map,this.initialLoading=!0}}async function zg(e,t){if(t.promiseCache||(t.promiseCache=new Map),!e||!e.src)return;const i=Ne(e);t.productQueue[i]||(t.productQueue[i]={loadStage:0,nodes:new Set}),t.productQueue[i].nodes.add(e),t.productQueue[i].loadStage<1&&await Kg(i,t),t.loadStages.productContour&&jg(e,t)}async function jg(e,t){const i=Ne(e),r=t.resources.products[i];if(!r||!t.productQueue[i])return;const n=hg(e,r);if($g(t.resources,e),!t.textureQueue[n]){const o=Lr.getProductThumbnailUrl(n);t.textureQueue[n]={productId:i,loadStage:0,nodes:new Set,textureUrl:o,applyFilter:!0},t.loadStages.productTexture&&t.emit("product-load-texture",{textureId:n,productData:r})}if(t.textureQueue[n].nodes.add(e),t.textureQueue[n].loadStage===2){t.emit("product-load-stage",{node:e,args:{_loadStage:3,_textureId:n}});return}t.resources.productBoundingBoxes[i]||(t.resources.productBoundingBoxes[i]=Vg(r),t.productQueue[i].loadStage=2),t.productQueue[i].loadStage===2&&t.emit("product-load-stage",{node:e,args:{_loadStage:2}}),t.resources.productContours[i]||qg(r,t).then(()=>{var o,s;((o=t.textureQueue[n])==null?void 0:o.loadStage)===1||((s=t.textureQueue[n])==null?void 0:s.error)?t.emit("product-contour",n):t.loadStages.productTexture||t.emit("product-load-stage",{node:e,args:{_loadStage:3}})})}const Vg=e=>{const t=e.boundingPoints;let i;if(t)return i=[[t.min[0],t.min[2]],[t.min[0],t.max[2]],[t.max[0],t.max[2]],[t.max[0],t.min[2]]],e._loadStage=1,[i]},qg=async(e,t)=>{const{productId:i}=e,r=dl+i,n=t.promiseCache.get(r);if(n)return n;const o=Jg(i,t).then(s=>{const a=s;t.resources.productContours[i]=a,t.resources.products[i]._shapes=ao.interior({type:"interior"},null,a),t.productQueue[i].loadStage=3}).catch(()=>{});return t.promiseCache.set(r,o),o};function Zg(e){if(!e)return;const t=e.subCategories.includes("ceilingLight"),i=e.subCategories.includes("rug"),r=e.productResourceId,n=Lr.getProductThumbnailUrl(r);return{preview:e.preview,manufacturer:e.manufacturer,productId:r,name:e.productDisplayName,fileKey:e.fileKey,tags:e.tags,categories:e.categories,subCategories:e.subCategories,boundingPoints:e.boundingPoints,boundingBox:e.boundingBox,seatCapacity:e.seatCapacity,texture:n,materials:[],matColors:e.matColors,colours:e.colours,order:Yg(e),isCeilingLamp:t,isCarpet:i,createdAt:e.createdAt,updatedAt:e.updatedAt,link:e.link}}function $g(e,t){if(!t||t.type!=="interior")return;let i=Ne(t);if(!i)return;let r=Qh(t,e.products[i]);r&&!e.products[i].materials.includes(r)&&e.products[i].materials.splice(0,0,r)}function Kg(e,t){const i=t.productDataCacheAge,r=i||24*3600*1e3;if(!e)return Promise.reject("product id missing");const n=Hg+e,o=t.promiseCache.get(n);if(o)return o;const s=pl(n,i).then(a=>!a||!a.matColors?Lr.getProduct(e).then(h=>(h.matColors={},h.colours&&h.colours.length&&h.colours.forEach(l=>{if(!l.includes(":"))return;let u=l.split(":"),c=tl(u[1]);h.matColors[c]=u[2]}),cl(n,h,r),h)):a).then(a=>{const h=Zg(a);t.resources.products[e]=h,t.productQueue[e].loadStage=1,t.emit("product-data",{productId:e,data:h})}).catch(a=>{console.warn(a.message)});return t.promiseCache.set(n,s),s}function Jg(e,t){const i=t.productContourCacheAge,r=i||10*24*3600*1e3;if(!e)return Promise.reject("product id missing");const n=dl+e,o=t.promiseCache.get(n);if(o)return o;const s=pl(n,i).then(a=>a||Lr.getProductOutline(e).then(h=>(cl(n,h,r),h))).catch(a=>{console.warn(a)});return t.promiseCache.set(n,s),s}function fl(e,t){const{node:i,...r}=t;return{...r,resourceType:e,setHighlight:n=>{i.setHighlight(n)},node:i}}function Qg(e){return fl("space",e)}function t0(e){return fl("asset",e)}const Ra=e=>{const t=e.scene.nodesByType.interior;return Promise.all(t.map(i=>zg(i,e.loader).catch(r=>console.error(r)))).then(()=>{e.resources.assets=t.map(i=>{const r=r0(i,e.resources);return r&&t0(r)}).filter(i=>i)})};function e0(e,t){!e||t.type!=="polyfloor"||(e.usage=t.usage,e.usageName=rl(t.usage),e.program=Or(t.usage),e.name=t.name,e.customId=t.customId)}function i0(e,t){if(!e)return null;const i=Ne(e),r=t.products[i];if(!r)return null;const{boundingPoints:n}=r;if(n){const{min:o,max:s}=n,a=[[o[0],o[2]],[o[0],s[2]],[s[0],s[2]],[s[0],o[2]]];return Dt(e.getWorldPosition(),a)}return null}function r0(e,t){if(!e)return;const i=Ne(e),r=t.products[i];if(!r){console.error("no productData",i,e);return}const n=e.getWorldPosition(),o=i0(e,t),s=o&&Sr([o]);return{id:e.id,node:e,polygon:o,boundingBox:s,name:r.name,manufacturer:r.manufacturer,productId:i,tags:r.tags,categories:r.categories,subCategories:r.subCategories,dimensions:r.boundingBox,seatCapacity:r.seatCapacity,position:{x:n.x,y:n.y,z:n.z},rotation:n.ry}}class n0{constructor({options:t={},scene:i}={}){this.settings=He(It),this.fpeId="fpe-"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,3),this.resources={spaces:[],assets:[],products:{},productContours:{},productBoundingBoxes:{}},this.computed={wallContours:[],relations:{spaces:[]},snapPoints:[],snapMargin:0},this.isBrowser=typeof process!="object"&&typeof window<"u",this._emitter=new Lo,this.set(t),this.loader=new Wg(this.resources,this.settings),this.scene=i||new dg,i&&this.initScene(i),this.version=It.api.sdkVersion,this.utils={polygonOffset:Ar,polygonIntersection:Uv,pointInPolygon:Ge,polygonUnion:Wh},this.scene.on("scene-structure-loading",()=>{this.loader.isSceneStructureLoaded=!1}),this.scene.on("scene-structure-loaded",this.initScene,this)}on(t,i,r){return this._emitter.on(t,i,r),this}once(t,i,r){return this._emitter.once(t,i,r),this}off(t,i){return this._emitter.off(t,i),this}emit(t,...i){return this._emitter.emit(t,...i),this}initScene(t){this.loader.initialLoading||this.loader.reset(),this.scene||(this.scene=t),this.loader.isSceneStructureLoaded=!0,this.settings.theme.wallContours&&(this.computed.wallContours=vn(this.scene)),this.getSpaces(),this.loader.emit("spaces-loaded",!0),Ra(this).then(()=>{const i=this.settings.hideElements.includes("interior"),r=this.scene.nodesByType.interior.length===0;this.loader.emit("assets-loaded",!0),(i||r)&&this.loader.emit("loading-done",{totalCount:0})}),this.loader.initialLoading=!1}loadScene(t,i=this.settings.api){return new Promise((r,n)=>{(!t||typeof t!="string")&&n(`Expected non-empty string sceneId parameter instead got: "${t}"`);let o;try{o=Rg(i)}catch(s){n(s)}return this.loader.once("assets-loaded",r),Dg.getSceneStructure(t,o).then(s=>(kg(this.fpeId),this.scene.loadSceneStructure(s.structure,{planRotation:this.settings.planRotation}))).catch(s=>{const a=typeof s=="string"?s:s&&s.message;n(a)})}).catch(r=>{throw Bg(this.fpeId,r),r})}getSpaces(){let t=nl({scene:this.scene});this.resources.spaces=t.map(i=>{let r=i.interiors;return delete i.interiors,Qg({...i,assets:r.map(n=>n.id)})})}set(t={}){var i,r,n,o,s,a,h;const l=(i=this.settings.hideElements)==null?void 0:i.includes("interior");let u=He(t);u.theme&&(u.theme=ja(It.theme,u.theme)),u.ui&&(u.ui={...It.ui,...u.ui}),u.api&&(u.api={...It.api,...u.api}),u.units&&(u.units={...It.units,...u.units});const c=!((r=u.hideElements)!=null&&r.includes("interior"));for(let d in u)this.settings[d]=u[d];if((s=(o=(n=this.settings.theme)==null?void 0:n.elements)==null?void 0:o.space)!=null&&s.program){const d=this.settings.theme.elements.space.program,f={wash:"care",operate:"support",common:"socialize"};Object.keys(d).forEach(m=>{Object.keys(f).includes(m)&&(d[f[m]]=d[m],delete d[m])})}this.scene&&this.scene.node&&(l&&c&&Ra(this),((a=u.theme)==null?void 0:a.wallContours)&&!((h=this.computed.wallContours)!=null&&h.length)&&(this.computed.wallContours=vn(this.scene)),this.scene.node.ry!==u.planRotation&&Number.isFinite(u.planRotation)&&(this.scene.node.set({ry:u.planRotation}),this.computed.wallContours&&(this.computed.wallContours=vn(this.scene))),this.getSpaces()),this.emit("update-settings",this.settings)}getResourcesFromPosition(t){const i=this.resources.spaces.filter(n=>Ge(t,n.polygons[0],n.polygons.slice(1))),r=[];return i.forEach(n=>{let o=this.resources.assets.filter(s=>n.assets.includes(s.id)).filter(s=>{var a;if(!(((a=this.resources.products[s.productId])==null?void 0:a.isCeilingLamp)&&!this.settings.showCeilingLamps)&&!(!s.polygon||!s.polygon.length))return Ge(t,s.polygon)});r.push(...o)}),{spaces:i,assets:r}}getElementBoundingBox(t,i=0){if(!t)return;let r,n;if(t instanceof Ci?n=t.getWorldPosition():typeof t=="string"&&(r=this.scene.nodesById[t].find({id:t}),n=r&&r.getWorldPosition()),!n)return;let o;if(n.type==="interior"&&n.src){let a=Ne(n),h=this.resources.productBoundingBoxes[a]||this.resources.productContours[a];o=h&&Dt(n,h[0])}else n.type==="polyfloor"?o=Dt(n,n.polygon):n.type!=="group"?o=so(n):o=[[n.x-2,n.z-2],[n.x+2,n.z-2],[n.x+2,n.z+2],[n.x-2,n.z+2]];const s=Sr([o]);return{x:s.x-i,z:s.z-i,x2:s.x2+i,z2:s.z2+i,length:s.length+i*2,width:s.width+i*2}}destroy(){delete this.scene,delete this.resources,delete this.settings,delete this.utils}}const Ma=(e,t,i=.15)=>{let r,n,o;for(const s of t)if(r=Math.abs(e[0]-s[0]),!(r>i)&&(n=Math.abs(e[1]-s[1]),r<i&&n<i)){o=s;break}return o};function o0(e,t,i){const r=new MutationObserver(()=>{function n(o){return o.parentNode===t?!1:o.parentNode===null?!0:n(o.parentNode)}n(e)&&(r.disconnect(),i())});r.observe(t,{childList:!0,subtree:!0})}function s0(e,t,i){let{x:r,z:n,x2:o,z2:s,length:a,width:h}=e;const l=t/i;if(a/h>l){const u=h;h=a/l;const c=(u-h)/2;n+=c,s-=c}else{const u=a;a=h*l;const c=(u-a)/2;r+=c,o-=c}return{x:r,x2:o,z:n,z2:s,length:a,width:h}}function a0(e,t){var i,r;if(Or(e.usage)==="void")return[];let{showUsage:n,showArea:o,roomStampDisplay:s}=((i=t.theme.elements)==null?void 0:i.roomStamp)||{};const a=t.spaceLabelMapping||{};let h;a[e.usage]!==void 0&&(h=a[e.usage]),a[e.id]!==void 0&&(h=a[e.id]);let l;switch(t.units.roomDimensions){case"area":l=Wa(e.area,t.units.system,t.units.areaDecimals);break;case"boundingBox":const{length:d,width:f}=e.boundingBox;l=`${fi(d,t.units.system,t.units.lengthDecimals)} x ${fi(f,t.units.system,t.units.lengthDecimals)}`;break;default:l="";break}let u=e.usageName;if(!u&&e.usage!=="undefined"&&(u=Bl(e.usage||"")),h!==void 0&&(typeof h!="string"?console.warn("space label mapping has to be a string"):h.length>50?console.warn("space label mapping has to be less than 50 characters"):u=h),!s){const d=((r=t.theme.elements)==null?void 0:r.roomStamp)!==!1,f=n!==void 0||o!==void 0;s=[],d&&f?(n&&s.push("usage"),o&&s.push("area")):d&&s.push("usage","area")}const c=[];return s.forEach(d=>{var f,m;switch(d){case"name":(f=e.node)!=null&&f.name&&c.push(e.node.name);break;case"customId":(m=e.node)!=null&&m.customId&&c.push(e.node.customId);break;case"usage":c.push(u);break;case"area":c.push(l);break}}),c}function ho(e,t=0){return({door:31,window:31,column:30,wall:30,closet:20,railing:20,curtain:20,kitchen:20,group:12,box:11,polybox:11,interior:10,"a:helper:spaceDivider":5,stairs:5,floor:0,polyfloor:0}[e]||0)+t}var ml={exports:{}};(function(e,t){(function(){var i,r;r=function(n){return e.exports=n},i={linear:function(n,o,s,a){return s*n/a+o},easeInQuad:function(n,o,s,a){return s*(n/=a)*n+o},easeOutQuad:function(n,o,s,a){return-s*(n/=a)*(n-2)+o},easeInOutQuad:function(n,o,s,a){return(n/=a/2)<1?s/2*n*n+o:-s/2*(--n*(n-2)-1)+o},easeInCubic:function(n,o,s,a){return s*(n/=a)*n*n+o},easeOutCubic:function(n,o,s,a){return s*((n=n/a-1)*n*n+1)+o},easeInOutCubic:function(n,o,s,a){return(n/=a/2)<1?s/2*n*n*n+o:s/2*((n-=2)*n*n+2)+o},easeInQuart:function(n,o,s,a){return s*(n/=a)*n*n*n+o},easeOutQuart:function(n,o,s,a){return-s*((n=n/a-1)*n*n*n-1)+o},easeInOutQuart:function(n,o,s,a){return(n/=a/2)<1?s/2*n*n*n*n+o:-s/2*((n-=2)*n*n*n-2)+o},easeInQuint:function(n,o,s,a){return s*(n/=a)*n*n*n*n+o},easeOutQuint:function(n,o,s,a){return s*((n=n/a-1)*n*n*n*n+1)+o},easeInOutQuint:function(n,o,s,a){return(n/=a/2)<1?s/2*n*n*n*n*n+o:s/2*((n-=2)*n*n*n*n+2)+o},easeInSine:function(n,o,s,a){return-s*Math.cos(n/a*(Math.PI/2))+s+o},easeOutSine:function(n,o,s,a){return s*Math.sin(n/a*(Math.PI/2))+o},easeInOutSine:function(n,o,s,a){return-s/2*(Math.cos(Math.PI*n/a)-1)+o},easeInExpo:function(n,o,s,a){return n===0?o:s*Math.pow(2,10*(n/a-1))+o},easeOutExpo:function(n,o,s,a){return n===a?o+s:s*(-Math.pow(2,-10*n/a)+1)+o},easeInOutExpo:function(n,o,s,a){return(n/=a/2)<1?s/2*Math.pow(2,10*(n-1))+o:s/2*(-Math.pow(2,-10*--n)+2)+o},easeInCirc:function(n,o,s,a){return-s*(Math.sqrt(1-(n/=a)*n)-1)+o},easeOutCirc:function(n,o,s,a){return s*Math.sqrt(1-(n=n/a-1)*n)+o},easeInOutCirc:function(n,o,s,a){return(n/=a/2)<1?-s/2*(Math.sqrt(1-n*n)-1)+o:s/2*(Math.sqrt(1-(n-=2)*n)+1)+o},easeInElastic:function(n,o,s,a){var h,l,u;return u=1.70158,l=0,h=s,n===0||(n/=a),l||(l=a*.3),h<Math.abs(s)?(h=s,u=l/4):u=l/(2*Math.PI)*Math.asin(s/h),-(h*Math.pow(2,10*(n-=1))*Math.sin((n*a-u)*(2*Math.PI)/l))+o},easeOutElastic:function(n,o,s,a){var h,l,u;return u=1.70158,l=0,h=s,n===0||(n/=a),l||(l=a*.3),h<Math.abs(s)?(h=s,u=l/4):u=l/(2*Math.PI)*Math.asin(s/h),h*Math.pow(2,-10*n)*Math.sin((n*a-u)*(2*Math.PI)/l)+s+o},easeInOutElastic:function(n,o,s,a){var h,l,u;return u=1.70158,l=0,h=s,n===0||(n/=a/2),l||(l=a*(.3*1.5)),h<Math.abs(s)?(h=s,u=l/4):u=l/(2*Math.PI)*Math.asin(s/h),n<1?-.5*(h*Math.pow(2,10*(n-=1))*Math.sin((n*a-u)*(2*Math.PI)/l))+o:h*Math.pow(2,-10*(n-=1))*Math.sin((n*a-u)*(2*Math.PI)/l)*.5+s+o},easeInBack:function(n,o,s,a,h){return h===void 0&&(h=1.70158),s*(n/=a)*n*((h+1)*n-h)+o},easeOutBack:function(n,o,s,a,h){return h===void 0&&(h=1.70158),s*((n=n/a-1)*n*((h+1)*n+h)+1)+o},easeInOutBack:function(n,o,s,a,h){return h===void 0&&(h=1.70158),(n/=a/2)<1?s/2*(n*n*(((h*=1.525)+1)*n-h))+o:s/2*((n-=2)*n*(((h*=1.525)+1)*n+h)+2)+o},easeInBounce:function(n,o,s,a){var h;return h=i.easeOutBounce(a-n,0,s,a),s-h+o},easeOutBounce:function(n,o,s,a){return(n/=a)<1/2.75?s*(7.5625*n*n)+o:n<2/2.75?s*(7.5625*(n-=1.5/2.75)*n+.75)+o:n<2.5/2.75?s*(7.5625*(n-=2.25/2.75)*n+.9375)+o:s*(7.5625*(n-=2.625/2.75)*n+.984375)+o},easeInOutBounce:function(n,o,s,a){var h;return n<a/2?(h=i.easeInBounce(n*2,0,s,a),h*.5+o):(h=i.easeOutBounce(n*2-a,0,s,a),h*.5+s*.5+o)}},r(i)}).call(Wt)})(ml);var lo=ml.exports;class xt{constructor(t){this.parent=t,this.paused=!1}destroy(){}down(t){return!1}move(t){return!1}up(t){return!1}wheel(t){return!1}update(t){}resize(){}reset(){}pause(){this.paused=!0}resume(){this.paused=!1}}function Nr(e,t){if(e){if(typeof e=="function")return e;if(typeof e=="string")return lo[e]}else return lo[t]}const h0={removeOnInterrupt:!1,ease:"linear",time:1e3};class Gt extends xt{__init(){this.startWidth=null}__init2(){this.startHeight=null}__init3(){this.deltaWidth=null}__init4(){this.deltaHeight=null}__init5(){this.width=null}__init6(){this.height=null}__init7(){this.time=0}constructor(t,i={}){super(t),Gt.prototype.__init.call(this),Gt.prototype.__init2.call(this),Gt.prototype.__init3.call(this),Gt.prototype.__init4.call(this),Gt.prototype.__init5.call(this),Gt.prototype.__init6.call(this),Gt.prototype.__init7.call(this),this.options=Object.assign({},h0,i),this.options.ease=Nr(this.options.ease),this.setupPosition(),this.setupZoom(),this.time=0}setupPosition(){typeof this.options.position<"u"?(this.startX=this.parent.center.x,this.startY=this.parent.center.y,this.deltaX=this.options.position.x-this.parent.center.x,this.deltaY=this.options.position.y-this.parent.center.y,this.keepCenter=!1):this.keepCenter=!0}setupZoom(){this.width=null,this.height=null,typeof this.options.scale<"u"?this.width=this.parent.screenWidth/this.options.scale:typeof this.options.scaleX<"u"||typeof this.options.scaleY<"u"?(typeof this.options.scaleX<"u"&&(this.width=this.parent.screenWidth/this.options.scaleX),typeof this.options.scaleY<"u"&&(this.height=this.parent.screenHeight/this.options.scaleY)):(typeof this.options.width<"u"&&(this.width=this.options.width),typeof this.options.height<"u"&&(this.height=this.options.height)),this.width!==null&&(this.startWidth=this.parent.screenWidthInWorldPixels,this.deltaWidth=this.width-this.startWidth),this.height!==null&&(this.startHeight=this.parent.screenHeightInWorldPixels,this.deltaHeight=this.height-this.startHeight)}down(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("animate"),!1}complete(){this.parent.plugins.remove("animate"),this.width!==null&&this.parent.fitWidth(this.width,this.keepCenter,this.height===null),this.height!==null&&this.parent.fitHeight(this.height,this.keepCenter,this.width===null),this.keepCenter||this.parent.moveCenter(this.options.position),this.parent.emit("animate-end",this.parent),this.options.callbackOnComplete&&this.options.callbackOnComplete(this.parent)}update(t){if(!this.paused)if(this.time+=t,this.time>=this.options.time)this.complete();else{const i=new G(this.parent.scale.x,this.parent.scale.y),r=this.options.ease(this.time,0,1,this.options.time);if(this.width!==null){const n=this.startWidth,o=this.deltaWidth;this.parent.fitWidth(n+o*r,this.keepCenter,this.height===null)}if(this.height!==null){const n=this.startHeight,o=this.deltaHeight;this.parent.fitHeight(n+o*r,this.keepCenter,this.width===null)}if(this.width===null?this.parent.scale.x=this.parent.scale.y:this.height===null&&(this.parent.scale.y=this.parent.scale.x),!this.keepCenter){const n=this.startX,o=this.startY,s=this.deltaX,a=this.deltaY,h=new G(this.parent.x,this.parent.y);this.parent.moveCenter(n+s*r,o+a*r),this.parent.emit("moved",{viewport:this.parent,original:h,type:"animate"})}(this.width||this.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:i,type:"animate"})}}}function Ji(e){let t,i=e[0],r=1;for(;r<e.length;){const n=e[r],o=e[r+1];if(r+=2,(n==="optionalAccess"||n==="optionalCall")&&i==null)return;n==="access"||n==="optionalAccess"?(t=i,i=o(i)):(n==="call"||n==="optionalCall")&&(i=o((...s)=>i.call(t,...s)),t=void 0)}return i}const l0={sides:"all",friction:.5,time:150,ease:"easeInOutSine",underflow:"center",bounceBox:null};class u0 extends xt{constructor(t,i={}){super(t),this.options=Object.assign({},l0,i),this.ease=Nr(this.options.ease,"easeInOutSine"),this.options.sides?this.options.sides==="all"?this.top=this.bottom=this.left=this.right=!0:this.options.sides==="horizontal"?(this.right=this.left=!0,this.top=this.bottom=!1):this.options.sides==="vertical"?(this.left=this.right=!1,this.top=this.bottom=!0):(this.top=this.options.sides.indexOf("top")!==-1,this.bottom=this.options.sides.indexOf("bottom")!==-1,this.left=this.options.sides.indexOf("left")!==-1,this.right=this.options.sides.indexOf("right")!==-1):this.left=this.top=this.right=this.bottom=!1;const r=this.options.underflow.toLowerCase();r==="center"?(this.underflowX=0,this.underflowY=0):(this.underflowX=r.indexOf("left")!==-1?-1:r.indexOf("right")!==-1?1:0,this.underflowY=r.indexOf("top")!==-1?-1:r.indexOf("bottom")!==-1?1:0),this.reset()}isActive(){return this.toX!==null||this.toY!==null}down(){return this.toX=this.toY=null,!1}up(){return this.bounce(),!1}update(t){if(!this.paused){if(this.bounce(),this.toX){const i=this.toX;i.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-x"}),i.time>=this.options.time?(this.parent.x=i.end,this.toX=null,this.parent.emit("bounce-x-end",this.parent)):this.parent.x=this.ease(i.time,i.start,i.delta,this.options.time)}if(this.toY){const i=this.toY;i.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-y"}),i.time>=this.options.time?(this.parent.y=i.end,this.toY=null,this.parent.emit("bounce-y-end",this.parent)):this.parent.y=this.ease(i.time,i.start,i.delta,this.options.time)}}}calcUnderflowX(){let t;switch(this.underflowX){case-1:t=0;break;case 1:t=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:t=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}return t}calcUnderflowY(){let t;switch(this.underflowY){case-1:t=0;break;case 1:t=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:t=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}return t}oob(){const t=this.options.bounceBox;if(t){const i=typeof t.x>"u"?0:t.x,r=typeof t.y>"u"?0:t.y,n=typeof t.width>"u"?this.parent.worldWidth:t.width,o=typeof t.height>"u"?this.parent.worldHeight:t.height;return{left:this.parent.left<i,right:this.parent.right>n,top:this.parent.top<r,bottom:this.parent.bottom>o,topLeft:new G(i*this.parent.scale.x,r*this.parent.scale.y),bottomRight:new G(n*this.parent.scale.x-this.parent.screenWidth,o*this.parent.scale.y-this.parent.screenHeight)}}return{left:this.parent.left<0,right:this.parent.right>this.parent.worldWidth,top:this.parent.top<0,bottom:this.parent.bottom>this.parent.worldHeight,topLeft:new G(0,0),bottomRight:new G(this.parent.worldWidth*this.parent.scale.x-this.parent.screenWidth,this.parent.worldHeight*this.parent.scale.y-this.parent.screenHeight)}}bounce(){if(this.paused)return;let t,i=this.parent.plugins.get("decelerate",!0);i&&(i.x||i.y)&&(i.x&&i.percentChangeX===Ji([i,"access",o=>o.options,"optionalAccess",o=>o.friction])||i.y&&i.percentChangeY===Ji([i,"access",o=>o.options,"optionalAccess",o=>o.friction]))&&(t=this.oob(),(t.left&&this.left||t.right&&this.right)&&(i.percentChangeX=this.options.friction),(t.top&&this.top||t.bottom&&this.bottom)&&(i.percentChangeY=this.options.friction));const r=this.parent.plugins.get("drag",!0)||{},n=this.parent.plugins.get("pinch",!0)||{};if(i=i||{},!Ji([r,"optionalAccess",o=>o.active])&&!Ji([n,"optionalAccess",o=>o.active])&&(!this.toX||!this.toY)&&(!i.x||!i.y)){t=t||this.oob();const o=t.topLeft,s=t.bottomRight;if(!this.toX&&!i.x){let a=null;t.left&&this.left?a=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-o.x:t.right&&this.right&&(a=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-s.x),a!==null&&this.parent.x!==a&&(this.toX={time:0,start:this.parent.x,delta:a-this.parent.x,end:a},this.parent.emit("bounce-x-start",this.parent))}if(!this.toY&&!i.y){let a=null;t.top&&this.top?a=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-o.y:t.bottom&&this.bottom&&(a=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-s.y),a!==null&&this.parent.y!==a&&(this.toY={time:0,start:this.parent.y,delta:a-this.parent.y,end:a},this.parent.emit("bounce-y-start",this.parent))}}}reset(){this.toX=this.toY=null,this.bounce()}}const c0={left:!1,right:!1,top:!1,bottom:!1,direction:null,underflow:"center"};class p0 extends xt{constructor(t,i={}){super(t),this.options=Object.assign({},c0,i),this.options.direction&&(this.options.left=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.right=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.top=this.options.direction==="y"||this.options.direction==="all"?!0:null,this.options.bottom=this.options.direction==="y"||this.options.direction==="all"?!0:null),this.parseUnderflow(),this.last={x:null,y:null,scaleX:null,scaleY:null},this.update()}parseUnderflow(){const t=this.options.underflow.toLowerCase();t==="none"?this.noUnderflow=!0:t==="center"?(this.underflowX=this.underflowY=0,this.noUnderflow=!1):(this.underflowX=t.indexOf("left")!==-1?-1:t.indexOf("right")!==-1?1:0,this.underflowY=t.indexOf("top")!==-1?-1:t.indexOf("bottom")!==-1?1:0,this.noUnderflow=!1)}move(){return this.update(),!1}update(){if(this.paused||this.parent.x===this.last.x&&this.parent.y===this.last.y&&this.parent.scale.x===this.last.scaleX&&this.parent.scale.y===this.last.scaleY)return;const t={x:this.parent.x,y:this.parent.y},i=this.parent.plugins.decelerate||{};if(this.options.left!==null||this.options.right!==null){let r=!1;if(!this.noUnderflow&&this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x!==0&&(this.parent.x=0,r=!0);break;case 1:this.parent.x!==this.parent.screenWidth-this.parent.screenWorldWidth&&(this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth,r=!0);break;default:this.parent.x!==(this.parent.screenWidth-this.parent.screenWorldWidth)/2&&(this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2,r=!0)}else this.options.left!==null&&this.parent.left<(this.options.left===!0?0:this.options.left)&&(this.parent.x=-(this.options.left===!0?0:this.options.left)*this.parent.scale.x,i.x=0,r=!0),this.options.right!==null&&this.parent.right>(this.options.right===!0?this.parent.worldWidth:this.options.right)&&(this.parent.x=-(this.options.right===!0?this.parent.worldWidth:this.options.right)*this.parent.scale.x+this.parent.screenWidth,i.x=0,r=!0);r&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-x"})}if(this.options.top!==null||this.options.bottom!==null){let r=!1;if(!this.noUnderflow&&this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y!==0&&(this.parent.y=0,r=!0);break;case 1:this.parent.y!==this.parent.screenHeight-this.parent.screenWorldHeight&&(this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight,r=!0);break;default:this.parent.y!==(this.parent.screenHeight-this.parent.screenWorldHeight)/2&&(this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2,r=!0)}else this.options.top!==null&&this.parent.top<(this.options.top===!0?0:this.options.top)&&(this.parent.y=-(this.options.top===!0?0:this.options.top)*this.parent.scale.y,i.y=0,r=!0),this.options.bottom!==null&&this.parent.bottom>(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)&&(this.parent.y=-(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)*this.parent.scale.y+this.parent.screenHeight,i.y=0,r=!0);r&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-y"})}this.last.x=this.parent.x,this.last.y=this.parent.y,this.last.scaleX=this.parent.scale.x,this.last.scaleY=this.parent.scale.y}reset(){this.update()}}const d0={minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,minScale:null,maxScale:null};class f0 extends xt{constructor(t,i={}){super(t),this.options=Object.assign({},d0,i),this.clamp()}resize(){this.clamp()}clamp(){if(!this.paused){if(this.options.minWidth||this.options.minHeight||this.options.maxWidth||this.options.maxHeight){let t=this.parent.worldScreenWidth,i=this.parent.worldScreenHeight;if(this.options.minWidth!==null&&t<this.options.minWidth){const r=this.parent.scale.x;this.parent.fitWidth(this.options.minWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/r,t=this.parent.worldScreenWidth,i=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxWidth!==null&&t>this.options.maxWidth){const r=this.parent.scale.x;this.parent.fitWidth(this.options.maxWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/r,t=this.parent.worldScreenWidth,i=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.minHeight!==null&&i<this.options.minHeight){const r=this.parent.scale.y;this.parent.fitHeight(this.options.minHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/r,t=this.parent.worldScreenWidth,i=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxHeight!==null&&i>this.options.maxHeight){const r=this.parent.scale.y;this.parent.fitHeight(this.options.maxHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/r,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}}else if(this.options.minScale||this.options.maxScale){const t={x:null,y:null},i={x:null,y:null};if(typeof this.options.minScale=="number")t.x=this.options.minScale,t.y=this.options.minScale;else if(this.options.minScale!==null){const o=this.options.minScale;t.x=typeof o.x>"u"?null:o.x,t.y=typeof o.y>"u"?null:o.y}if(typeof this.options.maxScale=="number")i.x=this.options.maxScale,i.y=this.options.maxScale;else if(this.options.maxScale!==null){const o=this.options.maxScale;i.x=typeof o.x>"u"?null:o.x,i.y=typeof o.y>"u"?null:o.y}let r=this.parent.scale.x,n=this.parent.scale.y;t.x!==null&&r<t.x&&(r=t.x),i.x!==null&&r>i.x&&(r=i.x),t.y!==null&&n<t.y&&(n=t.y),i.y!==null&&n>i.y&&(n=i.y),(r!==this.parent.scale.x||n!==this.parent.scale.y)&&(this.parent.scale.set(r,n),this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"}))}}}reset(){this.clamp()}}const m0={friction:.98,bounce:.8,minSpeed:.01},Kt=16;class y0 extends xt{constructor(t,i={}){super(t),this.options=Object.assign({},m0,i),this.saved=[],this.timeSinceRelease=0,this.reset(),this.parent.on("moved",r=>this.moved(r))}down(){return this.saved=[],this.x=this.y=null,!1}isActive(){return!!(this.x||this.y)}move(){if(this.paused)return!1;const t=this.parent.input.count();return(t===1||t>1&&!this.parent.plugins.get("pinch",!0))&&(this.saved.push({x:this.parent.x,y:this.parent.y,time:performance.now()}),this.saved.length>60&&this.saved.splice(0,30)),!1}moved(t){if(this.saved.length){const i=this.saved[this.saved.length-1];t.type==="clamp-x"?i.x===t.original.x&&(i.x=this.parent.x):t.type==="clamp-y"&&i.y===t.original.y&&(i.y=this.parent.y)}}up(){if(this.parent.input.count()===0&&this.saved.length){const t=performance.now();for(const i of this.saved)if(i.time>=t-100){const r=t-i.time;this.x=(this.parent.x-i.x)/r,this.y=(this.parent.y-i.y)/r,this.percentChangeX=this.percentChangeY=this.options.friction,this.timeSinceRelease=0;break}}return!1}activate(t){t=t||{},typeof t.x<"u"&&(this.x=t.x,this.percentChangeX=this.options.friction),typeof t.y<"u"&&(this.y=t.y,this.percentChangeY=this.options.friction)}update(t){if(this.paused)return;const i=this.x||this.y,r=this.timeSinceRelease,n=this.timeSinceRelease+t;if(this.x){const o=this.percentChangeX,s=Math.log(o);this.parent.x+=this.x*Kt/s*(Math.pow(o,n/Kt)-Math.pow(o,r/Kt)),this.x*=Math.pow(this.percentChangeX,t/Kt)}if(this.y){const o=this.percentChangeY,s=Math.log(o);this.parent.y+=this.y*Kt/s*(Math.pow(o,n/Kt)-Math.pow(o,r/Kt)),this.y*=Math.pow(this.percentChangeY,t/Kt)}this.timeSinceRelease+=t,this.x&&this.y?Math.abs(this.x)<this.options.minSpeed&&Math.abs(this.y)<this.options.minSpeed&&(this.x=0,this.y=0):(Math.abs(this.x||0)<this.options.minSpeed&&(this.x=0),Math.abs(this.y||0)<this.options.minSpeed&&(this.y=0)),i&&this.parent.emit("moved",{viewport:this.parent,type:"decelerate"})}reset(){this.x=this.y=null}}const v0={direction:"all",pressDrag:!0,wheel:!0,wheelScroll:1,reverse:!1,clampWheel:!1,underflow:"center",factor:1,mouseButtons:"all",keyToPress:null,ignoreKeyToPressOnTouch:!1,lineHeight:20};class g0 extends xt{constructor(t,i={}){super(t),this.options=Object.assign({},v0,i),this.moved=!1,this.reverse=this.options.reverse?1:-1,this.xDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="x",this.yDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="y",this.keyIsPressed=!1,this.parseUnderflow(),this.mouseButtons(this.options.mouseButtons),this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){window.addEventListener("keydown",i=>{t.includes(i.code)&&(this.keyIsPressed=!0)}),window.addEventListener("keyup",i=>{t.includes(i.code)&&(this.keyIsPressed=!1)})}mouseButtons(t){!t||t==="all"?this.mouse=[!0,!0,!0]:this.mouse=[t.indexOf("left")!==-1,t.indexOf("middle")!==-1,t.indexOf("right")!==-1]}parseUnderflow(){const t=this.options.underflow.toLowerCase();t==="center"?(this.underflowX=0,this.underflowY=0):(t.includes("left")?this.underflowX=-1:t.includes("right")?this.underflowX=1:this.underflowX=0,t.includes("top")?this.underflowY=-1:t.includes("bottom")?this.underflowY=1:this.underflowY=0)}checkButtons(t){const i=t.data.pointerType==="mouse",r=this.parent.input.count();return!!((r===1||r>1&&!this.parent.plugins.get("pinch",!0))&&(!i||this.mouse[t.data.button]))}checkKeyPress(t){return!this.options.keyToPress||this.keyIsPressed||this.options.ignoreKeyToPressOnTouch&&t.data.pointerType==="touch"}down(t){return this.paused||!this.options.pressDrag?!1:this.checkButtons(t)&&this.checkKeyPress(t)?(this.last={x:t.data.global.x,y:t.data.global.y},this.current=t.data.pointerId,!0):(this.last=null,!1)}get active(){return this.moved}move(t){if(this.paused||!this.options.pressDrag)return!1;if(this.last&&this.current===t.data.pointerId){const i=t.data.global.x,r=t.data.global.y,n=this.parent.input.count();if(n===1||n>1&&!this.parent.plugins.get("pinch",!0)){const o=i-this.last.x,s=r-this.last.y;if(this.moved||this.xDirection&&this.parent.input.checkThreshold(o)||this.yDirection&&this.parent.input.checkThreshold(s)){const a={x:i,y:r};return this.xDirection&&(this.parent.x+=(a.x-this.last.x)*this.options.factor),this.yDirection&&(this.parent.y+=(a.y-this.last.y)*this.options.factor),this.last=a,this.moved||this.parent.emit("drag-start",{event:t,screen:new G(this.last.x,this.last.y),world:this.parent.toWorld(new G(this.last.x,this.last.y)),viewport:this.parent}),this.moved=!0,this.parent.emit("moved",{viewport:this.parent,type:"drag"}),!0}}else this.moved=!1}return!1}up(t){if(this.paused)return!1;const i=this.parent.input.touches;if(i.length===1){const r=i[0];return r.last&&(this.last={x:r.last.x,y:r.last.y},this.current=r.id),this.moved=!1,!0}else if(this.last&&this.moved){const r=new G(this.last.x,this.last.y);return this.parent.emit("drag-end",{event:t,screen:r,world:this.parent.toWorld(r),viewport:this.parent}),this.last=null,this.moved=!1,!0}return!1}wheel(t){if(this.paused)return!1;if(this.options.wheel){const i=this.parent.plugins.get("wheel",!0);if(!i||!i.options.wheelZoom&&!t.ctrlKey){const r=t.deltaMode?this.options.lineHeight:1;return this.xDirection&&(this.parent.x+=t.deltaX*r*this.options.wheelScroll*this.reverse),this.yDirection&&(this.parent.y+=t.deltaY*r*this.options.wheelScroll*this.reverse),this.options.clampWheel&&this.clamp(),this.parent.emit("wheel-scroll",this.parent),this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.options.passiveWheel||t.preventDefault(),this.parent.options.stopPropagation&&t.stopPropagation(),!0}}return!1}resume(){this.last=null,this.paused=!1}clamp(){const t=this.parent.plugins.get("decelerate",!0)||{};if(this.options.clampWheel!=="y")if(this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x=0;break;case 1:this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}else this.parent.left<0?(this.parent.x=0,t.x=0):this.parent.right>this.parent.worldWidth&&(this.parent.x=-this.parent.worldWidth*this.parent.scale.x+this.parent.screenWidth,t.x=0);if(this.options.clampWheel!=="x")if(this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y=0;break;case 1:this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}else this.parent.top<0&&(this.parent.y=0,t.y=0),this.parent.bottom>this.parent.worldHeight&&(this.parent.y=-this.parent.worldHeight*this.parent.scale.y+this.parent.screenHeight,t.y=0)}}const _0={speed:0,acceleration:null,radius:null};class x0 extends xt{constructor(t,i,r={}){super(t),this.target=i,this.options=Object.assign({},_0,r),this.velocity={x:0,y:0}}update(t){if(this.paused)return;const i=this.parent.center;let r=this.target.x,n=this.target.y;if(this.options.radius)if(Math.sqrt(Math.pow(this.target.y-i.y,2)+Math.pow(this.target.x-i.x,2))>this.options.radius){const a=Math.atan2(this.target.y-i.y,this.target.x-i.x);r=this.target.x-Math.cos(a)*this.options.radius,n=this.target.y-Math.sin(a)*this.options.radius}else return;const o=r-i.x,s=n-i.y;if(o||s)if(this.options.speed)if(this.options.acceleration){const a=Math.atan2(n-i.y,r-i.x),h=Math.sqrt(Math.pow(o,2)+Math.pow(s,2));if(h){const l=(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2))/(2*this.options.acceleration);h>l?this.velocity={x:Math.min(this.velocity.x+this.options.acceleration*t,this.options.speed),y:Math.min(this.velocity.y+this.options.acceleration*t,this.options.speed)}:this.velocity={x:Math.max(this.velocity.x-this.options.acceleration*this.options.speed,0),y:Math.max(this.velocity.y-this.options.acceleration*this.options.speed,0)};const u=Math.cos(a)*this.velocity.x,c=Math.sin(a)*this.velocity.y,d=Math.abs(u)>Math.abs(o)?r:i.x+u,f=Math.abs(c)>Math.abs(s)?n:i.y+c;this.parent.moveCenter(d,f),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}else{const a=Math.atan2(n-i.y,r-i.x),h=Math.cos(a)*this.options.speed,l=Math.sin(a)*this.options.speed,u=Math.abs(h)>Math.abs(o)?r:i.x+h,c=Math.abs(l)>Math.abs(s)?n:i.y+l;this.parent.moveCenter(u,c),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}else this.parent.moveCenter(r,n),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}const b0={radius:null,distance:null,top:null,bottom:null,left:null,right:null,speed:8,reverse:!1,noDecelerate:!1,linear:!1,allowButtons:!1};class P0 extends xt{constructor(t,i={}){super(t),this.options=Object.assign({},b0,i),this.reverse=this.options.reverse?1:-1,this.radiusSquared=typeof this.options.radius=="number"?Math.pow(this.options.radius,2):null,this.resize()}resize(){const t=this.options.distance;t!==null?(this.left=t,this.top=t,this.right=this.parent.worldScreenWidth-t,this.bottom=this.parent.worldScreenHeight-t):this.options.radius||(this.left=this.options.left,this.top=this.options.top,this.right=this.options.right===null?null:this.parent.worldScreenWidth-this.options.right,this.bottom=this.options.bottom===null?null:this.parent.worldScreenHeight-this.options.bottom)}down(){return this.paused||this.options.allowButtons||(this.horizontal=this.vertical=null),!1}move(t){if(this.paused||t.data.pointerType!=="mouse"&&t.data.identifier!==1||!this.options.allowButtons&&t.data.buttons!==0)return!1;const i=t.data.global.x,r=t.data.global.y;if(this.radiusSquared){const n=this.parent.toScreen(this.parent.center);if(Math.pow(n.x-i,2)+Math.pow(n.y-r,2)>=this.radiusSquared){const o=Math.atan2(n.y-r,n.x-i);this.options.linear?(this.horizontal=Math.round(Math.cos(o))*this.options.speed*this.reverse*(60/1e3),this.vertical=Math.round(Math.sin(o))*this.options.speed*this.reverse*(60/1e3)):(this.horizontal=Math.cos(o)*this.options.speed*this.reverse*(60/1e3),this.vertical=Math.sin(o)*this.options.speed*this.reverse*(60/1e3))}else this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=0}else this.left!==null&&i<this.left?this.horizontal=Number(this.reverse)*this.options.speed*(60/1e3):this.right!==null&&i>this.right?this.horizontal=-1*this.reverse*this.options.speed*(60/1e3):(this.decelerateHorizontal(),this.horizontal=0),this.top!==null&&r<this.top?this.vertical=Number(this.reverse)*this.options.speed*(60/1e3):this.bottom!==null&&r>this.bottom?this.vertical=-1*this.reverse*this.options.speed*(60/1e3):(this.decelerateVertical(),this.vertical=0);return!1}decelerateHorizontal(){const t=this.parent.plugins.get("decelerate",!0);this.horizontal&&t&&!this.options.noDecelerate&&t.activate({x:this.horizontal*this.options.speed*this.reverse/(1e3/60)})}decelerateVertical(){const t=this.parent.plugins.get("decelerate",!0);this.vertical&&t&&!this.options.noDecelerate&&t.activate({y:this.vertical*this.options.speed*this.reverse/(1e3/60)})}up(){return this.paused||(this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=null),!1}update(){if(!this.paused&&(this.horizontal||this.vertical)){const t=this.parent.center;this.horizontal&&(t.x+=this.horizontal*this.options.speed),this.vertical&&(t.y+=this.vertical*this.options.speed),this.parent.moveCenter(t),this.parent.emit("moved",{viewport:this.parent,type:"mouse-edges"})}}}const E0={noDrag:!1,percent:1,center:null,factor:1,axis:"all"};class pi extends xt{__init(){this.active=!1}__init2(){this.pinching=!1}__init3(){this.moved=!1}constructor(t,i={}){super(t),pi.prototype.__init.call(this),pi.prototype.__init2.call(this),pi.prototype.__init3.call(this),this.options=Object.assign({},E0,i)}down(){return this.parent.input.count()>=2?(this.active=!0,!0):!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}move(t){if(this.paused||!this.active)return!1;const i=t.data.global.x,r=t.data.global.y,n=this.parent.input.touches;if(n.length>=2){const o=n[0],s=n[1],a=o.last&&s.last?Math.sqrt(Math.pow(s.last.x-o.last.x,2)+Math.pow(s.last.y-o.last.y,2)):null;if(o.id===t.data.pointerId?o.last={x:i,y:r,data:t.data}:s.id===t.data.pointerId&&(s.last={x:i,y:r,data:t.data}),a){let h;const l={x:o.last.x+(s.last.x-o.last.x)/2,y:o.last.y+(s.last.y-o.last.y)/2};this.options.center||(h=this.parent.toLocal(l));let u=Math.sqrt(Math.pow(s.last.x-o.last.x,2)+Math.pow(s.last.y-o.last.y,2));u=u===0?u=1e-10:u;const c=(1-a/u)*this.options.percent*(this.isAxisX()?this.parent.scale.x:this.parent.scale.y);this.isAxisX()&&(this.parent.scale.x+=c),this.isAxisY()&&(this.parent.scale.y+=c),this.parent.emit("zoomed",{viewport:this.parent,type:"pinch",center:l});const d=this.parent.plugins.get("clamp-zoom",!0);if(d&&d.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const f=this.parent.toGlobal(h);this.parent.x+=(l.x-f.x)*this.options.factor,this.parent.y+=(l.y-f.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})}!this.options.noDrag&&this.lastCenter&&(this.parent.x+=(l.x-this.lastCenter.x)*this.options.factor,this.parent.y+=(l.y-this.lastCenter.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})),this.lastCenter=l,this.moved=!0}else this.pinching||(this.parent.emit("pinch-start",this.parent),this.pinching=!0);return!0}return!1}up(){return this.pinching&&this.parent.input.touches.length<=1?(this.active=!1,this.lastCenter=null,this.pinching=!1,this.moved=!1,this.parent.emit("pinch-end",this.parent),!0):!1}}const w0={topLeft:!1,friction:.8,time:1e3,ease:"easeInOutSine",interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1};class T0 extends xt{constructor(t,i,r,n={}){super(t),this.options=Object.assign({},w0,n),this.ease=Nr(n.ease,"easeInOutSine"),this.x=i,this.y=r,this.options.forceStart&&this.snapStart()}snapStart(){this.percent=0,this.snapping={time:0};const t=this.options.topLeft?this.parent.corner:this.parent.center;this.deltaX=this.x-t.x,this.deltaY=this.y-t.y,this.startX=t.x,this.startY=t.y,this.parent.emit("snap-start",this.parent)}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap"):this.options.interrupt&&(this.snapping=null),!1}up(){if(this.parent.input.count()===0){const t=this.parent.plugins.get("decelerate",!0);t&&(t.x||t.y)&&(t.percentChangeX=t.percentChangeY=this.options.friction)}return!1}update(t){if(!this.paused&&!(this.options.interrupt&&this.parent.input.count()!==0))if(this.snapping){const i=this.snapping;i.time+=t;let r,n,o;const s=this.startX,a=this.startY,h=this.deltaX,l=this.deltaY;if(i.time>this.options.time)r=!0,n=s+h,o=a+l;else{const u=this.ease(i.time,0,1,this.options.time);n=s+h*u,o=a+l*u}this.options.topLeft?this.parent.moveCorner(n,o):this.parent.moveCenter(n,o),this.parent.emit("moved",{viewport:this.parent,type:"snap"}),r&&(this.options.removeOnComplete&&this.parent.plugins.remove("snap"),this.parent.emit("snap-end",this.parent),this.snapping=null)}else{const i=this.options.topLeft?this.parent.corner:this.parent.center;(i.x!==this.x||i.y!==this.y)&&this.snapStart()}}}const I0={width:0,height:0,time:1e3,ease:"easeInOutSine",center:null,interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1,noMove:!1};class C0 extends xt{constructor(t,i={}){super(t),this.options=Object.assign({},I0,i),this.ease=Nr(this.options.ease),this.xIndependent=!1,this.yIndependent=!1,this.xScale=0,this.yScale=0,this.options.width>0&&(this.xScale=t.screenWidth/this.options.width,this.xIndependent=!0),this.options.height>0&&(this.yScale=t.screenHeight/this.options.height,this.yIndependent=!0),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale,this.options.time===0?(t.container.scale.x=this.xScale,t.container.scale.y=this.yScale,this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom")):i.forceStart&&this.createSnapping()}createSnapping(){const t=this.parent.worldScreenWidth,i=this.parent.worldScreenHeight,r=this.parent.screenWidth/this.xScale,n=this.parent.screenHeight/this.yScale;this.snapping={time:0,startX:t,startY:i,deltaX:r-t,deltaY:n-i},this.parent.emit("snap-zoom-start",this.parent)}resize(){this.snapping=null,this.options.width>0&&(this.xScale=this.parent.screenWidth/this.options.width),this.options.height>0&&(this.yScale=this.parent.screenHeight/this.options.height),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap-zoom"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap-zoom"):this.options.interrupt&&(this.snapping=null),!1}update(t){if(this.paused||this.options.interrupt&&this.parent.input.count()!==0)return;let i;if(!this.options.center&&!this.options.noMove&&(i=this.parent.center),!this.snapping)(this.parent.scale.x!==this.xScale||this.parent.scale.y!==this.yScale)&&this.createSnapping();else if(this.snapping){const r=this.snapping;if(r.time+=t,r.time>=this.options.time)this.parent.scale.set(this.xScale,this.yScale),this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom"),this.parent.emit("snap-zoom-end",this.parent),this.snapping=null;else{const o=this.snapping,s=this.ease(o.time,o.startX,o.deltaX,this.options.time),a=this.ease(o.time,o.startY,o.deltaY,this.options.time);this.parent.scale.x=this.parent.screenWidth/s,this.parent.scale.y=this.parent.screenHeight/a}const n=this.parent.plugins.get("clamp-zoom",!0);n&&n.clamp(),this.options.noMove||(this.options.center?this.parent.moveCenter(this.options.center):this.parent.moveCenter(i))}}resume(){this.snapping=null,super.resume()}}const S0={percent:.1,smooth:!1,interrupt:!0,reverse:!1,center:null,lineHeight:20,axis:"all",keyToPress:null,trackpadPinch:!1,wheelZoom:!0};class A0 extends xt{constructor(t,i={}){super(t),this.options=Object.assign({},S0,i),this.keyIsPressed=!1,this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){window.addEventListener("keydown",i=>{t.includes(i.code)&&(this.keyIsPressed=!0)}),window.addEventListener("keyup",i=>{t.includes(i.code)&&(this.keyIsPressed=!1)})}checkKeyPress(){return!this.options.keyToPress||this.keyIsPressed}down(){return this.options.interrupt&&(this.smoothing=null),!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}update(){if(this.smoothing){const t=this.smoothingCenter,i=this.smoothing;let r;this.options.center||(r=this.parent.toLocal(t)),this.isAxisX()&&(this.parent.scale.x+=i.x),this.isAxisY()&&(this.parent.scale.y+=i.y),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const n=this.parent.plugins.get("clamp-zoom",!0);if(n&&n.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const o=this.parent.toGlobal(r);this.parent.x+=t.x-o.x,this.parent.y+=t.y-o.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.smoothingCount++,this.smoothingCount>=this.options.smooth&&(this.smoothing=null)}}pinch(t){if(this.paused)return;const i=this.parent.input.getPointerPosition(t),r=-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/200,n=Math.pow(2,(1+this.options.percent)*r);let o;this.options.center||(o=this.parent.toLocal(i)),this.isAxisX()&&(this.parent.scale.x*=n),this.isAxisY()&&(this.parent.scale.y*=n),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const s=this.parent.plugins.get("clamp-zoom",!0);if(s&&s.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const a=this.parent.toGlobal(o);this.parent.x+=i.x-a.x,this.parent.y+=i.y-a.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel",{wheel:{dx:t.deltaX,dy:t.deltaY,dz:t.deltaZ},event:t,viewport:this.parent})}wheel(t){if(this.paused||!this.checkKeyPress())return!1;if(t.ctrlKey&&this.options.trackpadPinch)this.pinch(t);else if(this.options.wheelZoom){const i=this.parent.input.getPointerPosition(t),r=(this.options.reverse?-1:1)*-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/500,n=Math.pow(2,(1+this.options.percent)*r);if(this.options.smooth){const o={x:this.smoothing?this.smoothing.x*(this.options.smooth-this.smoothingCount):0,y:this.smoothing?this.smoothing.y*(this.options.smooth-this.smoothingCount):0};this.smoothing={x:((this.parent.scale.x+o.x)*n-this.parent.scale.x)/this.options.smooth,y:((this.parent.scale.y+o.y)*n-this.parent.scale.y)/this.options.smooth},this.smoothingCount=0,this.smoothingCenter=i}else{let o;this.options.center||(o=this.parent.toLocal(i)),this.isAxisX()&&(this.parent.scale.x*=n),this.isAxisY()&&(this.parent.scale.y*=n),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const s=this.parent.plugins.get("clamp-zoom",!0);if(s&&s.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const a=this.parent.toGlobal(o);this.parent.x+=i.x-a.x,this.parent.y+=i.y-a.y}}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel",{wheel:{dx:t.deltaX,dy:t.deltaY,dz:t.deltaZ},event:t,viewport:this.parent})}return!this.parent.options.passiveWheel}}class O0{constructor(t){this.viewport=t,this.touches=[],this.addListeners()}addListeners(){this.viewport.interactive=!0,this.viewport.forceHitArea||(this.viewport.hitArea=new X(0,0,this.viewport.worldWidth,this.viewport.worldHeight)),this.viewport.on("pointerdown",this.down,this),this.viewport.on("pointermove",this.move,this),this.viewport.on("pointerup",this.up,this),this.viewport.on("pointerupoutside",this.up,this),this.viewport.on("pointercancel",this.up,this),this.viewport.on("pointerout",this.up,this),this.wheelFunction=t=>this.handleWheel(t),this.viewport.options.divWheel.addEventListener("wheel",this.wheelFunction,{passive:this.viewport.options.passiveWheel}),this.isMouseDown=!1}destroy(){this.viewport.options.divWheel.removeEventListener("wheel",this.wheelFunction)}down(t){if(!(this.viewport.pause||!this.viewport.worldVisible)){if(t.data.pointerType==="mouse"?this.isMouseDown=!0:this.get(t.data.pointerId)||this.touches.push({id:t.data.pointerId,last:null}),this.count()===1){this.last=t.data.global.clone();const i=this.viewport.plugins.get("decelerate",!0),r=this.viewport.plugins.get("bounce",!0);(!i||!i.isActive())&&(!r||!r.isActive())?this.clickedAvailable=!0:this.clickedAvailable=!1}else this.clickedAvailable=!1;this.viewport.plugins.down(t)&&this.viewport.options.stopPropagation&&t.stopPropagation()}}clear(){this.isMouseDown=!1,this.touches=[],this.last=null}checkThreshold(t){return Math.abs(t)>=this.viewport.threshold}move(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const i=this.viewport.plugins.move(t);if(this.clickedAvailable&&this.last){const r=t.data.global.x-this.last.x,n=t.data.global.y-this.last.y;(this.checkThreshold(r)||this.checkThreshold(n))&&(this.clickedAvailable=!1)}i&&this.viewport.options.stopPropagation&&t.stopPropagation()}up(t){if(this.viewport.pause||!this.viewport.worldVisible)return;t.data.pointerType==="mouse"&&(this.isMouseDown=!1),t.data.pointerType!=="mouse"&&this.remove(t.data.pointerId);const i=this.viewport.plugins.up(t);this.clickedAvailable&&this.count()===0&&this.last&&(this.viewport.emit("clicked",{event:t,screen:this.last,world:this.viewport.toWorld(this.last),viewport:this}),this.clickedAvailable=!1),i&&this.viewport.options.stopPropagation&&t.stopPropagation()}getPointerPosition(t){const i=new G;return this.viewport.options.interaction?this.viewport.options.interaction.mapPositionToPoint(i,t.clientX,t.clientY):(i.x=t.clientX,i.y=t.clientY),i}handleWheel(t){if(this.viewport.pause||!this.viewport.worldVisible||this.viewport.options.interaction&&this.viewport.options.interaction.interactionDOMElement!==t.target)return;const i=this.viewport.toLocal(this.getPointerPosition(t));this.viewport.left<=i.x&&i.x<=this.viewport.right&&this.viewport.top<=i.y&&i.y<=this.viewport.bottom&&this.viewport.plugins.wheel(t)&&!this.viewport.options.passiveWheel&&t.preventDefault()}pause(){this.touches=[],this.isMouseDown=!1}get(t){for(const i of this.touches)if(i.id===t)return i;return null}remove(t){for(let i=0;i<this.touches.length;i++)if(this.touches[i].id===t){this.touches.splice(i,1);return}}count(){return(this.isMouseDown?1:0)+this.touches.length}}function xn(e){let t,i=e[0],r=1;for(;r<e.length;){const n=e[r],o=e[r+1];if(r+=2,(n==="optionalAccess"||n==="optionalCall")&&i==null)return;n==="access"||n==="optionalAccess"?(t=i,i=o(i)):(n==="call"||n==="optionalCall")&&(i=o((...s)=>i.call(t,...s)),t=void 0)}return i}const ni=["drag","pinch","wheel","follow","mouse-edges","decelerate","animate","bounce","snap-zoom","clamp-zoom","snap","clamp"];class L0{constructor(t){this.viewport=t,this.list=[],this.plugins={}}add(t,i,r=ni.length){this.plugins[t]=i;const n=ni.indexOf(t);n!==-1&&ni.splice(n,1),ni.splice(r,0,t),this.sort()}get(t,i){return i&&xn([this,"access",r=>r.plugins,"access",r=>r[t],"optionalAccess",r=>r.paused])?null:this.plugins[t]}update(t){for(const i of this.list)i.update(t)}resize(){for(const t of this.list)t.resize()}reset(){for(const t of this.list)t.reset()}removeAll(){this.plugins={},this.sort()}remove(t){this.plugins[t]&&(delete this.plugins[t],this.viewport.emit(`${t}-remove`),this.sort())}pause(t){xn([this,"access",i=>i.plugins,"access",i=>i[t],"optionalAccess",i=>i.pause,"call",i=>i()])}resume(t){xn([this,"access",i=>i.plugins,"access",i=>i[t],"optionalAccess",i=>i.resume,"call",i=>i()])}sort(){this.list=[];for(const t of ni)this.plugins[t]&&this.list.push(this.plugins[t])}down(t){let i=!1;for(const r of this.list)r.down(t)&&(i=!0);return i}move(t){let i=!1;for(const r of this.viewport.plugins.list)r.move(t)&&(i=!0);return i}up(t){let i=!1;for(const r of this.list)r.up(t)&&(i=!0);return i}wheel(t){let i=!1;for(const r of this.list)r.wheel(t)&&(i=!0);return i}}const N0={screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:null,worldHeight:null,threshold:5,passiveWheel:!0,stopPropagation:!1,forceHitArea:null,noTicker:!1,interaction:null,disableOnContextMenu:!1,ticker:dt.shared};class Bo extends rt{__init(){this._disableOnContextMenu=t=>t.preventDefault()}constructor(t={}){super(),Bo.prototype.__init.call(this),this.options=Object.assign({},{divWheel:document.body},N0,t),this.screenWidth=this.options.screenWidth,this.screenHeight=this.options.screenHeight,this._worldWidth=this.options.worldWidth,this._worldHeight=this.options.worldHeight,this.forceHitArea=this.options.forceHitArea,this.threshold=this.options.threshold,this.options.divWheel=this.options.divWheel||document.body,this.options.disableOnContextMenu&&this.options.divWheel.addEventListener("contextmenu",this._disableOnContextMenu),this.options.noTicker||(this.tickerFunction=()=>this.update(this.options.ticker.elapsedMS),this.options.ticker.add(this.tickerFunction)),this.input=new O0(this),this.plugins=new L0(this)}destroy(t){!this.options.noTicker&&this.tickerFunction&&this.options.ticker.remove(this.tickerFunction),this.options.disableOnContextMenu&&this.options.divWheel.removeEventListener("contextmenu",this._disableOnContextMenu),this.input.destroy(),super.destroy(t)}update(t){this.pause||(this.plugins.update(t),this.lastViewport&&(this.lastViewport.x!==this.x||this.lastViewport.y!==this.y?this.moving=!0:this.moving&&(this.emit("moved-end",this),this.moving=!1),this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y?this.zooming=!0:this.zooming&&(this.emit("zoomed-end",this),this.zooming=!1)),this.forceHitArea||(this._hitAreaDefault=new X(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight),this.hitArea=this._hitAreaDefault),this._dirty=this._dirty||!this.lastViewport||this.lastViewport.x!==this.x||this.lastViewport.y!==this.y||this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y,this.lastViewport={x:this.x,y:this.y,scaleX:this.scale.x,scaleY:this.scale.y},this.emit("frame-end",this))}resize(t=window.innerWidth,i=window.innerHeight,r,n){this.screenWidth=t,this.screenHeight=i,typeof r<"u"&&(this._worldWidth=r),typeof n<"u"&&(this._worldHeight=n),this.plugins.resize(),this.dirty=!0}get worldWidth(){return this._worldWidth?this._worldWidth:this.width/this.scale.x}set worldWidth(t){this._worldWidth=t,this.plugins.resize()}get worldHeight(){return this._worldHeight?this._worldHeight:this.height/this.scale.y}set worldHeight(t){this._worldHeight=t,this.plugins.resize()}getVisibleBounds(){return new X(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight)}toWorld(t,i){return arguments.length===2?this.toLocal(new G(t,i)):this.toLocal(t)}toScreen(t,i){return arguments.length===2?this.toGlobal(new G(t,i)):this.toGlobal(t)}get worldScreenWidth(){return this.screenWidth/this.scale.x}get worldScreenHeight(){return this.screenHeight/this.scale.y}get screenWorldWidth(){return this.worldWidth*this.scale.x}get screenWorldHeight(){return this.worldHeight*this.scale.y}get center(){return new G(this.worldScreenWidth/2-this.x/this.scale.x,this.worldScreenHeight/2-this.y/this.scale.y)}set center(t){this.moveCenter(t)}moveCenter(...t){let i,r;typeof t[0]=="number"?(i=t[0],r=t[1]):(i=t[0].x,r=t[0].y);const n=(this.worldScreenWidth/2-i)*this.scale.x,o=(this.worldScreenHeight/2-r)*this.scale.y;return(this.x!==n||this.y!==o)&&(this.position.set(n,o),this.plugins.reset(),this.dirty=!0),this}get corner(){return new G(-this.x/this.scale.x,-this.y/this.scale.y)}set corner(t){this.moveCorner(t)}moveCorner(...t){let i,r;return t.length===1?(i=-t[0].x*this.scale.x,r=-t[0].y*this.scale.y):(i=-t[0]*this.scale.x,r=-t[1]*this.scale.y),(i!==this.x||r!==this.y)&&(this.position.set(i,r),this.plugins.reset(),this.dirty=!0),this}get screenWidthInWorldPixels(){return this.screenWidth/this.scale.x}get screenHeightInWorldPixels(){return this.screenHeight/this.scale.y}findFitWidth(t){return this.screenWidth/t}findFitHeight(t){return this.screenHeight/t}findFit(t,i){const r=this.screenWidth/t,n=this.screenHeight/i;return Math.min(r,n)}findCover(t,i){const r=this.screenWidth/t,n=this.screenHeight/i;return Math.max(r,n)}fitWidth(t=this.worldWidth,i,r=!0,n){let o;i&&(o=this.center),this.scale.x=this.screenWidth/t,r&&(this.scale.y=this.scale.x);const s=this.plugins.get("clamp-zoom",!0);return!n&&s&&s.clamp(),i&&o&&this.moveCenter(o),this}fitHeight(t=this.worldHeight,i,r=!0,n){let o;i&&(o=this.center),this.scale.y=this.screenHeight/t,r&&(this.scale.x=this.scale.y);const s=this.plugins.get("clamp-zoom",!0);return!n&&s&&s.clamp(),i&&o&&this.moveCenter(o),this}fitWorld(t){let i;t&&(i=this.center),this.scale.x=this.screenWidth/this.worldWidth,this.scale.y=this.screenHeight/this.worldHeight,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const r=this.plugins.get("clamp-zoom",!0);return r&&r.clamp(),t&&i&&this.moveCenter(i),this}fit(t,i=this.worldWidth,r=this.worldHeight){let n;t&&(n=this.center),this.scale.x=this.screenWidth/i,this.scale.y=this.screenHeight/r,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const o=this.plugins.get("clamp-zoom",!0);return o&&o.clamp(),t&&n&&this.moveCenter(n),this}setZoom(t,i){let r;i&&(r=this.center),this.scale.set(t);const n=this.plugins.get("clamp-zoom",!0);return n&&n.clamp(),i&&r&&this.moveCenter(r),this}zoomPercent(t,i){return this.setZoom(this.scale.x+this.scale.x*t,i)}zoom(t,i){return this.fitWidth(t+this.worldScreenWidth,i),this}get scaled(){return this.scale.x}set scaled(t){this.setZoom(t,!0)}snapZoom(t){return this.plugins.add("snap-zoom",new C0(this,t)),this}OOB(){return{left:this.left<0,right:this.right>this.worldWidth,top:this.top<0,bottom:this.bottom>this.worldHeight,cornerPoint:new G(this.worldWidth*this.scale.x-this.screenWidth,this.worldHeight*this.scale.y-this.screenHeight)}}get right(){return-this.x/this.scale.x+this.worldScreenWidth}set right(t){this.x=-t*this.scale.x+this.screenWidth,this.plugins.reset()}get left(){return-this.x/this.scale.x}set left(t){this.x=-t*this.scale.x,this.plugins.reset()}get top(){return-this.y/this.scale.y}set top(t){this.y=-t*this.scale.y,this.plugins.reset()}get bottom(){return-this.y/this.scale.y+this.worldScreenHeight}set bottom(t){this.y=-t*this.scale.y+this.screenHeight,this.plugins.reset()}get dirty(){return!!this._dirty}set dirty(t){this._dirty=t}get forceHitArea(){return this._forceHitArea}set forceHitArea(t){t?(this._forceHitArea=t,this.hitArea=t):(this._forceHitArea=null,this.hitArea=new X(0,0,this.worldWidth,this.worldHeight))}drag(t){return this.plugins.add("drag",new g0(this,t)),this}clamp(t){return this.plugins.add("clamp",new p0(this,t)),this}decelerate(t){return this.plugins.add("decelerate",new y0(this,t)),this}bounce(t){return this.plugins.add("bounce",new u0(this,t)),this}pinch(t){return this.plugins.add("pinch",new pi(this,t)),this}snap(t,i,r){return this.plugins.add("snap",new T0(this,t,i,r)),this}follow(t,i){return this.plugins.add("follow",new x0(this,t,i)),this}wheel(t){return this.plugins.add("wheel",new A0(this,t)),this}animate(t){return this.plugins.add("animate",new Gt(this,t)),this}clampZoom(t){return this.plugins.add("clamp-zoom",new f0(this,t)),this}mouseEdges(t){return this.plugins.add("mouse-edges",new P0(this,t)),this}get pause(){return!!this._pause}set pause(t){this._pause=t,this.lastViewport=null,this.moving=!1,this.zooming=!1,t&&this.input.pause()}ensureVisible(t,i,r,n,o){o&&(r>this.worldScreenWidth||n>this.worldScreenHeight)&&(this.fit(!0,r,n),this.emit("zoomed",{viewport:this,type:"ensureVisible"}));let s=!1;t<this.left?(this.left=t,s=!0):t+r>this.right&&(this.right=t+r,s=!0),i<this.top?(this.top=i,s=!0):i+n>this.bottom&&(this.bottom=i+n,s=!0),s&&this.emit("moved",{viewport:this,type:"ensureVisible"})}}const j=100;var yl={exports:{}};function uo(){}uo.prototype={on:function(e,t,i){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:i}),this},once:function(e,t,i){var r=this;function n(){r.off(e,n),t.apply(i,arguments)}return n._=t,this.on(e,n,i)},emit:function(e){var t=[].slice.call(arguments,1),i=((this.e||(this.e={}))[e]||[]).slice(),r=0,n=i.length;for(r;r<n;r++)i[r].fn.apply(i[r].ctx,t);return this},off:function(e,t){var i=this.e||(this.e={}),r=i[e],n=[];if(r&&t)for(var o=0,s=r.length;o<s;o++)r[o].fn!==t&&r[o].fn._!==t&&n.push(r[o]);return n.length?i[e]=n:delete i[e],this}},yl.exports=uo;var vl=yl.exports.TinyEmitter=uo;class Rr extends vl{constructor({floorPlan:t,helperId:i}){super(),this.floorPlan=t,this.helperId=i}destroy(){delete this.floorPlan.helper[this.helperId],this.floorPlan=null}}class R0 extends Rr{constructor({floorPlan:t,parentEl:i,helperId:r}){super({floorPlan:t,helperId:r}),!(!i||!t)&&(this.data={cursor:["0","0"]},this.floorPlan.on("mousemove",this.update,this),this.mount(i),this.update())}update(){!this.rootEl||this.setData({cursor:[fi(this.floorPlan.interaction.cursor[0],this.floorPlan.settings.units.system,this.floorPlan.settings.units.lengthDecimals),fi(this.floorPlan.interaction.cursor[1],this.floorPlan.settings.units.system,this.floorPlan.settings.units.lengthDecimals)]})}setData(t={}){for(let i in t)this.data[i]=t[i];this.rootEl.innerHTML=this.template(this.data)}template(t={}){return`<span class="fpe-coordinates__unit">x:${t.cursor[0]}</span>
    <span class="fpe-coordinates__unit">z:${t.cursor[1]}</span>`}mount(t){this.rootEl||(this.rootEl=document.createElement("div"),this.rootEl.classList.add("fpe-coordinates"),t.appendChild(this.rootEl))}destroy(){this.floorPlan.off("mousemove",this.update),this.rootEl.remove(),delete this.floorPlan,delete this.data}}class M0 extends Rr{constructor({floorPlan:t,parentEl:i,helperId:r}){super({floorPlan:t,helperId:r}),!(!i||!t)&&(this.data={width:10,height:.4,margin:.2,style:"lines",box:{},scaleStep:null,scaleDisplay:null,steps:[],leftHanded:!1,isImperial:t.settings.units.system==="imperial"},this.floorPlan.view.on("zoom",this.update,this),this.floorPlan.on("update-settings",this.update,this),this.mount(i),this.update())}update(){this.data.isImperial=this.floorPlan.settings.units.system==="imperial";const t=this.data.isImperial?3.28084:1;if(!this.floorPlan.view.viewbox||!this.floorPlan.view.viewbox.length)return;this.data.box=this.floorPlan.view.viewbox;const i=Math.min(this.floorPlan.view.client[0],this.floorPlan.view.client[1]),r=Math.min(this.data.box.length,this.data.box.width),n=i/r;if(!n)return;const o=200/n;r<=2.5/t?this.data.scaleStep=.1/t:r<=5.4/t?this.data.scaleStep=.2/t:r<=12/t?this.data.scaleStep=.5/t:r<=25/t?this.data.scaleStep=1/t:r<=50/t?this.data.scaleStep=2/t:r<=100/t?this.data.scaleStep=5/t:r<=200/t?this.data.scaleStep=10/t:r<=550/t?this.data.scaleStep=20/t:this.data.scaleStep=50/t,this.data.scaleDisplay=this.data.scaleStep*t;const s=this.data.width,a=s*this.data.scaleStep/o,h=this.leftHanded?0:s;let l=0,u=[];if(this.data.leftHanded)for(;l<s-a;){let c=a<s-l?a:s-l;u.push([l+h,c]),l+=a}else for(;l>-s+a;){let c=a;u.push([l+h,-c]),l-=a}this.data.steps=u,this.setData()}setData(t={}){for(let i in t)this.data[i]=t[i];this.rootEl.setAttribute("viewBox",`-${this.data.margin} -${this.data.margin*3} ${this.data.width+this.data.margin*2} ${this.data.height+this.data.margin*2}`),this.rootEl.innerHTML=this.template(this.data)}template(t={}){let i="";return t.steps[0]&&(i+=`<rect
      class="fpe-scale-bar__background"
      style="fill:${this.backgroundClr()}"
      y="${-t.height*2.5}"
      x="${t.width+t.steps[0][1]-t.margin}"
      width="${-t.steps[0][1]+t.margin*2}"
      height="${t.height*4}"
    />`),i+=`<text x="${t.leftHanded?0:t.width}" text-anchor="${t.leftHanded?"start":"end"}" y="-0.3">
      ${t.scaleDisplay} ${t.isImperial?"ft":"m"}
    </text>`,t.style==="lines"&&(i+=`<path d="${this.stepStr(t.steps)}" />`),t.style==="solid"&&(i+="<g>",t.steps.forEach((r,n)=>{i+=`<rect
        class="${n%2!==0?"white":""}"
        x="${r[0]}"
        y="0"
        width="${r[1]}"
        height="0.5"
      />`}),i+="</g>"),i}backgroundClr(){function t(n,o=1){if(Yl(n)){const{r:s,g:a,b:h}=Xl(n);return`rgba(${s},${a},${h},${o})`}}const i="rgba(255, 255, 255, 0.8)";let r=this.floorPlan.settings&&t(this.floorPlan.settings.theme.background.color);return r||(r=i),r+"!important"}stepStr(t){if(!t)return"";let i="",r=this.data.height;return t.forEach((n,o)=>{if(o>=1&&!this.data.leftHanded)return;n=n.map(h=>Math.round(h*1e3)/1e3);let s=o%2===0?0:r,a=o%2===0?r:0;o===0&&(i+=`M ${n[0]} ${r} L ${n[0]} 0`),i+=`L ${n[0]+n[1]} ${s} `,i+=`L ${n[0]+n[1]} ${a} `}),i}mount(t){this.rootEl||(this.rootEl=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.rootEl.classList.add("fpe-scale-bar"),t.appendChild(this.rootEl))}destroy(){this.floorPlan.view.off("viewbox",this.update),this.floorPlan.off("update-settings",this.update),this.rootEl.remove(),delete this.floorPlan.helper.scaleBar,delete this.floorPlan,delete this.data}}const D0=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40">
  <g fill="none" stroke="#000" stroke-width="1.2" stroke-miterlimit="10">
    <path d="M11.8 11.8l16.4 16.4M11.8 28.2l16.3-16.4" />
  </g>
</svg>`,Da={w:100,h:80,tip:15};class F0{constructor({width:t,height:i,pos:r=[0,0],html:n="",closeButton:o=!0,floorPlan:s}={}){this._floorPlan=s,this.pos=r,this.html=n,this.closeButton=o,this._anchorPos=null;let a=t||Da.w;this.width=Math.max(100,a);let h=i||Da.h;this.height=Math.max(50,h),this._getPosition=()=>{this._anchorPos=this._floorPlan.getScreenPosition(this.pos),this._updateInfoWindow()},this._getPosition(),this._createInfoWindow(),this._floorPlan.view.on("viewbox",this._getPosition,this),this._floorPlan.view.on("resize-canvas",this._getPosition,this)}_createInfoWindow(){const t=document.querySelector(`#${this._floorPlan.fpeId}.fpe`),i=t.querySelector("canvas");this.el||(this.el=document.createElement("div"),this.el.classList.add("fpe-info-window"),t.appendChild(this.el),this.el.addEventListener("wheel",r=>{let n=new WheelEvent(r.type,r);i.dispatchEvent(n)})),this._setContent(),this._updateInfoWindow()}_setContent(){let t=`<div class="fpe-info-window__content">${this.html}</div>`;this.closeButton&&(t+=`<div class="fpe-info-window__close" @click="infoWindow.remove">${D0}</div>`),this.el.innerHTML=t;const i=this.el.querySelector(".fpe-info-window__close");i&&i.addEventListener("click",this.remove.bind(this))}_updateInfoWindow(){if(!this.el)return;const t=this._floorPlan.interaction.isPanning?"pointer-events: none;":"",i=this._anchorPos[0]-47,r=this._anchorPos[1]-this.height-15,n=1e3+this.pos[1]*2,o=this.height,s=this.width;this.el.setAttribute("style",`transform: translate(${i}px, ${r}px);${t} height:${o}px; width:${s}px; z-index:${n}`)}set({width:t,height:i,pos:r,html:n,closeButton:o}){r!==void 0&&(this.pos=r),t!==void 0&&(this.width=Math.max(100,t)),i!==void 0&&(this.height=Math.max(50,i)),n!==void 0&&(this.html=n),o!==void 0&&(this.closeButton=o),(n!==void 0||o!==void 0)&&this._setContent(),this._getPosition()}remove(){this._floorPlan.view.off("viewbox",this._getPosition),this._floorPlan.view.off("resize-canvas",this._getPosition),this.el.remove(),this._floorPlan=null}}const B0=([e,t],i,r=0)=>i.x-r<e&&i.x+i.length+r>e&&i.z-r<t&&i.z+i.width+r>t;class k0{constructor({pos:t=[0,0],offset:i=[0,0],el:r,floorPlan:n}){if(this._updateHtmlMarker=()=>{!this.el||(this.isHidden=!B0(this.pos,this._floorPlan.view.viewbox,5),this.el.classList.toggle("fpe-marker--hidden",this.isHidden),this.isHidden||(this._anchorPos=this._floorPlan.getScreenPosition(this.pos),this._updateHtmlMarkerStyle()))},!n)return;if(!(r instanceof HTMLElement)){console.warn("no Element provided");return}this.el=r;const o=document.querySelector(`#${n.fpeId}.fpe`),s=o.querySelector("canvas");o.appendChild(this.el),this.el.classList.add("fpe-marker");const{width:a,height:h}=r.getBoundingClientRect();this.el.addEventListener("wheel",l=>{let u=new WheelEvent(l.type,l);s.dispatchEvent(u)}),this.id=be(),this._floorPlan=n,this.pos=t,this.size=[a,h],this.offset=i,this._updateHtmlMarker(),this._floorPlan.view.on("viewbox",this._updateHtmlMarker),this._floorPlan.on("drag-end",this._updateHtmlMarker),this._floorPlan.view.on("resize-canvas",this._updateHtmlMarker)}_updateHtmlMarkerStyle(){const t=this._floorPlan.interaction.isPanning,i=this.offset?this.offset:[0,0],r=this._anchorPos[0]-this.size[0]/2+i[0],n=this._anchorPos[1]-this.size[1]/2+i[1];this.el.style.pointerEvents=t?"none":"",this.el.style.transform=`translate(${r}px, ${n}px)`}set({pos:t,offset:i}){t!==void 0&&(this.pos=t),i!==void 0&&(this.offset=i),this._updateHtmlMarker()}remove(){this._floorPlan.view.off("viewbox",this._updateHtmlMarker),this._floorPlan.view.off("resize-canvas",this._updateHtmlMarker),this._floorPlan.off("drag-end",this._updateHtmlMarker),this.el.remove(),this._floorPlan=null}}Iy({ShaderSystem:Oh}),Ce.registerPlugin("batch",ny),Ce.registerPlugin("interaction",la),ee.registerPlugin("extract",Fy),ee.registerPlugin("graphics",By),ee.registerPlugin("prepare",Ky),ee.registerPlugin("sprite",Jy),ee.registerPlugin("interaction",la);const gl={ColorMatrixFilter:ro};sv(ee);const U0=Object.freeze(Object.defineProperty({__proto__:null,utils:bf,filters:gl,SCALE_MODES:ct,settings:F,Ticker:dt,Container:rt,AbstractRenderer:Co,Sprite:Rt,Graphics:tt,Text:Ze,TextStyle:Se},Symbol.toStringTag,{value:"Module"}));class X0{constructor({pos:t,color:i,size:r,floorPlan:n}){this.pos=t,this.color=i,this.size=r,this.floorPlan=n,this.id=be(),this.draw()}draw(){const t=this.size/4e3;this.layer=this.floorPlan.addLayer({id:"fpe-markers"});let i=[{type:"composite",segments:[{type:"arc",position:[0,-27.8],radius:12.4,startAngle:-25,endAngle:205},{type:"line",end:[0,0],start:[-11.2,-22.5]}],style:{fill:qe(this.color),stroke:6710886,strokeWidth:.5/t}},{type:"circle",position:[0,-28],radius:5,style:{fill:1,fillOpacity:.2}}];this.graphic=this.layer.addGraphic({shapes:i,pos:this.pos,id:"marker_"+this.id,scale:t,scaleOnZoom:!0})}remove(){this.off("click"),this.layer.deleteGraphic(this.graphic),delete this.floorPlan,this.layer.graphics.size===0&&this.layer.destroy()}on(t="click",i,r){this.graphic.gfx.interactive=!0,this.graphic.gfx.on(t,i,r)}off(t="click",i){this.graphic.gfx.off(t,i)}set(t){let i=["pos","color","size"];Object.keys(t).forEach(r=>{i.includes(r)&&(this[r]=t[r])}),this.draw()}}function _l(e,t,i=!1,r=16,n=8){let o=[];for(let v=0;v<t.length-1;v+=2)o.push({x:t[v],y:t[v+1]});let s,a,h,l=0,u=0,c=i?1:0;for(s=0;s<o.length-c;s++){a=o[s],s==o.length-1?h=o[0]:h=o[s+1];let v=h.x-a.x,y=h.y-a.y;var d=Math.sqrt(v*v+y*y),f={x:v/d,y:y/d},m=0;for(e.moveTo(a.x+u*f.x,a.y+u*f.y);m<=d;)m+=u,l>0?m+=l:m+=r,m>d?(l=m-d,m=d):l=0,e.lineTo(a.x+m*f.x,a.y+m*f.y),m+=n,m>d&&l==0?u=m-d:(u=0,e.moveTo(a.x+m*f.x,a.y+m*f.y))}}function Nt(e){if(typeof e=="number")return e;if(typeof e=="string")return qe(e);if(Array.isArray(e))return Ai(e.map(t=>t/255))}function ko(e){return e.stroke?{alpha:e.strokeOpacity||1,color:Nt(e.stroke),native:e.strokeWidth==="native",width:typeof e.strokeWidth=="number"?e.strokeWidth:1}:{}}function Oe({shape:e,settings:t,gfx:i,style:r={}}){var n,o,s;if(!i||!i.lineStyle)return;let a={...r,...e.style||{}};const h=j,l=!["line","polyline","arc"].includes(e.type)&&!!a.fill;if(l&&a.fill&&i.beginFill(Nt(a.fill),a.fillOpacity),i.lineStyle(ko(a)),e.type==="rectangle"){let{position:u,dimensions:c}=e;i.drawRect(u[0]*h,u[1]*h,c[0]*h,c[1]*h)}else if(e.type==="circle"||e.type==="composite"){let u=sl(e);Fa(u.points,[],a,h,i,l)}else if(e.type==="arc"||e.type==="quadraticBezier")Mo(e).points.forEach((u,c)=>{c===0?i.moveTo(u[0]*h,u[1]*h):i.lineTo(u[0]*h,u[1]*h)});else if(e.type==="polygon"){let{points:u,holes:c}=e;Fa(u,c,a,h,i,l)}else if(e.type==="line"){let{start:u=[],end:c=[]}=e;i.moveTo(u[0]*h,u[1]*h),i.lineTo(c[0]*h,c[1]*h)}else if(e.type==="polyline"){let{points:u}=e;a.dash?_l(i,u.flat().map(c=>c*h),!0):u.forEach((c,d)=>{d===0?i.moveTo(c[0]*h,c[1]*h):i.lineTo(c[0]*h,c[1]*h)})}else if(e.type==="group"){let{position:u=[0,0],rotation:c=0}=e,d=new tt;d.x=u[0]*h,d.y=u[1]*h,d.rotation=-Math.PI/180*c,e.children.forEach(f=>Oe({shape:f,settings:t,gfx:d,style:r})),i.addChild(d)}else if(e.type==="text"){let u=(n=e.style)!=null&&n.fill?Nt(e.style.fill):0,c=(o=e.style)!=null&&o.stroke?Nt(e.style.stroke):16777215,{position:d=[0,0],rotation:f=0,text:m,alignH:v="center",alignV:y="center",fontSize:g=16}=e;const x=new Se({fontFamily:((s=t==null?void 0:t.theme)==null?void 0:s.fontFamily)||It.theme.fontFamily,fontSize:g,fill:u,align:v,stroke:c,strokeThickness:3});let _=new Ze(m,x);_.x=d[0]*h,_.y=d[1]*h,_.rotation=-Math.PI/180*f,_.anchor.x=.5,_.anchor.y=y==="center"?.5:y==="bottom"?1:0,i.addChild(_)}l&&i.endFill()}function Fa(e=[],t=[],i={},r=100,n,o){if(!e||!Array.isArray(e)||!e.length)return n;n.lineStyle(ko(i));let s=e.flat().map(a=>a*r);if(i.dash?(_l(n,s),o&&(n.lineStyle(0),n.drawPolygon(s))):n.drawPolygon(s),t.length){o&&n.beginHole();for(const a of t){let h=a.flat().map(l=>l*r);n.drawPolygon(h)}o&&n.endHole()}return n}const Jt={fill:16777215,stroke:4605266,strokeWidth:.5,selectFill:15398134,selectStroke:7321278,selectStrokeWidth:1,fillOpacity:1};function Y0({node:e,settings:t}){const i=t==null?void 0:t.theme.showAssetTextures;return{wallContour:{strokeWidth:1.5},wall:{fill:5396576,selectFill:9677484,selectStroke:5671825},curtain:{fill:15659510},column:{fill:5396576,selectFill:9677484,selectStroke:5671825},interior:{fill:i?null:15659510,selectFill:i?null:16116704,selectStrokeWidth:2.5},stairs:{fill:15987440},door:{selectStroke:6594727},window:{selectStroke:6594727},railing:{},polyfloor:(()=>{if(e.type!=="polyfloor")return{};const r=e.usage!=="kitchen"&&Or(e.usage);let n={care:14804201,circulate:15987440,fallback:16777215};const o=r&&n[r]||n.fallback;let s;return r==="void"&&(s=e._isSelected?.5:.05),{fill:o,fillOpacity:s}})(),"a:helper:spaceDivider":{fill:14541549,stroke:14541549,strokeOpacity:.8,strokeWidth:1,selectFill:16116704,selectStroke:11494980,selectStrokeWidth:1},floorplan:{}}[e.type]}const G0=({settings:e,node:t})=>{var i,r,n,o;let s=e.theme.elements,a=t.type,h;a==="column"&&(a="wall"),(a==="polyfloor"||a==="floor")&&(a="space"),a==="interior"&&(a="asset"),t.class&&(a==="door"&&t.class.includes("entryDoor")?h="entryDoor":a==="window"&&t.class.includes("balconyDoor")?h="balconyDoor":a==="window"&&t.class.includes("slidingDoor")?h="slidingDoor":a==="box"&&t.class.includes("preWall")&&(h="preWall"));let l=s[h]||s[a]||{};if(a==="space"){let v=ge[t.usage]||{},y=v.type==="program"?t.usage:v.program;l.usage&&l.usage[t.usage]?l=l.usage[t.usage]:l.program&&l.program[y]&&(l=l.program[y])}else a==="stairs"&&!s[a]&&((r=(i=s==null?void 0:s.space)==null?void 0:i.usage)!=null&&r.staircase?l=s.space.usage.staircase:(o=(n=s==null?void 0:s.space)==null?void 0:n.program)!=null&&o.circulate&&(l=s.space.program.circulate));let{fill:u,fillOpacity:c,stroke:d,strokeWidth:f}=l,m={};return u&&(m.fill=Nt(u),m.selectFill=Nt(u)),d&&(m.stroke=Nt(d)),c&&Number.isFinite(c)&&(m.fillOpacity=Math.max(Math.min(c,1),0)),f&&Number.isFinite(f)&&(m.strokeWidth=f),m},Uo=({isSelected:e,settings:t,node:i})=>{var r,n,o,s,a,h,l,u,c,d,f,m,v;const y=Y0({node:i,settings:t}),g=G0({node:i,settings:t});let x={};if(((r=i._highlight)==null?void 0:r.fill)&&Array.isArray((n=i._highlight)==null?void 0:n.fill)){let b=i._highlight.fill;Math.max(...b)<=1&&b.forEach(S=>S=Math.round(S*255));const P=Nt(b);x={fill:P,selectFill:P},Number.isFinite((o=i._highlight)==null?void 0:o.fillOpacity)&&(x.fillOpacity=Math.max(Math.min((s=i._highlight)==null?void 0:s.fillOpacity,1),0))}if(((a=i._highlight)==null?void 0:a.outline)&&Array.isArray((h=i._highlight)==null?void 0:h.outline)){const b=i._highlight.outline,P=Nt(b);x={...x,stroke:P,selectStroke:P},Number.isFinite((l=i._highlight)==null?void 0:l.outlineWidth)&&(x.strokeWidth=(u=i._highlight)==null?void 0:u.outlineWidth,x.selectStrokeWidth=(c=i._highlight)==null?void 0:c.outlineWidth)}const _={...y,...g,...x};let E={fill:_.fill!==void 0?_.fill:Jt.fill,fillOpacity:_.fillOpacity!==void 0?_.fillOpacity:Jt.fillOpacity,stroke:(d=_.stroke)!=null?d:Jt.stroke,strokeWidth:(f=_.strokeWidth)!=null?f:Jt.strokeWidth};return e&&(E={fill:_.selectFill!==void 0?_.selectFill:Jt.selectFill,fillOpacity:_.fillOpacity!==void 0?_.fillOpacity:Jt.fillOpacity,stroke:(m=_.selectStroke)!=null?m:Jt.selectStroke,strokeWidth:(v=_.selectStrokeWidth)!=null?v:Jt.selectStrokeWidth}),t.theme.nativeLines&&(E.strokeWidth="native"),E};function H0(e,t){t.on("product-load-texture",({textureId:r,productData:n})=>{z0(t,{textureId:r,productData:n}),xl({view:e,resourceId:r,loader:t})}),t.on("product-contour",r=>co(r,e,t));const i=new tt;i.lineStyle({native:!0,color:3355443}),i.drawCircle(0,0,1),e._dummyTexture=e._renderer.generateTexture(i)}function W0(e){return new Promise((t,i)=>{var r=new Image;r.addEventListener("load",()=>{URL.revokeObjectURL(r.src),t(new z(new W(r)))}),r.addEventListener("error",()=>{URL.revokeObjectURL(r.src),i("image loading failed: "+e)});const n=e.includes("/storage/get/"),o=e.startsWith("https://")?e:ir+e;r.src=o,r.crossOrigin=n?"use-credentials":"anonymous"})}function xl({resourceId:e,loader:t,view:i}){var r;if((r=t.textureQueue[e])!=null&&r.texture)return Promise.resolve();if(!t.textureQueue[e])return Promise.reject(`no texture data to load ${e}`);let{textureUrl:n,productId:o}=t.textureQueue[e];return _o(),new Promise(s=>{W0(n).then(a=>{t.textureQueue[e].imageData=a,t.textureQueue[e].loadStage=1,(!o||t.productQueue[o].loadStage===3)&&co(e,i,t),s()}).catch(a=>{t.textureQueue[e].error=a,t.textureQueue[e].loadStage=1,(!o||t.productQueue[o].loadStage===3)&&co(e,i,t),s()})})}function co(e,t,i){const r=t==null?void 0:t._renderer,n=i.textureQueue[e],o=n.error;if(_o(),!n.texture){const s=n==null?void 0:n.productId,a=i.resources.products[s],h=new rt;let l;if(!o){if(l=new Rt(n.imageData),n.applyFilter){let f=new gl.ColorMatrixFilter;f.matrix=[.7,0,0,0,.25,0,.7,0,0,.25,0,0,.7,0,.25,0,0,0,1,0],l.filters=[f]}h.addChild(l)}let u=new tt,c;const d=s&&i.resources.products[s]._shapes||[];if(d.length){d.forEach(m=>{let v;o?v={strokeWidth:.5,stroke:1,fill:16316664}:v=Uo({settings:{theme:{showAssetTextures:!0,elements:{}}},node:{type:"interior"}}),Oe({shape:m,gfx:u,style:v})}),c=u.generateCanvasTexture(ct.LINEAR,1.5);const f=new Rt(c);if(f.anchor.x=n.anchor.x,f.anchor.y=n.anchor.y,!o){let m=l.width/a.boundingBox.length,v=(n==null?void 0:n.offset)||{x:0,y:0};f.scale.x=l.width/f.width,f.scale.y=l.height/f.height,f.x=l.width/2-v.x*m,f.y=l.height/2-v.y*m}h.addChild(f)}n.texture=r.generateTexture(h,{scaleMode:ct.LINEAR,resolution:1.5}),n.loadStage=2,h.destroy(!0),c&&c.destroy(!0)}n.nodes.forEach(s=>{i.emit("product-load-stage",{node:s,args:{_loadStage:3,_textureId:e}})})}function z0(e,{textureId:t,productData:i}){if(!i||!i.boundingPoints)return;let r={x:i.boundingPoints.min[0],y:i.boundingPoints.min[2]},n={x:Math.abs(i.boundingPoints.min[0]/i.boundingBox.length),y:Math.abs(i.boundingPoints.min[2]/i.boundingBox.width)},o={x:i.boundingPoints.max[0]-i.boundingBox.length/2,y:i.boundingPoints.max[2]-i.boundingBox.width/2};e.textureQueue[t].offset=o,e.textureQueue[t].anchor=n,e.textureQueue[t].position=r}function qt(e){if(e!=null&&e.children)for(var t=e.children.length-1;t>=0;t--)e.children[t].destroy({children:!0}),e.removeChild(e.children[t])}function Ba(e,t,i){const r=new Rt(e);return r.x=0,r.y=0,r.anchor.x=.5,r.anchor.y=.5,r.rotation=0,t&&(r.width=t),i&&(r.height=i),r}function Mr({node:e,ctx:t,parentNode:i,floorPlan:r,update:n=null}){if(!e)return;const{view:o,resources:s,settings:a,loader:h}=r;i=i||e.parent;const l=["plan","level","group"].includes(e.type),u=e.id&&(e._isSelected||e.getParents().some(C=>C._isSelected)),c=e.id&&e._highlight,d=j,f=n&&n.container||new rt,m=o.gfxLayers.scene;if(f.x=e.x*d,f.y=e.z*d,f.rotation=-Math.PI/180*e.ry||0,e.type!=="interior"){const C=ho(e.type);f.parentLayer=m,f.zOrder=C}const{hideElements:v,showCeilingLamps:y,showFloorPlan:g,theme:x,showSpaceDividers:_,xrayMode:E}=a,b=Ne(e),P=s.products[b],S=s.productContours[b]||s.productBoundingBoxes[b],D=e.type==="interior"&&(P==null?void 0:P.isCeilingLamp)&&!y||x.wallContours&&["wall","column"].includes(e.type)||v.includes(e.type)||!_&&e.type==="a:helper:spaceDivider",T=o.gfxNodes[e.id],A=e.type!=="interior"||e.type==="interior"&&(T==null?void 0:T.loadStage)===2;let M=!D&&A&&Gg(e,i,S)||[],O,R;if(D)O=void 0;else if(e.type==="interior"){n&&qt(f);const C=ho(e.type,P==null?void 0:P.order);if(f.parentLayer=m,f.zOrder=C,(T==null?void 0:T.loadStage)===2)O=new tt;else if(!x.showAssetTextures&&(T==null?void 0:T.loadStage)===3)O=new tt,M=P._shapes||[];else if((T==null?void 0:T.loadStage)>2&&x.showAssetTextures&&(P==null?void 0:P.boundingPoints)&&(T==null?void 0:T.textureId)){const{texture:N,anchor:B}=h.textureQueue[T.textureId]||{};if(N){let et=P.boundingBox.length*d,Ft=P.boundingBox.width*d;O=Ba(N,et,Ft),O.anchor.x=B.x,O.anchor.y=B.y,O.zIndex=1}(u||c)&&(M=P._shapes||[],R=new tt,R.zIndex=5)}else O=new Rt(o._dummyTexture)}else if(e.type==="floorplan"){if(!g)return;const C=e.id;if(f._textureId=C,T!=null&&T.loadStage){const{texture:N}=h.textureQueue[T.textureId]||{};N&&(O=Ba(N,e.l*d,e.w*d)),R=new tt,O.zIndex=1,R.zIndex=5}else{const N=e.file;h.textureQueue[C]={loadStage:0,nodes:new Set([e]),textureUrl:N,applyFilter:!1},xl({loader:h,view:o,resourceId:C}),O=new tt}}else l||(n&&qt(f),O=new tt);const H=Uo({settings:a,node:e,isSelected:u});M.forEach(C=>Oe({shape:C,settings:a,gfx:R||O,style:H})),O&&(O.interactive=!0,f.addChild(O),O._nodeId=e.id),R&&f.addChild(R),f.alpha=j0(e,r,E),(!n||n.updateChildren||e.type==="wall"||e.type==="interior")&&e&&e.children&&e.children.forEach(C=>{Mr({node:C,ctx:f,parentNode:e,floorPlan:r})}),o.gfxNodes[e.id]||(o.gfxNodes[e.id]={}),o.gfxNodes[e.id].nodeContainer=f,n||t.addChild(f)}function j0(e,t,i){return i&&!["plan","level","floorplan"].includes(e.type)&&!(e.id&&e.getParents().some(r=>r.id===t.activeGroup))?.7:1}function bl(e,t,i,r){var n;const o=t.getChildByName(e.id);if(o==null||o.destroy(!0),r.hideElements.includes("roomStamp"))return;const{text:s,textOutline:a=!0}=((n=r.theme.elements)==null?void 0:n.roomStamp)||{},h=r.theme.background.color,l=h!=="transparent"?h:"#eee",u=s?Si(Ai(s.map(m=>m/255))):"#333333",c=new Se({fontFamily:r.theme.fontFamily||It.theme.fontFamily,fontSize:16,align:"center",fill:u,stroke:l,strokeThickness:a?3:0});let d=a0(e,r).join(`
`);const f=new Ze(d,c);f.x=e.center[0]*j,f.y=e.center[1]*j,f.anchor.x=.5,f.anchor.y=.5,Pl(f,i,e),f.name=e.id,t.addChild(f)}function Pl(e,t,i){let r=Math.min(1/t,2);e.scale.x=r,e.scale.y=r,e.visible=i.area>r*1.5}function ka({node:e,event:t,args:i,floorPlan:r}){r=r||this;const{view:n,loader:o}=r;if(!!o.isSceneStructureLoaded&&!!e){if(t==="add-child"){const{nodeContainer:s}=n.gfxNodes[e.id]||{};Mr({node:i,ctx:s,parentNode:e,floorPlan:r})}else if(t==="remove-child"){const{nodeContainer:s}=n.gfxNodes[i.id]||{};s&&(s.parent.removeChild(s),s.destroy({children:!0})),n.viewportNeedsUpdate=!0,n.viewportPaused&&n.startAnimationLoop(),delete n.gfxNodes[i.id]}setTimeout(()=>{this.viewportNeedsUpdate=!0},100)}}function V0({node:e,args:t,event:i,floorPlan:r}){r=r||this;const{view:n}=r;if(e.type==="stairs"||e.type==="door"){di({node:e,args:t,event:i,floorPlan:r});return}const{nodeContainer:o}=n.gfxNodes[e.id]||{};!o||(o.x=e.x*j,o.y=e.z*j,o.rotation=-Math.PI/180*e.ry,n.viewportNeedsUpdate=!0,n.viewportPaused&&n.startAnimationLoop())}function q0(e,t){di({...e,floorPlan:t})}function di({node:e,args:t,event:i,floorPlan:r}){r=r||this;const{view:n,resources:o,settings:s}=r;i==="set-materials"&&(t={materials:t});const{nodeContainer:a}=n.gfxNodes[e.id]||{};if(!!a&&!(e.type==="level"||e.type==="plan")){if(t._loadStage&&(n.gfxNodes[e.id].loadStage=t._loadStage),t._textureId&&(n.gfxNodes[e.id].textureId=t._textureId),qt(a),e.type==="polyfloor"){const h=o.spaces.find(l=>l.id===e.id);if(h){e0(h,e);const l=n.layers.get("fpe-room-stamp");l&&bl(h,l.container,n.zoom,s)}else console.warn(`Node with ID=${e.id} has no data in floorPlan.resources.spaces`)}Mr({node:e,ctx:a.parent,floorPlan:r,update:{container:a,args:t,updateChildren:t._isSelected!==void 0}}),n.viewportNeedsUpdate=!0,n.viewportPaused&&n.startAnimationLoop()}}function Z0(e,t){t=t||this;const i=Uo({settings:t.settings,node:{type:"wallContour"},isSelected:!1}),r=new tt,n=t.view.gfxLayers.scene,o=ho("wall");r.parentLayer=n,r.zOrder=o,t.computed.wallContours.forEach(s=>{Oe({shape:{type:"polygon",points:s[0],holes:s.slice(1)},settings:t.settings,gfx:r,style:i})}),e.addChild(r)}function $0(e="linear"){return lo[e]}function K0({sceneBoundingBox:e,rectLeft:t,rectTop:i,rectRight:r,rectBottom:n,viewportWidth:o,viewportHeight:s}){if([t,i,r,n].some(a=>a>0)&&o&&s){const a=r-t,h=n-i,l=s0(e,a,h);let{x:u,z:c,length:d,width:f}=l;const m=o/a,v=s/h;return d*=m,f*=v,u-=t/o*d,c-=i/s*f,{x:u,z:c,x2:u+d,z2:c+f,length:d,width:f}}return e}function J0({margin:e=0,animate:t,floorPlan:i,boundingBox:r}){if(!i.view.sceneContainer)return Promise.resolve(!1);if(r)return br({bb:r,animate:t,view:i.view});let{x:n,z:o,length:s,width:a}=i.getSceneBoundingBox();n-=e,o-=e,s+=e*2,a+=e*2;const h={x:n,z:o,x2:n+s,z2:o+a,length:s,width:a};return br({bb:h,animate:t,view:i.view})}function br({bb:e,animate:t=!1,view:i}){const r=i._viewport;if(!r)throw new Error("no viewport");return i.viewportPaused&&i.startAnimationLoop(),new Promise(n=>{Number.isFinite(e.x)||n(!1),Object.keys(e).forEach(a=>{e[a]=e[a]*j});let o=0;typeof t=="number"&&Number.isFinite(t)?o=t:t===!0&&(o=500);let s={x:e.x+e.length/2,y:e.z+e.width/2,width:e.length,height:e.width};if(!o)r.fit(!1,s.width,s.height).moveCenter(s.x,s.y),Pr.bind(i)({type:"animation"}),i.viewportNeedsUpdate=!0,n(!0);else{let a={x:r.center.x,y:r.center.y,width:r.worldScreenWidth,height:r.worldScreenHeight},h={x:a.x-s.x,y:a.y-s.y,width:a.width-s.width,height:a.height-s.height};i._zoomTarget={delta:h,start:a,target:s,time:0,duration:o,destroy:()=>{i.ticker.remove("animateView"),delete i._zoomTarget,n(!0)},ease:$0("easeInOutQuad"),updateViewport:Pr.bind(i)},i.ticker.add("animateView",Q0,i)}})}function Q0(e){let t=this._zoomTarget,i=!1;t.time+=e;let r=t.ease(t.time,0,1,t.duration),n={x:t.start.x-t.delta.x*r,y:t.start.y-t.delta.y*r,width:t.start.width-t.delta.width*r,height:t.start.height-t.delta.height*r};t.time>t.duration&&(n=t.target,i=!0),this._viewport.fit(!1,n.width,n.height).moveCenter(n.x,n.y),this.viewportNeedsUpdate=!0,t.updateViewport({type:"animation"});const o=this._viewport.input.count()!==0;(i||o)&&t.destroy()}function Pr(e){this.viewportNeedsUpdate=!0,this.viewportPaused&&this.startAnimationLoop();const t=this._viewport;e.type!=="animation"&&this._zoomTarget&&this._zoomTarget.destroy();const i=j,r=t.scale._x,n=t.left,o=t.top,s=t.worldScreenWidth,a=t.worldScreenHeight;this.viewbox={x:n/i,z:o/i,x2:(n+s)/i,z2:(o+a)/i,length:s/i,width:a/i},this.client=[t.screenWidth,t.screenHeight];const h=this.zoom!==r;this.zoom=r;const l={sourceEvent:{type:e.type},viewbox:this.viewbox,zoom:this.zoom};h?this.emit("zoom",l):this.emit("pan",l),this.emit("viewbox",l)}function t_({pos:e,nodeId:t}){El(this.interaction,{cursor:e,cursorTarget:t&&this.scene.nodesById[t]})}function El(e,t){for(const i in t)e[i]=t[i],i==="cursorAction"&&e_(t[i])}function e_(e){let t="";switch(e){case"split-wall":t="var(--fpe-split-cursor) 16 16, pointer";break;case"duplicate":t="var(--fpe-duplicate-cursor) 16 16, pointer";break;case"move":t="move";break;default:t="default";break}document.body.style.cursor=t}function i_(e){var t,i,r,n;if(((i=(t=e==null?void 0:e.data)==null?void 0:t.originalEvent)==null?void 0:i.button)===2)return;if(!this)throw new Error("Viewport context is missing");const o=400,s=10,a=5;let h=this.interaction._dragStart||{x:0,y:0},l=e.data.global||{x:0,y:0},u=Math.abs(l.x-h.x),c=Math.abs(l.y-h.y);if(!(u<a&&c<a))return;let d=new Date().getTime(),f;if(this.interaction.lastClick){let E=d-this.interaction.lastClick.time,b=this.interaction.lastClick.pos&&Math.max(Math.abs(l.x-this.interaction.lastClick.pos.x),Math.abs(l.y-this.interaction.lastClick.pos.y));f=E<o&&b<s}this.interaction.lastClick={time:d,pos:{...l}};const m=f?"dblclick":"click",v=(r=e.target)==null?void 0:r._nodeId,{x:y,y:g}=((n=e.data)==null?void 0:n.global)||{},x=this.getPlanPosition([y,g]);El(this.interaction,{cursor:[x[0],x[1]]});let _={sourceEvent:e,nodeId:v,pos:x,isDoubleClick:!!f};this.emit(m,_)}function r_(e){var t;const{x:i,y:r}=e.data.global;this.view.windowPos=[i,r],this.interaction.lastSceneClick=this.getPlanPosition(this.view.windowPos);const n=(t=e.target)==null?void 0:t._nodeId;this.emit("context-menu",{sourceEvent:e,nodeId:n})}const n_=e=>{const{view:t,interaction:i}=e,r=(s,a)=>{!t.viewportInFocus||(i.shiftKey=s.shiftKey,i.ctrlKey=s.ctrlKey,i.altKey=s.altKey,i.metaKey=s.metaKey,e.emit(a,{key:s.key,lowerCaseKey:s.key&&s.key.toLowerCase(),sourceEvent:s}))},n=s=>r(s,"keyup"),o=s=>r(s,"key");document.addEventListener("keydown",o),document.addEventListener("keyup",n)};function wl(e){e.drag().pinch({percent:4}).wheel()}function o_(e){e.plugins.remove("wheel"),e.plugins.remove("pinch"),e.plugins.remove("drag")}function s_(e){const{settings:t,view:i}=e;t.panZoom&&wl(i._viewport),i._viewport.on("pointerdown",a_,e).on("pointerup",Ua,e).on("pointerup",i_,e).on("rightup",r_,e).on("pointerupoutside",Ua,e).on("pointermove",h_,e).on("moved",Pr,i).on("zoomed",Pr,i),l_(e),n_(e),e.on("mousemove",t_,e)}function a_(e){this.interaction._dragStart={x:e.data.global.x,y:e.data.global.y},this.emit("drag-start",{pos:this.interaction.cursor,sourceEvent:e})}function Ua(){this.view.resume("drag"),this.emit("drag-end",{pos:this.interaction.cursor,sourceEvent:{}}),this.interaction.isDragging=!1,this.interaction.dragOffset=null}function h_(e){var t;const{srcElement:i}=((t=e==null?void 0:e.data)==null?void 0:t.originalEvent)||{};if(!i)return;const r=this.view._viewport.options.divWheel;if(i!==r)return;const n=e.data.getLocalPosition(this.view._viewport);let o=[n.x/j,n.y/j];const s=e.target&&e.target._nodeId;if(this.interaction.cursor=o,this.interaction.isDragging){const a=[n.x,n.y];this.emit("drag-move",{pos:this.interaction.cursor,screenPos:a,sourceEvent:e})}this.emit("mousemove",{sourceEvent:e,nodeId:s,pos:o})}const l_=e=>{const t=document.querySelector(`#${e.fpeId} .fpe__plan`);!t||(t.addEventListener("mouseleave",()=>e.view.emit("focus",!1,e.view)),t.addEventListener("mouseenter",()=>e.view.emit("focus",!0,e.view)),document.addEventListener("visibilitychange",()=>e.view.emit("focus",document.visibilityState==="visible",e.view)),t.addEventListener("contextmenu",function(i){return i.preventDefault(),!1},!1))};function Xa({floorPlan:e,update:t=!1}){const{scene:i,view:r,settings:n}=e,{_renderer:o,_viewport:s}=r;let a=n.theme.background.color;a.length===4&&(a=a[0]+a[1]+a[1]+a[2]+a[2]+a[3]+a[3]),o.backgroundColor=qe(a);const h=r.sceneContainer;qt(h),Mr({node:i.node,ctx:h,floorPlan:e}),n.theme.wallContours&&Z0(h,e),Tl(e,!0),r.emit("scene-rendered",{update:t}),r.viewportNeedsUpdate=!0,t&&(n.panZoom?wl(s):o_(s)),r.viewportPaused&&r.startAnimationLoop()}function Tl(e,t=!1){const{view:i,resources:r,settings:n}=e,o=e.addLayer({id:"fpe-room-stamp",baseLayer:"annotation"});t?(qt(o.container),r.spaces.forEach(s=>bl(s,o.container,i.zoom,n))):o.container.children.forEach(s=>{let a=r.spaces.find(h=>h.id===s.name);Pl(s,i.zoom,a)})}class u_ extends Bo{}const Qi=(e,t=!1)=>new yr(new _t(e,t)),c_={top:0,left:0,center:.5,right:1,bottom:1};class p_{constructor(){this.methods={},this.add=(t,i,r)=>{this.methods[t]={fn:i,ctx:r}},this.remove=t=>{delete this.methods[t]}}}class d_ extends vl{constructor(t,i,r){var n;super(),this.windowPos=[0,0],this.zoom=1,this.client=[0,0],this.layers=new Map,this.viewbox={x:0,z:0,x2:0,z2:0,length:0,width:0},this.viewportNeedsUpdate=!1,this.viewportPaused=!1,this.viewportInFocus=!1,this.sceneContainer=new rt,this.gfxNodes={},this.ticker=new p_,this._oldTime=Date.now(),ch(),this.parentEl=document.getElementById(r);const o=this.parentEl.querySelector(".fpe__plan");let s=this.parentEl.clientWidth,a=this.parentEl.clientHeight;this._settings=i;const h=window.devicePixelRatio||1;let l=i.theme.background.color;const u=l==="transparent";this._renderer=Km({width:s,height:a,view:o,antialias:!0,backgroundAlpha:u?0:1,autoDensity:!0,resolution:h,powerPreference:"high-performance",preserveDrawingBuffer:!0}),this.parentEl.appendChild(this._renderer.view),l.length===4&&(l=l[0]+l[1]+l[1]+l[2]+l[2]+l[3]+l[3]),u||(this._renderer.backgroundColor=qe(l)),this._stage=new wi,this._stage.sortableChildren=!0,this._viewport=new u_({screenWidth:s,screenHeight:a,worldWidth:s,worldHeight:a,interaction:this._renderer.plugins.interaction,noTicker:!0,passiveWheel:!1,divWheel:document.querySelector(`#${r} .fpe__plan`)}),this._viewport.addChild(this.sceneContainer),(n=U0==null?void 0:dt)!=null&&n.system&&dt.system.stop(),this.startAnimationLoop(),this.watchResize(),this._stage.addChild(this._viewport),this.on("focus",c=>{c&&this.viewportPaused?this.startAnimationLoop():c||this.stopAnimationLoop(),this.viewportInFocus=c}),this.gfxLayers=Ya(this._stage,this.parentEl.clientWidth),H0(this,t)}draw(){var t;const i=Date.now();let r=i-this._oldTime;this._oldTime=i,r<0&&(r=0),r>1e3&&(r=1e3);let n=Object.keys(this.ticker.methods).length;(this.viewportNeedsUpdate||n)&&((t=this.ticker)!=null&&t.methods&&Object.values(this.ticker.methods).forEach(({fn:o,ctx:s})=>{typeof o=="function"&&(s?o.call(s,r):o(r))}),this._viewport.update(r),this._renderer.render(this._stage)),this.viewportPaused||requestAnimationFrame(()=>this.draw()),this.viewportNeedsUpdate=!1}startAnimationLoop(){this._oldTime=Date.now(),this.viewportNeedsUpdate=!0,this.viewportPaused=!1,requestAnimationFrame(()=>this.draw())}stopAnimationLoop(){this.viewportPaused=!0}updateView(){if(!this.parentEl.clientWidth||!this.parentEl.clientHeight)return;const t=this._viewport,i=this._renderer,r=j,n=t.screenWidth,o=t.screenHeight,s=this.parentEl.clientWidth,a=this.parentEl.clientHeight;i.resize(s,a),t.resize(s,a);const h=n-s,l=o-a,u=this._settings.preserveViewbox,[c=.5,d=.5]=u.split("-").map(_=>c_[_]),f=c*h,m=d*l;t.position.set(t.x-f,t.y-m),t.plugins.get("clamp-zoom")||t.clampZoom({minHeight:this._settings.zoomRange[0]*r,maxHeight:this._settings.zoomRange[1]*r}),i.render(this._stage);let v=t.left,y=t.top,g=t.worldScreenWidth,x=t.worldScreenHeight;this.viewbox={x:v/r,z:y/r,x2:(v+g)/r,z2:(y+x)/r,length:g/r,width:x/r},this.client=[t.screenWidth,t.screenHeight]}async watchResize(){new ResizeObserver(()=>{this.updateView(),this.emit("resize-canvas",this.viewbox)}).observe(this.parentEl)}get gfxNodeCount(){return Object.keys(this.gfxNodes).length}reset(){this.gfxNodes={},this.gfxLayers=Ya(this._stage,this.parentEl.clientWidth)}pause(t="drag"){this._viewport.plugins.pause(t)}resume(t="drag"){this._viewport.plugins.resume(t)}}const Ya=(e,t)=>{const i=Qi(0);e.addChild(i);const r=Qi(1,!0);r.width=r.height=t,e.addChild(r);const n=Qi(2);e.addChild(n);const o=Qi(3);return e.addChild(o),{base:i,scene:r,annotation:n,helper:o}};class f_{constructor({shapes:t=[],pos:i=[0,0],alpha:r=1,scale:n=1,clearLayer:o=!1,interactive:s=!1,id:a,isHandler:h=!1,scaleOnZoom:l=!1,baseLayer:u,container:c,floorPlan:d}){if(this.shapes=t,this.gfxScale=n,this.scaleOnZoom=l,this.container=c,this.floorPlan=d,!this.container)return;o&&qt(this.container);let f=new tt;this.gfx=f,f.alpha=r;const m=Math.min(1/this.floorPlan.view.zoom)*this.gfxScale;i&&(f.x=i[0]*j,f.y=i[1]*j),s&&(f.interactive=!0),f._nodeId=a,h&&(f._isHandler=!0),f.parentLayer=u,m&&l&&(f.scale.x=f.scale.y=m),this.container.addChild(f),t.forEach(v=>Oe({shape:v,settings:this.floorPlan.settings,gfx:f})),this.floorPlan.view.viewportNeedsUpdate=!0,this.floorPlan.view.viewportPaused&&this.floorPlan.view.startAnimationLoop()}set({pos:t,style:i,shapes:r}={}){const n=Math.min(1/this.floorPlan.view.zoom)*this.gfxScale,o=this.gfx;if(t&&(o.x=t[0]*j,o.y=t[1]*j),r&&(this.shapes=r,o.clear(),qt(o),r.forEach(s=>Oe({shape:s,settings:this.floorPlan.settings,gfx:o}))),n&&this.scaleOnZoom&&(o.scale.x=o.scale.y=n),i){const s=ko(i);i.fill&&(o.geometry.graphicsData[0].fillStyle.color=Nt(i.fill)),o.geometry.graphicsData[0].lineStyle.color=s.color,o.geometry.graphicsData[0].lineStyle.width=s.width,o.geometry.graphicsData[0].lineStyle.native=s.native,o.geometry.invalidate()}this.floorPlan.view.viewportNeedsUpdate=!0,this.floorPlan.view.viewportPaused&&this.floorPlan.view.startAnimationLoop()}on(t,i,r){return this.gfx.interactive=!0,t==="drag"?this.addDragEvent(i,r):this.gfx.on(t,i,r),this}off(t,i){return t==="drag"?this.removeDragEvent():this.gfx.off(t,i),this}destroy(){this.gfx.destroy(),this.floorPlan.view.viewportNeedsUpdate=!0,this.floorPlan.view.viewportPaused&&this.floorPlan.view.startAnimationLoop()}addDragEvent(t,i){function r(){this.floorPlan.interaction.isDragging=!0,this.floorPlan.view.pause("drag"),this.floorPlan.on("mousemove",t,i)}function n(){this.floorPlan.interaction.isDragging=!1,this.floorPlan.view.resume("drag"),this.floorPlan.off("mousemove",t)}this.on("pointerdown",r,this),this.on("pointerup",n,this),this.on("pointerupoutside",n,this),this.on("pointercancel",n,this)}removeDragEvent(){this.off("pointerdown"),this.off("pointerup"),this.off("pointerupoutside"),this.off("pointercancel")}}class Ga{constructor(t,i,r){this.graphics=new Set;const n=t.view._viewport;this.container=new rt,this.id=r,this.baseLayer=t.view.gfxLayers[i]||t.view.gfxLayers.helper,this.container.parentLayer=this.baseLayer,this.floorPlan=t,n.addChild(this.container)}addGraphic(t){const i=new f_({...t,floorPlan:this.floorPlan,baseLayer:this.baseLayer,container:this.container});return this.graphics.add(i),i}deleteGraphic(t){this.graphics.delete(t),t.destroy()}draw(t){return this.addGraphic(t)}drawImage({url:t,width:i,height:r,mask:n,options:o}){if(o!=null&&o.pixelated?F.SCALE_MODE=ct.NEAREST:F.SCALE_MODE=ct.LINEAR,!this.container)return;qt(this.container);let s=Rt.from(t);if(s.width=i*j,s.height=r*j,s.parentLayer=this.baseLayer,n){let{x:a,z:h,length:l,width:u}=Sr([n]);s.x=(a+l/2)*j,s.y=(h+u/2)*j,s.anchor.set(.5);let c=new tt;Oe({shape:{type:"polygon",points:n,style:{fill:16724736}},settings:this.floorPlan.settings,gfx:c}),this.container.addChild(c),s.mask=c}this.container.addChild(s),this.floorPlan.view.viewportNeedsUpdate=!0,this.floorPlan.view.viewportPaused&&this.floorPlan.view.startAnimationLoop(),setTimeout(()=>{this.floorPlan.view.viewportNeedsUpdate=!0},100)}clear(){qt(this.container),this.floorPlan.view.viewportNeedsUpdate=!0,this.floorPlan.view.viewportPaused&&this.floorPlan.view.startAnimationLoop()}destroy(){!this.container||(this.floorPlan.view.layers.delete(this.id),this.container.destroy({children:!0,texture:!0,baseTexture:!0}),this.floorPlan.view.viewportNeedsUpdate=!0,this.floorPlan.view.viewportPaused&&this.floorPlan.view.startAnimationLoop(),delete this.container,delete this.floorPlan)}}function m_(e,{format:t="png",quality:i=.95}){return new Promise(r=>{let n;t==="jpg"?n=e.toDataURL("image/jpeg",i):n=e.toDataURL(),r(n)})}function y_(e,{format:t,fileName:i,quality:r}={}){if(t==="svg")return;const n=new Image;n.src=e,n.onload=function(){const o=document.createElement("canvas");o.width=n.naturalWidth,o.height=n.naturalHeight;const s=o.getContext("2d");s.imageSmoothingEnabled=!1,s.drawImage(n,0,0),v_(o,{format:t,fileName:i,quality:r})}}function v_(e,{format:t="png",fileName:i="floorplan",quality:r=.95}){const n=document.createElement("a");n.download=i+"."+t;let o=t==="png"?"image/png":"image/jpeg";e.toBlob(function(s){n.href=URL.createObjectURL(s),n.click()},o,r)}const Dr=22015,g_=6789887,__=16777215,x_=Dr,b_=Dr,P_=g_,E_=Dr,w_=Dr,T_=__;class I_ extends Rr{constructor({floorPlan:t,helperId:i,mode:r="distance"}){super({floorPlan:t,helperId:i}),this.drawing=!1,this.polygonsOrPolylines=[],this.floorPlan=t,this.mode=r,this.floorPlan.on("mousemove",this.handlePointerMove,this),this.floorPlan.on("click",this.handlePointerDown,this),this.floorPlan.on("dblclick",this.handlePointerDown,this),this.floorPlan.on("update-settings",this.draw,this),this.startDrawing()}get isInAreaMode(){return this.mode==="area"}get isDrawing(){return this.drawing}set({mode:t}){this.mode=t,this.draw()}handlePointerMove(t){this.setSnapCursor(t)}handlePointerDown(t){this.setSnapCursor(t),this.drawPoint(t)}setSnapCursor({pos:t}){this._snapCursor!=null||(this._snapCursor=this.floorPlan.addHelper("snapCursor",{pos:t}));const{snapPoints:i,snapMargin:r}=this.floorPlan.computed;if(!i.length){this._snapCursor.set({pos:t}),this.draw();return}const n=Ma(t,i,r);this._snapCursor.isSnapping=!!n,this._snapCursor.set({pos:n||t}),this.draw()}stopDrawing(){this.polygonsOrPolylines[this.polygonsOrPolylines.length-1].points.length>1&&this.drawing&&this.polygonDone()}cancelDrawing(){this.destroy()}startDrawing(){this.drawing=!0,this.polygonsOrPolylines.push({points:[],isClosed:!1,length:0,area:0,areaDisplay:"",lengthDisplay:"",contour:null,label:null,pointGraphics:[]})}removeLastPoint(){var t,i;const r=this.polygonsOrPolylines[this.polygonsOrPolylines.length-1];if((r==null?void 0:r.points.length)>0){r.points.pop();const n=r.pointGraphics.pop();n&&this.layer.deleteGraphic(n),r.points.length<=1&&(r.contour&&((t=this.layer)==null||t.deleteGraphic(r.contour),r.contour=null),r.label&&((i=this.layer)==null||i.deleteGraphic(r.label),r.label=null)),r.points.length===0?(this.polygonsOrPolylines.pop(),this.drawing=!1):this.draw()}}polygonDone(){this.drawing=!1,this.emit("polygon-done",{}),this.draw()}drawPoint(t){var i;this.drawing||this.startDrawing();const r=this.polygonsOrPolylines.length-1,n=this.polygonsOrPolylines[r];if(((i=t.nodeId)==null?void 0:i.startsWith(`point/${r}/`))||t.isDoubleClick){const u=t.nodeId===`point/${r}/0`;this.mode==="distance"&&u&&(n.isClosed=!0),this.polygonDone();return}const{pos:o}=this._snapCursor;n.points.push([...o]);const s=n.points.length-1,a=`point/${r}/${s}`;this.layer||(this.layer=this.floorPlan.addLayer());const h=this.layer.addGraphic({shapes:[{type:"circle",position:[0,0],radius:.15,style:{fill:E_,fillOpacity:.1}},{type:"circle",position:[0,0],radius:.05,style:{stroke:w_,fill:T_,strokeWidth:1.5}}],pos:o,scaleOnZoom:!0,id:a,isHandler:!0});n.pointGraphics[s]=h;function l(){this.updatePolygon(r,s,this.floorPlan.interaction.cursor),h.set({pos:n.points[s]})}h.on("drag",l,this)}updatePolygon(t,i,r){const n=r,{snapPoints:o,snapMargin:s}=this.floorPlan.computed,a=o.length&&Ma(n,o,s),h=this.polygonsOrPolylines[t];h.points[i]=a||n,this.draw()}getLengthText(t){const{units:i}=this.floorPlan.settings;return fi(t,i.system,i.lengthDecimals)}getAreaText(t){const{units:i}=this.floorPlan.settings;return Wa(t,i.system,i.areaDecimals)}reset(){this.drawing=!1,this.polygonsOrPolylines=[],this.floorPlan.removeHelper("snapCursor"),this._snapCursor=null,this.layer&&(this.layer.destroy(),this.layer=null)}draw(){!this.polygonsOrPolylines.length||(this.layer||(this.layer=this.floorPlan.addLayer()),this.polygonsOrPolylines.forEach((t,i)=>{if(!t.points.length)return;const r=this.drawing&&this._snapCursor&&i===this.polygonsOrPolylines.length-1?[...t.points,this._snapCursor.pos]:t.points;if(r.length<2)return;t.length=Yv(r,t.isClosed),t.lengthDisplay=this.getLengthText(t.length);const n=r.length<2?0:Dv({x:r[0][0],z:r[0][1]},{x:r[1][0],z:r[1][1]}),o=r.map(m=>m.map(v=>Number(v.toFixed(10)))).slice(0,this.isInAreaMode?void 0:2),s=this.isInAreaMode?jh(o):[o[0][0]+(o[1][0]-o[0][0])/2,o[0][1]+(o[1][1]-o[0][1])/2];t.area=Math.abs(Ae(r)),t.areaDisplay=this.getAreaText(t.area);const a=this.isInAreaMode||t.isClosed?"polygon":"polyline",h={stroke:P_,dash:!0,strokeWidth:"native"};let l=t.lengthDisplay,u=n;this.isInAreaMode&&(h.fill=b_,h.fillOpacity=.04,l=t.areaDisplay,u=0);const c=[{type:a,points:r,style:h}],d={shapes:[{type:"text",text:l,position:[0,0],rotation:u,alignV:"bottom",fontSize:15,style:{fill:x_}}],id:"text",pos:s,scaleOnZoom:!0};t.contour?t.contour.set({shapes:c}):t.contour=this.layer.addGraphic({shapes:c}),t.label?t.label.set(d):t.label=this.layer.addGraphic(d);const f=this.isInAreaMode?{area:t.area}:{distance:t.length};this.emit("polygon-draw",f)}))}destroy(){this.reset(),this.floorPlan.off("mousemove",this.handlePointerMove),this.floorPlan.off("click",this.handlePointerDown),this.floorPlan.off("dblclick",this.handlePointerDown),this.floorPlan.off("update-settings",this.draw),super.destroy()}}class C_ extends Rr{constructor({floorPlan:t,helperId:i,pos:r}){super({floorPlan:t,helperId:i}),this.pos=[0,0],this.floorPlan.on("mousemove",this.draw,this),this.isSnapping=!1,this.isEdge=!1,r&&(this.pos=r)}draw(){if(this.layer||(this.layer=this.floorPlan.addLayer({id:"fpe-snap-cursor"})),!this.cursor)this.cursor=this.layer.addGraphic({shapes:[{type:"circle",position:[0,0],radius:.06,style:{stroke:6789887,strokeWidth:1.5}}],pos:this.pos,scaleOnZoom:!0});else{const t=this.isSnapping?6789887:12303291,i=this.isSnapping?2:1.5;this.cursor.set({pos:this.pos,style:{stroke:t,strokeWidth:i}})}}set({pos:t,isSnapping:i,isEdge:r,node:n}){this.pos=t,this.isSnapping=i,this.isEdge=r,this.node=n,this.draw()}snapState(){return this.isSnapping?this.isEdge?"edge":"point":""}destroy(){this.floorPlan.off("mousemove",this.draw),this.layer&&this.layer.destroy(),this.layer=void 0,this.cursor=null,super.destroy()}}const S_={lastSceneClick:[0,0],cursor:[0,0],cursorTarget:null,isDragging:!1,altKey:!1,shiftKey:!1,metaKey:!1,ctrlKey:!1,dragOffset:null,cursorAction:"none",isPanning:!1,lastClick:{time:null,pos:{x:0,y:0}},_dragStart:{x:0,y:0}};class A_ extends n0{constructor({container:t,options:i={},scene:r}={}){super({options:i,scene:r}),this.interaction=S_,this.availableHelpers={cursorCoordinates:R0,scaleBar:M0},this.helper={},this.version=It.api.sdkVersion;let n;t instanceof Element?n=t:n=document.body,this.mountFloorPlan(n),this.availableHelpers.polygonHelper=I_,this.availableHelpers.snapCursor=C_}prevent(t){t.preventDefault()}on(t,i,r){return this._emitter.on(t,i,r),this}once(t,i,r){return this._emitter.once(t,i,r),this}off(t,i){return this._emitter.off(t,i),this}emit(t,...i){return this._emitter.emit(t,...i),this}handleDrop(t){var i;t.preventDefault(),t.stopPropagation();const r=[t.offsetX,t.offsetY],n=this.getPlanPosition(r);this.interaction.cursor=[...n];const{spaces:o}=this.getResourcesFromPosition(n),s=((i=o[0])==null?void 0:i.node.y)||0;this.emit("drop",{pos:n,sourceEvent:t,verticalPos:s})}set(t){super.set(t),this.view&&Xa({floorPlan:this,update:!0})}mountFloorPlan(t){const i=t.querySelector(".fpe");i&&i.remove();const r=document.createElement("div");r.id=this.fpeId,r.classList.add("fpe"),t.appendChild(r);const n=document.createElement("canvas");n.classList.add("fpe__plan"),r.appendChild(n),this.fpeNode=r,Mg(this.settings.api),this.view=new d_(this.loader,this.settings,this.fpeId),this.loader.on("product-load-stage",o=>q0(o,this)),this.loader.on("spaces-loaded",this.initDrawing,this),n.addEventListener("drop",this.handleDrop.bind(this)),n.addEventListener("gesturestart",this.prevent),n.addEventListener("gesturechange",this.prevent),n.addEventListener("gestureend",this.prevent),n.addEventListener("dragover",this.prevent),this.settings.destroyOnDomRemove&&o0(r,t,()=>this.destroy()),s_(this),this.view.on("scene-rendered",({update:o})=>{o||this.zoomExtents(1,0)}),this.view.on("zoom",()=>{this.view.layers.forEach(o=>{o.graphics.forEach(s=>{s.scaleOnZoom&&!s.gfx.destroyed&&s.set()})}),Tl(this)}),this.generateUi()}initDrawing(){this.loader.initialLoading||this.view.reset(),Xa({floorPlan:this}),this.loader.initialLoading&&this.initDrawingEvents()}initDrawingEvents(){this.scene.on("set",di,this),this.scene.on("set-transform",V0,this),this.scene.on("set-transient",di,this),this.scene.on("set-materials",di,this),this.scene.on("add-child",ka,this),this.scene.on("remove-child",ka,this)}generateUi(){this.settings.ui.coordinates?this.addHelper("cursorCoordinates",{parentEl:this.fpeNode}):this.helper.cursorCoordinates&&this.removeHelper("cursorCoordinates"),this.settings.ui.scale?this.addHelper("scaleBar",{parentEl:this.fpeNode}):this.helper.scaleBar&&this.removeHelper("scaleBar")}getSceneBoundingBox(t=0){var i;if(!((i=this.view)!=null&&i._viewport))return;let r=this.view.sceneContainer;if(!r)return;let{x:n,y:o,width:s,height:a}=r.getLocalBounds(),h=n/j-t,l=o/j-t,u=s/j+t*2,c=a/j+t*2;return{x:h,x2:h+u,z:l,z2:l+c,length:u,width:c}}getZoomExtentsBoundingBox(t,i,r,n,o,s,a){return K0({sceneBoundingBox:t,rectLeft:i,rectTop:r,rectRight:n,rectBottom:o,viewportWidth:s,viewportHeight:a})}zoomExtents(t=1,i=!1,r=null){return J0({margin:t,animate:i,floorPlan:this,boundingBox:r})}zoomToElement(t,i=1,r){const n=this.getElementBoundingBox(t,i);return br({bb:n,animate:r,view:this.view})}setZoom(t,i=!0){return br({bb:t,animate:i,view:this.view})}zoomByFactor(t,i=!0){if(!Number.isFinite(t)||t<=0)return Promise.reject("factor is not a positive number");let{x:r,z:n,length:o,width:s}=this.view.viewbox;const a=o/t,h=s/t;r-=(a-o)/2,n-=(h-s)/2;const l=r+o,u=n+s;return this.setZoom({x:r,z:n,length:a,width:h,x2:l,z2:u},i)}addInfoWindow(t={}){return new F0({...t,floorPlan:this})}addHtmlMarker(t={}){return new k0({...t,floorPlan:this})}addMarker({pos:t=[0,0],color:i="#669cff",size:r=40}={}){return new X0({pos:t,color:i,size:r,floorPlan:this})}getPlanPosition(t){const i=this.view._viewport.toWorld(t[0],t[1]);return[i.x/j,i.y/j]}getScreenPosition(t){const i=t.map(n=>n*j),r=this.view._viewport.toScreen(i[0],i[1]);return[r.x,r.y]}addLayer({id:t,baseLayer:i}={}){if(t||(t=be()),this.view.layers.has(t)){const n=this.view.layers.get(t);if(n!=null&&n.container)return n}const r=new Ga(this,i,t);return this.view.layers.set(t,r),r}getLayer(t){return this.view.layers.get(t)}addPlanGraphic(){return new Ga(this)}addHelper(t,i={}){let r=i==null?void 0:i.helperId;return r||(typeof t=="string"?r=t:r=be()),this.helper[r]&&this.removeHelper(r),typeof t=="string"?this.availableHelpers[t]?this.helper[r]=new this.availableHelpers[t]({floorPlan:this,helperId:r,...i}):console.warn(`No helper registered for: ${t}`):this.helper[r]=new t({floorPlan:this,helperId:r,...i}),this.helper[r]}removeHelper(t){var i,r;(r=(i=this.helper[t])==null?void 0:i.destroy)==null||r.call(i),delete this.helper[t]}async exportImage({format:t="png",fileName:i,quality:r=90,output:n="base64",maxWidth:o,download:s=!1}={}){let a={format:t,quality:r,output:n,maxWidth:o};s&&(a.format="png");const h=document.querySelector("#"+this.fpeId+" canvas"),l=await m_(h,a).catch(u=>u);if(s)y_(l,{format:t,fileName:i,quality:r});else return l}destroy(){var t;(t=this.view._viewport)==null||t.destroy(),this.view.reset(),this.loader.reset(),delete this.scene,delete this.resources,delete this.utils,this.fpeNode&&this.fpeNode.remove(),delete this.fpeNode}}async function O_(){const e=document.querySelector("#app");if(!e)return;const t="e9c82007-ae74-4b95-9174-8df619a08bd8",i="9efdcf08-9683-4aaa-8e46-242f26b61858",r=new A_({container:e,options:{ui:{coordinates:!0}}});await r.loadScene(t,{publishableAccessToken:i}),r.addLayer().addGraphic({shapes:r.resources.spaces.filter(o=>["work","meet"].includes(o.program||"")).map(o=>({type:"polygon",points:o.polygons[0],style:{stroke:o.program==="work"?"#ff5500":"#55ff99",strokeWidth:10}}))})}O_();
